if(define("base/event_emitter",[],function(){function t(){this._events={}}function e(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,i.prototype._onExtend&&i.prototype._onExtend(t),t.prototype._onInherit&&t.prototype._onInherit(i),t.extend=e}var i=Array.prototype.shift,o=/[ ,]+/;return t.prototype.on=t.prototype.addEventListener=function(t,e,i){var n,s=t.split(o),r=this._events;for(n=s.length;n--;)t=s[n],(r[t]||(r[t]=[])).push({listener:e,ctx:i||this});return this},t.prototype.once=t.prototype.addEventListenerOnce=function(t,e,i){function o(){n.off(t,o),e.apply(i,arguments)}var n=this;return i||(i=this),this.on(t,o,i)},t.prototype.listenTo=t.prototype.addEventListenerTo=function(e,i,o,n){if(!(e instanceof t))throw"Can't listen to Object, its not a instance of EventEmitter";return e.on(i,o,n||this),this},t.prototype.off=t.prototype.removeEventListener=function(t,e,i){var n,s,r,a,h=t.split(o),p=this._events;for(r=h.length;r--;){if(t=h[r],!t){for(r in p)p[r].length=0;return this}if(n=p[t],!n)return this;if(e){for(i||(i=this),a=n.length;a--;)if(s=n[a],s.listener===e&&s.ctx===i){n.splice(a,1);break}}else n.length=0}return this},t.prototype.emit=t.prototype.trigger=function(t){var e,o,n,s,r,a,h=this._events[t];if(!h||!h.length)return this;switch(arguments.length){case 1:for(a=h.length;a--;)(r=h[a]).listener.call(r.ctx);break;case 2:for(e=arguments[1],a=h.length;a--;)(r=h[a]).listener.call(r.ctx,e);break;case 3:for(e=arguments[1],o=arguments[2],a=h.length;a--;)(r=h[a]).listener.call(r.ctx,e,o);break;case 4:for(e=arguments[1],o=arguments[2],n=arguments[3],a=h.length;a--;)(r=h[a]).listener.call(r.ctx,e,o,n);break;case 5:for(e=arguments[1],o=arguments[2],n=arguments[3],s=arguments[4],a=h.length;a--;)(r=h[a]).listener.call(r.ctx,e,o,n,s);break;default:for(i.apply(arguments),a=h.length;a--;)(r=h[a]).listener.apply(r.ctx,arguments)}return this},t.extend=e,t}),define("base/class",["base/event_emitter"],function(t){function e(){t.call(this),this._id=++i,this._serverId=-1,this._SYNC={}}var i=0;return t.extend(e,t),e.prototype.clone=function(){return(new this.constructor).copy(this)},e.prototype.copy=function(){return this},e.prototype.toSYNC=function(t){return t||(t=this._SYNC),t._id=this._id,t},e.prototype.fromSYNC=function(){return this},e.prototype.toJSON=function(t){return t||(t={}),t._id=this._id,t},e.prototype.fromJSON=function(t){return this._serverId=t._id,this},e}),define("math/vec2",[],function(){function t(t,e){this.x=t||0,this.y=e||0}var e=Math.sqrt;return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},t.prototype.sadd=function(t){return this.x+=t,this.y+=t,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},t.prototype.ssub=function(t){return this.x-=t,this.y-=t,this},t.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this},t.prototype.smul=function(t){return this.x*=t,this.y*=t,this},t.prototype.div=function(t){var e=t.x,i=t.y;return this.x*=0!==e?1/e:0,this.y*=0!==i?1/i:0,this},t.prototype.vdiv=function(t,e){var i=e.x,o=e.y;return this.x=0!==i?t.x/i:0,this.y=0!==o?t.y/o:0,this},t.prototype.sdiv=function(t){return t=0===t?0:1/t,this.x*=t,this.y*=t,this},t.prototype.length=function(){var t=this.x,i=this.y,o=t*t+i*i;return 1===o?1:o>0?e(o):0},t.prototype.lengthSq=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.setLength=function(t){var i=this.x,o=this.y,n=i*i+o*o;return 1===n?(this.x*=t,this.y*=t,this):(n=n>0?1/e(n):0,this.x*=n*t,this.y*=n*t,this)},t.prototype.normalize=function(){var t=this.x,i=this.y,o=t*t+i*i;return 1===o?this:(o=o>0?1/e(o):0,this.x*=o,this.y*=o,this)},t.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this},t.prototype.inverseVec=function(t){return this.x=-t.x,this.y=-t.y,this},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},t.prototype.vlerp=function(t,e,i){var o=t.x,n=t.y;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this},t.vdot=t.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.vcross=t.prototype.vcross=function(t,e){return t.x*e.y-t.y*e.x},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.min=function(t){var e=this.x,i=this.y,o=t.x,n=t.y;return this.x=e>o?o:e,this.y=i>n?n:i,this},t.prototype.max=function(t){var e=this.x,i=this.y,o=t.x,n=t.y;return this.x=o>e?o:e,this.y=n>i?n:i,this},t.prototype.clamp=function(t,e){var i=this.x,o=this.y,n=t.x,s=t.y,r=e.x,a=e.y;return this.x=n>i?n:i>r?r:i,this.y=s>o?s:o>a?a:o,this},t.prototype.transformAngle=function(t){var e=this.x,i=this.y,o=cos(t),n=sin(t);return this.x=e*o-i*n,this.y=e*n+i*o,this},t.prototype.transformMat2=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[2],this.y=i*e[1]+o*e[3],this},t.prototype.untransformMat2=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[1],this.y=i*e[2]+o*e[3],this},t.prototype.transformMat32=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[2]+e[4],this.y=i*e[1]+o*e[3]+e[5],this},t.prototype.untransformMat32=function(t){var e=t.elements,i=this.x-e[4],o=this.y-e[5];return this.x=i*e[0]+o*e[1],this.y=i*e[2]+o*e[3],this},t.prototype.transformMat3=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[3]+e[6],this.y=i*e[1]+o*e[4]+e[7],this},t.prototype.transformMat4=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[4]+e[12],this.y=i*e[1]+o*e[5]+e[13],this},t.prototype.fromVec3=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.fromVec4=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.positionFromMat32=function(t){var e=t.elements;return this.x=e[4],this.y=e[5],this},t.prototype.positionFromMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this},t.prototype.scaleFromMat2=function(t){var e=t.elements,i=this.set(e[0],t[2]).length(),o=this.set(e[1],t[3]).length();return this.x=i,this.y=o,this},t.prototype.scaleFromMat32=t.prototype.scaleFromMat2,t.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.toJSON=function(t){return t||(t={}),t.x=this.x,t.y=this.y,t},t.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this},t.prototype.toArray=function(t){return t||(t=[]),t[0]=this.x,t[1]=this.y,t},t.prototype.toString=function(){return"Vec2( "+this.x+", "+this.y+" )"},t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/dynamic/particle",["base/class","math/vec2"],function(t,e){function i(i){i||(i={}),t.call(this),this._index=-1,this._type=h,this.space=void 0,this.position=void 0!==i.position?i.position:new e,this.velocity=void 0!==i.velocity?i.velocity:new e,this.force=new e,this.linearDamping=void 0!==i.linearDamping?i.linearDamping:0,this.motionState=void 0!==i.motionState?i.motionState:o,this.allowSleep=void 0!==i.allowSleep?i.allowSleep:!0,this.sleepState=r,this.mass=void 0!==i.mass?i.mass:0,this.invMass=this.mass>0?1/this.mass:0,this.vlambda=new e}var o,n,s,r,a,h;return t.extend(i,t),i.prototype.copy=function(t){return this.motionState=t.motionState,this.linearDamping=t.linearDamping,this.angularDamping=t.angularDamping,this.position.copy(t.position),this.velocity.copy(t.velocity),this.force.copy(t.force),this},i.prototype.init=function(){},i.prototype.update=function(t){if(this.motionState!==n){var e=this.force,i=this.invMass,o=this.position,s=this.velocity,r=pow(1-this.linearDamping,t);s.x+=e.x*i*t,s.y+=e.y*i*t,e.x=e.y=0,s.x*=r,s.y*=r,this.sleepState<a&&(o.x+=s.x*t,o.y+=s.y*t)}},i.prototype.setMotionState=function(t){this.motionState!==t&&(this.motionState=t,this.velocity.set(0,0),this.force.set(0,0),this.wake())},i.prototype.setMass=function(t){this.mass=t,this.invMass=t>0?1/t:0},i.prototype.isAwake=function(){return this.sleepState===r},i.prototype.isSleeping=function(){return this.sleepState===a},i.prototype.isDynamic=function(){return this.motionState===o},i.prototype.isStatic=function(){return this.motionState===n},i.prototype.isKinematic=function(){return this.motionState===s},i.prototype.wake=function(){this.sleepState>r&&this.emit("wake"),this.sleepState=r},i.prototype.sleep=function(){this.sleepState<a&&this.emit("sleep"),this.sleepState=a},i.prototype.toJSON=function(e){return e||(e={}),t.prototype.toJSON.call(this,e),e._type=this._type,e.position=this.position.toJSON(e.position),e.velocity=this.velocity.toJSON(e.velocity),e.force=this.force.toJSON(e.force),e.linearDamping=this.linearDamping,e.motionState=this.motionState,e.allowSleep=this.allowSleep,e.sleepState=this.sleepState,e.mass=this.mass,e.invMass=this.invMass,e.vlambda=this.vlambda.toJSON(e.vlambda),e},i.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.position.fromJSON(e.position),this.velocity.fromJSON(e.velocity),this.force.fromJSON(e.force),this.linearDamping=e.linearDamping,this.motionState=e.motionState,this.allowSleep=e.allowSleep,this.sleepState=e.sleepState,this.mass=e.mass,this.invMass=e.invMass,this.vlambda.fromJSON(e.vlambda),this},i.DYNAMIC=o=1,i.STATIC=n=2,i.KINEMATIC=s=3,i.AWAKE=r=4,i.SLEEPING=a=5,i.PARTICLE=h=6,i.RIGIDBODY=7,i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/collision/broadphase",["phys_2d/dynamic/particle"],function(t){function e(){}function i(t,e){return t.sleepState===s&&e.sleepState===s?!0:t.motionState>n&&e.motionState>n?!0:t.aabb&&e.aabb&&!t.aabb.intersects(e.aabb)?!0:!1}function o(t,e,i,o,n,s){return i||o?i?o?i.aabb.intersects(o.aabb)?(n.push(i),s.push(o),void 0):void 0:(n.push(i),s.push(e),void 0):(n.push(t),s.push(o),void 0):void 0}var n=t.DYNAMIC,s=t.SLEEPING;return e.prototype.collisions=function(t,e,n){var s,r,a,h,p,c,u,l,m,f,d,y,v=t.length;for(e.length=n.length=0,m=0;v>m;m++)for(f=0;f!==m;f++)if(s=t[m],r=t[f],!i(s,r))for(a=s.shapes,h=r.shapes,p=a.length,c=h.length,d=p;d--;)for(y=c;y--;)u=a[d],l=h[y],o(s,r,u,l,e,n)},e}),define("base/object_pool",[],function(){function t(t){this.pooled=[],this.objects=[],this.object=t}return t.prototype.create=function(){var t=this.pooled,e=t.length?t.pop():new this.object;return this.objects.push(e),e},t.prototype.removeObject=function(t){var e=this.objects,i=this.pooled,o=e.indexOf(t);return o>-1&&(i.push(t),e.splice(o,1)),this},t.prototype.remove=t.prototype.removeObjects=function(){for(var t=arguments.length;t--;)this.removeObject(arguments[t]);return this},t.prototype.clear=function(){var t,e=this.objects,i=this.pooled;for(t=e.length;t--;)i.push(e[t]);return e.length=0,this},t}),define("math/mathf",[],function(){function t(){this.PI=m,this.TWO_PI=f,this.HALF_PI=d,this.EPSILON=l,this.TO_RADS=y,this.TO_DEGS=v}var e,i,o,n,s,r=Math.random,a=Math.abs,h=Math.pow,p=Math.floor,c=Math.ceil,u=Math.atan2,l=1e-6,m=3.141592653589793,f=2*m,d=.5*m,y=m/180,v=180/m;t.prototype.acos=Math.acos,t.prototype.asin=Math.asin,t.prototype.atan=Math.atan,t.prototype.atan2=Math.atan2,t.prototype.cos=Math.cos,t.prototype.sin=Math.sin,t.prototype.tan=Math.tan,t.prototype.abs=Math.abs,t.prototype.ceil=Math.ceil,t.prototype.exp=Math.exp,t.prototype.floor=Math.floor,t.prototype.log=Math.log,t.prototype.max=Math.max,t.prototype.min=Math.min,t.prototype.pow=Math.pow,t.prototype.random=Math.random,t.prototype.round=Math.round,t.prototype.sqrt=Math.sqrt,t.prototype.equals=function(t,e,i){return a(t-e)<(i||l)},t.prototype.modulo=e=function(t,e){var i=t%e;return 0>i*e?i+e:i},t.prototype.standardRadian=o=function(t){return e(t,f)},t.prototype.standardAngle=n=function(t){return e(t,360)},t.prototype.sign=function(t){return t?0>t?-1:1:0},t.prototype.clamp=function(t,e,i){return e>t?e:t>i?i:t},t.prototype.clampBottom=function(t,e){return e>t?e:t},t.prototype.clampTop=function(t,e){return t>e?e:t},t.prototype.clamp01=i=function(t){return 0>t?0:t>1?1:t},t.prototype.truncate=function(t,e){var i=h(10,e),o=t*i;return(0>o?c(o):p(o))/i},t.prototype.lerp=function(t,e,i){return t+(e-t)*i},t.prototype.lerpAngle=function(t,e,i){return o(t+(e-t)*i)},t.prototype.smoothStep=function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},t.prototype.smootherStep=function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(6*t-15)+10))},t.prototype.pingPong=function(t,e){return e||(e=1),e-a(t%(2*e)-e)},t.prototype.degsToRads=function(t){return o(t*y)},t.prototype.radsToDegs=s=function(t){return n(t*v)},t.prototype.randInt=function(t,e){return~~(t+r()*(e+1-t))},t.prototype.randFloat=function(t,e){return t+r()*(e-t)},t.prototype.randChoice=function(t){return t[~~(r()*t.length)]},t.prototype.isPowerOfTwo=function(t){return(t&-t)===t},t.prototype.toPowerOfTwo=function(t){for(var e=2;t>e;)e*=2;return e};var g="right",x="up_right",b="up",w="up_left",S="left",_="down_left",O="down",N="down_right";return t.prototype.directionAngle=function(t){return t=s(t),t>337.5&&22.5>t?g:t>22.5&&67.5>t?x:t>67.5&&112.5>t?b:t>112.5&&157.5>t?w:t>157.5&&202.5>t?S:t>202.5&&247.5>t?_:t>247.5&&292.5>t?O:t>292.5&&337.5>t?N:g},t.prototype.direction=function(t,e){var i=s(u(e,t));return i>337.5&&22.5>i?g:i>22.5&&67.5>i?x:i>67.5&&112.5>i?b:i>112.5&&157.5>i?w:i>157.5&&202.5>i?S:i>202.5&&247.5>i?_:i>247.5&&292.5>i?O:i>292.5&&337.5>i?N:g},new t}),define("math/aabb2",["math/mathf","math/vec2"],function(t,e){function i(t,i){this.min=t||new e(1/0,1/0),this.max=i||new e(-1/0,-1/0)}return i.prototype.clone=function(){return new i(this.min.clone(),this.max.clone())},i.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.prototype.expandPoint=function(t){return this.min.min(t),this.max.max(t),this},i.prototype.expandVec=function(t){return this.min.sub(t),this.max.add(t),this},i.prototype.expandScalar=function(t){return this.min.ssub(t),this.max.sadd(t),this},i.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.prototype.clear=function(){return this.min.set(1/0,1/0),this.max.set(-1/0,-1/0),this},i.prototype.contains=function(t){var e=this.min,i=this.max,o=t.x,n=t.y;return!(o<e.x||o>i.x||n<e.y||n>i.y)},i.prototype.intersects=function(t){var e=this.min,i=this.max,o=t.min,n=t.max;return!(n.x<e.x||o.x>i.x||n.y<e.y||o.y>i.y)},i.prototype.fromPoints=function(t){for(var e,i,o,n=t.length,s=1/0,r=1/0,a=-1/0,h=-1/0,p=this.min,c=this.max;n--;)e=t[n],i=e.x,o=e.y,s=s>i?i:s,r=r>o?o:r,a=i>a?i:a,h=o>h?o:h;return p.x=s,p.y=r,c.x=a,c.y=h,this},i.prototype.fromCenterSize=function(t,e){var i=this.min,o=this.max,n=t.x,s=t.y,r=.5*e.x,a=.5*e.y;return i.x=n-r,i.y=s-a,o.x=n+r,o.y=s+a,this},i.prototype.fromJSON=function(t){return this.min.fromJSON(t.min),this.max.fromJSON(t.max),this},i.prototype.toJSON=function(t){return t||(t={}),t.min=this.min.toJSON(t.min),t.max=this.max.toJSON(t.max),t},i.prototype.toString=function(){var t=this.min,e=this.max;return"AABB2( min: "+t+", max: "+e+" )"},i}),define("math/mat32",[],function(){function t(t,e,i,o,n,s){var r=new Float32Array(6);this.elements=r,r[0]=void 0!==t?t:1,r[2]=e||0,r[4]=i||0,r[1]=o||0,r[3]=void 0!==n?n:1,r[5]=s||0}var e=Math.sqrt,i=Math.cos,o=Math.sin,n=Math.atan2;return t.prototype.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3],e[4],e[5])},t.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],this},t.prototype.set=function(t,e,i,o,n,s){var r=this.elements;return r[0]=t,r[2]=e,r[4]=i,r[1]=o,r[3]=n,r[5]=s,this},t.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[2],s=e[4],r=e[1],a=e[3],h=e[5],p=i[0],c=i[2],u=i[4],l=i[1],m=i[3],f=i[5];return e[0]=o*p+r*c,e[2]=n*p+a*c,e[1]=o*l+r*m,e[3]=n*l+a*m,e[4]=o*u+n*f+s,e[5]=r*u+a*f+h,this},t.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,s=o[0],r=o[2],a=o[4],h=o[1],p=o[3],c=o[5],u=n[0],l=n[2],m=n[4],f=n[1],d=n[3],y=n[5];return i[0]=s*u+h*l,i[2]=r*u+p*l,i[1]=s*f+h*d,i[3]=r*f+p*d,i[4]=s*m+r*y+a,i[5]=h*m+p*y+c,this},t.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,this},t.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,this},t.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this},t.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,this},t.prototype.determinant=function(){var t=this.elements;return t[0]*t[3]-t[2]*t[1]},t.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[2],o=t[4],n=t[1],s=t[3],r=t[5],a=e*s-i*n;return a=0!==a?1/a:0,t[0]=s*a,t[1]=-i*a,t[2]=-n*a,t[3]=e*a,t[4]=(i*r-s*o)*a,t[5]=(n*o-e*r)*a,this},t.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[2],s=i[4],r=i[1],a=i[3],h=i[5],p=o*a-n*r;return p=0!==p?1/p:0,e[0]=a*p,e[1]=-n*p,e[2]=-r*p,e[3]=o*p,e[4]=(n*h-a*s)*p,e[5]=(r*s-o*h)*p,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[2],e[2]=t,this},t.prototype.setTrace=function(t,e){var i=this.elements;return i[0]=t,i[3]=e,this},t.prototype.lookAt=function(t,e){var s=this.elements,r=e.x-t.x,a=e.y-t.y,h=n(a,r)-HALF_PI,p=i(h),c=o(h);return s[0]=p,s[1]=c,s[2]=-c,s[3]=p,this},t.prototype.compose=function(t,e,n){var s=this.elements,r=e.x,a=e.y,h=i(n),p=o(n);return s[0]=h*r,s[1]=p*r,s[2]=-p*a,s[3]=h*a,s[4]=t.x,s[5]=t.y,this},t.prototype.decompose=function(t,e){var i=this.elements,o=i[0],s=i[1],r=e.set(o,s).length(),a=e.set(i[2],i[3]).length();return t.x=i[4],t.y=i[5],e.x=r,e.y=a,n(s,o)},t.prototype.setRotation=function(t){var e=this.elements,n=i(t),s=o(t);return e[0]=n,e[1]=s,e[2]=-s,e[3]=n,this},t.prototype.getRotation=function(){var t=this.elements;return n(t[1],t[0])},t.prototype.setPosition=function(t){var e=this.elements;return e[4]=t.x,e[5]=t.y,this},t.prototype.getPosition=function(t){var e=this.elements;return t.x=e[4],t.y=e[5],t},t.prototype.extractPosition=function(t){var e=this.elements,i=t.elements;return e[4]=i[4],e[5]=i[5],this},t.prototype.extractRotation=function(t){var i=this.elements,o=t.elements,n=o[0],s=o[2],r=o[1],a=o[3],h=n*n+r*r,p=s*s+a*a,c=h>0?1/e(h):0,u=p>0?1/e(p):0;return i[0]=n*c,i[1]=r*c,i[2]=s*u,i[3]=a*u,this},t.prototype.translate=function(t){var e=this.elements,i=t.x,o=t.y;return e[4]=e[0]*i+e[2]*o+e[4],e[5]=e[1]*i+e[3]*o+e[5],this},t.prototype.rotate=function(t){var e=this.elements,i=e[0],n=e[2],s=e[1],r=e[3],a=o(t),h=o(t);return e[0]=i*h+n*a,e[1]=i*-a+n*h,e[2]=s*h+r*a,e[3]=s*-a+r*h,this},t.prototype.scale=function(t){var e=this.elements,i=t.x,o=t.y;return e[0]*=i,e[1]*=i,e[4]*=i,e[2]*=o,e[3]*=o,e[5]*=o,this},t.prototype.orthographic=function(t,e,i,o){var n=this.elements,s=1/(e-t),r=1/(o-i),a=(e+t)*s,h=(o+i)*r;return n[0]=2*s,n[1]=0,n[2]=0,n[3]=2*r,n[4]=-a,n[5]=-h,this},t.prototype.fromMat3=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[3],e[3]=i[4],e[4]=0,e[5]=0,this},t.prototype.fromMat4=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[4],e[3]=i[5],e[4]=i[11],e[5]=i[12],this},t.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],this},t.prototype.toJSON=function(t){t||(t={});var e=this.elements,i=t.elements||(t.elements=[]);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],t},t.prototype.toString=function(){var t=this.elements;return"Mat32[ "+t[0]+", "+t[2]+", "+t[4]+"]\n"+"     [ "+t[1]+", "+t[3]+", "+t[5]+"]"},t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/collision/shape",["base/class","math/vec2","math/aabb2","math/mat32","phys_2d/dynamic/particle"],function(t,e,i,o){function n(n){n||(n={}),t.call(this),this._type=-1,this.body=void 0,this.density=void 0!==n.density?n.density:1,this.localPosition=void 0!==n.localPosition?n.localPosition:new e,this.localRotation=void 0!==n.localRotation?n.localRotation:0,this.matrix=new o,this.position=new e,this.rotation=0,this.matrixWorld=new o,this.friction=void 0!==n.friction?n.friction:.25,this.elasticity=void 0!==n.elasticity?n.elasticity:.25,this.aabb=new i}return t.extend(n,t),n.prototype.copy=function(t){return this.density=t.density,this.localPosition.copy(t.localPosition),this.localRotation=t.localRotation,this.friction=t.friction,this.elasticity=t.elasticity,this},n.prototype.setLocalPosition=function(t){this.localPosition.copy(t),this.matrix.setPosition(t)},n.prototype.setLocalRotation=function(t){this.localRotation=t,this.matrix.setRotation(t)},n.prototype.pointQuery=function(){return!1},n.prototype.centroid=function(t){return t},n.prototype.area=function(){return 0},n.prototype.inertia=function(){return 0},n.prototype.update=function(){},n.prototype.toJSON=function(e){return e||(e={}),t.prototype.toJSON.call(this,e),e._type=this._type,e.density=this.density,e.localPosition=this.localPosition.toJSON(e.localPosition),e.localRotation=this.localRotation,e.matrix=this.matrix.toJSON(e.matrix),e.matrixWorld=this.matrixWorld.toJSON(e.matrixWorld),e.position=this.position.toJSON(e.position),e.rotation=this.rotation,e.friction=this.friction,e.elasticity=this.elasticity,e.aabb=this.aabb.toJSON(e.aabb),e},n.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.density=e.density,this.localPosition.fromJSON(e.localPosition),this.localRotation=e.localRotation,this.matrix.fromJSON(e.matrix),this.matrixWorld.fromJSON(e.matrixWorld),this.position.fromJSON(e.position),this.rotation=e.rotation,this.friction=e.friction,this.elasticity=e.elasticity,this.aabb.fromJSON(e.aabb),this},n.CIRCLE=1,n.SEGMENT=2,n.CONVEX=3,n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/solver/equation",[],function(){function t(){this.bi=void 0,this.bj=void 0,this.minForce=-1e6,this.maxForce=1e6,this.relaxation=5,this.stiffness=1e7,this.a=0,this.b=0,this.eps=0,this.lambda=0,this.B=0,this.invC=0}return t.prototype.updateConstants=function(t){var e=this.stiffness,i=this.relaxation;this.a=4/(t*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(t*t*e*(1+4*i))},t}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/solver/contact",["base/class","math/mathf","math/vec2","phys_2d/solver/equation"],function(t,e,i,o){function n(){o.call(this),this.p=new i,this.n=new i,this.s=0,this.e=1,this.u=0,this.ri=new i,this.rj=new i,this.rixn=0,this.rjxn=0}return Math.max,e.clamp,t.extend(n,o),n.prototype.init=function(t){var e=this.bi,i=this.bj,o=this.p,n=o.x,s=o.y,r=this.n,a=r.x,h=r.y,p=e.position,c=i.position,u=this.ri,l=n-p.x,m=s-p.y,f=this.rj,d=n-c.x,y=s-c.y,v=l*h-m*a,g=d*h-y*a;u.x=l,u.y=m,f.x=d,f.y=y,this.rixn=v,this.rjxn=g,this.lambda=0,this.calculateB(t),this.calculateC()},n.prototype.calculateB=function(t){var e=this.bi,i=this.bj,o=this.n,n=o.x,s=o.y,r=e.velocity,a=e.angularVelocity||0,h=e.force,p=e.torque||0,c=e.invMass,u=e.invInertia||0,l=i.velocity,m=i.angularVelocity||0,f=i.force,d=i.torque||0,y=i.invMass,v=i.invInertia||0,g=this.ri,x=g.x,b=g.y,w=this.rj,S=w.x,_=w.y,O=1+this.e,N=this.s,z=l.x+-m*_-r.x- -a*b,C=l.y+m*S-r.y-a*x,A=O*z*n+O*C*s,E=f.x*y+-d*v*_-h.x*c- -p*u*b,J=f.y*y+d*v*S-h.y*c-p*u*x,M=E*n+J*s;this.B=-this.a*N-this.b*A-t*M},n.prototype.calculateC=function(){var t=this.bi,e=this.bj,i=this.rixn,o=this.rjxn,n=t.invInertia||0,s=e.invInertia||0,r=t.invMass+e.invMass+this.eps+n*i*i+s*o*o;this.invC=0===r?0:1/r},n.prototype.calculateGWlambda=function(){var t=this.bi,e=this.bj,i=this.n,o=t.vlambda,n=t.wlambda||0,s=e.vlambda,r=e.wlambda||0,a=s.x-o.x,h=s.y-o.y,p=a*i.x+h*i.y;return void 0!==n&&(p-=n*this.rixn),void 0!==r&&(p+=r*this.rjxn),p},n.prototype.addToLambda=function(t){var e=this.bi,i=this.bj,o=this.n,n=o.x,s=o.y,r=e.invMass,a=e.vlambda,h=i.invMass,p=i.vlambda;a.x-=t*r*n,a.y-=t*r*s,p.x+=t*h*n,p.y+=t*h*s,void 0!==e.wlambda&&(e.wlambda-=t*e.invInertia*this.rixn),void 0!==i.wlambda&&(i.wlambda+=t*i.invInertia*this.rjxn)},n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/collision/nearphase",["base/object_pool","math/mathf","math/aabb2","phys_2d/dynamic/particle","phys_2d/collision/shape","phys_2d/solver/contact"],function(t,e,i,o,n,s){function r(t,e,i,o,n,s,r,a,h,p){var c=_.create(),u=c.p,l=c.n;u.x=t,u.y=e,l.x=i,l.y=o,c.s=n,c.bi=s,c.bj=r,c.e=a,c.u=h,p.push(c)}function a(){}function h(t,e,i,o,n,s,a,h,p){var c,u,l,m,f=a+h,d=n-i,y=s-o,b=d*d+y*y;b>f*f||(x>b?(u=0,l=1,m=-f):(b=g(b),c=1/b,u=d*c,l=y*c,m=b-f),r(n-h*u,s-h*l,u,l,m,t.body,e.body,v(t.elasticity,e.elasticity),v(t.friction,e.friction),p))}function p(t,e,i){var o=t.position,n=e.position;h(t,e,o.x,o.y,n.x,n.y,t.radius,e.radius,i)}function c(t,e,i){var o,n,s,a,p,c,u,l,m,f,d,y,g,x,b,w,S,_,O=t._vertices,N=t._normals,z=O.length,C=e.position,A=C.x,E=C.y,J=e.radius,b=-1/0,M=0;for(_=z;_--;){if(o=O[_],n=N[_],s=n.x*(A-o.x)+n.y*(E-o.y),s>J)return;s>b&&(b=s,M=_)}return n=N[M],w=n.x,S=n.y,a=O[M],c=a.x,u=a.y,p=O[(M+1)%z],l=p.x,m=p.y,f=l-c,d=m-u,y=A-c,g=E-u,x=(f*y+d*g)/(f*f+d*d),0>x?(h(t,e,c,u,A,E,0,J,i),void 0):x>1?(h(t,e,l,m,A,E,0,J,i),void 0):(r(A-J*w,E-J*S,w,S,b-J,t.body,e.body,v(t.elasticity,e.elasticity),v(t.friction,e.friction),i),void 0)}function u(t,e,i){var o,n,s,r;o=f(t,e),0>o||(n=O,s=f(e,t),0>s||(r=O,n>r?l(t,e,t._normals[o],n,i):l(e,t,e._normals[s],r,i)))}function l(t,e,i,o,n){var s,a,h,p,c=t._vertices,u=t._normals,l=e._vertices,f=e._normals,d=i.x,y=i.y,g=t.body,x=e.body,b=v(t.elasticity,e.elasticity),w=v(t.friction,e.friction);for(p=c.length;p--;)s=c[p],a=s.x,h=s.y,m(l,f,a,h)&&r(a,h,d,y,o,g,x,b,w,n);for(p=l.length;p--;)s=l[p],a=s.x,h=s.y,m(c,u,a,h)&&r(a,h,d,y,o,g,x,b,w,n)}function m(t,e,i,o){var n,s,r,a,h,p,c;for(c=t.length;c--;)if(n=e[c],s=n.x,r=n.y,a=t[c],h=a.x,p=a.y,s*i+r*o-(s*h+r*p)>0)return!1;return!0}function f(t,e){var i,o,n,s,r=t._vertices,a=t._normals,h=a.length,p=e._vertices,c=-1/0,u=-1;for(s=h;s--;){if(i=a[s],o=r[s],n=d(p,i,i.x*o.x+i.y*o.y),n>0)return-1;n>c&&(c=n,u=s)}return O=c,u}function d(t,e,i){var o,n,s=e.x,r=e.y,a=1/0;for(n=t.length;n--;)o=t[n],a=v(a,s*o.x+r*o.y);return a-i}function y(t,e,i){if(t._type!==b||e._type!==b)if(t._type===b&&e._type!==b);else if(e._type===b&&t._type!==b);else if(t._type===w)switch(e._type){case w:p(t,e,i);break;case S:c(e,t,i)}else if(t._type===S)switch(e._type){case w:c(t,e,i);break;case S:u(t,e,i)}}var v=Math.min,g=Math.sqrt,x=e.EPSILON,b=o.PARTICLE,w=n.CIRCLE,S=n.CONVEX,_=new t(s);a.prototype.collisions=function(t,e,i){var o,n,s;for(i.length=0,_.clear(),s=t.length;s--;)o=t[s],n=e[s],y(o,n,i)},a.CONTACT_POOL=_;var O=0;return a}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/collision/circle",["base/class","phys_2d/collision/shape"],function(t,e){function i(t){t||(t={}),e.call(this,t),this._type=o,this.radius=void 0!==t.radius?t.radius:.5,this.innerRadius=void 0!==t.innerRadius?t.innerRadius:0}var o=e.CIRCLE,n=Math.PI;return t.extend(i,e),i.prototype.copy=function(t){return this.density=t.density,this.localPosition.copy(t.localPosition),this.localRotation=t.localRotation,this.friction=t.friction,this.elasticity=t.elasticity,this.radius=t.radius,this.innerRadius=t.innerRadius,this},i.prototype.pointQuery=function(t){var e=this.position,i=e.x-t.x,o=e.y-t.y,n=i*i+o*o,s=this.radius,r=this.innerRadius;return n>s*s?!1:n>r*r},i.prototype.centroid=function(t){var e=this.localPosition;return t.x=e.x,t.y=e.y,t},i.prototype.area=function(){var t=this.radius,e=this.innerRadius;return n*(t*t-e*e)},i.prototype.inertia=function(t){var e=this.radius,i=this.innerRadius,o=this.localPosition,n=o.x,s=o.y;return t*(.5*(e*e+i*i)+(n*n+s*s))},i.prototype.update=function(t){var e,i,o=this.matrix,n=this.matrixWorld,s=this.localPosition,r=this.position,a=this.radius,h=this.aabb,p=h.min,c=h.max;n.mmul(t,o),r.x=s.x,r.y=s.y,r.transformMat32(t),e=r.x,i=r.y,p.x=e-a,p.y=i-a,c.x=e+a,c.y=i+a},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/collision/convex",["base/class","math/vec2","phys_2d/collision/shape"],function(t,e,i){function o(t){if(t||(t={}),i.call(this,t),this._type=n,this.vertices=[],this.normals=[],this._vertices=[],this._normals=[],t.extents){var o=t.extents,s=o.x,r=o.y;this.setVertices([new e(s,r),new e(-s,r),new e(-s,-r),new e(s,-r)])}else t.vertices&&this.setVertices(t.vertices)}var n=i.CONVEX;t.extend(o,i),o.prototype.copy=function(t){var i,o=t.vertices,n=t.normals;for(this.density=t.density,this.localPosition.copy(t.localPosition),this.localRotation=t.localRotation,this.friction=t.friction,this.elasticity=t.elasticity,this.vertices.length=this.normals.length=this._vertices.length=this._normals.length=o.length,i=o.length;i--;)(this.vertices[i]||(this.vertices[i]=new e)).copy(o[i]),(this.normals[i]||(this.normals[i]=new e)).copy(n[i]);return this},o.prototype.setVertices=function(t){s(t)||(console.warn("Convex.setVertices: passed vertices are invalid, creating convex hull from vertices with gift wrapping algorithm"),t=r(t));var i,o,n,a=this._vertices,h=t.length,p=this.normals,c=this._normals,u=this.matrixWorld;for(n=h;n--;)i=t[n],o=t[(n+1)%h],p[n]=(p[n]||new e).set(o.y-i.y,-(o.x-i.x)).normalize(),a[n]=(a[n]||new e).copy(i).transformMat32(u),c[n]=(c[n]||new e).copy(p[n]).transformMat2(u);return this.vertices=t,this},o.prototype.pointQuery=function(t){if(!this.aabb.contains(t))return!1;var e,i,o,n,s,r,a,h=this._vertices,p=this._normals,c=t.x,u=t.y;for(a=h.length;a--;)if(e=p[a],i=e.x,o=e.y,n=h[a],s=n.x,r=n.y,i*c+o*u-(i*s+o*r)>0)return!1;return!0},o.prototype.centroid=function(){var t=new e,i=new e,o=new e;return function(e){var n,s,r,a,h,p,c,u=this.localPosition,l=this.vertices,m=l.length,f=0;for(o.x=o.y=0,c=m;c--;)t.vadd(u,l[c]),i.vadd(u,l[(c+1)%m]),n=t.x,s=t.y,r=i.x,a=i.y,h=n*a-s*r,f+=h,o.x+=(n+r)*h,o.y+=(s+a)*h;return p=1/(3*f),e.x=o.x*p,e.y=o.y*p,e}}(),o.prototype.area=function(){var t,e,i,o=this.vertices,n=o.length,s=0;for(i=n;i--;)t=o[i],e=o[(i+1)%n],s+=t.x*e.y-t.y*e.x;return.5*s},o.prototype.inertia=function(){var t=new e,i=new e;return function(e){var o,n,s,r,a,h=this.localPosition,p=this.vertices,c=p.length,u=0,l=0,m=0,f=0;for(a=c;a--;)t.vadd(h,p[a]),i.vadd(h,p[(a+1)%c]),o=t.x,n=t.y,s=i.x,r=i.y,u=s*n-r*o,l=o*o+n*n+(o*s+n*r)+(s*s+r*r),m+=u*l,f+=u;return e*m/(6*f)}}(),o.prototype.update=function(t){var i,o,n,s,i,o,r,a=this.matrix,h=this.matrixWorld,p=this.localPosition,c=this.vertices,u=this.normals,l=this.position,m=(this.radius,this.aabb),f=m.min,d=m.max,y=1/0,v=1/0,g=-1/0,x=-1/0,b=this._normals,w=this._vertices;for(h.mmul(t,a),l.x=p.x,l.y=p.y,l.transformMat32(t),r=c.length;r--;)s=w[r]||(w[r]=new e),n=b[r]||(b[r]=new e),n.copy(u[r]).transformMat2(h),s.copy(c[r]).transformMat32(h),i=s.x,o=s.y,y=y>i?i:y,v=v>o?o:v,g=i>g?i:g,x=o>x?o:x;f.x=y,f.y=v,d.x=g,d.y=x},o.prototype.toJSON=function(t){t||(t={}),i.prototype.toJSON.call(this,t);var e,o=this.vertices,n=t.vertices||(t.vertices=[]);for(e=o.length;e--;)n[e]=o[e].toJSON(n[e]);return t},o.prototype.fromJSON=function(t){i.prototype.fromJSON.call(this,t);var o,n=t.vertices||(t.vertices=[]);for(o=n.length;o--;)n[o]=(new e).fromJSON(n[o]);return this.setVertices(n),this};var s=o.validateVertices=function(t){var e,i,o,n,s,r,a,h,p,c,u=t.length;for(c=0;u>c;c++)if(e=t[c],i=t[(c+1)%u],o=i.x,n=i.y,s=t[(c+2)%u],r=o-e.x,a=n-e.y,h=s.x-o,p=s.y-n,h*a-p*r>0)return!1;return!0},r=o.createConvexHull=function(){var t=[],i=new e;return new e,function(n){var s,r,a,h,p,c,u,l=0,m=-1/0,f=n.length,d=0,y=[],v=!1;for(u=f;u--;)s=n[u],r=s.x,a=s.y,(r>m||r==m&&a<n[l].y)&&(l=u,m=r);for(t.length=0,h=l;;){for(t[d]=h,p=0,u=1;f>u;u++)p!==h?(i.vsub(n[p],n[t[d]]),s.vsub(n[u],n[t[d]]),c=s.cross(i),0>c&&(p=u),0===c&&s.lenSq()>i.lenSq()&&(p=u)):p=u;if(d++,h=p,d>f){v=!0;break}if(p===l)break}if(v)return console.warn("Convex.constructor: gift wrapping algorithm failed"),[new e(.5,.5),new e(-.5,.5),new e(-.5,-.5),new e(.5,-.5)];
for(u=d;u--;)y.push(n[t[u]]);return o.validateVertices(y)?y:(console.warn("Convex.constructor: gift wrapping algorithm failed"),[new e(.5,.5),new e(-.5,.5),new e(-.5,-.5),new e(.5,-.5)])}}();return o}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/collision/segment",["base/class","phys_2d/collision/shape"],function(t,e){function i(t){t||(t={}),e.call(this,t),this._type=o,this.length=void 0!==t.length?t.length:.5,this.radius=void 0!==t.radius?t.radius:.25,this.normal=new Vec2(1,0)}var o=e.SEGMENT,n=Math.PI,s=1/12;return t.extend(i,e),i.prototype.copy=function(t){return this.density=t.density,this.localPosition.copy(t.localPosition),this.localRotation=t.localRotation,this.friction=t.friction,this.elasticity=t.elasticity,this.length=t.length,this.radius=t.radius,this.normal.copy(t.normal),this},i.prototype.pointQuery=function(){return!1},i.prototype.centroid=function(t){var e=this.localPosition;return t.x=e.x,t.y=e.y,t},i.prototype.area=function(){var t=this.radius;return t*(n*t+2*this.length)},i.prototype.inertia=function(t){var e=this.radius,i=this.length+e+e,o=this.localPosition,n=o.x,r=o.y;return t*(i*i*s+(n*n+r*r))},i.prototype.update=function(t){var e,i,o,n,s=this.matrix,r=this.matrixWorld,a=this.localPosition,h=this.position,p=this.normal,c=this.radius,u=.5*this.length,l=this.aabb,m=l.min,f=l.max;r.mmul(t,s),p.transformMat2(t),o=-p.y*u,n=p.x*u,h.x=a.x,h.y=a.y,h.transformMat32(t),e=h.x,i=h.y,m.x=e-(o-c),m.y=i-(n-c),f.x=e+(o+c),f.y=i+(n+c)},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/dynamic/rigid_body",["base/class","math/vec2","math/aabb2","math/mat32","phys_2d/dynamic/particle","phys_2d/collision/shape","phys_2d/collision/circle","phys_2d/collision/segment","phys_2d/collision/convex"],function(t,e,i,o,n,s,r,a,h){function p(t){if(t||(t={}),n.call(this,t),this._type=c,this.matrix=new o,this.rotation=void 0!==t.rotation?t.rotation:0,this.angularVelocity=void 0!==t.angularVelocity?t.angularVelocity:0,this.torque=0,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:0,this.inertia=0,this.invInertia=0,this.shapes=[],this._shapeHash={},this.aabb=new i,this.wlambda=0,t.shapes){var e,s=t.shapes;for(e=s.length;e--;)this.addShape(s[e])}}var c=n.RIGIDBODY,u=n.DYNAMIC,l=n.STATIC,m=n.AWAKE,f=n.SLEEPING,d=Math.pow,y={};return y[s.CIRCLE]=r,y[s.SEGMENT]=a,y[s.CONVEX]=h,t.extend(p,n),p.prototype.copy=function(t){var e,i=t.shapes;for(this.motionState=t.motionState,this.linearDamping=t.linearDamping,this.angularDamping=t.angularDamping,this.position.copy(t.position),this.velocity.copy(t.velocity),this.force.copy(t.force),this.rotation=t.rotation,this.angularVelocity=t.angularVelocity,this.torque=t.torque,e=i.length;e--;)this.addShape(i[e].clone());return t.space&&t.space.addBody(this),this},p.prototype.init=function(){var t,e,i=this.shapes,o=this.aabb,n=this.matrix;for(n.setRotation(this.rotation),n.setPosition(this.position),e=i.length;e--;)t=i[e],t.update(n),o.union(t.aabb);this.resetMassData()},p.prototype.update=function(t){if(this.motionState!==l){var e,i,o=this.shapes,n=this.force,s=this.invMass,r=this.position,a=this.velocity,h=d(1-this.linearDamping,t),p=this.matrix,c=this.aabb;if(a.x+=n.x*s*t,a.y+=n.y*s*t,this.angularVelocity+=this.torque*this.invInertia*t,n.x=n.y=this.torque=0,a.x*=h,a.y*=h,this.angularVelocity*=d(1-this.angularDamping,t),this.sleepState<f)for(r.x+=a.x*t,r.y+=a.y*t,this.rotation+=this.angularVelocity*t,p.setRotation(this.rotation),p.setPosition(r),i=o.length;i--;)e=o[i],e.update(p),c.union(e.aabb)}},p.prototype.applyForce=function(t,e){if(this.motionState!==l){var i,o,n=this.position,s=this.force,r=t.x,a=t.y;e=e||n,this.sleepState>m&&this.wake(),i=e.x-n.x,o=e.y-n.y,s.x+=r,s.y+=a,this.torque+=i*a-o*r}},p.prototype.applyTorque=function(t){this.motionState!==l&&(this.sleepState>m&&this.wake(),this.torque+=t)},p.prototype.applyImpulse=function(t,e){if(this.motionState!==l){var i,o,n=this.position,s=this.invMass,r=this.velocity,a=t.x,h=t.y;e=e||n,this.sleepState>m&&this.wake(),i=e.x-n.x,o=e.y-n.y,r.x+=a*s,r.y+=h*s,this.angularVelocity+=(i*h-o*a)*this.invInertia}},p.prototype.resetMassData=function(){var t=new e;return function(){if(!(this.motionState>u)){var e,i,o=this.shapes,n=0,s=0,r=0,a=0,h=0,p=0,c=0,l=0;for(i=o.length;i--;)e=o[i],e.centroid(t),r=e.area()*e.density,h+=t.x*r,p+=t.y*r,n+=r,s+=e.inertia(r);a=n>0?1/n:0,c=h*a,l=p*a,this.setMass(n),this.setInertia(s-n*(c*c+l*l))}}}(),p.prototype.setMotionState=function(t){this.motionState!==t&&(this.motionState=t,this.velocity.set(0,0),this.force.set(0,0),this.angularVelocity=this.torque=0,this.wake())},p.prototype.setInertia=function(t){this.inertia=t,this.invInertia=t>0?1/t:0},p.prototype.addShape=function(t){var e=this.shapes,i=e.indexOf(t);0>i&&(t.body=this,e.push(t),this._shapeHash[t._id]=t,this.space&&(t.update(this.matrix),this.resetMassData()))},p.prototype.removeShape=function(t){var e=this.shapes,i=e.indexOf(t);i>-1&&(t.body=void 0,e.splice(i,1),delete this._shapeHash[t._id],this.space&&this.resetMassData())},p.prototype.toJSON=function(t){t||(t={}),n.prototype.toJSON.call(this,t);var e,i=this.shapes,o=t.shapes||(t.shapes=[]);for(t.matrix=this.matrix.toJSON(t.matrix),t.rotation=this.rotation,t.angularVelocity=this.angularVelocity,t.torque=this.torque,t.angularDamping=this.angularDamping,t.inertia=this.inertia,t.invInertia=this.invInertia,t.aabb=this.aabb.toJSON(t.aabb),t.wlambda=this.wlambda,e=i.length;e--;)o[e]=i[e].toJSON(o[e]);return t},p.prototype.fromJSON=function(t){n.prototype.fromJSON.call(this,t);var e,i,o=this.shapes,s=t.shapes||(t.shapes=[]);for(this.matrix.fromJSON(t.matrix),this.rotation=t.rotation,this.angularVelocity=t.angularVelocity,this.torque=t.torque,this.angularDamping=t.angularDamping,this.inertia=t.inertia,this.invInertia=t.invInertia,this.aabb.fromJSON(t.aabb),this.wlambda=t.wlambda,i=s.length;i--;)e=y[s[i]._type],e&&(o[i]=(new e).fromJSON(s[i]));return this},p}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/solver/solver",["base/class","math/mathf"],function(t,e){function i(t,e){this.iterations=void 0!==t?t:10,this.tolerance=void 0!==e?e:1e-6}var o=e.clamp;return i.prototype.solve=function(t,e){var i,n,s,r,a,h,p,c,u,l=e.length,m=this.iterations,f=this.tolerance,d=f*f,y=0,v=0,g=0,x=0;for(c=l;c--;)i=e[c],i.updateConstants(t),i.init(t);for(c=m;c--;){for(y=0,u=l;u--;)i=e[u],v=i.calculateGWlambda(),g=i.lambda,x=i.invC*(i.B-v-i.eps*g),i.lambda=o(g+x,i.minForce,i.maxForce),x=i.lambda-g,i.addToLambda(x),y+=x;if(d>y*y)break}for(c=l;c--;)i=e[c],n=i.bi,r=n.velocity,h=n.vlambda,s=i.bj,a=s.velocity,p=s.vlambda,r.x+=h.x,r.y+=h.y,a.x+=p.x,a.y+=p.y,h.x=h.y=p.x=p.y=0,void 0!==n.wlambda&&(n.angularVelocity+=n.wlambda,n.wlambda=0),void 0!==s.wlambda&&(s.angularVelocity+=s.wlambda,s.wlambda=0)},i}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/solver/friction",["base/class","math/mathf","math/vec2","phys_2d/solver/equation"],function(t,e,i,o){function n(){o.call(this),this.p=new i,this.t=new i,this.ri=new i,this.rj=new i,this.rixt=0,this.rjxt=0}return Math.max,e.clamp,t.extend(n,o),n.prototype.init=function(t){var e=this.bi,i=this.bj,o=this.p,n=o.x,s=o.y,r=this.t,a=r.x,h=r.y,p=e.position,c=i.position,u=this.ri,l=n-p.x,m=s-p.y,f=this.rj,d=n-c.x,y=s-c.y,v=l*h-m*a,g=d*h-y*a;u.x=l,u.y=m,f.x=d,f.y=y,this.rixt=v,this.rjxt=g,this.lambda=0,this.calculateB(t),this.calculateC()},n.prototype.calculateB=function(t){var e=this.bi,i=this.bj,o=this.t,n=o.x,s=o.y,r=e.velocity,a=e.angularVelocity||0,h=e.force,p=e.torque||0,c=e.invMass,u=e.invInertia||0,l=i.velocity,m=i.angularVelocity||0,f=i.force,d=i.torque||0,y=i.invMass,v=i.invInertia||0,g=this.ri,x=g.x,b=g.y,w=this.rj,S=w.x,_=w.y,O=0,N=l.x+-m*_-r.x- -a*b,z=l.y+m*S-r.y-a*x,C=N*n+z*s,A=f.x*y+-d*v*_-h.x*c- -p*u*b,E=f.y*y+d*v*S-h.y*c-p*u*x,J=A*n+E*s;this.B=-this.a*O-this.b*C-t*J},n.prototype.calculateC=function(){var t=this.bi,e=this.bj,i=this.rixt,o=this.rjxt,n=t.invInertia||0,s=e.invInertia||0,r=t.invMass+e.invMass+this.eps+n*i*i+s*o*o;this.invC=0===r?0:1/r},n.prototype.calculateGWlambda=function(){var t=this.bi,e=this.bj,i=this.t,o=t.vlambda,n=t.wlambda||0,s=e.vlambda,r=e.wlambda||0,a=s.x-o.x,h=s.y-o.y,p=a*i.x+h*i.y;return void 0!==n&&(p-=n*this.rixt),void 0!==r&&(p+=r*this.rjxt),p},n.prototype.addToLambda=function(t){var e=this.bi,i=this.bj,o=this.t,n=o.x,s=o.y,r=e.invMass,a=e.vlambda,h=i.invMass,p=i.vlambda;a.x-=t*r*n,a.y-=t*r*s,p.x+=t*h*n,p.y+=t*h*s,void 0!==e.wlambda&&(e.wlambda-=t*e.invInertia*this.rixt),void 0!==i.wlambda&&(i.wlambda+=t*i.invInertia*this.rjxt)},n}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/dynamic/space",["base/class","base/object_pool","math/vec2","phys_2d/dynamic/particle","phys_2d/collision/broadphase","phys_2d/collision/nearphase","phys_2d/solver/solver","phys_2d/solver/friction"],function(t,e,i,o,n,s,r,a){function h(t,e){var i,o,n=t.bi,s=t.bj,r=m.create(),a=t.u,h=a*t.lambda,p=t.p,c=t.n;r.minForce=-h,r.maxForce=h,r.bi=n,r.bj=s,i=r.p,i.x=p.x,i.y=p.y,o=r.t,o.x=c.y,o.y=-c.x,r.minForce=-h,r.maxForce=h,e.push(r)}function p(){t.call(this),this.gravity=new i(0,-9.801),this.time=0,this.stats={step:0,solve:0,integrate:0,nearphase:0,broadphase:0},this.broadphase=new n,this.nearphase=new s,this.solver=new r,this.bodies=[],this._bodyHash={},this._pairsi=[],this._pairsj=[],this._contacts=[],this._frictions=[]}Date.now||(Date.now=function(){return(new Date).getTime()});var c=o.DYNAMIC,u=Date.now(),l=function(){var t="undefined"!=typeof window?window:{},e="undefined"!=typeof t.performance?t.performance:{};return e.now=e.now||e.webkitNow||e.mozNow||e.msNow||e.oNow||function(){return Date.now()-u},function(){return e.now()}}(),m=new e(a);return t.extend(p,t),p.prototype.findBodyByPoint=function(t){var e,i,o,n,s,r=this.bodies,a=void 0;for(n=r.length;n--;)if(e=r[n])for(i=e.shapes,s=i.length;s--;)if(o=i[s],o&&o.pointQuery(t)){a=e;break}return a},p.prototype.getBodyById=function(t){return this._bodyHash[t]},p.prototype.addBody=function(t){if(!t)return console.log("Phys2D.Space.addBody: passed argumenet is not a valid body"),this;var e=this.bodies,i=e.indexOf(t);return 0>i?(t.space&&t.space.removeBody(t),t.space=this,e.push(t),this._bodyHash[t._id]=t,t.init()):console.log("Phys2D.Space.addBody: body is already a member of this"),this},p.prototype.removeBody=function(t){var e=this.bodies,i=e.indexOf(t);i>-1?(t.space=void 0,e.splice(i,1),delete this._bodyHash[t._id]):console.log("Phys2D.Space.removeBody: body is not a member of this")},p.prototype.step=function(t){var e,i,o,n,s,r,a,p=l(),u=this.stats,f=this.gravity,d=f.x,y=f.y,v=this.bodies,g=v.length,x=this._pairsi,b=this._pairsj,w=this._contacts,S=this.solver,_=this._frictions;for(s=this.time+=t,e=l(),a=g;a--;)i=v[a],i.motionState>c||(o=i.force,n=i.mass,o.x+=d*n,o.y+=y*n);for(u.integrate=l()-e,e=l(),this.broadphase.collisions(v,x,b),u.broadphase=l()-e,e=l(),this.nearphase.collisions(x,b,w),u.nearphase=l()-e,e=l(),S.solve(t,w),m.clear(),_.length=0,a=w.length;a--;)r=w[a],r.u>0&&h(r,_);for(S.solve(t,_),u.solve=l()-e,e=l(),a=g;a--;)v[a].update(t);u.integrate+=l()-e,u.step=l()-p},p}),"function"!=typeof define)var define=require("amdefine")(module);if(define("phys_2d/phys_2d",["require","phys_2d/collision/broadphase","phys_2d/collision/nearphase","phys_2d/collision/circle","phys_2d/collision/convex","phys_2d/collision/segment","phys_2d/collision/shape","phys_2d/dynamic/particle","phys_2d/dynamic/rigid_body","phys_2d/dynamic/space","phys_2d/solver/contact","phys_2d/solver/equation","phys_2d/solver/friction","phys_2d/solver/solver"],function(t){function e(){this.Broadphase=t("phys_2d/collision/broadphase"),this.Nearphase=t("phys_2d/collision/nearphase"),this.Circle=t("phys_2d/collision/circle"),this.Convex=t("phys_2d/collision/convex"),this.Segment=t("phys_2d/collision/segment"),this.Shape=t("phys_2d/collision/shape"),this.Particle=t("phys_2d/dynamic/particle"),this.Rigidbody=t("phys_2d/dynamic/rigid_body"),this.Space=t("phys_2d/dynamic/space"),this.Contact=t("phys_2d/solver/contact"),this.Equation=t("phys_2d/solver/equation"),this.Friction=t("phys_2d/solver/friction"),this.Solver=t("phys_2d/solver/solver")}return new e}),define("core/game/config",[],function(){function t(){this.debug=!1,this.forceCanvas=!1,this.renderer="",this.host="127.0.0.1",this.port=3e3,this.MAX_SERVER_STATES=10,this.SCENE_SYNC_RATE=.5,this.MIN_DELTA=1e-6,this.MAX_DELTA=1}return t.prototype.fromJSON=function(t){for(var e in t)void 0!=this[e]&&(this[e]=t[e]);return this},new t}),define("core/game/log",["core/game/config"],function(t){function e(){}var i=Object.prototype.hasOwnProperty;return e.prototype.debug=e.prototype.info=e.prototype.log=function(){t.debug&&console.log.apply(console,arguments)},e.prototype.warn=function(){t.debug&&console.warn.apply(console,arguments)},e.prototype.error=function(){t.debug&&console.error.apply(console,arguments)},e.prototype.object=function(e){if(!t.debug)return"";var o,n,s,r="",a=arguments[1]||(arguments[1]=[]);for(o in e)i.call(e,o)&&(n=e[o],~a.indexOf(n)||(s=typeof n,"object"===s?(a.push(n),r+="	"+o+" = "+this.object(n,a)):"function"!==s?r+="	"+o+" = "+n+"\n":a.push(n)));return r},new e}),define("base/audio_ctx",["core/game/log"],function(t){var e="undefined"!=typeof window?window:global,i=e.AudioContext||e.webkitAudioContext||e.mozAudioContext||e.oAudioContext||e.msAudioContext;return i||t.error("AudioContext not supported by this Browser"),i?new i:!1}),define("base/device",[],function(){function t(){var t=navigator.userAgent.toLowerCase(),e=new Audio,i=document.createElement("video");this.userAgent=t,this.pixelRatio=window.devicePixelRatio||1,this.invPixelRatio=1/this.pixelRatio,this.browser=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i)[1],this.touch="ontouchstart"in window,this.mobile=/android|webos|iphone|ipad|ipod|blackberry/i.test(t),this.webgl=function(){var t,e,i=document.createElement("canvas"),o=["3d","moz-webgl","experimental-webgl","webkit-3d","webgl"];for(e=o.length;e--&&!(t=!!i.getContext(o[e])););return t}(),this.canvas=function(){var t=document.createElement("canvas"),e=!!t.getContext("2d");return e}(),this.gamepads=!!navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.webkitGamepads,this.audioMpeg=!!e.canPlayType("audio/mpeg"),this.audioOgg=!!e.canPlayType("audio/ogg"),this.audioMp4=!!e.canPlayType("audio/mp4"),this.videoWebm=!!i.canPlayType("video/webm"),this.videoOgg=!!i.canPlayType("video/ogg"),this.videoMp4=!!i.canPlayType("video/mp4")}return new t}),define("base/dom",["core/game/log"],function(t){function e(){}var i=/[ \,]+/,o=/attribute\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,n=/uniform\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,s=["webgl","webkit-3d","moz-webgl","experimental-webgl","3d"],r={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0};e.prototype.addEvent=function(t,e,o,n){var s,r=e.split(i),a=n||t,h=function(t){t=t||window.event,o&&o.call(a,t)};for(s=r.length;s--;)e=r[s],t.attachEvent?t.attachEvent("on"+e,h):t.addEventListener(e,h,!1)},e.prototype.removeEvent=function(t,e,o,n){var s,r,a=e.split(i),h=n||t,p=function(t){t=t||window.event,o&&o.call(h,t)};for(s=0,r=a.length;r>s;s++)e=a[s],t.detachEvent?t.detachEvent("on"+e,p):t.removeEventListener(e,p,!1)},e.prototype.addMeta=function(t,e,i){var o=document.createElement("meta"),n=document.head;t&&(o.id=t),e&&(o.name=e),i&&(o.content=i),n.insertBefore(o,n.firstChild)},e.prototype.getWebGLContext=function(e,i){var o,n,a,h;i||(i={});for(o in r)void 0!=i[o]&&(i[o]=r[o]);for(h=s.length;h--;){try{a=e.getContext(s[h],i)}catch(p){n=p}if(a)break}return n&&t.warn("Dom.getWebGLContext: could not get a WebGL Context "+n.message||""),a};var a=e.prototype.createShader=function(e,i,o){var n=e.createShader(o);return e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(t.warn("Dom.createShader: problem compiling shader "+e.getShaderInfoLog(n)),e.deleteShader(n),void 0)};return e.prototype.createProgram=function(e,i,o){var n,s=e.createProgram();return n=a(e,i,e.VERTEX_SHADER),e.attachShader(s,n),e.deleteShader(n),n=a(e,o,e.FRAGMENT_SHADER),e.attachShader(s,n),e.deleteShader(n),e.linkProgram(s),e.validateProgram(s),e.useProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(t.warn("Dom.createProgram: problem compiling Program "+e.getProgramInfoLog(s)),e.deleteProgram(s),void 0)},e.prototype.parseUniformsAttributes=function(t,e,i,s,r,a){var h,p,c,u,l,m,f,d=i+s,y=d.split("\n");for(m=y.length;m--;)if(l=y[m],h=l.match(o),p=l.match(n),h&&(c=h[3],r[c]=t.getAttribLocation(e,c)),p)if(c=p[3],u=parseInt(p[5]))for(a[c]=[],f=u;f--;)a[c][f]=t.getUniformLocation(e,c+"["+f+"]");else a[c]=t.getUniformLocation(e,c)},new e}),define("base/request_animation_frame",[],function(){var t=1e3/60,e="undefined"!=typeof window?window:global;return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(i){return e.setTimeout(i,t)}}),define("base/time",[],function(){function t(){return.001*o.now()}function e(){this.start=r,this.sinceStart=0,this.time=0,this.fps=60,this.delta=a,this.frameCount=0,n(this,"scale",{get:function(){return c},set:function(t){c=t,h=p*t}}),n(this,"fixedDelta",{get:function(){return h},set:function(t){p=t,h=p*c}})}var i="undefined"!=typeof window?window:{},o="undefined"!=typeof i.performance?i.performance:{},n=Object.defineProperty,s=Date.now(),r=.001*s,a=1/60,h=a,p=a,c=1;return o.now=o.now||o.webkitNow||o.mozNow||o.msNow||o.oNow||function(){return Date.now()-s},e.prototype.now=t,e.prototype.stamp=function(){return r+t()},new e}),define("core/assets/asset",["core/game/log"],function(t){function e(t){t||(t={}),this._id=++o,this._type=this.constructor.name||"UnknownAsset",this.json=void 0!=t.json?!!t.json:!0,this.assets=void 0,this._name=void 0!=t.name?t.name:"Asset"+this._id,this.src=t.src,this.raw=t.raw}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,e.prototype._onExtend&&e.prototype._onExtend(t),t.extend=i}var o=0,n=Object.defineProperty;return e.type="Asset",e._types={Asset:e},e.prototype._onExtend=function(t){e._types[t.type]=t},n(e.prototype,"name",{get:function(){return this._name},set:function(e){var i,o=this.assets;if(o){if(i=o.hash,i[e])return t.warn("Asset.set name: can't change name to "+e+" Assets already have an asset with same name"),void 0;delete i[this.name],i[e]=this}this._name=e}}),e.prototype.clone=function(){return(new this.constructor).copy(this)},e.prototype.copy=function(t){return this.sync=t.sync,this.json=t.json,this.name=t.name+"."+this._id,this.src=t.src,this.raw=t.raw,this.assets!==t.assets&&t.assets.addAsset(this),this},e.prototype.mimeType=function(){return this.src?this.src.split(".").pop():!1},e.prototype.clear=function(){return this.raw=null,this},e.prototype.destroy=function(){return this.assets?(this.assets.removeAsset(this),this.clear(),this):(t.warn("Asset.destroy: can't destroy Asset if it's not added to Assets"),this)},e.prototype.parse=function(t){return this.raw=t,this},e.prototype.toJSON=function(t,e){return t||(t={}),t._type=this._type,t.name=this.name,e||(t.src=this.src),t},e.prototype.fromJSON=function(t){return this._type=t._type,this.name=t.name,this.src=t.src,this},e.extend=i,e}),define("core/assets/assets",["core/assets/asset","core/game/log"],function(t,e){function i(){Array.call(this),this.hash={}}return i.prototype=Object.create(Array.prototype),i.prototype.constructor=i,i.prototype.addAsset=function(t){var i=t.name;return this.hash[i]?(e.warn("Assets.addAsset: Assets already have Asset named "+t.name),void 0):(t.assets=this,this.push(t),this.hash[i]=t,t)},i.prototype.add=i.prototype.addAssets=function(){for(var t=arguments.length;t--;)this.addAsset(arguments[t])},i.prototype.removeAsset=function(t){var i="string"==typeof t?t:t.name;return(t=this.hash[i])?(this.splice(this.indexOf(t),1),this.hash[i]=null,t):(e.warn("Assets.removeAsset: Assets does not have an Asset named "+i),void 0)},i.prototype.remove=i.prototype.removeAssets=function(){for(var t=arguments.length;t--;)this.removeAsset(arguments[t])},i.prototype.toJSON=function(t,e){t||(t={});var i,o,n=t.assets||(t.assets=[]);for(o=this.length;o--;)(i=this[o]).json&&(n[o]=i.toJSON(n[o],e));return t},i.prototype.fromJSON=function(e){var i,o,n,s=this.hash,r=e.assets||(e.assets=[]);for(n=r.length;n--;)(o=r[n])&&((i=s[o.name])?i.fromJSON(o):this.add((new t._types[o._type]).fromJSON(o)));return this},new i}),define("core/assets/asset_loader",["base/event_emitter","base/audio_ctx","core/assets/asset","core/assets/assets","core/game/log"],function(t,e,i,o,n){function s(){t.call(this)}var r=function(){};return t.extend(s,t),s.prototype.load=function(t,e){t||(t=r);var i,s=this,a=o.length,h=function(e){e&&n.warn(e.message),a--,0===a&&(s.emit("load"),t())};for(i=a;i--;)this.loadAsset(o[i],h,e)},s.prototype.loadAsset=function(t,e,i){var o,n=this;if(t.raw&&!i)return e(),void 0;if(o=t.mimeType()){if(!this[o])return e(new Error("AssetLoader.load: has no loader named "+o)),void 0;this[o](t.src,function(i,o){return i?(e(new Error("AssetLoader.load: "+i.message)),void 0):(t.parse(o),n.emit("loadAsset",t),e(),void 0)})}},s.prototype.gif=s.prototype.jpg=s.prototype.jpeg=s.prototype.png=function(t,e){var i=new Image;i.addEventListener("load",function(){e&&e(null,i)},!1),i.addEventListener("error",function(t){e&&e(t)},!1),i.src=t},s.prototype.json=function(t,e){var i=new XMLHttpRequest;i.addEventListener("readystatechange",function(t){if(1==this.readyState)this.send(null);else if(4==this.readyState){var i,o=this.status;if(o>199&&301>o||304==o){try{i=JSON.parse(this.responseText)}catch(t){return e&&e(t),void 0}e&&e(null,i)}else e&&e(new Error(o))}},!1),i.open("GET",t,!0)},s.prototype.ogg=s.prototype.wav=s.prototype.mp3=s.prototype.aac=function(t,e){var i=new XMLHttpRequest;i.addEventListener("readystatechange",function(){if(1==this.readyState)this.send(null);else if(4==this.readyState){var t=this.status;t>199&&301>t||304==t?e&&e(null,this.response):e&&e(new Error(t))}},!1),i.responseType="arraybuffer",i.open("GET",t,!0)},new s}),define("core/assets/audio_clip",["base/audio_ctx","core/assets/asset"],function(t,e){function i(t){t||(t={}),e.call(this,t),this.buffer=void 0}function o(t){return r.apply(null,new Uint16Array(t))}function n(t){var e,i=t.length,o=new ArrayBuffer(2*i),n=new Uint16Array(o);for(e=i;e--;)n[e]=t.charCodeAt(e);return o}var s=Object.defineProperty,r=String.fromCharCode;return i.type="AudioClip",e.extend(i,e),s(i.prototype,"length",{get:function(){return this.buffer?this.buffer.duration:0}}),s(i.prototype,"samples",{get:function(){return this.buffer?this.buffer.length:0}}),s(i.prototype,"frequency",{get:function(){return this.buffer?this.buffer.sampleRate:44100}}),s(i.prototype,"channels",{get:function(){return this.buffer?this.buffer.numberOfChannels:0}}),i.prototype.getData=function(t,e){return t||(t=[]),this.buffer?this.buffer.getChannelData(t,e):t},i.prototype.parse=function(i){return e.prototype.parse.call(this,i),this.buffer=t.createBuffer(i,!1),this},i.prototype.toJSON=function(t,i){return t||(t={}),e.prototype.toJSON.call(this,t,i),!i&&this.src||!this.raw||(t.raw=o(this.raw)),t},i.prototype.fromJSON=function(t,i){return e.prototype.fromJSON.call(this,t,i),!i&&this.src||!this.raw||(this.raw=n(t.raw)),this},i}),define("core/assets/sprite_sheet",["core/assets/asset","core/game/log"],function(t,e){function i(e){e||(e={}),t.call(this,e)}return i.type="SpriteSheet",t.extend(i,t),i.prototype.parse=function(i){t.prototype.parse.call(this,i);for(var o in i)this[o]?e.warn("SpriteSheet.parse: bad name "+o+" in file "+this.src):this[o]=i[o];return this},i.prototype.clear=function(){for(var e in this.raw)this[e]=null;return t.prototype.clear.call(this),this},i.prototype.toJSON=function(e,i){return e||(e={}),t.prototype.toJSON.call(this,e),!i&&this.src||!this.raw||(e.raw=JSON.stringify(this.raw)),e},i.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),!e.src&&e.raw&&(this.raw=JSON.parse(e.raw)),this.parse(this.raw),this},i}),define("core/assets/texture",["core/assets/asset"],function(t){function e(e){e||(e={}),t.call(this,e),this.anisotropy=void 0!=e.anisotropy?e.anisotropy:1,this.minFilter=void 0!=e.minFilter?e.minFilter:"LINEAR",this.magFilter=void 0!=e.magFilter?e.magFilter:"LINEAR",this.format=void 0!==e.format?e.format:"RGBA",this._needsUpdate=!0}e.type="Texture",t.extend(e,t),e.prototype.setAnisotropy=function(t){this.anisotropy=t,this._needsUpdate=!0},e.prototype.setMinFilter=function(t){this.minFilter=t,this._needsUpdate=!0},e.prototype.setMagFilter=function(t){this.magFilter=t,this._needsUpdate=!0},e.prototype.setFormat=function(t){this.format=t,this._needsUpdate=!0};var i,o;return e.prototype.toJSON=function(e,n){if(e||(e={}),t.prototype.toJSON.call(this,e),(n||!this.src)&&this.raw)if("undefined"==typeof window)e.raw=this.raw;else{var s=this.raw,r=i||(i=document.createElement("canvas")),a=o||(o=i.getContext("2d"));r.width=s.width,r.height=s.height,a.clearRect(0,0,r.width,r.height),a.drawImage(s,0,0),e.raw=r.toDataURL()}return e.anisotropy=this.anisotropy,e.minFilter=this.minFilter,e.magFilter=this.magFilter,e.format=this.format,e},e.prototype.fromJSON=function(e){if(t.prototype.fromJSON.call(this,e),!e.src&&e.raw)if("undefined"==typeof window)this.raw=e.raw;else{var i=new Image;i.src=e.raw,this.raw=i}return this.anisotropy=e.anisotropy,this.minFilter=e.minFilter,this.magFilter=e.magFilter,this.format=e.format,this},e}),define("math/vec3",[],function(){function t(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}var e=Math.sqrt;return t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},t.prototype.sadd=function(t){return this.x+=t,this.y+=t,this.z+=t,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},t.prototype.ssub=function(t){return this.x-=t,this.y-=t,this.z-=t,this},t.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},t.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},t.prototype.smul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.div=function(t){var e=t.x,i=t.y,o=t.z;return t.w,this.x*=0!==e?1/e:0,this.y*=0!==i?1/i:0,this.z*=0!==o?1/o:0,this},t.prototype.vdiv=function(t,e){var i=e.x,o=e.y,n=e.z;return this.x=0!==i?t.x/i:0,this.y=0!==o?t.y/o:0,this.z=0!==n?t.z/n:0,this},t.prototype.sdiv=function(t){return t=0===t?0:1/t,this.x*=t,this.y*=t,this.z*=t,this},t.prototype.length=function(){var t=this.x,i=this.y,o=this.z,n=t*t+i*i+o*o;return 1===n?1:0===n?0:e(n)},t.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},t.prototype.setLength=function(t){var i=this.x,o=this.y,n=this.z,s=i*i+o*o+n*n;return 1===s?(this.x*=t,this.y*=t,this.z*=t,this):(s=s>0?1/e(s):0,this.x*=s*t,this.y*=s*t,this.z*=s*t,this)},t.prototype.normalize=function(){var t=this.x,i=this.y,o=this.z,n=t*t+i*i+o*o;return 1===n?this:(n=n>0?1/e(n):0,this.x*=n,this.y*=n,this.z*=n,this)},t.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.inverseVec=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},t.prototype.vlerp=function(t,e,i){var o=t.x,n=t.y,s=t.z;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=s+(e.z-s)*i,this},t.vdot=t.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.vcross=t.prototype.vcross=function(t,e){var i=t.x,o=t.y,n=t.z,s=e.x,r=e.y,a=e.z;return this.x=o*a-n*r,this.y=n*s-i*a,this.z=i*r-o*s,this},t.prototype.cross=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,s=t.y,r=t.z;return this.x=i*r-o*s,this.y=o*n-e*r,this.z=e*s-i*n,this},t.prototype.min=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,s=t.y,r=t.z;return this.x=e>n?n:e,this.y=i>s?s:i,this.z=o>r?r:o,this},t.prototype.max=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,s=t.y,r=t.z;return this.x=n>e?n:e,this.y=s>i?s:i,this.z=r>o?r:o,this},t.prototype.clamp=function(t,e){var i=this.x,o=this.y,n=this.z,s=t.x,r=t.y,a=t.z,h=e.x,p=e.y,c=e.z;return this.x=s>i?s:i>h?h:i,this.y=r>o?r:o>p?p:o,this.z=a>n?a:n>c?c:n,this},t.prototype.transformMat3=function(t){var e=t.elements,i=this.x,o=this.y,n=this.z;return this.x=i*e[0]+o*e[3]+n*e[6],this.y=i*e[1]+o*e[4]+n*e[7],this.z=i*e[2]+o*e[5]+n*e[8],this},t.prototype.transformMat4=function(t){var e=t.elements,i=this.x,o=this.y,n=this.z;return this.x=i*e[0]+o*e[4]+n*e[8]+e[12],this.y=i*e[1]+o*e[5]+n*e[9]+e[13],this.z=i*e[2]+o*e[6]+n*e[10]+e[14],this},t.prototype.transformQuat=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,s=t.y,r=t.z,a=t.w,h=a*e+s*o-r*i,p=a*i+r*e-n*o,c=a*o+n*i-s*e,u=-n*e-s*i-r*o;return this.x=h*a+u*-n+p*-r-c*-s,this.y=p*a+u*-s+c*-n-h*-r,this.z=c*a+u*-r+h*-s-p*-n,this},t.prototype.fromVec2=function(t){return this.x=t.x,this.y=t.y,this.z=0,this},t.prototype.fromVec4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.positionFromMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},t.prototype.scaleFromMat3=function(t){var e=t.elements,i=this.set(e[0],e[3],e[6]).length(),o=this.set(e[1],e[4],e[7]).length(),n=this.set(e[2],e[5],e[8]).length();return this.x=i,this.y=o,this.z=n,this},t.prototype.scaleFromMat4=function(t){var e=t.elements,i=this.set(e[0],e[4],e[8]).length(),o=this.set(e[1],e[5],e[9]).length(),n=this.set(e[2],e[6],e[10]).length();return this.x=i,this.y=o,this.z=n,this},t.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.toJSON=function(t){return t||(t={}),t.x=this.x,t.y=this.y,t.z=this.z,t},t.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},t.prototype.toArray=function(t){return t||(t=[]),t[0]=this.x,t[1]=this.y,t[2]=this.z,t},t.prototype.toString=function(){return"Vec3( "+this.x+", "+this.y+", "+this.z+" )"},t}),define("core/components/component",["base/class","core/game/log"],function(t,e){function i(e,i,o){t.call(this),this._type=e||"UnknownComponent",this._name=this._type.toLowerCase(),this.sync=void 0!=i?!!i:!0,this.json=void 0!=o?!!o:!0,this.gameObject=void 0}return t.extend(i,t),i.type="Component",i._types={},i.prototype._onExtend=function(t){i._types[t.type]=t},i.prototype.init=function(){},i.prototype.update=function(){},i.prototype.clear=function(){},i.prototype.destroy=function(){return this.gameObject?(this.gameObject.removeComponent(this),this.emit("destroy"),this.clear(),this):(e.warn("Component.destroy: can't destroy Component if it's not added to a GameObject"),this)},i.prototype.sort=function(t,e){return t===e?-1:1},i.prototype.toSYNC=function(e){return e=t.prototype.toSYNC.call(this,e)},i.prototype.fromSYNC=function(){return this},i.prototype.toJSON=function(e){return e||(e={}),t.prototype.toJSON.call(this,e),e._type=this._type,e._name=this._name,e.sync=this.sync,e.json=this.json,e},i.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this._type=e._type,this._name=e._name,this.sync=e.sync,this.json=e.json,this},i}),define("core/components/audio_source",["base/audio_ctx","base/class","base/time","math/mathf","math/vec2","math/vec3","core/components/component"],function(t,e,i,o,n,s,r){function a(t){t||(t={}),r.call(this,"AudioSource",void 0!=t.sync?!!t.sync:!1,t.json),this.clip=t.clip,this._source=void 0,this._gain=void 0,this._panner=void 0,this.dopplerLevel=void 0!=t.dopplerLevel?t.dopplerLevel:1,this._loop=void 0!=t.loop?!!t.loop:!1,this.maxDistance=void 0!=t.maxDistance?t.maxDistance:15,this.minDistance=void 0!=t.minDistance?t.minDistance:1,this.offset=void 0!=t.offset?t.offset:new s,this.pitch=void 0!=t.pitch?t.pitch:0,this.playOnInit=void 0!=t.playOnInit?!!t.playOnInit:!1,this.spread=void 0!=t.spread?t.spread:0,this.time=void 0!=t.time?t.time:0,this._volume=void 0!=t.volume?t.volume:1,this.isPlaying=!1,this._startTime=0;
var e=this;this._onended=function(){e.isPlaying=!1,e.time=0}}var h=i.now,p=o.clamp01,c=Object.defineProperty;a.type="AudioSource",e.extend(a,r),c(a.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=p(t),this._gain&&(this._gain.gain.value=this._volume)}}),c(a.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=!!t,this._source&&(this._source.loop=this._loop)}}),a.prototype.init=function(){this.playOnInit&&this.play()};var u=new n,l=new s;return a.prototype.update=function(){if(0!==this.dopplerLevel&&this.isPlaying){var t,e,i,o,n;(i=this.gameObject.scene.game.camera)&&(n=this._panner)&&(e=this.transform,t=this.transform2d,o=i.transform||i.transform2d,t?(u.vadd(t.position,this.offset),u.sub(o.position),u.smul(this.dopplerLevel),n.setPosition(u.x,u.y,i.orthographicSize)):(l.vadd(e.position,this.offset),l.sub(o.position),l.smul(this.dopplerLevel),n.setPosition(l.x,l.y,l.z||0)))}},a.prototype.clear=function(){this.isPlaying&&this.stop(),this._source=void 0,this._gain=void 0,this._panner=void 0},a.prototype.play=function(e,i){return t?(e||(e=0),i||(i=0),this.refresh(),this.isPlaying=!0,this._startTime=h(),this.time=i,this._source.start(e,this.time),this):this},a.prototype.pause=function(){return t?(this.isPlaying=!1,this.time=h()-this._startTime,this._source.stop(this.time),this):this},a.prototype.stop=function(){return t?(this.time=0,this.isPlaying=!1,this._source.stop(this.time),this):this},a.prototype.refresh=function(){var e=this._source=t.createBufferSource(),i=this._gain=t.createGain(),o=this._panner=t.createPanner();return i.connect(t.destination),o.connect(i),e.connect(o),e.buffer=this.clip.buffer,e.onended=this._onended,i.gain.value=this.volume,e.loop=this.loop,this},a.prototype.toSYNC=function(t){return t=r.prototype.toSYNC.call(this,t)},a.prototype.fromSYNC=function(t){return r.prototype.fromSYNC.call(this,t),this},a.prototype.toJSON=function(t){return t||(t={}),r.prototype.toJSON.call(this,t),t.clip=this.clip?this.clip.name:void 0,t.dopplerLevel=this.dopplerLevel,t.loop=this.loop,t.maxDistance=this.maxDistance,t.minDistance=this.minDistance,t.offset=this.offset.toJSON(t.offset),t.panLevel=this.panLevel,t.pitch=this.pitch,t.playOnInit=this.playOnInit,t.spread=this.spread,t.time=this.time,t.volume=this.volume,t.isPlaying=this.isPlaying,t},a.prototype.fromJSON=function(t){return r.prototype.fromJSON.call(this,t),this.clip=t.clip?Assets.hash[t.clip]:void 0,this.dopplerLevel=t.dopplerLevel,this.loop=t.loop,this.maxDistance=t.maxDistance,this.minDistance=t.minDistance,this.offset.fromJSON(t.offset),this.panLevel=t.panLevel,this.pitch=t.pitch,this.playOnInit=t.playOnInit,this.spread=t.spread,this.time=t.time,this.volume=t.volume,this.isPlaying=t.isPlaying,this},a}),define("math/color",["math/mathf"],function(t){function e(t,e,i){this.r=0,this.g=0,this.b=0,this._r=0,this._g=0,this._b=0,this._hex="#000000",this._rgb="rgb(0,0,0)",this.set(t,e,i)}function i(t){var e=(~~(255*s(t))).toString(16);return 1===e.length?"0"+e:e}var o=Math.sqrt,n=Math.floor,s=t.clamp01;e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},e.prototype.set=function(t,i,o){var n=typeof t;return"number"===n?(this.r=t,this.g=i,this.b=o):"string"===n?this.setStyle(t):t instanceof e&&(this.r=t.r,this.g=t.g,this.b=t.b),this},e.prototype.setRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},e.prototype.setStyle=function(){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i,e=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i,i=/^\#([0-9a-f]{6})$/i,o=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,n=/#(.)(.)(.)/,s="#$1$1$2$2$3$3",a=/^(\w+)$/i,h=1/255,p=.01;return function(c){if(t.test(c)){var u=t.exec(c);return this.r=min(255,Number(u[1]))*h,this.g=min(255,Number(u[2]))*h,this.b=min(255,Number(u[3]))*h,this}if(e.test(c)){var u=e.exec(c);return this.r=min(100,Number(u[1]))*p,this.g=min(100,Number(u[2]))*p,this.b=min(100,Number(u[3]))*p,this}return i.test(c)?(this.r=parseInt(c.substr(1,2),16)*h,this.g=parseInt(c.substr(3,2),16)*h,this.b=parseInt(c.substr(5,2),16)*h,this):o.test(c)?(c=c.replace(n,s),this.r=parseInt(c.substr(1,2),16)*h,this.g=parseInt(c.substr(3,2),16)*h,this.b=parseInt(c.substr(5,2),16)*h,this):a.test(c)?(c=r[c],this.r=parseInt(c.substr(1,2),16)*h,this.g=parseInt(c.substr(3,2),16)*h,this.b=parseInt(c.substr(5,2),16)*h,this):this}}(),e.prototype.toHEX=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var t=i(this.r),e=i(this.g),o=i(this.b);this._r=this.r,this._g=this.g,this._b=this.b,this._hex="#"+t+e+o}return this._hex},e.prototype.toRGB=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var t=n(256*s(this.r)),e=n(256*s(this.g)),i=n(256*s(this.b));this._r=this.r,this._g=this.g,this._b=this.b,this._rgb="rgb("+t+","+e+","+i+")"}return this._rgb},e.prototype.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},e.prototype.cadd=function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},e.prototype.sadd=function(t){return this.r+=t,this.g+=t,this.b+=t,this},e.prototype.sub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this},e.prototype.csub=function(t,e){return this.r=t.r-e.r,this.g=t.g-e.g,this.b=t.b-e.b,this},e.prototype.ssub=function(t){return this.r-=t,this.g-=t,this.b-=t,this},e.prototype.mul=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},e.prototype.cmul=function(t,e){return this.r=t.r*e.r,this.g=t.g*e.g,this.b=t.b*e.b,this},e.prototype.smul=function(t){return this.r*=t,this.g*=t,this.b*=t,this},e.prototype.div=function(t){var e=t.r,i=t.g,o=t.b;return t.w,this.r*=0!==e?1/e:0,this.g*=0!==i?1/i:0,this.b*=0!==o?1/o:0,this},e.prototype.cdiv=function(t,e){var i=e.r,o=e.g,n=e.b;return this.r=0!==i?t.r/i:0,this.g=0!==o?t.g/o:0,this.b=0!==n?t.b/n:0,this},e.prototype.sdiv=function(t){return t=0===t?0:1/t,this.r*=t,this.g*=t,this.b*=t,this},e.prototype.length=function(){var t=this.r,e=this.g,i=this.b,n=t*t+e*e+i*i;return n>0?1/o(n):0},e.prototype.lengthSq=function(){var t=this.r,e=this.g,i=this.b;return t*t+e*e+i*i},e.prototype.normalize=function(){var t=this.r,e=this.g,i=this.b,n=t*t+e*e+i*i;return n=n>0?1/o(n):0,this.r*=n,this.g*=n,this.b*=n,this},e.prototype.check=function(){var t=this.r,e=this.g,i=this.b;return this.r=t>1?1:t,this.g=e>1?1:e,this.b=i>1?1:i,this},e.prototype.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},e.prototype.clerp=function(t,e,i){var o=t.r,n=t.g,s=t.b;return this.r=o+(e.r-o)*i,this.g=n+(e.g-n)*i,this.b=s+(e.b-s)*i,this},e.prototype.min=function(t){var e=this.r,i=this.g,o=this.b,n=t.r,s=t.g,r=t.b;return this.r=e>n?n:e,this.g=i>s?s:i,this.b=o>r?r:o,this},e.prototype.max=function(t){var e=this.r,i=this.g,o=this.b,n=t.r,s=t.g,r=t.b;return this.r=n>e?n:e,this.g=s>i?s:i,this.b=r>o?r:o,this},e.prototype.fromVec2=function(t){return this.r=t.x,this.g=t.y,this.b=0,this},e.prototype.fromVec3=function(t){return this.r=t.x,this.g=t.y,this.b=t.z,this},e.prototype.fromVec4=e.prototype.fromVec3,e.prototype.fromJSON=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},e.prototype.toJSON=function(t){return t||(t={}),t.r=this.r,t.g=this.g,t.b=this.b,t},e.prototype.fromArray=function(t){return this.r=t[0],this.g=t[1],this.b=t[2],this},e.prototype.toArray=function(t){return t||(t=[]),t[0]=this.r,t[1]=this.g,t[2]=this.b,t},e.prototype.toString=function(){return"Color( "+this.r+", "+this.g+", "+this.b+" )"};var r=e.colorNames={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return e}),define("math/mat4",["math/mathf","math/vec3"],function(t,e){function i(t,e,i,o,n,s,r,a,h,p,c,u,l,m,f,d){var y=new Float32Array(16);this.elements=y,y[0]=void 0!==t?t:1,y[4]=e||0,y[8]=i||0,y[12]=o||0,y[1]=n||0,y[5]=void 0!==s?s:1,y[9]=r||0,y[13]=a||0,y[2]=h||0,y[6]=p||0,y[10]=void 0!==c?c:1,y[14]=u||0,y[3]=l||0,y[7]=m||0,y[11]=f||0,y[15]=void 0!==d?d:1}var o=Math.sqrt,n=Math.cos,s=Math.sin,r=Math.tan,a=t.degsToRads;return i.prototype.clone=function(){var t=this.elements;return new i(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},i.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},i.prototype.set=function(t,e,i,o,n,s,r,a,h,p,c,u,l,m,f,d){var y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=o,y[1]=n,y[5]=s,y[9]=r,y[13]=a,y[2]=h,y[6]=p,y[10]=c,y[14]=u,y[3]=l,y[7]=m,y[11]=f,y[15]=d,this},i.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[4],s=e[8],r=e[12],a=e[1],h=e[5],p=e[9],c=e[13],u=e[2],l=e[6],m=e[10],f=e[14],d=e[3],y=e[7],v=e[11],g=e[15],x=i[0],b=i[4],w=i[8],S=i[12],_=i[1],O=i[5],N=i[9],z=i[13],C=i[2],A=i[6],E=i[10],J=i[14],M=i[3],R=i[7],D=i[11],T=i[15];return e[0]=o*x+n*_+s*C+r*M,e[4]=o*b+n*O+s*A+r*R,e[8]=o*w+n*N+s*E+r*D,e[12]=o*S+n*z+s*J+r*T,e[1]=a*x+h*_+p*C+c*M,e[5]=a*b+h*O+p*A+c*R,e[9]=a*w+h*N+p*E+c*D,e[13]=a*S+h*z+p*J+c*T,e[2]=u*x+l*_+m*C+f*M,e[6]=u*b+l*O+m*A+f*R,e[10]=u*w+l*N+m*E+f*D,e[14]=u*S+l*z+m*J+f*T,e[3]=d*x+y*_+v*C+g*M,e[7]=d*b+y*O+v*A+g*R,e[11]=d*w+y*N+v*E+g*D,e[15]=d*S+y*z+v*J+g*T,this},i.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,s=o[0],r=o[4],a=o[8],h=o[12],p=o[1],c=o[5],u=o[9],l=o[13],m=o[2],f=o[6],d=o[10],y=o[14],v=o[3],g=o[7],x=o[11],b=o[15],w=n[0],S=n[4],_=n[8],O=n[12],N=n[1],z=n[5],C=n[9],A=n[13],E=n[2],J=n[6],M=n[10],R=n[14],D=n[3],T=n[7],j=n[11],B=n[15];return i[0]=s*w+r*N+a*E+h*D,i[4]=s*S+r*z+a*J+h*T,i[8]=s*_+r*C+a*M+h*j,i[12]=s*O+r*A+a*R+h*B,i[1]=p*w+c*N+u*E+l*D,i[5]=p*S+c*z+u*J+l*T,i[9]=p*_+c*C+u*M+l*j,i[13]=p*O+c*A+u*R+l*B,i[2]=m*w+f*N+d*E+y*D,i[6]=m*S+f*z+d*J+y*T,i[10]=m*_+f*C+d*M+y*j,i[14]=m*O+f*A+d*R+y*B,i[3]=v*w+g*N+x*E+b*D,i[7]=v*S+g*z+x*J+b*T,i[11]=v*_+g*C+x*M+b*j,i[15]=v*O+g*A+x*R+b*B,this},i.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,this},i.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,this},i.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,this},i.prototype.determinant=function(){var t=(this.elements,ae[0]),e=ae[4],i=ae[8],o=ae[12],n=ae[1],s=ae[5],r=ae[9],a=ae[13],h=ae[2],p=ae[6],c=ae[10],u=ae[14],l=ae[3],m=ae[7],f=ae[11],d=ae[15];return l*(o*r*p-i*a*p-o*s*c+e*a*c+i*s*u-e*r*u)+m*(t*r*u-t*a*c+o*n*c-i*n*u+i*a*h-o*r*h)+f*(t*a*p-t*s*u-o*n*p+e*n*u+o*s*h-e*a*h)+d*(-i*s*h-t*r*p+t*s*c+i*n*p-e*n*c+e*r*h)},i.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[4],o=t[8],n=t[12],s=t[1],r=t[5],a=t[9],h=t[13],p=t[2],c=t[6],u=t[10],l=t[14],m=t[3],f=t[7],d=t[11],y=t[15],v=a*l*f-h*u*f+h*c*d-r*l*d-a*c*y+r*u*y,g=n*u*f-o*l*f-n*c*d+i*l*d+o*c*y-i*u*y,x=o*h*f-n*a*f+n*r*d-i*h*d-o*r*y+i*a*y,i=n*a*c-o*h*c-n*r*u+i*h*u+o*r*l-i*a*l,b=e*v+s*g+p*x+m*i;return b=0===b?0:1/b,t[0]=v*b,t[4]=g*b,t[8]=x*b,t[12]=i*b,t[1]=(h*u*m-a*l*m-h*p*d+s*l*d+a*p*y-s*u*y)*b,t[5]=(o*l*m-n*u*m+n*p*d-e*l*d-o*p*y+e*u*y)*b,t[9]=(n*a*m-o*h*m-n*s*d+e*h*d+o*s*y-e*a*y)*b,t[13]=(o*h*p-n*a*p+n*s*u-e*h*u-o*s*l+e*a*l)*b,t[2]=(r*l*m-h*c*m+h*p*f-s*l*f-r*p*y+s*c*y)*b,t[6]=(n*c*m-i*l*m-n*p*f+e*l*f+i*p*y-e*c*y)*b,t[10]=(i*h*m-n*r*m+n*s*f-e*h*f-i*s*y+e*r*y)*b,t[14]=(n*r*p-i*h*p-n*s*c+e*h*c+i*s*l-e*r*l)*b,t[3]=(a*c*m-r*u*m-a*p*f+s*u*f+r*p*d-s*c*d)*b,t[7]=(i*u*m-o*c*m+o*p*f-e*u*f-i*p*d+e*c*d)*b,t[11]=(o*r*m-i*a*m-o*s*f+e*a*f+i*s*d-e*r*d)*b,t[15]=(i*a*p-o*r*p+o*s*c-e*a*c-i*s*u+e*r*u)*b,this},i.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[4],s=i[8],r=i[12],a=i[1],h=i[5],p=i[9],c=i[13],u=i[2],l=i[6],m=i[10],f=i[14],d=i[3],y=i[7],v=i[11],g=i[15],x=p*f*y-c*m*y+c*l*v-h*f*v-p*l*g+h*m*g,b=r*m*y-s*f*y-r*l*v+n*f*v+s*l*g-n*m*g,w=s*c*y-r*p*y+r*h*v-n*c*v-s*h*g+n*p*g,n=r*p*l-s*c*l-r*h*m+n*c*m+s*h*f-n*p*f,S=o*x+a*b+u*w+d*n;return S=0===S?0:1/S,e[0]=x*S,e[4]=b*S,e[8]=w*S,e[12]=n*S,e[1]=(c*m*d-p*f*d-c*u*v+a*f*v+p*u*g-a*m*g)*S,e[5]=(s*f*d-r*m*d+r*u*v-o*f*v-s*u*g+o*m*g)*S,e[9]=(r*p*d-s*c*d-r*a*v+o*c*v+s*a*g-o*p*g)*S,e[13]=(s*c*u-r*p*u+r*a*m-o*c*m-s*a*f+o*p*f)*S,e[2]=(h*f*d-c*l*d+c*u*y-a*f*y-h*u*g+a*l*g)*S,e[6]=(r*l*d-n*f*d-r*u*y+o*f*y+n*u*g-o*l*g)*S,e[10]=(n*c*d-r*h*d+r*a*y-o*c*y-n*a*g+o*h*g)*S,e[14]=(r*h*u-n*c*u-r*a*l+o*c*l+n*a*f-o*h*f)*S,e[3]=(p*l*d-h*m*d-p*u*y+a*m*y+h*u*v-a*l*v)*S,e[7]=(n*m*d-s*l*d+s*u*y-o*m*y-n*u*v+o*l*v)*S,e[11]=(s*h*d-n*p*d-s*a*y+o*p*y+n*a*v-o*h*v)*S,e[15]=(n*p*u-s*h*u+s*a*l-o*p*l-n*a*m+o*h*m)*S,this},i.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},i.prototype.setTrace=function(t){var e=this.elements,i=t.w;return e[0]=t.x,e[5]=t.y,e[10]=t.z,e[15]=void 0!==i?i:1,this},i.prototype.lookAt=function(){var t=new e(0,0,1),i=new e,o=new e,n=new e;return function(e,s,r){var a=this.elements;return r=r||t,n.vsub(s,e).normalize(),i.vcross(r,n).normalize(),o.vcross(n,i),a[0]=i.x,a[4]=o.x,a[8]=n.x,a[1]=i.y,a[5]=o.y,a[9]=n.y,a[2]=i.z,a[6]=o.z,a[10]=n.z,this}}(),i.prototype.compose=function(t,e,i){var o=this.elements,n=i.x,s=i.y,r=i.z,a=i.w,h=n+n,p=s+s,c=r+r,u=n*h,l=n*p,m=n*c,f=s*p,d=s*c,y=r*c,v=a*h,g=a*p,x=a*c,b=e.x,w=e.y,S=e.z;return o[0]=(1-(f+y))*b,o[4]=(l-x)*w,o[8]=(m+g)*S,o[1]=(l+x)*b,o[5]=(1-(u+y))*w,o[9]=(d-v)*S,o[2]=(m-g)*b,o[6]=(d+v)*w,o[10]=(1-(u+f))*S,o[3]=0,o[7]=0,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this},i.prototype.decompose=function(t,e,i){var n,s,r=this.elements,a=r[0],h=r[4],p=r[8],c=r[1],u=r[5],l=r[9],m=r[2],f=r[6],d=r[10],y=0,v=0,g=0,x=1,b=e.set(a,c,m).length(),w=e.set(h,u,f).length(),S=e.set(p,l,d).length(),_=1/b,O=1/w,N=1/S;return e.x=b,e.y=w,e.z=S,t.x=r[12],t.y=r[13],t.z=r[14],a*=_,h*=O,p*=N,c*=_,u*=O,l*=N,m*=_,f*=O,d*=N,n=a+u+d,n>0?(s=.5/o(n+1),x=.25/s,y=(f-l)*s,v=(p-m)*s,g=(c-h)*s):a>u&&a>d?(s=2*o(1+a-u-d),x=(f-l)/s,y=.25*s,v=(h+c)/s,g=(p+m)/s):u>d?(s=2*o(1+u-a-d),x=(p-m)/s,y=(h+c)/s,v=.25*s,g=(l+f)/s):(s=2*o(1+d-a-u),x=(c-h)/s,y=(p+m)/s,v=(l+f)/s,g=.25*s),i.x=y,i.y=v,i.w=x,i.z=g,this},i.prototype.setPosition=function(t){var e=this.elements,i=t.z;return e[12]=t.x,e[13]=t.y,e[14]=void 0!==i?i:0,this},i.prototype.extractPosition=function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},i.prototype.extractRotation=function(){var t=new e;return function(e){var i=this.elements,n=e.elements,s=t.set(n[0],n[1],n[2]).lengthSq(),r=t.set(n[4],n[5],n[6]).lengthSq(),a=t.set(n[8],n[9],n[10]).lengthSq(),h=s>0?1/o(s):0,p=r>0?1/o(r):0,c=a>0?1/o(a):0;return i[0]=n[0]*h,i[1]=n[1]*h,i[2]=n[2]*h,i[4]=n[4]*p,i[5]=n[5]*p,i[6]=n[6]*p,i[8]=n[8]*c,i[9]=n[9]*c,i[10]=n[10]*c,this}}(),i.prototype.extractRotationScale=function(){return new e,function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[8]=i[8],e[9]=i[9],e[10]=i[10],this}}(),i.prototype.translate=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z||0;return e[12]=e[0]*i+e[4]*o+e[8]*n+e[12],e[13]=e[1]*i+e[5]*o+e[9]*n+e[13],e[14]=e[2]*i+e[6]*o+e[10]*n+e[14],e[15]=e[3]*i+e[7]*o+e[11]*n+e[15],this},i.prototype.scale=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z;return e[0]*=i,e[4]*=o,e[8]*=n,e[1]*=i,e[5]*=o,e[9]*=n,e[2]*=i,e[6]*=o,e[10]*=n,e[3]*=i,e[7]*=o,e[11]*=n,this},i.prototype.rotateX=function(t){var e=this.elements,i=e[4],o=e[5],r=e[6],a=e[7],h=e[8],p=e[9],c=e[10],u=e[11],l=n(t),m=s(t);return e[4]=l*i+m*h,e[5]=l*o+m*p,e[6]=l*r+m*c,e[7]=l*a+m*u,e[8]=l*h-m*i,e[9]=l*p-m*o,e[10]=l*c-m*r,e[11]=l*u-m*a,this},i.prototype.rotateY=function(t){var e=this.elements,i=e[0],o=e[1],r=e[2],a=e[3],h=e[8],p=e[9],c=e[10],u=e[11],l=n(t),m=s(t);return e[0]=l*i-m*h,e[1]=l*o-m*p,e[2]=l*r-m*c,e[3]=l*a-m*u,e[8]=l*h+m*i,e[9]=l*p+m*o,e[10]=l*c+m*r,e[11]=l*u+m*a,this},i.prototype.rotateZ=function(t){var e=this.elements,i=e[0],o=e[1],r=e[2],a=e[3],h=e[4],p=e[5],c=e[6],u=e[7],l=n(t),m=s(t);return e[0]=l*i+m*h,e[1]=l*o+m*p,e[2]=l*r+m*c,e[3]=l*a+m*u,e[4]=l*h-m*i,e[5]=l*p-m*o,e[6]=l*c-m*r,e[7]=l*u-m*a,this},i.prototype.makeTranslation=function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)},i.prototype.makeScale=function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1)},i.prototype.makeRotationX=function(t){var e=n(t),i=s(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1)},i.prototype.makeRotationY=function(t){var e=n(t),i=s(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1)},i.prototype.makeRotationZ=function(t){var e=n(t),i=s(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1)},i.prototype.frustum=function(t,e,i,o,n,s){var r=this.elements,a=1/(e-t),h=1/(o-i),p=1/(n-s);return r[0]=2*n*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*n*h,r[6]=0,r[7]=0,r[8]=(e+t)*a,r[9]=(o+i)*h,r[10]=(s+n)*p,r[11]=-1,r[12]=0,r[13]=0,r[14]=2*s*n*p,r[15]=0,this},i.prototype.perspective=function(t,e,i,o){var n=this.elements,s=1/r(a(.5*t)),h=1/(i-o);return n[0]=s/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(o+i)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*o*i*h,n[15]=0,this},i.prototype.orthographic=function(t,e,i,o,n,s){var r=this.elements,a=1/(t-e),h=1/(i-o),p=1/(n-s);return r[0]=-2*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*p,r[11]=0,r[12]=(t+e)*a,r[13]=(o+i)*h,r[14]=(s+n)*p,r[15]=1,this},i.prototype.fromMat2=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=0,e[3]=0,e[4]=i[2],e[5]=i[3],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.prototype.fromMat32=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=0,e[3]=0,e[4]=i[2],e[5]=i[3],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[4],e[13]=i[5],e[14]=0,e[15]=1,this},i.prototype.fromMat3=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=0,e[4]=i[3],e[5]=i[4],e[6]=i[5],e[7]=0,e[8]=i[6],e[9]=i[7],e[10]=i[8],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.prototype.fromQuat=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z,s=t.w,r=i+i,a=o+o,h=n+n,p=i*r,c=i*a,u=i*h,l=o*a,m=o*h,f=n*h,d=s*r,y=s*a,v=s*h;return e[0]=1-(l+f),e[4]=c-v,e[8]=u+y,e[1]=c+v,e[5]=1-(p+f),e[9]=m-d,e[2]=u-y,e[6]=m+d,e[10]=1-(p+l),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},i.prototype.toJSON=function(){json||(json={});var t=this.elements,e=json.elements||(json.elements=[]);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],json},i.prototype.toString=function(){var t=this.elements;return"Mat4["+t[0]+", "+t[4]+", "+t[8]+", "+t[12]+"]\n"+"     ["+t[1]+", "+t[5]+", "+t[9]+", "+t[13]+"]\n"+"     ["+t[2]+", "+t[6]+", "+t[10]+", "+t[14]+"]\n"+"     ["+t[3]+", "+t[7]+", "+t[11]+", "+t[15]+"]"},i}),define("core/components/camera",["base/class","math/mathf","math/color","math/vec3","math/mat4","core/components/component"],function(t,e,i,o,n,s){function r(t){t||(t={}),s.call(this,"Camera",void 0!=t.sync?!!t.sync:!1,t.json),this.backgroundColor=void 0!==t.backgroundColor?t.backgroundColor:new i(.5,.5,.5),this.width=960,this.height=640,this.aspect=this.width/this.height,this.fov=void 0!==t.fov?t.fov:35,this.near=void 0!==t.near?t.near:.1,this.far=void 0!==t.far?t.far:512,this.orthographic=void 0!==t.orthographic?!!t.orthographic:!1,this.orthographicSize=void 0!==t.orthographicSize?t.orthographicSize:2,this.minOrthographicSize=void 0!==t.minOrthographicSize?t.minOrthographicSize:.01,this.maxOrthographicSize=void 0!==t.maxOrthographicSize?t.maxOrthographicSize:1024,this.projection=new n,this.view=new n,this._needsUpdate=!0,this._active=!1}var a=e.degsToRads;r.type="Camera",t.extend(r,s),r.prototype.copy=function(t){return this.backgroundColor.copy(t.backgroundColor),this.width=t.width,this.height=t.height,this.aspect=t.aspect,this.far=t.far,this.near=t.near,this.fov=t.fov,this.orthographic=t.orthographic,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},r.prototype.set=function(t,e){this.width=t,this.height=e,this.aspect=t/e,this._needsUpdate=!0},r.prototype.setWidth=function(t){this.width=t,this.aspect=t/this.height,this._needsUpdate=!0},r.prototype.setHeight=function(t){this.height=t,this.aspect=this.width/t,this._needsUpdate=!0},r.prototype.setFov=function(t){this.fov=t,this._needsUpdate=!0},r.prototype.setNear=function(t){this.near=t,this._needsUpdate=!0},r.prototype.setFar=function(t){this.far=t,this._needsUpdate=!0},r.prototype.setOrthographic=function(t){this.orthographic=!!t,this._needsUpdate=!0},r.prototype.toggleOrthographic=function(){this.orthographic=!this.orthographic,this._needsUpdate=!0},r.prototype.setOrthographicSize=function(t){this.orthographicSize=clamp(t,this.minOrthographicSize,this.maxOrthographicSize),this._needsUpdate=!0};var h=new n,p=new o;return r.prototype.toWorld=function(t,e){return e||(e=new o),e.x=2*t.x/this.width-1,e.y=-2*t.y/this.height+1,e.transformMat4(h.mmul(this.projection,this.view).inverse()),e.z=this.near,e},r.prototype.toScreen=function(t,e){return e||(e=new Vec2),p.copy(t),p.transformMat4(h.mmul(this.projection,this.view)),e.x=.5*(p.x+1)*this.width,e.y=.5*(1-p.y)*this.height,t},r.prototype.update=function(){if(this._active){if(this._needsUpdate){if(this.orthographic){this.orthographicSize=clamp(this.orthographicSize,this.minOrthographicSize,this.maxOrthographicSize);var t=this.orthographicSize,e=t*this.aspect,i=-e,o=t,n=-o;this.projection.orthographic(i,e,n,o,this.near,this.far)}else this.projection.perspective(a(this.fov),this.aspect,this.near,this.far);this._needsUpdate=!1}this.view.inverseMat(this.transform.matrixWorld)}},r.prototype.sort=function(t,e){return t._active?-1:e._active?1:-1},r.prototype.toSYNC=function(t){return t=s.prototype.toSYNC.call(this,t),t.backgroundColor=this.backgroundColor.toJSON(t.backgroundColor),t.width=this.width,t.height=this.height,t.aspect=this.aspect,t.far=this.far,t.near=this.near,t.fov=this.fov,t.orthographic=this.orthographic,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},r.prototype.fromSYNC=function(t){return s.prototype.fromSYNC.call(this,t),(t.width!==this.width||t.height!==this.height)&&(this._needsUpdate=!0),this.backgroundColor.fromJSON(t.backgroundColor),this.width=t.width,this.height=t.height,this.aspect=t.aspect,this.far=t.far,this.near=t.near,this.fov=t.fov,this.orthographic=t.orthographic,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this},r.prototype.toJSON=function(t){return t||(t={}),s.prototype.toJSON.call(this,t),t.backgroundColor=this.backgroundColor.toJSON(t.backgroundColor),t.width=this.width,t.height=this.height,t.aspect=this.aspect,t.far=this.far,t.near=this.near,t.fov=this.fov,t.orthographic=this.orthographic,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},r.prototype.fromJSON=function(t){return s.prototype.fromJSON.call(this,t),this.backgroundColor.fromJSON(t.backgroundColor),this.width=t.width,this.height=t.height,this.aspect=t.aspect,this.far=t.far,this.near=t.near,this.fov=t.fov,this.orthographic=t.orthographic,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},r}),define("core/components/camera_2d",["base/class","math/mathf","math/color","math/vec2","math/mat32","math/mat4","core/components/component"],function(t,e,i,o,n,s,r){function a(t){t||(t={}),r.call(this,"Camera2D",void 0!=t.sync?!!t.sync:!1,t.json),this.backgroundColor=void 0!==t.backgroundColor?t.backgroundColor:new i(.5,.5,.5),this.width=960,this.height=640,this.aspect=this.width/this.height,this.orthographicSize=void 0!==t.orthographicSize?t.orthographicSize:2,this.minOrthographicSize=void 0!==t.minOrthographicSize?t.minOrthographicSize:.01,this.maxOrthographicSize=void 0!==t.maxOrthographicSize?t.maxOrthographicSize:1024,this.projection=new n,this.view=new n,this._needsUpdate=!0,this._active=!1}var h=e.clamp;e.degsToRads,a.type="Camera2D",t.extend(a,r),a.prototype.copy=function(t){return this.backgroundColor.copy(t.backgroundColor),this.width=t.width,this.height=t.height,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},a.prototype.set=function(t,e){this.width=t,this.height=e,this.aspect=t/e,this._needsUpdate=!0},a.prototype.setWidth=function(t){this.width=t,this.aspect=t/this.height,this._needsUpdate=!0},a.prototype.setHeight=function(t){this.height=t,this.aspect=this.width/t,this._needsUpdate=!0},a.prototype.setOrthographicSize=function(t){this.orthographicSize=h(t,this.minOrthographicSize,this.maxOrthographicSize),this._needsUpdate=!0};var p=new n,c=new o;return a.prototype.toWorld=function(t,e){return e||(e=new Vec3),e.x=2*t.x/this.width-1,e.y=-2*t.y/this.height+1,e.transformMat32(p.mmul(this.projection,this.view).inverse()),e},a.prototype.toScreen=function(t,e){return e||(e=new o),c.copy(t).transformMat32(p.mmul(this.projection,this.view)),e.x=.5*(c.x+1)*this.width,e.y=.5*(1-c.y)*this.height,t},a.prototype.update=function(){if(this._active){if(this._needsUpdate){var t=this.orthographicSize,e=t*this.aspect,i=-e,o=t,n=-o;this.projection.orthographic(i,e,n,o),this._needsUpdate=!1}this.view.inverseMat(this.transform2d.matrixWorld)}},a.prototype.sort=function(t,e){return t._active?-1:e._active?1:-1},a.prototype.toSYNC=function(t){return t=r.prototype.toSYNC.call(this,t),t.backgroundColor=this.backgroundColor.toJSON(t.backgroundColor),t.width=this.width,t.height=this.height,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},a.prototype.fromSYNC=function(t){return r.prototype.fromSYNC.call(this,t),(t.width!==this.width||t.height!==this.height)&&(this._needsUpdate=!0),this.backgroundColor.fromJSON(t.backgroundColor),this.width=t.width,this.height=t.height,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this},a.prototype.toJSON=function(t){return t||(t={}),r.prototype.toJSON.call(this,t),t.backgroundColor=this.backgroundColor.toJSON(t.backgroundColor),t.width=this.width,t.height=this.height,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},a.prototype.fromJSON=function(t){return r.prototype.fromJSON.call(this,t),this.backgroundColor.fromJSON(t.backgroundColor),this.width=t.width,this.height=t.height,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},a}),"function"!=typeof define)var define=require("amdefine")(module);define("core/components/emitter_2d",["base/class","base/object_pool","base/time","math/mathf","math/vec2","math/color","core/components/component"],function(t,e,i,o,n,s,r){function a(t){t||(t=p),r.call(this,"Emitter2D",void 0!=t.sync?!!t.sync:!1,t.json),this.worldSpace=void 0!=t.worldSpace?t.worldSpace:!0,this.offset=void 0!=t.offset?t.offset:new n,this.minEmission=void 0!=t.minEmission?t.minEmission:1,this.maxEmission=void 0!=t.maxEmission?t.maxEmission:2,this.minLife=void 0!=t.minLife?t.minLife:1,this.maxLife=void 0!=t.maxLife?t.maxLife:2,this.minSize=void 0!=t.minSize?t.minSize:.1,this.maxSize=void 0!=t.maxSize?t.maxSize:.5,this.velocity=void 0!=t.velocity?t.velocity:new n(0,0,0),this.randVelocity=void 0!=t.randVelocity?t.randVelocity:new n(1,1,1),this.angularVelocity=void 0!=t.angularVelocity?t.angularVelocity:0,this.randAngularVelocity=void 0!=t.randAngularVelocity?t.randAngularVelocity:c,this.randRotation=void 0!=t.randRotation?t.randRotation:!0,this.emissionRate=void 0!=t.emissionRate?t.emissionRate:1/60,this.color=void 0!=t.color?t.color:new s,this.randColor=void 0!=t.randColor?t.randColor:new s,this.alphaStart=void 0!=t.alphaStart?t.alphaStart:0,this.time=void 0!=t.time?t.time:0,this._time=0,this.duration=void 0!=t.duration?t.duration:0,this.loop=void 0!=t.loop?t.loop:!0,this.playing=void 0!=t.playing?t.playing:!0,this.particles=[],this._OBJ=[]}function h(){this.alpha=0,this.lifeTime=0,this.life=1,this.size=1,this.color=new s,this.position=new n,this.velocity=new n,this.rotation=0,this.angularVelocity=0,this._OBJ={}
}var p={},c=Math.PI,u=2*c,l=(Math.sqrt,Math.random),m=o.randInt,f=o.randFloat,d=o.clampTop,y=a.PARTICLE_POOL=new e(h);a.type="Emitter2D",t.extend(a,r),a.prototype.copy=function(t){return this.worldSpace=t.worldSpace,this.minEmission=t.minEmission,this.maxEmission=t.maxEmission,this.minLife=t.minLife,this.maxLife=t.maxLife,this.minSize=t.minSize,this.maxSize=t.maxSize,this.velocity.copy(t.velocity),this.randVelocity.copy(t.randVelocity),this.angularVelocity=t.angularVelocity,this.randAngularVelocity=t.randAngularVelocity,this.randRotation=t.randRotation,this.emissionRate=t.emissionRate,this.color.copy(t.color),this.randColor.copy(t.randColor),this.time=t.time,this._time=t._time,this.duration=t.duration,this.loop=t.loop,this.playing=t.playing,this},a.prototype.play=function(){this.playing||(this.time=0,this.playing=!0)};var v=new n;return a.prototype.spawn=function(t){var e,i,o,n,s,r=this.gameObject.transform2d||this.gameObject.transform,h=r.toWorld(v.set(0,0)),p=this.offset,c=this.particles,m=c.length,g=this.worldSpace,x=this.randRotation,b=this.color,w=this.randColor,S=w.lengthSq()>0,_=this.velocity,O=this.randVelocity,N=this.angularVelocity,z=this.randAngularVelocity,C=this.minLife,A=this.maxLife,E=this.minSize,J=this.maxSize,M=this.alphaStart,R=d(m+t,a.MAX_PARTICLES)-m;for(s=R;s--;)e=y.create(),o=e.position,i=e.velocity,n=e.color,n.r=b.r,n.g=b.g,n.b=b.b,S&&(n.r+=w.r*l(),n.g+=w.g*l(),n.b+=w.b*l(),n.check()),g?(o.x=p.x+h.x,o.y=p.y+h.y):(o.x=p.x,o.y=p.y),e.rotation=x?l()*u:0,e.lifeTime=0,e.life=f(C,A),e.size=f(E,J),i.x=_.x+f(-O.x,O.x),i.y=_.y+f(-O.y,O.y),e.angularVelocity=N+f(-z,z),e.alpha=M,c.push(e);this.playing=!0},a.prototype.update=function(){if(this.time>this.duration&&!this.loop&&(this.playing=!1),this.playing||0!==this.particles.length){var t,e,o,n,s,r,a,h=i.delta,p=(this.forces,this.particles);for(this.alphaStart,this.time+=h,this._time+=h,this.playing&&this._time>this.emissionRate&&(this._time=0,this.spawn(m(this.minEmission,this.maxEmission))),a=p.length;a--;)t=p[a],n=t.lifeTime,s=t.life,r=n/s,r>1?(y.removeObject(t),p.splice(a,1)):(e=t.position,o=t.velocity,e.x+=o.x*h,e.y+=o.y*h,t.rotation+=t.angularVelocity*h,t.lifeTime+=h,t.alpha=1-r)}},a.prototype.toJSON=function(t){return t||(t={}),r.prototype.toJSON.call(this,t),t.worldSpace=this.worldSpace,t.offset=this.offset.toJSON(t.offset),t.minEmission=this.minEmission,t.maxEmission=this.maxEmission,t.minLife=this.minLife,t.maxLife=this.maxLife,t.minSize=this.minSize,t.maxSize=this.maxSize,t.velocity=this.velocity.toJSON(t.velocity),t.randVelocity=this.randVelocity.toJSON(t.randVelocity),t.angularVelocity=this.angularVelocity,t.randAngularVelocity=this.randAngularVelocity,t.randRotation=this.randRotation,t.emissionRate=this.emissionRate,t.color=this.color.toJSON(t.color),t.randColor=this.randColor.toJSON(t.randColor),t.time=this.time,t._time=this._time,t.duration=this.duration,t.loop=this.loop,t.playing=this.playing,t},a.prototype.fromJSON=function(t){return r.prototype.fromJSON.call(this,t),this.worldSpace=t.worldSpace,this.offset.fromJSON(t.offset),this.minEmission=t.minEmission,this.maxEmission=t.maxEmission,this.minLife=t.minLife,this.maxLife=t.maxLife,this.minSize=t.minSize,this.maxSize=t.maxSize,this.velocity.fromJSON(t.velocity),this.randVelocity.fromJSON(t.randVelocity),this.angularVelocity=t.angularVelocity,this.randAngularVelocity=t.randAngularVelocity,this.randRotation=t.randRotation,this.emissionRate=t.emissionRate,this.color.fromJSON(t.color),this.randColor.fromJSON(t.randColor),this.time=t.time,this._time=t._time,this.duration=t.duration,this.loop=t.loop,this.playing=t.playing,this},a.Particle2D=h,a.MAX_PARTICLES=1024,a}),define("core/components/rigid_body_2d",["base/class","core/components/component","phys_2d/dynamic/rigid_body"],function(t,e,i){function o(t){t||(t={}),e.call(this,"RigidBody2D",t.sync,t.json),this.body=new i(t)}return o.type="RigidBody2D",t.extend(o,e),o.prototype.copy=function(){return this},o.prototype.init=function(){},o.prototype.update=function(){},o.prototype.sort=function(t,e){return t===e?1:-1},o.prototype.toSYNC=function(t){return t=e.prototype.toSYNC.call(this,t)},o.prototype.fromSYNC=function(){return this},o.prototype.toJSON=function(t){return t||(t={}),e.prototype.toJSON.call(this,t),t.body=this.body.toJSON(t.body),t},o.prototype.fromJSON=function(t){return e.prototype.fromJSON.call(this,t),this.body.fromJSON(t.body),this},o}),define("core/components/sprite_2d",["base/class","base/time","math/vec2","core/components/component","core/assets/assets"],function(t,e,i,o,n){function s(t){t||(t={}),o.call(this,"Sprite2D",void 0!=t.sync?!!t.sync:!1,t.json),this.visible=void 0!=t.visible?!!t.visible:!0,this.z=void 0!=t.z?t.z:0,this.alpha=void 0!=t.alpha?t.alpha:1,this.texture=void 0!=t.texture?t.texture:void 0,this.width=t.width||1,this.height=t.height||1,this.x=t.x||0,this.y=t.y||0,this.w=t.w||1,this.h=t.h||1}return s.type="Sprite2D",t.extend(s,o),s.prototype.copy=function(t){return this.visible=t.visible,this.z=t.z,this.alpha=t.alpha,this.texture=t.texture,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},s.prototype.toSYNC=function(t){return t=o.prototype.toSYNC.call(this,t),t.visible=this.visible,t.z=this.z,t.alpha=this.alpha,t.width=this.width,t.height=this.height,t},s.prototype.fromSYNC=function(t){return o.prototype.fromSYNC.call(this,t),this.visible=t.visible,this.z=t.z,this.alpha=t.alpha,this.width=t.width,this.height=t.height,this},s.prototype.toJSON=function(t){return t||(t={}),o.prototype.toJSON.call(this,t),t.visible=this.visible,t.z=this.z,t.alpha=this.alpha,t.texture=this.texture?this.texture.name:void 0,t.width=this.width,t.height=this.height,t.x=this.x,t.y=this.y,t.w=this.w,t.h=this.h,t},s.prototype.fromJSON=function(t){return o.prototype.fromJSON.call(this,t),this.visible=t.visible,this.z=t.z,this.alpha=t.alpha,this.texture=t.texture?n.hash[t.texture]:void 0,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},s.prototype.sort=function(t,e){return e.z-t.z},s.ONCE=1,s.LOOP=2,s.PING_PONG=3,s}),define("math/quat",["math/mathf","math/vec3"],function(t,e){function i(t,e,i,o){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==o?o:1}var o=Math.abs,n=Math.sqrt,r=Math.acos,a=Math.sin,h=Math.cos,p=t.EPSILON;return i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.set=function(t,e,i,o){return this.x=t,this.y=e,this.z=i,this.w=o,this},i.prototype.mul=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,s=t.x,r=t.y,a=t.z,h=t.w;return this.x=e*h+n*s+i*a-o*r,this.y=i*h+n*r+o*s-e*a,this.z=o*h+n*a+e*r-i*s,this.w=n*h-e*s-i*r-o*a,this},i.prototype.qmul=function(t,e){var i=t.x,o=t.y,n=t.z,s=t.w,r=e.x,a=e.y,h=e.z,p=e.w;return this.x=i*p+s*r+o*h-n*a,this.y=o*p+s*a+n*r-i*h,this.z=n*p+s*h+i*a-o*r,this.w=s*p-i*r-o*a-n*h,this},i.prototype.div=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,s=-t.x,r=-t.y,a=-t.z,h=t.w;return this.x=e*h+n*s+i*a-o*r,this.y=i*h+n*r+o*s-e*a,this.z=o*h+n*a+e*r-i*s,this.w=n*h-e*s-i*r-o*a,this},i.prototype.qdiv=function(t,e){var i=t.x,o=t.y,n=t.z,s=t.w,r=-e.x,a=-e.y,h=-e.z,p=e.w;return this.x=i*p+s*r+o*h-n*a,this.y=o*p+s*a+n*r-i*h,this.z=n*p+s*h+i*a-o*r,this.w=s*p-i*r-o*a-n*h,this},i.prototype.length=function(){var t=this.x,e=this.y,i=this.z,o=this.w,s=t*t+e*e+i*i+o*o;return s>0?n(s):0},i.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z,o=this.w;return t*t+e*e+i*i+o*o},i.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,o=this.w,s=t*t+e*e+i*i+o*o;return s=s>0?1/n(s):0,this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},i.prototype.inverse=function(){var t=this.x,e=this.y,i=this.z,o=this.w,n=t*t+e*e+i*i+o*o,s=n>0?1/n:0;return this.x*=-s,this.y*=-s,this.z*=-s,this.w*=s,this},i.prototype.inverseQuat=function(t){var e=t.x,i=t.y,o=t.z,n=t.w,s=e*e+i*i+o*o+n*n,r=s>0?1/s:0;return this.x=-e*r,this.y=-i*r,this.z=-o*r,this.w=n*r,this},i.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.calculateW=function(){var t=this.x,e=this.y,i=this.z;return this.w=-n(o(1-t*t-e*e-i*i)),this},i.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},i.prototype.qlerp=function(t,e,i){var o=t.x,n=t.y,s=t.z,r=t.w;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=s+(e.z-s)*i,this.w=r+(e.w-r)*i,this},i.prototype.nlerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this.normalize()},i.prototype.qnlerp=function(t,e,i){var o=t.x,n=t.y,s=t.z,r=t.w;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=s+(e.z-s)*i,this.w=r+(e.w-r)*i,this.normalize()},i.prototype.slerp=function(t,e){var i,o,n,s,h=this.x,c=this.y,u=this.z,l=this.w,m=t.x,f=t.y,d=t.z,y=t.w,v=h*m+c*f+u*d+l*y;return 0>v&&(v*=-1,m*=-1,f*=-1,d*=-1,y*=-1),1-v>p?(i=r(v),o=1/a(i),n=a((1-e)*i)*o,s=a(e*i)*o):(n=1-e,s=e),this.x=n*h+s*m,this.y=n*c+s*f,this.z=n*u+s*d,this.w=n*l+s*y,this},i.prototype.qslerp=function(t,e,i){var o,n,s,h,c=t.x,u=t.y,l=t.z,m=t.w,f=e.x,d=e.y,y=e.z,v=e.w,g=c*f+u*d+l*y+m*v;return 0>g&&(g*=-1,f*=-1,d*=-1,y*=-1,v*=-1),1-g>p?(o=r(g),n=1/a(o),s=a((1-i)*o)*n,h=a(i*o)*n):(s=1-i,h=i),this.x=s*c+h*f,this.y=s*u+h*d,this.z=s*l+h*y,this.w=s*m+h*v,this},i.qdot=i.prototype.qdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.prototype.rotateX=function(t){var e=.5*t,i=this.x,o=this.y,n=this.z,s=this.w,r=a(e),p=h(e);return this.x=i*p+s*r,this.y=o*p+n*r,this.z=n*p-o*r,this.w=s*p-i*r,this},i.prototype.rotateY=function(t){var e=.5*t,i=this.x,o=this.y,n=this.z,s=this.w,r=a(e),p=h(e);return this.x=i*p-n*r,this.y=o*p+s*r,this.z=n*p+i*r,this.w=s*p-o*r,this},i.prototype.rotateZ=function(t){var e=.5*t,i=this.x,o=this.y,n=this.z,s=this.w,r=a(e),p=h(e);return this.x=i*p+o*r,this.y=o*p-i*r,this.z=n*p+s*r,this.w=s*p-n*r,this},i.prototype.rotate=function(t,e,i){return this.rotateZ(i),this.rotateX(t),this.rotateY(e),this},i.prototype.lookRotation=function(t,e){var i=t.x,o=t.y,n=t.z,r=e.x,a=u.y,h=e.z,p=a*n-h*o,c=h*i-r*n,l=r*o-a*i,m=2*(1+r*i+a*o+h*n),f=m*m;return s=1/f,this.x=p*s,this.y=c*s,this.z=l*s,this.w=.5*f,this},i.prototype.fromAxisAngle=function(t,e){var i=.5*e,o=a(i);return this.x=t.x*o,this.y=t.y*o,this.z=t.z*o,this.w=h(i),this},i.prototype.fromVec3s=function(){var t=new e;return function(e,i){return t.vcross(e,i),this.x=t.x,this.y=t.y,this.z=t.z,this.w=n(e.lengthSq()*i.lengthSq())+e.dot(i),this.normalize()}}(),i.prototype.fromMat3=function(t){var e,i,o=t.elements,s=o[0],r=o[3],a=o[6],h=o[1],p=o[4],c=o[7],u=o[2],l=o[5],m=o[8],f=s+p+m;return f>0?(e=.5/n(f+1),this.w=.25/e,this.x=(l-c)*e,this.y=(a-u)*e,this.z=(h-r)*e):s>p&&s>m?(e=2*n(1+s-p-m),i=1/e,this.w=(l-c)*i,this.x=.25*e,this.y=(r+h)*i,this.z=(a+u)*i):p>m?(e=2*n(1+p-s-m),i=1/e,this.w=(a-u)*i,this.x=(r+h)*i,this.y=.25*e,this.z=(c+l)*i):(e=2*n(1+m-s-p),i=1/e,this.w=(h-r)*i,this.x=(a+u)*i,this.y=(c+l)*i,this.z=.25*e),this},i.prototype.fromMat4=function(t){var e,i,o=t.elements,s=o[0],r=o[4],a=o[8],h=o[1],p=o[5],c=o[9],u=o[2],l=o[6],m=o[10],f=s+p+m;return f>0?(e=.5/n(f+1),this.w=.25/e,this.x=(l-c)*e,this.y=(a-u)*e,this.z=(h-r)*e):s>p&&s>m?(e=2*n(1+s-p-m),i=1/e,this.w=(l-c)*i,this.x=.25*e,this.y=(r+h)*i,this.z=(a+u)*i):p>m?(e=2*n(1+p-s-m),i=1/e,this.w=(a-u)*i,this.x=(r+h)*i,this.y=.25*e,this.z=(c+l)*i):(e=2*n(1+m-s-p),i=1/e,this.w=(h-r)*i,this.x=(a+u)*i,this.y=(c+l)*i,this.z=.25*e),this},i.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},i.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},i.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},i.prototype.toString=function(){return"Quat( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},i}),define("core/components/transform",["base/class","math/mathf","math/vec3","math/quat","math/mat4","core/components/component","core/game/log"],function(t,e,i,o,n,s,r){function a(t){t||(t={}),s.call(this,"Transform",t.sync,t.json),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!==t.position?t.position:new i,this.rotation=void 0!==t.rotation?t.rotation:new o,this.scale=void 0!==t.scale?t.scale:new i(1,1,1),this.matrix=new n,this.matrixWorld=new n,this.modelView=new n,this._modelViewNeedsUpdate=!1}function h(t,e){var i,o=t.children;for(t.depth=e,i=o.length;i--;)h(o[i],e+1)}var p=e.EPSILON;a.type="Transform",t.extend(a,s),a.prototype.copy=function(t){var e,i=t.children;for(this.position.copy(t.position),this.scale.copy(t.scale),this.rotation.copy(t.rotation),e=i.length;e--;)this.add(i[e].gameObject.clone().transform);return t.parent&&t.parent.add(this),this},a.prototype.translate=function(){var t=new i;return function(e,i){return t.copy(e),i instanceof a?t.transformQuat(i.rotation):i instanceof o&&t.transformQuat(i),this.position.add(t),this}}(),a.prototype.rotate=function(){var t=new i;return function(e,i){return t.copy(e),i instanceof a?t.transformQuat(i.rotation):i instanceof o&&t.transformQuat(i),this.rotation.rotate(t.x,t.y,t.z),this}}(),a.prototype.lookAt=function(){var t=new n,e=new i,o=new i(0,0,1);return function(i,n){return n=n||o,i instanceof a?e.copy(i.position):e.copy(i),t.lookAt(this.position,e,n),this.rotation.fromMat4(t),this}}(),a.prototype.follow=function(){var t=new i,e=new i,o=new i;return function(i,n){return e.set(0,0,0).transformMat4(this.matrixWorld),t.set(0,0,0).transformMat4(i.matrixWorld),o.vsub(t,e),o.lengthSq()>p&&this.position.add(o.smul(n)),this}}(),a.prototype.addChild=function(t){if(!(t instanceof a))return r.warn("Transform.add: can't add passed argument, it is not instance of Transform"),this;var e,i,o=this.children,n=o.indexOf(t);if(0>n){for(t.parent&&t.parent.remove(t),t.parent=this,o.push(t),e=this,i=0;e.parent;)e=e.parent,i++;t.root=e,this.root=e,h(this,i)}else r.warn("Transform.add: child is not a member of this Transform");return this},a.prototype.add=a.prototype.addChildren=function(){for(var t=arguments.length;t--;)this.addChild(arguments[t]);return this},a.prototype.removeChild=function(t){var e,i,o=this.children,n=o.indexOf(t);if(n>-1){for(t.parent=void 0,o.splice(n,1),e=this,i=0;e.parent;)e=e.parent,i++;t.root=t,this.root=e,h(this,i)}else r.warn("Transform.remove: child is not a member of this Transform");return this},a.prototype.remove=a.prototype.removeChildren=function(){for(var t=arguments.length;t--;)this.removeChild(arguments[t]);return this},a.prototype.detachChildren=function(){var t,e=this.children;for(t=e.length;t--;)this.removeChild(e[t]);return this},a.prototype.toWorld=function(t){return t.transformMat4(this.matrixWorld)},a.prototype.toLocal=function(){var t=new n;return function(e){return e.transformMat4(t.inverseMat(this.matrixWorld))}}(),a.prototype.update=function(){var t=this.matrix,e=this.parent;t.compose(this.position,this.scale,this.rotation),e?this.matrixWorld.mmul(e.matrixWorld,t):this.matrixWorld.copy(t),this._modelViewNeedsUpdate=!0},a.prototype.updateModelView=function(t){this._modelViewNeedsUpdate&&(this.modelView.mmul(t,this.matrixWorld),this._modelViewNeedsUpdate=!1)},a.prototype.sort=function(t,e){return e.depth-t.depth};var c=new i;return a.prototype.toSYNC=function(t){return t=s.prototype.toSYNC.call(this,t),this.parent?(t.position=this.toWorld(c.copy(this.position)).toJSON(t.position),t.scale=this.toWorld(c.copy(this.scale)).toJSON(t.scale),t.rotation=this.toWorld(c.copy(this.rotation)).toJSON(t.rotation)):(t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation.toJSON(t.rotation)),t},a.prototype.fromSYNC=function(t){return this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation.fromJSON(t.rotation),this},a.prototype.toJSON=function(t){return t||(t={}),s.prototype.toJSON.call(this,t),t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation.toJSON(t.rotation),t},a.prototype.fromJSON=function(t){return s.prototype.fromJSON.call(this,t),this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation.fromJSON(t.rotation),this},a}),define("core/components/transform_2d",["base/class","math/mathf","math/vec2","math/mat32","math/mat4","core/components/component","core/game/log"],function(t,e,i,o,n,s,r){function a(t){t||(t={}),s.call(this,"Transform2D",t.sync,t.json),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!=t.position?t.position:new i,this.rotation=void 0!=t.rotation?t.rotation:0,this.scale=void 0!=t.scale?t.scale:new i(1,1),this.matrix=new o,this.matrixWorld=new o,this.modelView=new o,this._modelViewNeedsUpdate=!1}function h(t,e){var i,o=t.children;for(t.depth=e,i=o.length;i--;)h(o[i],e+1)}var p=(e.lerp,e.EPSILON);a.type="Transform2D",t.extend(a,s),a.prototype.copy=function(t){var e,i=t.children;for(this.position.copy(t.position),this.scale.copy(t.scale),this.rotation=t.rotation,e=i.length;e--;)this.add(i[e].gameObject.clone().transform);return t.parent&&t.parent.add(this),this},a.prototype.translate=function(){var t=new i;return function(e,i){return t.copy(e),i instanceof a?t.transformAngle(i.rotation):i&&t.transformAngle(i),this.position.add(t),this}}(),a.prototype.rotate=function(){var t=new i;return function(e,i){return t.copy(e),i instanceof a?t.transformAngle(i.rotation):i&&t.transformAngle(i),this.rotation.rotate(t.x,t.y,t.z),this}}(),a.prototype.lookAt=function(){var t=new o,e=new i;return function(i,o){return o=o||dup,i instanceof a?e.copy(i.position):e.copy(i),t.lookAt(this.position,e),this.rotation=t.getRotation(),this}}(),a.prototype.follow=function(){var t=new i,e=new i,o=new i;return function(i,n){return e.set(0,0).transformMat32(this.matrixWorld),t.set(0,0).transformMat32(i.matrixWorld),o.vsub(t,e),o.lengthSq()>p&&this.position.add(o.smul(n)),this}}(),a.prototype.addChild=function(t){if(!(t instanceof a))return r.warn("Transform2D.add: can't add passed argument, it is not instance of Transform2D"),this;var e,i,o=this.children,n=o.indexOf(t);if(0>n){for(t.parent&&t.parent.remove(t),t.parent=this,o.push(t),e=this,i=0;e.parent;)e=e.parent,i++;t.root=e,this.root=e,h(this,i)}else r.warn("Transform2D.add: child is not a member of this Transform2D");return this},a.prototype.add=a.prototype.addChildren=function(){for(var t=arguments.length;t--;)this.addChild(arguments[t]);return this},a.prototype.removeChild=function(t){var e,i,o=this.children,n=o.indexOf(t);if(n>-1){for(t.parent=void 0,o.splice(n,1),e=this,i=0;e.parent;)e=e.parent,i++;t.root=t,this.root=e,h(this,i)}else r.warn("Transform2D.remove: child is not a member of this Transform2D");return this},a.prototype.remove=a.prototype.removeChildren=function(){for(var t=arguments.length;t--;)this.removeChild(arguments[t]);return this},a.prototype.detachChildren=function(){var t,e=this.children;for(t=e.length;t--;)this.removeChild(e[t]);return this},a.prototype.toWorld=function(t){return t.transformMat32(this.matrixWorld)},a.prototype.toLocal=function(){var t=new o;return function(e){return e.transformMat32(t.inverseMat(this.matrixWorld))}}(),a.prototype.update=function(){var t=this.matrix,e=this.parent;t.compose(this.position,this.scale,this.rotation),e?this.matrixWorld.mmul(e.matrixWorld,t):this.matrixWorld.copy(t),this._modelViewNeedsUpdate=!0},a.prototype.updateModelView=function(t){this._modelViewNeedsUpdate&&(this.modelView.mmul(t,this.matrixWorld),this._modelViewNeedsUpdate=!1)},a.prototype.sort=function(t,e){return e.depth-t.depth};var c=new i;return a.prototype.toSYNC=function(t){return t=s.prototype.toSYNC.call(this,t),this.parent?(t.position=this.toWorld(c.copy(this.position)).toJSON(t.position),t.scale=this.toWorld(c.copy(this.scale)).toJSON(t.scale),t.rotation=this.rotation-this.parent.rotation):(t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation),t},a.prototype.fromSYNC=function(t){return this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation=t.rotation,this},a.prototype.toJSON=function(t){return t||(t={}),s.prototype.toJSON.call(this,t),t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation,t},a.prototype.fromJSON=function(t){return s.prototype.fromJSON.call(this,t),this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation=t.rotation,this},a}),define("core/game/loop",["base/request_animation_frame","core/game/log"],function(t,e){function i(t,e){e||(e=this),this._loopState=n,this._runState=r,this.callback=t,this.ctx=e||this;var i=this;this._run=function(n){i._runState=s,t&&(t.call(e,n),i._loopState===o?i._pump():i.pause()),i._runState=r}}i.prototype.init=i.prototype.resume=function(){return this.callback?(this._loopState=o,this._runState===r&&this._pump(),void 0):(e.warn("Loop.resume: can't run loop without callback"),void 0)},i.prototype.pause=function(){this._loopState=n},i.prototype.isRunning=function(){return this._loopState===o},i.prototype.isPaused=function(){return this._loopState===n},i.prototype._pump=function(){t(this._run)};var o=i.L_RUNNING=1,n=i.L_PAUSED=2,s=i.R_RUNNING=1,r=i.R_PAUSED=2;return i}),define("core/game_object",["base/class","core/components/component","core/game/log"],function(t,e,i){function o(e){e||(e={}),t.call(this),this.sync=void 0!=e.sync?!!e.sync:!0,this.json=void 0!=e.json?!!e.json:!0,this.scene=void 0,this.tags=[],this.components=[],this._componentHash={},this._componentHashServer={},e.tags&&this.addTags.apply(this,e.tags),e.components&&this.addComponents.apply(this,e.components)}return t.extend(o,t),o.prototype.copy=function(t){var e,i=t.components,o=t.tags;for(this.clear(),e=i.length;e--;)this.addComponent(i[e].clone());for(e=o.length;e--;)this.addTag(o[e]);return t.scene&&t.scene.addGameObject(this),this},o.prototype.clear=function(){var t,e=this.components,i=this.tags;for(t=i.length;t--;)this.removeTag(i[t]);for(t=e.length;t--;)this.removeComponent(e[t]);return this},o.prototype.destroy=function(){return this.scene?(this.scene.removeGameObject(this),this.emit("destroy"),this.clear(),this):(i.warn("GameObject.destroy: can't destroy GameObject if it's not added to a Scene"),this)},o.prototype.addTag=function(t){var e=this.tags,i=e.indexOf(t);return-1===i&&e.push(t),this},o.prototype.addTags=function(){for(var t=arguments.length;t--;)this.addTag(arguments[t]);return this},o.prototype.removeTag=function(t){var e=this.tags,i=e.indexOf(t);return-1!==i&&e.splice(i,1),this},o.prototype.removeTags=function(){for(var t=arguments.length;t--;)this.removeTag(arguments[t]);return this},o.prototype.hasTag=function(t){return-1!==this.tags.indexOf(t)},o.prototype.addComponent=function(t,o){if("string"==typeof t&&(t=new e._types[t]),!(t instanceof e))return i.warn("GameObject.addComponent: can't add passed argument, it is not instance of Component"),this;var n,s,r,a=t._name,h=this.components,p=h.indexOf(t);if(-1===p){if(t.gameObject&&(t=t.clone()),h.push(t),this._componentHash[t._id]=t,-1!==t._serverId&&(this._componentHashServer[t._serverId]=t),t.gameObject=this,this[a]=t,!o)for(s=h.length;s--;)if(n=h[s])for(r=h.length;r--;)a=h[r]._name,n[a]=h[r];this.emit("add"+t._type,t),this.emit("addComponent",t),this.scene&&this.scene._addComponent(t)}else i.warn("GameObject.addComponent: GameObject already has a(n) "+type+" Component");return this},o.prototype.add=o.prototype.addComponents=function(){var t,e,i,o,n=(this.scene,arguments.length),s=this.components;for(i=n;i--;)this.addComponent(arguments[i],!0);for(i=s.length;i--;)if(t=s[i])for(o=s.length;o--;)e=s[o]._name,t[e]=s[o];return this},o.prototype.removeComponent=function(t,o){if("string"==typeof t&&(t=this.getComponent(t)),!(t instanceof e))return i.warn("GameObject.removeComponent: can't remove passed argument, it is not instance of Component"),this;var n,s,r,a=t._name,h=this.components,p=h.indexOf(t);if(-1!==p){if(!o)for(s=h.length;s--;)if(n=h[s])for(r=h.length;r--;)a===h[r]._name&&(n[a]=void 0);h.splice(p,1),this._componentHash[t._id]=void 0,-1!==t._serverId&&(this._componentHashServer[t._serverId]=void 0),t.gameObject=void 0,this[a]=void 0,this.emit("remove"+t._type,t),this.emit("removeComponent",t),this.scene&&this.scene._removeComponent(t)}else i.warn("GameObject.removeComponent: GameObject does not have a(n) "+type+" Component");return this},o.prototype.remove=o.prototype.removeComponents=function(){var t,e,i,o,n=(this.scene,arguments.length),s=this.components,r=arguments;for(i=n;i--;)this.removeComponent(arguments[i],!0);for(i=s.length;i--;)if(t=s[i])for(e=t._name,o=r.length;o--;)e===r[i]._name&&(t[e]=void 0);return this},o.prototype.getComponent=function(t){return this._componentHash[t]||this[t]||this[t.toLowerCase()]},o.prototype.hasComponent=function(t){var e,i=this.components;for(e=i.length;e--;)if(i[e]._type===t)return!0;return!1},o.prototype.findComponentById=function(t){return this._componentHash[t]},o.prototype.findComponentByServerId=function(t){return this._componentHashServer[t]},o.prototype.toSYNC=function(e){e=t.prototype.toSYNC.call(this,e);var i,o,n=this.components,s=e.components||(e.components=[]);for(o=n.length;o--;)(i=n[o]).sync&&(s[o]=i.toSYNC(s[o]));return e},o.prototype.fromSYNC=function(i,o){t.prototype.fromSYNC.call(this,i);var n,s,r,a,h=(this.components,i.components||(i.components=[]));for(a=h.length;a--;)if(s=h[a])if(n=this.findComponentByServerId(s._id))n.fromSYNC(s,o);else{if(!(r=e._types[s._type]))continue;this.addComponent((new r).fromSYNC(s,o))}return this},o.prototype.toJSON=function(e){e||(e={}),t.prototype.toJSON.call(this,e);var i,o,n=this.components,s=e.components||(e.components=[]),r=this.tags,a=e.tags||(e.tags=[]);for(o=n.length;o--;)(i=n[o]).json&&(s[o]=i.toJSON(s[o]));for(o=r.length;o--;)a[o]=r[o];return e},o.prototype.fromJSON=function(i){t.prototype.fromJSON.call(this,i);var o,n,s,r,a=(this.components,i.components||(i.components=[])),h=this.tags,p=i.tags||(i.tags=[]);for(r=a.length;r--;)(n=a[r])&&(s=e._types[n._type])&&((o=this.findComponentByServerId(n._id))?o.fromJSON(n):this.addComponent((new s).fromJSON(n)));for(r=p.length;r--;)this.hasTag(p[r])||h.push(p[r]);return this},o}),define("core/scene",["base/class","core/game_object","core/game/log"],function(t,e,i){function o(e){e||(e={}),t.call(this),this.game=void 0,this.gameObjects=[],this._gameObjectHash={},this._gameObjectServerHash={},this.components={},this._componentTypes=[],this._componentHash={},this._componentHashServer={},e.gameObjects&&this.addGameObjects.apply(this,e.gameObjects)}return t.extend(o,t),o.prototype.init=function(){var t,e,i,o=this._componentTypes,n=this.gameObjects;for(e=o.length;e--;)for(t=o[e],i=t.length;i--;)t[i].init();for(e=n.length;e--;)n[e].emit("init")},o.prototype.update=function(){var t,e,i,o=this._componentTypes,n=this.gameObjects;for(e=o.length;e--;)for(t=o[e],i=t.length;i--;)t[i].update();for(e=n.length;e--;)n[e].emit("update")},o.prototype.clear=function(){var t,e=this.gameObjects;for(t=e.length;t--;)this.removeGameObject(e[t]);return this},o.prototype.destroy=function(){return this.game?(this.game.removeScene(this),this.emit("destroy"),this.clear(),this):(i.warn("Scene.destroy: can't destroy Scene if it's not added to a Game"),this)},o.prototype.addGameObject=function(t){if(!(t instanceof e))return i.warn("Scene.addGameObject: can't add argument to Scene, it's not an instance of GameObject"),this;var o,n,s=this.gameObjects,r=s.indexOf(t);if(-1===r){for(t.scene&&t.scene.removeGameObject(t),s.push(t),this._gameObjectHash[t._id]=t,-1!==t._serverId&&(this._gameObjectServerHash[t._serverId]=t),t.scene=this,o=t.components,n=o.length;n--;)this._addComponent(o[n]);this.game&&t.emit("init"),this.emit("addGameObject",t)}else i.warn("Scene.addGameObject: GameObject is already a member of Scene");return this},o.prototype.add=o.prototype.addGameObjects=function(){for(var t=arguments.length;t--;)this.addGameObject(arguments[t]);return this},o.prototype._addComponent=function(t){if(t){var e=t._type,i=this.components,o=!i[e],n=i[e]=i[e]||[];this._componentHash[t._id]=t,-1!==t._serverId&&(this._componentHashServer[t._serverId]=t),n.push(t),n.sort(t.sort),o&&this._componentTypes.push(n),this.game&&t.init(),this.emit("add"+e,t),this.emit("addComponent",t)}},o.prototype.removeGameObject=function(t){if(!(t instanceof e))return i.warn("Scene.removeGameObject: can't remove argument from Scene, it's not an instance of GameObject"),this;var o,n,s=this.gameObjects,r=s.indexOf(t);if(-1!==r){for(s.splice(r,1),this._gameObjectHash[t._id]=void 0,-1!==t._serverId&&(this._gameObjectServerHash[t._serverId]=void 0),t.scene=void 0,o=t.components,n=o.length;n--;)this._removeComponent(o[n]);this.emit("removeGameObject",t)}else i.warn("Scene.removeGameObject: GameObject is not a member of Scene");return this},o.prototype.remove=o.prototype.removeGameObjects=function(){for(var t=arguments.length;t--;)this.removeGameObject(arguments[t]);return this},o.prototype._removeComponent=function(t){if(t){var e=t._type,i=this.components,o=i[e],n=o.indexOf(t);this._componentHash[t._id]=void 0,-1!==t._serverId&&(this._componentHashServer[t._serverId]=void 0),o.splice(n,1),o.sort(t.sort),this.emit("remove"+e,t),this.emit("removeComponent",t),t.clear()}},o.prototype.findById=function(t){return this._gameObjectHash[t]},o.prototype.findByServerId=function(t){return this._gameObjectServerHash[t]},o.prototype.findComponentById=function(t){return this._componentHash[t]},o.prototype.findComponentByServerId=function(t){return this._componentHashServer[t]},o.prototype.toSYNC=function(e){e=t.prototype.toSYNC.call(this,e);var i,o,n=this.gameObjects,s=e.gameObjects||(e.gameObjects=[]);for(o=n.length;o--;)(i=n[o]).sync&&(s[o]=i.toSYNC(s[o]));return e},o.prototype.fromSYNC=function(e,i){t.prototype.fromSYNC.call(this,e);var o,n,s,r=(this.gameObjects,e.gameObjects);for(s=r.length;s--;)(n=r[s])&&(o=this.findByServerId(n._id))&&o.fromSYNC(n,i);return this},o.prototype.toJSON=function(e){e||(e={}),t.prototype.toJSON.call(this,e);var i,o,n=this.gameObjects,s=e.gameObjects||(e.gameObjects=[]);for(o=n.length;o--;)(i=n[o]).json&&(s[o]=i.toJSON(s[o]));return e},o.prototype.fromJSON=function(i){t.prototype.fromJSON.call(this,i);var o,n,s,r=(this.gameObjects,i.gameObjects);for(s=r.length;s--;)(n=r[s])&&((o=this.findByServerId(n._id))?o.fromJSON(n):this.addGameObject((new e).fromJSON(n)));return this},o}),define("core/game/game",["base/class","core/game/loop","core/scene","core/game/log"],function(t,e,i,o){function n(i){i||(i={}),t.call(this),this._loop=new e(this.loop,this),this.scenes=[],this._sceneHash={},this._sceneServerHash={}}return t.extend(n,t),n.prototype.addScene=function(t){if(!(t instanceof i))return o.warn("Game.addScene: can't add argument to Game, it's not an instance of Scene"),this;var e=this.scenes,n=e.indexOf(t);return-1===n?(t.game&&t.game.removeScene(t),e.push(t),this._sceneHash[t._id]=t,-1!==t._serverId&&(this._sceneServerHash[t._serverId]=t),t.game=this,this.emit("addScene",t)):o.warn("Game.addScene: Scene is already a member of Game"),this},n.prototype.add=n.prototype.addScenes=function(){for(var t=arguments.length;t--;)this.addScene(arguments[t]);return this},n.prototype.removeScene=function(t){if(!(t instanceof i))return o.warn("Game.removeScene: can't remove argument from Game, it's not an instance of Scene"),this;var e=this.scenes,n=e.indexOf(t);return-1!==n?(e.splice(n,1),this._sceneHash[t._id]=void 0,-1!==t._serverId&&(this._sceneServerHash[t._serverId]=void 0),t.game=void 0,this.emit("removeScene",t)):o.warn("Game.removeScene: Scene not a member of Game"),this},n.prototype.remove=n.prototype.removeScenes=function(){for(var t=arguments.length;t--;)this.removeScene(arguments[t]);return this},n.prototype.findById=function(t){return this._sceneHash[t]},n.prototype.findByServerId=function(t){return this._sceneServerHash[t]
},n.prototype.pause=function(){return this._loop.pause(),this},n.prototype.resume=function(){return this._loop.resume(),this},n.prototype.loop=function(t){this.emit("update",t)},n.prototype.toSYNC=function(t){t||(t=this._SYNC);var e,i=this.scenes,o=t.jsonScenes||(t.jsonScenes=[]);for(e=i.length;e--;)o[e]=i[e].toSYNC(o[e]);return t},n.prototype.fromSYNC=function(t){var e,i,o,n=(this.scenes,t.scenes);for(o=n.length;o--;)i=n[o],(e=this.findByServerId(i._serverId))&&e.fromSYNC(i);return this},n.prototype.toJSON=function(e){e||(e={}),t.prototype.toJSON.call(this,e);var i,o=this.scenes,n=e.scenes||(e.scenes=[]);for(i=o.length;i--;)n[i]=o[i].toJSON(n[i]);return e},n.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e);var o,n,s,r=(this.scenes,e.scenes);for(s=r.length;s--;)n=r[s],(o=this.findByServerId(n._id))?o.fromJSON(n):this.addScene((new i).fromJSON(n));return this},n}),define("core/rendering/canvas",["base/event_emitter","base/device","base/dom","core/game/config"],function(t,e,i,o){function n(e,i){t.call(this),this.fullScreen=void 0===e&&void 0===i?!0:!1,this.width=void 0!==e?e:window.innerWidth,this.height=void 0!==i?i:window.innerHeight,this.aspect=this.width/this.height,this.pixelWidth=this.width,this.pixelHeight=this.height,this.element=void 0}var s=i.addEvent,r=i.removeEvent,a=i.addMeta,h=Math.floor,p=/-scale\s *=\s*[.0-9]+/g,c="viewport",u="viewport-width",l="viewport-height",m=["background: #000000;","position: absolute;","top: 50%;","left: 50%;","padding:0px;","margin: 0px;"].join("\n");return a(c,"viewport","initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"),a(u,"viewport","width=device-width"),a(l,"viewport","height=device-height"),t.extend(n,t),n.prototype.init=function(){this.element&&this.destroy();var t=document.createElement("canvas");t.style.cssText=m,document.body.appendChild(t),o.debug||(t.oncontextmenu=function(){return!1}),s(window,"resize orientationchange",this.handleResize,this),this.element=t,this.handleResize()},n.prototype.destroy=function(){return this.element?(r(window,"resize orientationchange",this.handleResize,this),document.body.removeChild(this.element),this.element=void 0,this):this},n.prototype.setFullscreen=function(t){return this.element&&this.fullScreen!==t?(this.fullScreen=!!t,this.handleResize(),this):this},n.prototype.setWidth=function(t){return this.element&&this.width!==t?(this.width=t,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},n.prototype.setHeight=function(t){return this.element&&this.height!==t?(this.height=t,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},n.prototype.style=function(t,e){return this.element?(this.element.style[t]=e,this):this},n.prototype.setBackgroundColor=function(t){return this.element?(this.element.style.background=t,this):this},n.prototype.handleResize=function(){var t,i,o=document.getElementById(c).getAttribute("content"),n=window.innerWidth,s=window.innerHeight,r=n/s,a=this.element,m=a.style;this.fullScreen?(t=n,i=s):r>this.aspect?(t=s*this.aspect,i=s):(t=n,i=n/this.aspect),this.pixelWidth=h(t),this.pixelHeight=h(i),a.width=t,a.height=i,m.marginLeft=-h(.5*t)-1+"px",m.marginTop=-h(.5*i)-1+"px",m.width=h(t)+"px",m.height=h(i)+"px",document.getElementById(c).setAttribute("content",o.replace(p,"-scale="+e.invPixelRatio)),document.getElementById(u).setAttribute("content","width="+n),document.getElementById(l).setAttribute("content","height="+s),window.scrollTo(1,1),this.emit("resize")},n}),define("core/rendering/canvas_renderer_2d",["base/event_emitter","base/device","base/dom","math/mathf","math/vec2","math/mat32","math/color"],function(t,e,i,o,n,s,r){function a(e){e||(e={}),t.call(this),this.canvas=void 0,this.context=void 0,this._context=!1,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground=new r}var h=[],p=new Image;p.src="data:image/gif;base64,R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",t.extend(a,t),a.prototype.init=function(t){this.canvas&&this.clear(),this.canvas=t;try{this.context=t.element.getContext("2d")}catch(e){return this}return this._context=!0,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground.set(0,0,0),this},a.prototype.clear=function(){return this.canvas=void 0,this.context=void 0,this._context=!1,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground.set(0,0,0),this},a.prototype.render=function(t,e){if(this._context){var i,o,n,s,r=this.context,a=this._lastBackground,p=e.backgroundColor,c=t.components,u=c.Sprite2D||h,l=c.Emitter2D||h;if((a.r!==p.r||a.g!==p.g||a.b!==p.b)&&(a.copy(p),r.fillStyle=p.toRGB()),this._lastCamera!==e){var m=this.canvas,f=m.pixelWidth,d=m.pixelHeight,y=.5*f,v=.5*d;e.set(f,d),r.translate(y,v),r.scale(y,-v),r.fillStyle=p.toRGB(),this._lastResizeFn&&m.off("resize",this._lastResizeFn),this._lastResizeFn=function(){var t=this.pixelWidth,i=this.pixelHeight,o=.5*t,n=.5*i;e.set(t,i),r.translate(o,n),r.scale(o,-n),r.fillStyle=p.toRGB()},m.on("resize",this._lastResizeFn),this._lastCamera=e}for(r.fillRect(-1,-1,2,2),s=u.length;s--;)i=u[s],n=i.transform2d,n&&(n.updateModelView(e.view),this.renderSprite2D(e,n,i));for(s=l.length;s--;)o=l[s],n=o.transform2d,n&&(n.updateModelView(e.view),this.renderEmitter2D(e,n,o))}};var c=new s;return a.prototype.renderSprite2D=function(t,e,i){var o=this.context,n=i.texture,s=c.elements;c.mmul(t.projection,e.modelView),n=n?n.raw:p,o.save(),o.transform(s[0],-s[2],-s[1],s[3],s[4],s[5]),o.scale(1,-1),1!==i.alpha&&(o.globalAlpha=i.alpha),o.drawImage(n,i.x,i.y,i.w,i.h,i.width*-.5,i.height*-.5,i.width,i.height),o.restore()},a.prototype.renderEmitter2D=function(t,e,i){var o,n,s,r=this.context,a=i.particles,h=i.worldSpace?t.view:e.modelView,p=c.elements,u=a.length;if(u){for(r.save(),c.mmul(t.projection,h),r.transform(p[0],-p[2],-p[1],p[3],p[4],p[5]);u--;)o=a[u],n=o.position,s=o.size,r.save(),r.fillStyle=o.color.toRGB(),r.globalAlpha=o.alpha,r.translate(n.x,n.y),r.rotate(o.rotation),r.fillRect(.5*-s,.5*-s,s,s),r.restore();r.restore()}},a}),define("core/rendering/webgl_renderer_2d",["base/event_emitter","base/device","base/dom","core/game/log","math/mathf","math/vec2","math/mat32","math/mat4","math/color"],function(t,e,i,o,n,s,r,a,h){function p(e){e||(e={}),t.call(this),this.canvas=void 0,this.context=void 0,this._context=!1,this.attributes=x(e.attributes||{},{alpha:!0,antialias:!0,depth:!0,premulipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0}),this._webgl={gpu:{precision:"highp",maxAnisotropy:16,maxTextures:16,maxTextureSize:16384,maxCubeTextureSize:16384,maxRenderBufferSize:16384},ext:{textureFilterAnisotropic:void 0,textureFloat:void 0,standardDerivatives:void 0,compressedTextureS3TC:void 0},textures:{},shaders:{},buffers:{},lastTexture:void 0,lastShader:void 0,lastBuffer:void 0},this._clearBytes=17664,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground=new h,this._lastBlending=void 0}function c(t,e,i){var o=e.attributes,n=t.FLOAT,s=t.ARRAY_BUFFER;i.vertex&&o.aVertexPosition>-1&&(t.bindBuffer(s,i.vertex),t.enableVertexAttribArray(o.aVertexPosition),t.vertexAttribPointer(o.aVertexPosition,2,n,!1,0,0)),i.color&&o.aVertexColor>-1&&(t.bindBuffer(s,i.color),t.enableVertexAttribArray(o.aVertexColor),t.vertexAttribPointer(o.aVertexColor,2,n,!1,0,0)),i.uv&&o.aVertexUv>-1&&(t.bindBuffer(s,i.uv),t.enableVertexAttribArray(o.aVertexUv),t.vertexAttribPointer(o.aVertexUv,2,n,!1,0,0)),i.index&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.index)}function u(t,e){if(!e)return void 0;var i=t.context,o=t._webgl,n=o.buffers,s=n[e._id];if(s&&!e._needsUpdate)return s;s=s||(n[e._id]={});var r,a,h,p,c=L,u=e.dynamic?i.DYNAMIC_DRAW:i.STATIC_DRAW,l=i.ARRAY_BUFFER,m=i.ELEMENT_ARRAY_BUFFER;if(r=e.vertices,r&&r.length){for(c.length=0,h=0,p=r.length;p>h;h++)a=r[h],c.push(a.x,a.y);c.length&&(s.vertex=s.vertex||i.createBuffer(),i.bindBuffer(l,s.vertex),i.bufferData(l,new Float32Array(c),u)),s.vertices=r.length}if(r=e.uvs,r&&r.length){for(c.length=0,h=0,p=r.length;p>h;h++)a=r[h],c.push(a.x,a.y);c.length&&(s.uv=s.uv||i.createBuffer(),i.bindBuffer(l,s.uv),i.bufferData(l,new Float32Array(c),u))}return r=e.indices||e.faces,r&&r.length&&(s.index=s.index||i.createBuffer(),i.bindBuffer(m,s.index),i.bufferData(m,new Int16Array(r),u),s.indices=r.length),s}function l(t,e){var i,o,n=t.context,s=t._webgl,r=s.shaders,a=r[e._id];if(a&&!e._needsUpdate)return a;a=a||(r[e._id]={}),i=e.vertex||e.vertexShader,o=e.fragment||e.fragmentShader;var h=a.program=S(n,i,o);return a.vertex=i,a.fragment=o,_(n,h,i,o,a.attributes||(a.attributes={}),a.uniforms||(a.uniforms={})),a}function m(t,e){if(!e||!e.raw)return t._webgl.textures[E];var i=t.context,o=t._webgl,n=o.textures,s=n[e._id],r=e.raw;if(s&&!e._needsUpdate)return s;s=s||(n[e._id]=i.createTexture());var a=o.ext,h=o.gpu,p=a.textureFilterAnisotropic,c=C(r.width)&&C(r.height),u=z(e.anisotropy,1,h.maxAnisotropy),l=i.TEXTURE_2D,m=c?i.REPEAT:i.CLAMP_TO_EDGE,f=i[e.magFilter]||i.LINEAR,d=i[e.minFilter]||i.LINEAR,y=i[e.format];return y=y?y:i.RGBA,d=c?d===i.NEAREST||d===i.LINEAR?i.LINEAR_MIPMAP_NEAREST:d:d===i.NEAREST?i.NEAREST:i.LINEAR,i.bindTexture(l,s),i.texImage2D(l,0,y,y,i.UNSIGNED_BYTE,r),i.texParameteri(l,i.TEXTURE_MAG_FILTER,f),i.texParameteri(l,i.TEXTURE_MIN_FILTER,d),i.texParameteri(l,i.TEXTURE_WRAP_S,m),i.texParameteri(l,i.TEXTURE_WRAP_T,m),p&&i.texParameterf(l,p.TEXTURE_MAX_ANISOTROPY_EXT,u),c&&i.generateMipmap(l),o.lastTexture=s,e._needsUpdate=!1,s}function f(t){return["precision "+t+" float;","uniform mat4 uMatrix;","uniform vec2 uPos;","uniform float uAngle;","uniform float uSize;","attribute vec2 aVertexPosition;","void main() {","	float c, s, vx, vy, x, y;","	c = cos(uAngle);","	s = sin(uAngle);","	vx = (aVertexPosition.x * uSize) - (uSize * 0.5);","	vy = (aVertexPosition.y * uSize) - (uSize * 0.5);","	x = vx * c - vy * s;","	y = vx * s + vy * c;","	gl_Position = uMatrix * vec4(uPos.x + x, uPos.y + y, 0.0, 1.0);","}"].join("\n")}function d(t){return["precision "+t+" float;","uniform mat4 uMatrix;","attribute vec2 aVertexPosition;","void main() {","	gl_Position = uMatrix * vec4(aVertexPosition, 0.0, 1.0);","}"].join("\n")}function y(t){return["precision "+t+" float;","uniform float uAlpha;","uniform vec3 uColor;","void main() {","	gl_FragColor = vec4(uColor, uAlpha);","}"].join("\n")}function v(t){return["precision "+t+" float;","uniform mat4 uMatrix;","uniform vec4 uCrop;","uniform vec2 uSize;","attribute vec2 aVertexPosition;","attribute vec2 aVertexUv;","varying vec2 vUvPosition;","void main() {","	vUvPosition = vec2(aVertexUv.x * uCrop.z, aVertexUv.y * uCrop.w) + uCrop.xy;","	gl_Position = uMatrix * vec4(aVertexPosition * uSize, 0.0, 1.0);","}"].join("\n")}function g(t){return["precision "+t+" float;","uniform float uAlpha;","uniform sampler2D uTexture;","varying vec2 vUvPosition;","void main() {","	vec4 finalColor = texture2D(uTexture, vUvPosition);","	finalColor.w *= uAlpha;","	gl_FragColor = finalColor;","}"].join("\n")}function x(t,e){var i;for(i in e)void 0==t[i]&&(t[i]=e[i]);return t}function b(t){var e;for(e in t)delete t[e];return t}var w=i.getWebGLContext,S=i.createProgram,_=i.parseUniformsAttributes,O=i.addEvent,N=i.removeEvent,z=(Math.min,Math.max,n.clamp),C=n.isPowerOfTwo,A=new Uint8Array([255,255,255,255]),E=-1,J=[new s(.5,.5),new s(-.5,.5),new s(.5,-.5),new s(-.5,-.5)],M=[new s(1,1),new s(0,1),new s(1,0),new s(0,0)],R=-1,D=-1,T=-2,j=-3,B=[];t.extend(p,t),p.prototype.init=function(t){this.canvas&&this.clear();var e=t.element;return this.canvas=t,this.context=w(e,this.attributes),this.context?(this._context=!0,O(e,"webglcontextlost",this._handleWebGLContextLost,this),O(e,"webglcontextrestored",this._handleWebGLContextRestored,this),this.setDefaults(),this):this},p.prototype.clear=function(){if(!this.canvas)return this;var t=this.canvas,e=t.element,i=this._webgl,o=i.ext;return this.canvas=void 0,this.context=void 0,this._context=!1,N(e,"webglcontextlost",this._handleWebGLContextLost,this),N(e,"webglcontextrestored",this._handleWebGLContextRestored,this),this._clearBytes=17664,this._lastCamera=void 0,this._lastBackground.setRGB(0,0,0),this._lastBlending=void 0,o.compressedTextureS3TC=o.standardDerivatives=o.textureFilterAnisotropic=o.textureFloat=void 0,i.lastBuffer=i.lastShader=i.lastTexture=void 0,b(i.textures),b(i.buffers),b(i.shaders),this},p.prototype.setDefaults=function(){var t=this.context,i=this._webgl,o=i.ext,n=i.gpu,s=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),a=t.getExtension("OES_standard_derivatives"),h=t.getExtension("OES_texture_float");o.textureFilterAnisotropic=s,o.standardDerivatives=a,o.textureFloat=h,o.compressedTextureS3TC=r;var p=t.VERTEX_SHADER,c=t.FRAGMENT_SHADER,m=t.HIGH_FLOAT,x=t.MEDIUM_FLOAT,b="undefined"!=typeof t.getShaderPrecisionFormat,w=o.textureFilterAnisotropic?t.getParameter(o.textureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,S=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),_=t.getParameter(t.MAX_TEXTURE_SIZE),O=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),N=t.getParameter(t.MAX_RENDERBUFFER_SIZE),z=b?t.getShaderPrecisionFormat(p,m):0,C=b?t.getShaderPrecisionFormat(p,x):1,B=b?t.getShaderPrecisionFormat(c,m):0,P=b?t.getShaderPrecisionFormat(c,x):1,I=z.precision>0&&B.precision>0,L=C.precision>0&&P.precision>0,k="highp";(!I||e.mobile)&&(k=L?"mediump":"lowp"),n.precision=k,n.maxAnisotropy=w,n.maxTextures=S,n.maxTextureSize=_,n.maxCubeTextureSize=O,n.maxRenderBufferSize=N,t.clearColor(0,0,0,1),t.clearDepth(1),t.clearStencil(0),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),t.cullFace(t.BACK),t.enable(t.CULL_FACE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.enable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);var U=t.createTexture();return t.bindTexture(t.TEXTURE_2D,U),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,A),t.bindTexture(t.TEXTURE_2D,null),i.textures[E]=U,u(this,{_id:R,vertices:J,uvs:M}),l(this,{_id:D,vertexShader:v(k),fragmentShader:g(k)}),l(this,{_id:T,vertexShader:d(k),fragmentShader:y(k)}),l(this,{_id:j,vertexShader:f(k),fragmentShader:y(k)}),this._clearBytes=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT,this},p.prototype.setBlending=function(t){var e=this.context;if(t!==this._lastBlending){switch(t){case 0:e.disable(e.BLEND);break;case 1:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 2:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case 3:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}this._lastBlending=t}},p.prototype.render=function(t,e){if(this._context){var i,o,n,s,r=this.context,a=this._lastBackground,h=e.backgroundColor,p=t.components,c=p.Sprite2D||B,u=p.Emitter2D||B;if((a.r!==h.r||a.g!==h.g||a.b!==h.b)&&(a.copy(h),r.clearColor(h.r,h.g,h.b,1)),this._lastCamera!==e){var l=this.canvas,m=l.pixelWidth,f=l.pixelHeight;e.set(m,f),r.viewport(0,0,m,f),this._lastResizeFn&&l.off("resize",this._lastResizeFn),this._lastResizeFn=function(){var t=this.pixelWidth,i=this.pixelHeight;e.set(t,i),r.viewport(0,0,t,i)},l.on("resize",this._lastResizeFn),this._lastCamera=e}for(r.clear(this._clearBytes),s=c.length;s--;)i=c[s],n=i.transform2d,n&&(n.updateModelView(e.view),this.renderSprite2D(e,n,i));for(s=u.length;s--;)o=u[s],n=o.transform2d,n&&(n.updateModelView(e.view),this.renderEmitter2D(e,n,o))}};var P=new r,I=new a;p.prototype.renderSprite2D=function(t,e,i){var o,n,s=this.context,r=this._webgl,a=i.texture,h=r.shaders[D],p=r.buffers[R],u=m(this,a),l=h.uniforms,f=a.raw;P.mmul(t.projection,e.modelView),I.fromMat32(P),a&&f&&(o=1/f.width,n=1/f.height,r.lastShader!==h&&(s.useProgram(h.program),r.lastShader=h),r.lastBuffer!==p&&(c(s,h,p),r.lastBuffer=p),s.uniformMatrix4fv(l.uMatrix,!1,I.elements),s.uniform4f(l.uCrop,i.x*o,i.y*n,i.w*o,i.h*n),s.uniform2f(l.uSize,i.width,i.height),s.uniform1f(l.uAlpha,i.alpha),r.lastTexture!==u&&(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u),s.uniform1i(l.uTexture,0),r.lastTexture=u),s.drawArrays(s.TRIANGLE_STRIP,0,p.vertices))},p.prototype.renderEmitter2D=function(t,e,i){var o,n,s,r=this.context,a=this._webgl,h=a.shaders[j],p=a.buffers[R],u=p.vertices,l=r.TRIANGLE_STRIP,m=h.uniforms,f=m.uMatrix,d=m.uPos,y=m.uAngle,v=m.uSize,g=m.uColor,x=m.uAlpha,b=i.particles,w=i.worldSpace?t.view:e.modelView,S=b.length,_=I.elements;if(S)for(a.lastShader!==h&&(r.useProgram(h.program),a.lastShader=h),a.lastBuffer!==p&&(c(r,h,p),a.lastBuffer=p),P.mmul(t.projection,w),I.fromMat32(P),r.uniformMatrix4fv(f,!1,_);S--;)o=b[S],n=o.position,s=o.color,r.uniform2f(d,n.x,n.y),r.uniform1f(y,o.rotation),r.uniform1f(v,o.size),r.uniform3f(g,s.r,s.g,s.b),r.uniform1f(x,o.alpha),r.drawArrays(l,0,u)},p.prototype._handleWebGLContextLost=function(t){t.preventDefault(),o.warn("WebGLRenderer2D: webgl context was lost"),this._context=!1,this.emit("webglcontextlost",t)},p.prototype._handleWebGLContextRestored=function(t){o.log("WebGLRenderer2D: webgl context was restored"),this.setDefaults(),this._context=!0,this.emit("webglcontextrestored",t)};var L=[];return p}),define("core/input/button",[],function(){function t(t){this.name=t,this.timeDown=-1,this.timeUp=-1,this.frameDown=-1,this.frameUp=-1,this.value=!1,this._first=!0,this._SYNC={}}return t.prototype.toSYNC=function(t){return t||(t=this._SYNC),t.name=this.name,t.timeDown=this.timeDown,t.timeUp=this.timeUp,t.frameDown=this.frameDown,t.frameUp=this.frameUp,t.value=this.value,t},t.prototype.fromSYNC=function(t){return this.name=t.name,this.timeDown=t.timeDown,this.timeUp=t.timeUp,this.frameDown=t.frameDown,this.frameUp=t.frameUp,this.value=t.value,this},t.prototype.toJSON=function(t){return t||(t={}),t.name=this.name,t.timeDown=this.timeDown,t.timeUp=this.timeUp,t.frameDown=this.frameDown,t.frameUp=this.frameUp,t.value=this.value,t},t.prototype.fromJSON=function(t){return this.name=t.name,this.timeDown=t.timeDown,this.timeUp=t.timeUp,this.frameDown=t.frameDown,this.frameUp=t.frameUp,this.value=t.value,this},t}),define("core/input/buttons",["base/time","core/input/button","core/game/log"],function(t,e,i){function o(){Array.call(this),this.hash={},this._SYNC={},this.add("mouse0"),this.add("mouse1"),this.add("mouse2")}return o.prototype=Object.create(Array.prototype),o.prototype.constructor=o,o.prototype.add=function(t){if(this.hash[t])return i.warn("Buttons.add: Buttons already have Button name "+t),void 0;var o=new e(t);return this.push(o),this.hash[t]=o,o},o.prototype.get=function(t){return this.hash[t]},o.prototype.on=function(e){var i=this.hash[e]||this.add(e);i._first&&(i.frameDown=t.frameCount+1,i.timeDown=t.stamp(),i._first=!1),i.value=!0},o.prototype.off=function(e){var i=this.hash[e]||this.add(e);i.frameUp=t.frameCount+1,i.timeUp=t.stamp(),i.value=!1,i._first=!0},o.prototype.toSYNC=function(t){t||(t=this._SYNC);var e,i=t.buttons||(t.buttons=[]);for(e=this.length;e--;)i[e]=this[e].toSYNC(i[e]);return t},o.prototype.fromSYNC=function(t){var e,i,o,n=this.hash,s=t.buttons||(t.buttons=[]);for(o=s.length;o--;)i=s[o],(e=n[i.name])?e.fromSYNC(i):this.add(i.name).fromJSON(i);return this},o.prototype.toJSON=function(t){t||(t={});var e,i=t.buttons||(t.buttons=[]);for(e=this.length;e--;)i[e]=this[e].toJSON(i[key]);return t},o.prototype.fromJSON=function(t){var e,i,o,n=this.hash,s=t.buttons||(t.buttons=[]);for(o=s.length;o--;)i=s[o],(e=n[i.name])?e.fromJSON(i):this.add(i.name).fromJSON(i);return this},o}),define("core/input/axis",[],function(){function t(e){e||(e={}),this.name=void 0!=e.name?e.name:"unknown",this.negButton=void 0!=e.negButton?e.negButton:"",this.posButton=void 0!=e.posButton?e.posButton:"",this.altNegButton=void 0!=e.altNegButton?e.altNegButton:"",this.altPosButton=void 0!=e.altPosButton?e.altPosButton:"",this.gravity=void 0!=e.gravity?e.gravity:3,this.sensitivity=void 0!=e.sensitivity?e.sensitivity:3,this.dead=void 0!=e.dead?e.dead:.001,this.type=void 0!=e.type?e.type:t.BUTTON,this.axis=void 0!=e.axis?e.axis:"x",this.index=void 0!=e.index?e.index:0,this.joyNum=void 0!=e.joyNum?e.joyNum:0,this.value=0,this._SYNC={}}return t.prototype.toSYNC=function(t){return t||(t=this._SYNC),t.name=this.name,t.value=this.value,t},t.prototype.fromSYNC=function(t){return this.name=t.name,this.value=t.value,this},t.prototype.toJSON=function(t){return t||(t={}),t.name=this.name,t.negButton=this.negButton,t.posButton=this.posButton,t.altNegButton=this.altNegButton,t.altPosButton=this.altPosButton,t.gravity=this.gravity,t.sensitivity=this.sensitivity,t.dead=this.dead,t.type=this.type,t.axis=this.axis,t.index=this.index,t.joyNum=this.joyNum,t.value=this.value,t},t.prototype.fromJSON=function(t){return this.name=t.name,this.negButton=t.negButton,this.posButton=t.posButton,this.altNegButton=t.altNegButton,this.altPosButton=t.altPosButton,this.gravity=t.gravity,this.sensitivity=t.sensitivity,this.dead=t.dead,this.type=t.type,this.axis=t.axis,this.index=t.index,this.joyNum=t.joyNum,this.value=t.value,this},t.BUTTON=1,t.MOUSE=2,t.TOUCH=3,t.MOUSE_WHEEL=4,t.JOYSTICK=5,t}),define("core/input/axes",["core/input/axis","core/game/log"],function(t,e){function i(){Array.call(this),this.hash={},this._SYNC={},this.add({name:"horizontal",posButton:"right",negButton:"left",altPosButton:"d",altNegButton:"a",type:o}),this.add({name:"vertical",posButton:"up",negButton:"down",altPosButton:"w",altNegButton:"s",type:o}),this.add({name:"fire",posButton:"ctrl",negButton:"",altPosButton:"mouse0",altNegButton:"",type:o}),this.add({name:"jump",posButton:"space",negButton:"",altPosButton:"mouse2",altNegButton:"",type:o}),this.add({name:"mouseX",type:n,axis:"x"}),this.add({name:"mouseY",type:n,axis:"y"}),this.add({name:"touchX",type:s,axis:"x"}),this.add({name:"touchY",type:s,axis:"y"}),this.add({name:"mouseWheel",type:r})}var o=t.BUTTON,n=t.MOUSE,s=t.TOUCH,r=t.MOUSE_WHEEL;return t.JOYSTICK,i.prototype=Object.create(Array.prototype),i.prototype.constructor=i,i.prototype.add=function(i,o){if("object"==typeof i&&(o=i,i=o.name),this.hash[i])return e.warn("Axes.add: Axes already have Axis named "+i),void 0;o||(o={}),o.name=i;var n=new t(o);return this.push(n),this.hash[i]=n,n},i.prototype.get=function(t){return this.hash[t]},i.prototype.toSYNC=function(t){t||(t=this._SYNC);var e,i=t.axes||(t.axes=[]);for(e=this.length;e--;)i[e]=this[e].toSYNC(i[e]);return t},i.prototype.fromSYNC=function(t){var e,i,o,n=this.hash,s=t.axes||(t.axes=[]);for(o=s.length;o--;)i=s[o],(e=n[i.name])?e.fromSYNC(i):this.add(i.name).fromJSON(i);return this},i.prototype.toJSON=function(t){t||(t={});var e,i=t.axes||(t.axes=[]);for(e=this.length;e--;)i[e]=this[e].toJSON(i[e]);return t},i.prototype.fromJSON=function(t){var e,i,o,n=this.hash,s=t.axes||(t.axes=[]);for(o=s.length;o--;)i=s[o],(e=n[i.name])?e.fromJSON(i):this.add(i.name).fromJSON(i);return this},i}),define("core/input/touch",["math/vec2"],function(t){function e(){this.id=-1,this.delta=new t,this.position=new t,this._last=new t,this._first=!1,this._SYNC={}}return e.prototype.clear=function(){return this.id=-1,this.position.set(0,0),this.delta.set(0,0),this._last.set(0,0),this._first=!1,this},e.prototype.fromEvent=function(t){var e=this.position,i=this.delta,o=this._last,n=this._first,s=t.target||t.srcElement,r=s.offsetLeft,a=s.offsetTop,h=(t.pageX||t.clientX)-r,p=(t.pageY||t.clientY)-a;return o.x=n?e.x:h,o.y=n?e.y:p,e.x=h,e.y=p,i.x=e.x-o.x,i.y=e.y-o.y,this._first=!0,this},e.prototype.toSYNC=function(t){return t||(t=this._SYNC),t.id=this.id,t.delta=this.delta.toJSON(t.delta),t.position=this.position.toJSON(t.position),t._last=this._last.toJSON(t._last),t._first=this._first,t},e.prototype.fromSYNC=function(t){return this.id=t.id,this.delta.fromJSON(t.delta),this.position.fromJSON(t.position),this._last.fromJSON(t._last),this._first=t._first,this},e.prototype.toJSON=function(t){return t||(t={}),t.id=this.id,t.delta=this.delta.toJSON(t.delta),t.position=this.position.toJSON(t.position),t._last=this._last.toJSON(t._last),t._first=this._first,t},e.prototype.fromJSON=function(t){return this.id=t.id,this.delta.fromJSON(t.delta),this.position.fromJSON(t.position),this._last.fromJSON(t._last),this._first=t._first,this},e}),define("core/input/touches",["base/object_pool","core/input/touch"],function(t,e){function i(){Array.call(this),this._SYNC={}}var o=new t(e),n=new t(Object);return i.prototype=Object.create(Array.prototype),i.prototype.constructor=i,i.TOUCH_POOL=o,i.prototype.start=function(t){var e=o.create();return e.clear(),e.id=t.identifier,e.fromEvent(t),this.push(e),e},i.prototype.end=function(t){var e=this[t];return o.removeObject(e),this.splice(t,1),e},i.prototype.cancel=function(){return o.clear(),this.length=0,this},i.prototype.move=function(t,e){var i=this[t];return i.fromEvent(e),i},i.prototype.toSYNC=function(t){t||(t=this._SYNC);var e=t.touches||(t.touches=[]),i=this.length;for(e.length=0,n.clear();i--;)e[i]=this[i].toSYNC(n.create());return t},i.prototype.fromSYNC=function(t){var e=t.touches,i=e.length;for(this.length=0,o.clear();i--;)this[i]=o.create().fromSYNC(e[i]);return this},i.prototype.toJSON=function(t){t||(t={});var e,i=t.touches||(t.touches=[]);for(e=this.length;e--;)i[e]=this[e].toJSON(i[e]);return t},i.prototype.fromJSON=function(t){var e,i,n,s,r=t.touches;for(i=r.length,s=this.length,n=s;i--;)s>i&&(this.splice(n--,1),o.removeObject(this[n])),(e=this[i])?e.fromJSON(r[i]):this[i]=o.create().fromJSON(r[i]);return this},i}),define("core/input/input",["base/event_emitter","base/object_pool","base/time","math/mathf","math/vec2","math/vec3","core/input/buttons","core/input/button","core/input/axes","core/input/axis","core/input/touches","core/input/touch"],function(t,e,i,o,n,s,r,a,h,p,c){function u(){t.call(this),this.axes=new h,this.buttons=new r,this.mouseWheel=0,this.mousePosition=new n,this.mouseDelta=new n,this.mouseMoveNeedsUpdate=!1,this.touches=new c,this.touchesMoveNeedsUpdate=!1,this.acceleration=new s,this.frameCount=0,this._frameCount=void 0,this.time=0,this._time=void 0,this._SYNC={}}var l=Math.abs,m=o.sign,f=o.clamp,d=p.BUTTON,y=p.MOUSE,v=p.TOUCH,g=p.MOUSE_WHEEL,x=(p.JOYSTICK,{0:"mouse0",1:"mouse1",2:"mouse2"});return t.extend(u,t),u.prototype.update=function(){var t,e,o,n,s,r,a,h,p,c=this.axes,u=this.buttons.hash,x=i.delta;for(this.frameCount=this._frameCount?this._frameCount:i.frameCount,this.time=this._time?this._time:i.stamp(),this.mouseMoveNeedsUpdate=!0,this.touchesMoveNeedsUpdate=!0,p=c.length;p--;){switch(o=c[p],n=o.value,s=o.sensitivity,o.type){case d:t=u[o.negButton],e=u[o.altNegButton],a=t&&t.value||e&&e.value,t=u[o.posButton],e=u[o.altPosButton],r=t&&t.value||e&&e.value;break;case y:o.value=this.mouseDelta[o.axis];continue;case v:var b=this.touches[o.index];o.value=b?b.delta[o.axis]:0;continue;case g:n+=this.mouseWheel}a&&(n-=s*x),r&&(n+=s*x),r||a||0===n||(h=l(n),n-=f(m(n)*o.gravity*x,-h,h)),n=f(n,-1,1),l(n)<=o.dead&&(n=0),o.value=n}this.mouseWheel=0},u.prototype.axis=function(t){var e=this.axes.hash[t];return e?e.value:0},u.prototype.mouseButton=function(t){var e=this.buttons.hash[x[t]];return e&&e.value},u.prototype.mouseButtonDown=function(t){var e=this.buttons.hash[x[t]];return e&&e.value&&e.frameDown>=this.frameCount},u.prototype.mouseButtonUp=function(t){var e=this.buttons.hash[x[t]];return e&&e.frameUp>=this.frameCount},u.prototype.anyKey=function(){var t,e=this.buttons;for(t=e.length;t--;)if(e[t].value)return!0;return!1},u.prototype.anyKeyDown=function(){var t,e,i=this.buttons;for(e=i.length;e--;)if((t=i[e]).value&&t.frameDown>=this.frameCount)return!0;return!1},u.prototype.key=function(t){var e=this.buttons.hash[t];return e&&e.value},u.prototype.keyDown=function(t){var e=this.buttons.hash[t];return e&&e.value&&e.frameDown>=this.frameCount},u.prototype.keyUp=function(t){var e=this.buttons.hash[t];return e&&e.frameUp>=this.frameCount},u.prototype.toSYNC=function(t){return t||(t=this._SYNC),t._frameCount=i.frameCount,t._time=i.stamp(),t.buttons=this.buttons.toSYNC(t.buttons),t.mousePosition=this.mousePosition.toJSON(t.mousePosition),t.mouseDelta=this.mouseDelta.toJSON(t.mouseDelta),t.acceleration=this.acceleration.toJSON(t.acceleration),t.touches=this.touches.toSYNC(t.touches),t},u.prototype.fromSYNC=function(t){return this._frameCount=t._frameCount,this._time=t._time,this.buttons.fromSYNC(t.buttons),this.mousePosition.fromJSON(t.mousePosition),this.mouseDelta.fromJSON(t.mouseDelta),this.acceleration.fromJSON(t.acceleration),this.touches.fromSYNC(t.touches),this},u.prototype.toJSON=function(t){return t||(t={}),t.buttons=this.buttons.toJSON(t.buttons),t.axes=this.axes.toJSON(t.axes),t.mousePosition=this.mousePosition.toJSON(t.mousePosition),t.mouseDelta=this.mouseDelta.toJSON(t.mouseDelta),t.acceleration=this.acceleration.toJSON(t.acceleration),t.touches=this.touches.toJSON(t.touches),t},u.prototype.fromJSON=function(t){return this.buttons.fromJSON(t.buttons),this.axes.fromJSON(t.axes),this.mousePosition.fromJSON(t.mousePosition),this.mouseDelta.fromJSON(t.mouseDelta),this.acceleration.fromJSON(t.acceleration),this.touches.fromJSON(t.touches),this},new u}),define("core/input/handler",["base/event_emitter","base/dom","base/object_pool","math/vec2","core/input/input","core/input/touch"],function(t,e,i,o,n,s){function r(){t.call(this),this.element=void 0}function a(t){var e,i=t.accelerationIncludingGravity;i&&(e=this.acceleration,e.x=i.x,e.y=i.y,e.z=i.z,this.emit("acceleration"))}function h(t){t.preventDefault();var e,i=this.touches,o=t.touches,n=t.changedTouches;switch(t.type){case"touchstart":for(e=o.length;e--;)this.emit("touchstart",i.start(o[e]));break;case"touchend":for(e=n.length;e--;)this.emit("touchend",i.end(e));break;case"touchcancel":i.cancel(),this.emit("touchcancel");break;case"touchmove":if(this.touchesMoveNeedsUpdate){for(e=n.length;e--;)this.emit("touchmove",i.move(e,n[e]));this.touchesMoveNeedsUpdate=!1}}}function p(t){switch(t.preventDefault(),t.type){case"mousedown":this.buttons.on(x[t.button]),c(this,t),this.emit("mousedown");break;case"mouseup":this.buttons.off(x[t.button]),c(this,t),this.emit("mouseup");break;case"mouseout":this.buttons.off(x[t.button]),c(this,t),this.emit("mouseout");break;case"mousewheel":case"DOMMouseScroll":g=m(-1,l(1,t.wheelDelta||-t.detail)),this.mouseWheel=g,this.emit("mousewheel",g);break;case"mousemove":this.mouseMoveNeedsUpdate&&(c(this,t),this.mouseMoveNeedsUpdate=!1),this.emit("mousemove")}}function c(t,e){var i=t.mousePosition,o=t.mouseDelta,n=e.target||e.srcElement,s=n.offsetLeft||0,r=n.offsetTop||0,a=(e.pageX||e.clientX)-s,h=(e.pageY||e.clientY)-r;v.x=y?i.x:a,v.y=y?i.y:h,i.x=a,i.y=h,o.x=i.x-v.x,o.y=i.y-v.y,y=!0}function u(t){switch(t.preventDefault(),t.type){case"keydown":this.buttons.on(b[t.keyCode]),this.emit("keydown");break;case"keyup":this.buttons.off(b[t.keyCode]),this.emit("keyup")}}var l=Math.min,m=Math.max,f=e.addEvent,d=e.removeEvent;new i(s),t.extend(r,t),r.prototype.setElement=function(t){this.element&&this.removeElement(),this.element=t,f(t,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",p,n),f(top,"keydown keyup",u,n),f(t,"touchstart touchmove touchend touchcancel",h,n),f(window,"devicemotion",a,n)},r.prototype.removeElement=function(){if(this.element){var t=this.element;d(t,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",p,n),d(top,"keydown keyup",u,n),d(t,"touchstart touchmove touchend touchcancel",h,n),d(window,"devicemotion",a,n),this.element=void 0}};for(var y=!1,v=new o,g=0,x={0:"mouse0",1:"mouse1",2:"mouse2"},b={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},w=48;90>=w;w++)b[w]=String.fromCharCode(w).toLowerCase();
return new r}),define("core/game/client_game",["base/class","base/device","base/time","core/game/config","core/game/game","core/game/log","core/rendering/canvas","core/rendering/canvas_renderer_2d","core/rendering/webgl_renderer_2d","core/game_object","core/components/component","core/scene","core/input/input","core/input/handler","core/assets/assets","core/assets/asset_loader"],function(t,e,i,o,n,s,r,a,h,p,c,u,l,m,f,d){function y(t){t||(t={}),o.fromJSON(t),n.call(this,t),this.io=void 0,this._sessionid=void 0,this._handler=m,this.input=l,this.scene=void 0,this.camera=void 0,this.canvas=new r(t.width,t.height),this.CanvasRenderer2D=void 0,this.WebGLRenderer2D=void 0,this._optsCanvasRenderer2D=t.CanvasRenderer2D,this._optsWebGLRenderer2D=t.WebGLRenderer2D,this.renderer=void 0}var v=i.now;i.stamp,t.extend(y,n),y.prototype.init=function(){return this.canvas.init(),this._loop.init(),this.emit("init"),this},y.prototype.connect=function(t){var i,o=this;return this.io=i=io.connect(),i.on("connect",function(){o._sessionid||(o._sessionid=this.socket.sessionid),o._sessionid!==this.socket.sessionid&&location.reload(),i.emit("client_device",e)}),i.on("server_ready",function(e,n){f.fromJSON(n),d.load(function(){o.fromJSON(e),i.emit("client_ready"),o.emit("connect",i),t&&t.call(o,i)})}),i.on("server_sync_input",function(){i.emit("client_sync_input",l.toSYNC())}),i.on("server_sync_scene",function(t){var e=o.scene;e&&e.fromSYNC(t)}),i.on("server_setScene",function(t){var e=o.findByServerId(t);o.setScene(e)}),i.on("server_setCamera",function(t){if(!o.scene)return s.warn("Socket:server_setCamera: can't set camera without an active scene, use ServerGame.setScene first"),void 0;var e=o.scene.findByServerId(t),n=o.canvas;return e?(o.setCamera(e),n.on("resize",function(){i.emit("client_resize",this.pixelWidth,this.pixelHeight)}),i.emit("client_resize",n.pixelWidth,n.pixelHeight),void 0):(s.warn("Socket:server_setCamera: can't find camera in active scene"),void 0)}),i.on("server_addScene",function(t){o.addScene((new u).fromJSON(t))}),i.on("server_addGameObject",function(t,e){var i=o.findByServerId(t);i&&i.addGameObject((new p).fromJSON(e))}),i.on("server_addComponent",function(t,e,i){var n=o.findByServerId(t);if(n){var s=n.findByServerId(e);s&&s.addComponent(new c._types[i._type].fromJSON(i))}}),i.on("server_removeScene",function(t){o.removeScene(o.findByServerId(t))}),i.on("server_removeGameObject",function(t,e){var i=o.findByServerId(t);i&&i.removeGameObject(i.findByServerId(e))}),i.on("server_removeComponent",function(t,e,i){var n=o.findByServerId(t);if(n){var s=n.findByServerId(e);s&&s.removeComponent(s.getComponent(i))}}),this},y.prototype.disconnect=function(){var t=this.io;return t.disconnect(),t.removeAllListeners(),this._sessionid=void 0,this},y.prototype.setScene=function(t){if(!(t instanceof u))return s.warn("ClientGame.setScene: can't add passed argument, it is not instance of Scene"),this;var e=this.scenes,i=e.indexOf(t);return-1!==i?(this.scene=t,this.emit("setScene",t)):s.warn("ClientGame.setScene: Scene is not a member of Game"),this},y.prototype.setCamera=function(t){if(!(t instanceof p))return s.warn("Scene.addGameObject: can't add argument to Scene, it's not an instance of GameObject"),this;var e,i=this.scene,o=this.camera;return i?(e=i.gameObjects.indexOf(t),-1===e&&(s.warn("ClientGame.setCamera: GameObject is not a member of the active Scene, adding it..."),i.addGameObject(t)),this.camera=t.camera||t.camera2d,this.camera?(this.camera._active=!0,o&&(o._active=!1),this.updateRenderer(),this.emit("setCamera",this.camera)):s.warn("ClientGame.setCamera: GameObject does't have a Camera or a Camera2D Component"),this):(s.warn("ClientGame.setCamera: can't set camera without an active scene, use ClientGame.setScene first"),this)},y.prototype.updateRenderer=function(){var t,i=this.camera,n=this.renderer,r=this.canvas;i&&(t=i.gameObject,o.renderer&&this[o.renderer]?(this.renderer=this[o.renderer],s.log("Game: setting up "+o.renderer)):t.camera?s.warn("Game.updateRenderer: no renderer for camera component yet"):t.camera2d&&(!o.forceCanvas&&e.webgl?(this.renderer=this.WebGLRenderer2D||(this.WebGLRenderer2D=new h(this._optsWebGLRenderer2D)),s.log("Game: setting up WebGLRenderer2D")):e.canvas?(this.renderer=this.CanvasRenderer2D||(this.CanvasRenderer2D=new a(this._optsCanvasRenderer2D)),s.log("Game: setting up CanvasRenderer2D")):s.error("Game.updateRenderer: Could not get a renderer for this device")),n!==this.renderer&&(n&&n.destroy(),this.renderer.init(r),m.setElement(r.element)))};var g=0,x=-1/60,b=0,w=1/60,S=0,_=0,O=0;return y.prototype.loop=function(){var t=this.camera,e=this.scene,n=o.MIN_DELTA,s=o.MAX_DELTA;i.frameCount=g++,x=b,b=v(),i.sinceStart=b,O=b,S++,O>_+1&&(i.fps=S/(O-_),_=O,S=0),w=(b-x)*i.scale,i.delta=n>w?n:w>s?s:w,i.time=b*i.scale,l.update(),e&&(e.update(),t&&this.renderer.render(e,t)),this.emit("update",b)},y}),define("math/aabb3",["math/mathf","math/vec3"],function(t,e){function i(t,i){this.min=t||new e(1/0,1/0,1/0),this.max=i||new e(-1/0,-1/0,-1/0)}return i.prototype.clone=function(){return new i(this.min.clone(),this.max.clone())},i.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.prototype.expandPoint=function(t){return this.min.min(t),this.max.max(t),this},i.prototype.expandVec=function(t){return this.min.sub(t),this.max.add(t),this},i.prototype.expandScalar=function(t){return this.min.ssub(t),this.max.sadd(t),this},i.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.prototype.clear=function(){return this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0),this},i.prototype.contains=function(t){var e=this.min,i=this.max,o=t.x,n=t.y,s=t.z;return!(o<e.x||o>i.x||n<e.y||n>i.y||s<e.z||s>i.z)},i.prototype.intersects=function(t){var e=this.min,i=this.max,o=t.min,n=t.max;return!(n.x<e.x||o.x>i.x||n.y<e.y||o.y>i.y||n.z<e.z||o.z>i.z)},i.prototype.fromPoints=function(t){for(var e,i,o,n,s=t.length,r=1/0,a=1/0,h=1/0,p=-1/0,c=-1/0,u=-1/0,l=this.min,m=this.max;s--;)e=t[s],i=e.x,o=e.y,n=e.z,r=r>i?i:r,a=a>o?o:a,h=h>n?n:h,p=i>p?i:p,c=o>c?o:c,u=n>u?n:u;return l.x=r,l.y=a,l.z=h,m.x=p,m.y=c,m.z=u,this},i.prototype.fromCenterSize=function(t,e){var i=this.min,o=this.max,n=t.x,s=t.y,r=t.z,a=.5*e.x,h=.5*e.y,p=.5*e.z;return i.x=n-a,i.y=s-h,i.z=r-p,o.x=n+a,o.y=s+h,o.z=r+p,this},i.prototype.fromJSON=function(t){return this.min.fromJSON(t.min),this.max.fromJSON(t.max),this},i.prototype.toJSON=function(t){return t||(t={}),t.min=this.min.toJSON(t.min),t.max=this.max.toJSON(t.max),t},i.prototype.toString=function(){var t=this.min,e=this.max;return"AABB3( min: "+t+", max: "+e+" )"},i}),define("math/mat2",[],function(){function t(t,e,i,o){var n=new Float32Array(4);this.elements=n,n[0]=void 0!==t?t:1,n[2]=e||0,n[1]=i||0,n[3]=void 0!==o?o:1}var e=Math.cos,i=Math.sin,o=Math.atan2;return t.prototype.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3])},t.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this},t.prototype.set=function(t,e,i,o){var n=this.elements;return n[0]=t,n[2]=e,n[1]=i,n[3]=o,this},t.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[2],s=e[1],r=e[3],a=i[0],h=i[2],p=i[1],c=i[3];return e[0]=o*a+s*h,e[1]=n*a+r*h,e[2]=o*p+s*c,e[3]=n*p+r*c,this},t.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,s=o[0],r=o[2],a=o[1],h=o[3],p=n[0],c=n[2],u=n[1],l=n[3];return i[0]=s*p+a*c,i[1]=r*p+h*c,i[2]=s*u+a*l,i[3]=r*u+h*l,this},t.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},t.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},t.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,this},t.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,this},t.prototype.determinant=function(){var t=this.elements;return t[0]*t[3]-t[2]*t[1]},t.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[2],o=t[1],n=t[3],s=e*n-i*o;return s=0!==s?1/s:0,t[0]=n*s,t[1]=-i*s,t[2]=-o*s,t[3]=e*s,this},t.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[2],s=i[1],r=i[3],a=o*r-n*s;return a=0!==a?1/a:0,e[0]=r*a,e[1]=-n*a,e[2]=-s*a,e[3]=o*a,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[2],e[2]=t,this},t.prototype.setTrace=function(t,e){var i=this.elements;return i[0]=t,i[3]=e,this},t.prototype.setRotation=function(t){var o=this.elements,n=e(t),s=i(t);return o[0]=n,o[1]=s,o[2]=-s,o[3]=n,this},t.prototype.getRotation=function(){var t=this.elements;return o(t[1],t[0])},t.prototype.rotate=function(t){var e=this.elements,o=e[0],n=e[2],s=e[1],r=e[3],a=i(t),h=i(t);return e[0]=o*h+n*a,e[1]=o*-a+n*h,e[2]=s*h+r*a,e[3]=s*-a+r*h,this},t.prototype.fromMat3=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[3],e[3]=i[4],this},t.prototype.fromMat4=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[4],e[3]=i[5],this},t.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this},t.prototype.toJSON=function(t){t||(t={});var e=this.elements,i=t.elements||(t.elements=[]);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],t},t.prototype.toString=function(){var t=this.elements;return"Mat2[ "+t[0]+", "+t[2]+"]\n"+"     [ "+t[1]+", "+t[3]+"]"},t}),define("math/mat3",[],function(){function t(t,e,i,o,n,s,r,a,h){var p=new Float32Array(9);this.elements=p,p[0]=void 0!==t?t:1,p[3]=e||0,p[6]=i||0,p[1]=o||0,p[4]=void 0!==n?n:1,p[7]=s||0,p[2]=r||0,p[5]=a||0,p[8]=void 0!==h?h:1}var e=Math.cos,i=Math.sin;return t.prototype.clone=function(){var e=this.elements;return new t(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},t.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},t.prototype.set=function(t,e,i,o,n,s,r,a,h){var p=this.elements;return p[0]=t,p[3]=e,p[6]=i,p[1]=o,p[4]=n,p[7]=s,p[2]=r,p[5]=a,p[8]=h,this},t.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[3],s=e[6],r=e[1],a=e[4],h=e[7],p=e[2],c=e[5],u=e[8],l=i[0],m=i[3],f=i[6],d=i[1],y=i[4],v=i[7],g=i[2],x=i[5],b=i[8];return e[0]=o*l+r*m+p*f,e[3]=n*l+a*m+c*f,e[6]=s*l+h*m+u*f,e[1]=o*d+r*y+p*v,e[4]=n*d+a*y+c*v,e[7]=s*d+h*y+u*v,e[2]=o*g+r*x+p*b,e[5]=n*g+a*x+c*b,e[8]=s*g+h*x+u*b,this},t.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,s=o[0],r=o[3],a=o[6],h=o[1],p=o[4],c=o[7],u=o[2],l=o[5],m=o[8],f=n[0],d=n[3],y=n[6],v=n[1],g=n[4],x=n[7],b=n[2],w=n[5],S=n[8];return i[0]=s*f+h*d+u*y,i[3]=r*f+p*d+l*y,i[6]=a*f+c*d+m*y,i[1]=s*v+h*g+u*x,i[4]=r*v+p*g+l*x,i[7]=a*v+c*g+m*x,i[2]=s*b+h*w+u*S,i[5]=r*b+p*w+l*S,i[8]=a*b+c*w+m*S,this},t.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.prototype.sdiv=function(t){var e=this.elements;return t=0===t?0:1/t,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},t.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,this},t.prototype.determinant=function(){var t=this.elements,e=t[0],i=t[1],o=t[2],n=t[3],s=t[4],r=t[5],a=t[6],h=t[7],p=t[8];return e*s*p-e*r*h-i*n*p+i*r*a+o*n*h-o*s*a},t.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[3],o=t[6],n=t[1],s=t[4],r=t[7],a=t[2],h=t[5],p=t[8],c=s*p-r*h,u=o*h-i*p,l=i*r-o*s,m=e*c+n*u+a*l;return m=0!==m?1/m:1,t[0]=c*m,t[1]=(r*a-n*p)*m,t[2]=(n*h-s*a)*m,t[3]=u*m,t[4]=(e*p-o*a)*m,t[5]=(i*a-e*h)*m,t[6]=l*m,t[7]=(o*n-e*r)*m,t[8]=(e*s-i*n)*m,this},t.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[3],s=i[6],r=i[1],a=i[4],h=i[7],p=i[2],c=i[5],u=i[8],l=a*u-h*c,m=s*c-n*u,f=n*h-s*a,d=o*l+r*m+p*f;return d=0!==d?1/d:0,e[0]=l*d,e[1]=(h*p-r*u)*d,e[2]=(r*c-a*p)*d,e[3]=m*d,e[4]=(o*u-s*p)*d,e[5]=(n*p-o*c)*d,e[6]=f*d,e[7]=(s*r-o*h)*d,e[8]=(o*a-n*r)*d,this},t.prototype.inverseMat4=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[4],s=i[8],r=i[1],a=i[5],h=i[9],p=i[2],c=i[6],u=i[10],l=u*a-c*h,m=-u*n+c*s,f=h*n-a*s,d=o*l+r*m+p*f;return d=0!==d?1/d:0,e[0]=l*d,e[1]=(-u*r+p*h)*d,e[2]=(c*r-p*a)*d,e[3]=m*d,e[4]=(u*o-p*s)*d,e[5]=(-c*o+p*n)*d,e[6]=f*d,e[7]=(-h*o+r*s)*d,e[8]=(a*o-r*n)*d,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},t.prototype.setTrace=function(t){var e=this.elements;return e[0]=t.x,e[4]=t.y,e[8]=t.z,this},t.prototype.scale=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z;return e[0]*=i,e[3]*=o,e[6]*=n,e[1]*=i,e[4]*=o,e[7]*=n,e[2]*=i,e[5]*=o,e[8]*=n,this},t.prototype.makeScale=function(t,e,i){return this.set(t,0,0,0,e,0,0,0,i)},t.prototype.makeRotationX=function(t){var o=e(t),n=i(t);return this.set(1,0,0,0,o,-n,0,n,o)},t.prototype.makeRotationY=function(t){var o=e(t),n=i(t);return this.set(o,0,n,0,1,0,-n,0,o)},t.prototype.makeRotationZ=function(t){var o=e(t),n=i(t);return this.set(o,-n,0,n,o,0,0,0,1)},t.prototype.fromMat2=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=0,e[3]=i[2],e[4]=i[3],e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},t.prototype.fromMat4=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],this},t.prototype.fromQuat=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z,s=t.w,r=i+i,a=o+o,h=n+n,p=i*r,c=i*a,u=i*h,l=o*a,m=o*h,f=n*h,d=s*r,y=s*a,v=s*h;return e[0]=1-(l+f),e[1]=c+v,e[2]=u-y,e[3]=c-v,e[4]=1-(p+f),e[5]=m+d,e[6]=u+y,e[7]=m-d,e[8]=1-(p+l),this},t.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},t.prototype.toJSON=function(t){t||(t={});var e=this.elements,i=t.elements||(t.elements=[]);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],t},t.prototype.toString=function(){var t=this.elements;return"Mat3["+t[0]+", "+t[3]+", "+t[6]+"]\n"+"     ["+t[1]+", "+t[4]+", "+t[7]+"]\n"+"     ["+t[2]+", "+t[5]+", "+t[8]+"]"},t}),define("math/vec4",[],function(){function t(t,e,i,o){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==o?o:1}var e=Math.sqrt;return t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.set=function(t,e,i,o){return this.x=t,this.y=e,this.z=i,this.w=o,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},t.prototype.sadd=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},t.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},t.prototype.ssub=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},t.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},t.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this},t.prototype.smul=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.div=function(t){var e=t.x,i=t.y,o=t.z,n=t.w;return this.x*=0!==e?1/e:0,this.y*=0!==i?1/i:0,this.z*=0!==o?1/o:0,this.w*=0!==n?1/n:0,this},t.prototype.vdiv=function(t,e){var i=e.x,o=e.y,n=e.z,s=e.w;return this.x=0!==i?t.x/i:0,this.y=0!==o?t.y/o:0,this.z=0!==n?t.z/n:0,this.w=0!==s?t.w/s:0,this},t.prototype.sdiv=function(t){return t=0===t?0:1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.length=function(){var t=this.x,i=this.y,o=this.z,n=this.w,s=t*t+i*i+o*o+n*n;return 1===s?1:s>0?e(s):0},t.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z,o=this.w;return t*t+e*e+i*i+o*o},t.prototype.setLength=function(t){var i=this.x,o=this.y,n=this.z,s=this.w,r=i*i+o*o+n*n+s*s;return 1===r?(this.x*=t,this.y*=t,this.z*=t,this.w*=t,this):(r=r>0?1/e(r):0,this.x*=r*t,this.y*=r*t,this.z*=r*t,this.w*=r*t,this)},t.prototype.normalize=function(){var t=this.x,i=this.y,o=this.z,n=this.w,s=t*t+i*i+o*o+n*n;return 1===s?this:(s=s>0?1/e(s):0,this.x*=s,this.y*=s,this.z*=s,this.w*=s,this)},t.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},t.prototype.inverseVec=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=-t.w,this},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},t.prototype.vlerp=function(t,e,i){var o=t.x,n=t.y,s=t.z,r=t.w;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=s+(e.z-s)*i,this.w=r+(e.w-r)*i,this},t.vdot=t.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},t.prototype.min=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,s=t.x,r=t.y,a=t.z,h=this.w;return this.x=e>s?s:e,this.y=i>r?r:i,this.z=o>a?a:o,this.w=n>h?h:n,this},t.prototype.max=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,s=t.x,r=t.y,a=t.z,h=this.w;return this.x=s>e?s:e,this.y=r>i?r:i,this.z=a>o?a:o,this.w=h>n?h:n,this},t.prototype.clamp=function(t,e){var i=this.x,o=this.y,n=this.z,s=this.w,r=t.x,a=t.y,h=t.z,p=t.w,c=e.x,u=e.y,l=e.z,m=m;return this.x=r>i?r:i>c?c:i,this.y=a>o?a:o>u?u:o,this.z=h>n?h:n>l?l:n,this.w=p>s?p:s>m?m:s,this},t.prototype.transformMat4=function(t){var e=t.elements,i=this.x,o=this.y,n=this.z,s=this.w;return this.x=i*e[0]+o*e[4]+n*e[8]+s*e[12],this.y=i*e[1]+o*e[5]+n*e[9]+s*e[13],this.z=i*e[2]+o*e[6]+n*e[10]+s*e[14],this.w=i*e[3]+o*e[7]+n*e[11]+s*e[15],this},t.prototype.fromVec2=function(t){return this.x=t.x,this.y=t.y,this.z=0,this.w=1,this},t.prototype.fromVec3=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=1,this},t.prototype.positionFromMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this},t.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.toJSON=function(t){return t||(t={}),t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},t.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},t.prototype.toArray=function(t){return t||(t=[]),t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t},t.prototype.toString=function(){return"Vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},t}),define("odin",["require","phys_2d/phys_2d","base/audio_ctx","base/class","base/device","base/dom","base/event_emitter","base/object_pool","base/request_animation_frame","base/time","core/assets/asset","core/assets/asset_loader","core/assets/assets","core/assets/audio_clip","core/assets/sprite_sheet","core/assets/texture","core/components/audio_source","core/components/camera","core/components/camera_2d","core/components/component","core/components/emitter_2d","core/components/rigid_body_2d","core/components/sprite_2d","core/components/transform","core/components/transform_2d","core/game/game","core/game/client_game","core/game/log","core/input/handler","core/input/input","core/rendering/canvas_renderer_2d","core/rendering/webgl_renderer_2d","core/game_object","core/scene","math/aabb2","math/aabb3","math/color","math/mat2","math/mat3","math/mat32","math/mat4","math/mathf","math/quat","math/vec2","math/vec3","math/vec4"],function(t){function e(){this.Phys2D=t("phys_2d/phys_2d"),this.AudioCtx=t("base/audio_ctx"),this.Class=t("base/class"),this.Device=t("base/device"),this.Dom=t("base/dom"),this.EventEmitter=t("base/event_emitter"),this.ObjectPool=t("base/object_pool"),this.requestAnimationFrame=t("base/request_animation_frame"),this.Time=t("base/time"),this.Asset=t("core/assets/asset"),this.AssetLoader=t("core/assets/asset_loader"),this.Assets=t("core/assets/assets"),this.AudioClip=t("core/assets/audio_clip"),this.SpriteSheet=t("core/assets/sprite_sheet"),this.Texture=t("core/assets/texture"),this.AudioSource=t("core/components/audio_source"),this.Camera=t("core/components/camera"),this.Camera2D=t("core/components/camera_2d"),this.Component=t("core/components/component"),this.Emitter2D=t("core/components/emitter_2d"),this.RigidBody2D=t("core/components/rigid_body_2d"),this.Sprite2D=t("core/components/sprite_2d"),this.Transform=t("core/components/transform"),this.Transform2D=t("core/components/transform_2d"),this.Game=t("core/game/game"),this.ClientGame=t("core/game/client_game"),this.Log=t("core/game/log"),this.Handler=t("core/input/handler"),this.Input=t("core/input/input"),this.CanvasRenderer2D=t("core/rendering/canvas_renderer_2d"),this.WebGLRenderer2D=t("core/rendering/webgl_renderer_2d"),this.GameObject=t("core/game_object"),this.Scene=t("core/scene"),this.AABB2=t("math/aabb2"),this.AABB3=t("math/aabb3"),this.Color=t("math/color"),this.Mat2=t("math/mat2"),this.Mat3=t("math/mat3"),this.Mat32=t("math/mat32"),this.Mat4=t("math/mat4"),this.Mathf=t("math/mathf"),this.Quat=t("math/quat"),this.Vec2=t("math/vec2"),this.Vec3=t("math/vec3"),this.Vec4=t("math/vec4"),this.Device.mobile&&(window.onerror=function(t,e,i){alert("line: "+i+", page: "+e+"\nmessage: "+t)})}return e.prototype.globalize=function(){for(var t in this)window[t]=this[t];window.Odin=this},new e});