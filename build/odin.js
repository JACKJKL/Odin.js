var define;"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/event_emitter",[],function(){function EventEmitter(){this._events={}}var shift=Array.prototype.shift,SPLITER=/[ ,]+/;return EventEmitter.prototype.on=function(type,listener,ctx){var i,types=type.split(SPLITER),events=this._events;for(i=types.length;i--;){type=types[i],(events[type]||(events[type]=[])).push({listener:listener,ctx:ctx||this})}return this},EventEmitter.prototype.once=function(type,listener,ctx){function once(){self.off(type,once),listener.apply(ctx,arguments)}var self=this;return ctx=ctx||this,this.on(type,once,ctx)},EventEmitter.prototype.listenTo=function(obj,type,listener,ctx){if(!obj.on||!obj.addEventListenerTo){throw"Can't listen to Object, it's not a instance of EventEmitter"}return obj.on(type,listener,ctx||this),this},EventEmitter.prototype.off=function(type,listener,ctx){var events,event,i,j,types=type.split(SPLITER),thisEvents=this._events;for(i=types.length;i--;){if(type=types[i],!type){for(i in thisEvents){thisEvents[i].length=0}return this}if(events=thisEvents[type],!events){return this}if(listener){for(ctx=ctx||this,j=events.length;j--;){if(event=events[j],event.listener===listener&&event.ctx===ctx){events.splice(j,1);break}}}else{events.length=0}}return this},EventEmitter.prototype.emit=function(type){var a1,a2,a3,a4,event,i,events=this._events[type];if(!events||!events.length){return this}switch(arguments.length){case 1:for(i=events.length;i--;){(event=events[i]).listener.call(event.ctx)}break;case 2:for(a1=arguments[1],i=events.length;i--;){(event=events[i]).listener.call(event.ctx,a1)}break;case 3:for(a1=arguments[1],a2=arguments[2],i=events.length;i--;){(event=events[i]).listener.call(event.ctx,a1,a2)}break;case 4:for(a1=arguments[1],a2=arguments[2],a3=arguments[3],i=events.length;i--;){(event=events[i]).listener.call(event.ctx,a1,a2,a3)}break;case 5:for(a1=arguments[1],a2=arguments[2],a3=arguments[3],a4=arguments[4],i=events.length;i--;){(event=events[i]).listener.call(event.ctx,a1,a2,a3,a4)}break;default:for(shift.apply(arguments),i=events.length;i--;){(event=events[i]).listener.apply(event.ctx,arguments)}}return this},EventEmitter.extend=function(child,parent){return parent||(parent=this),child.prototype=Object.create(parent.prototype),child.prototype.constructor=child,child.extend=parent.extend||this.extend,parent.onExtend&&(child.onExtend||(child.onExtend=parent.onExtend),parent.onExtend(child)),child},EventEmitter}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/class",["odin/base/event_emitter"],function(EventEmitter){function Class(){EventEmitter.call(this),this._id=++CLASS_ID,this._serverId=-1,this._SYNC={}}var CLASS_ID=0,IS_SERVER=!("undefined"!=typeof window&&window.document),IS_CLIENT=!IS_SERVER,defineProperty=Object.defineProperty;return EventEmitter.extend(Class),defineProperty(Class.prototype,"isServer",{get:function(){return IS_SERVER}}),defineProperty(Class.prototype,"isClient",{get:function(){return IS_CLIENT}}),Class.prototype.clone=function(){return(new this.constructor).copy(this)},Class.prototype.copy=function(){return this},Class.prototype.clear=function(){return this},Class.prototype.toSYNC=function(json){return json||(json=this._SYNC),json._id=this._id,json.__type__=this.__type__,json},Class.prototype.fromSYNC=function(json){return this._SYNC=json,this},Class.prototype.toJSON=function(json){return json||(json={}),json._id=this._id,json._serverId=this._serverId,json.__type__=this.__type__,json},Class.prototype.fromServerJSON=function(json){return this._serverId=json._id,this},Class.prototype.fromJSON=function(json){return this._serverId=json._serverId,this},Class.extend=function(child,parent){return parent||(parent=this),child.prototype=Object.create(parent.prototype),child.prototype.constructor=child,child.extend=parent.extend,child.prototype.__type__=child.__type__=child.name,Class.__types__[child.name]=child,parent.onExtend&&(child.onExtend||(child.onExtend=parent.onExtend),parent.onExtend(child)),child},Class.fromJSON=function(json){return(new Class.__types__[json.__type__]).fromJSON(json)},Class.fromServerJSON=function(json){return(new Class.__types__[json.__type__]).fromServerJSON(json)},Class.create=function(type){return new Class.__types__[type]},Class.__types__={},Class}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/enum",[],function(){function Enum(enums){enums=isArray(enums)?enums:enums.split(SPLITER);for(var i=enums.length;i--;){this[enums[i]]=COUNTER++}}var isArray=Array.isArray,SPLITER=/[ ,]+/,COUNTER=1;return Enum.prototype.add=function(enums){enums=isArray(enums)?enums:enums.split(SPLITER);for(var i=enums.length;i--;){this[enums[i]]=COUNTER++}return this},Enum}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/p2enums",["odin/base/enum"],function(Enum){return{BodyType:new Enum("Particle RigidBody"),ShapeType:new Enum("Convex Circle Segment"),MotionState:new Enum("Dynamic Static Kinematic"),SleepState:new Enum("Awake Sleepy Sleeping")}}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/collision/p2broadphase",["odin/base/class","odin/phys2d/p2enums"],function(Class,P2Enums){function P2Broadphase(){Class.call(this)}function bodiesNeedsBroadphase(bi,bj){return bi.sleepState===SleepState.Sleeping&&bj.sleepState===SleepState.Sleeping?!1:bi.motionState!==MotionState.Dynamic&&bj.motionState!==MotionState.Dynamic?!1:bi.aabb&&bj.aabb&&!bi.aabb.intersects(bj.aabb)?!1:!0}function shapesNeedsBroadphase(bi,bj,si,sj,pairsi,pairsj){return si||sj?si?sj?si.filterGroup&0===sj.filterMask||sj.filterGroup&0===si.filterMask?!1:!0:(pairsi.push(si),pairsj.push(bj),!1):(pairsi.push(bi),pairsj.push(sj),!1):!1}var MotionState=P2Enums.MotionState,SleepState=P2Enums.SleepState;return Class.extend(P2Broadphase),P2Broadphase.prototype.collisions=function(bodies,pairsi,pairsj){var bi,bj,shapesi,shapesj,shapesNumi,shapesNumj,si,sj,i,j,k,l,num=bodies.length;for(pairsi.length=pairsj.length=0,i=0;num>i;i++){for(j=0;j!==i;j++){if(bi=bodies[i],bj=bodies[j],bodiesNeedsBroadphase(bi,bj)){for(shapesi=bi.shapes,shapesj=bj.shapes,shapesNumi=shapesi.length,shapesNumj=shapesj.length,k=shapesNumi;k--;){for(l=shapesNumj;l--;){si=shapesi[k],sj=shapesj[l],shapesNeedsBroadphase(bi,bj,si,sj,pairsi,pairsj)&&si.aabb.intersects(sj.aabb)&&(pairsi.push(si),pairsj.push(sj))}}}}}},P2Broadphase}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/object_pool",[],function(){function ObjectPool(constructor){this.pooled=[],this.objects=[],this.object=constructor}return ObjectPool.prototype.create=function(){var pooled=this.pooled,object=pooled.length?pooled.pop():new this.object;return this.objects.push(object),object},ObjectPool.prototype.removeObject=function(object){var objects=this.objects,pooled=this.pooled,index=objects.indexOf(object);return index>-1&&(pooled.push(object),objects.splice(index,1)),this},ObjectPool.prototype.remove=ObjectPool.prototype.removeObjects=function(){for(var i=arguments.length;i--;){this.removeObject(arguments[i])}return this},ObjectPool.prototype.clear=function(){var i,objects=this.objects,pooled=this.pooled;for(i=objects.length;i--;){pooled.push(objects[i])}return objects.length=0,this},ObjectPool.prototype.clearForEach=function(fn){var object,i,objects=this.objects,pooled=this.pooled;for(i=objects.length;i--;){object=objects[i],fn(object),pooled.push(object)}return objects.length=0,this},ObjectPool}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mathf",[],function(){function Mathf(){this.PI=PI,this.TWO_PI=TWO_PI,this.HALF_PI=HALF_PI,this.EPSILON=EPSILON,this.TO_RADS=TO_RADS,this.TO_DEGS=TO_DEGS}var modulo,clamp01,standardRadian,standardAngle,radsToDegs,RIGHT,UP_RIGHT,UP,UP_LEFT,LEFT,DOWN_LEFT,DOWN,DOWN_RIGHT,random=Math.random,abs=Math.abs,pow=Math.pow,floor=Math.floor,ceil=Math.ceil,atan2=Math.atan2,EPSILON=1e-6,PI=3.141592653589793,TWO_PI=2*PI,HALF_PI=.5*PI,TO_RADS=PI/180,TO_DEGS=180/PI,keys=Object.keys;return Mathf.prototype.acos=Math.acos,Mathf.prototype.asin=Math.asin,Mathf.prototype.atan=Math.atan,Mathf.prototype.atan2=Math.atan2,Mathf.prototype.cos=Math.cos,Mathf.prototype.sin=Math.sin,Mathf.prototype.tan=Math.tan,Mathf.prototype.abs=Math.abs,Mathf.prototype.ceil=Math.ceil,Mathf.prototype.exp=Math.exp,Mathf.prototype.floor=Math.floor,Mathf.prototype.log=Math.log,Mathf.prototype.max=Math.max,Mathf.prototype.min=Math.min,Mathf.prototype.pow=Math.pow,Mathf.prototype.random=Math.random,Mathf.prototype.round=Math.round,Mathf.prototype.sqrt=Math.sqrt,Mathf.prototype.equals=function(a,b,e){return abs(a-b)<(e||EPSILON)},Mathf.prototype.modulo=modulo=function(a,b){var r=a%b;return 0>r*b?r+b:r},Mathf.prototype.standardRadian=standardRadian=function(x){return modulo(x,TWO_PI)},Mathf.prototype.standardAngle=standardAngle=function(x){return modulo(x,360)},Mathf.prototype.sign=function(x){return 0>x?-1:1},Mathf.prototype.clamp=function(x,min,max){return min>x?min:x>max?max:x},Mathf.prototype.clampBottom=function(x,min){return min>x?min:x},Mathf.prototype.clampTop=function(x,max){return x>max?max:x},Mathf.prototype.clamp01=clamp01=function(x){return 0>x?0:x>1?1:x},Mathf.prototype.truncate=function(x,n){var p=pow(10,n),num=x*p;return(0>num?ceil(num):floor(num))/p},Mathf.prototype.lerp=function(a,b,x){return a+(b-a)*x},Mathf.prototype.lerpAngle=function(a,b,x){return standardRadian(a+(b-a)*x)},Mathf.prototype.smoothStep=function(x,min,max){return min>=x?0:x>=max?1:(x=(x-min)/(max-min),x*x*(3-2*x))},Mathf.prototype.smootherStep=function(x,min,max){return min>=x?0:x>=max?1:(x=(x-min)/(max-min),x*x*x*(x*(6*x-15)+10))},Mathf.prototype.pingPong=function(x,length){return length||(length=1),length-abs(x%(2*length)-length)},Mathf.prototype.degsToRads=function(x){return standardRadian(x*TO_RADS)},Mathf.prototype.radsToDegs=radsToDegs=function(x){return standardAngle(x*TO_DEGS)},Mathf.prototype.randInt=function(min,max){return floor(min+random()*(max+1-min))},Mathf.prototype.randFloat=function(min,max){return min+random()*(max-min)},Mathf.prototype.randSign=function(){return random()<.5?1:-1},Mathf.prototype.randChoice=function(array){return array[~~(random()*array.length)]},Mathf.prototype.randArg=function(){return arguments[~~(random()*arguments.length)]},Mathf.prototype.randChoiceObject=function(obj){var array=keys(obj);return array[~~(random()*array.length)]},Mathf.prototype.isPowerOfTwo=function(x){return(x&-x)===x},Mathf.prototype.toPowerOfTwo=function(x){for(var i=2;x>i;){i*=2}return i},RIGHT="right",UP_RIGHT="up_right",UP="up",UP_LEFT="up_left",LEFT="left",DOWN_LEFT="down_left",DOWN="down",DOWN_RIGHT="down_right",Mathf.prototype.directionAngle=function(a){return a=radsToDegs(a),a>337.5&&22.5>a?RIGHT:a>22.5&&67.5>a?UP_RIGHT:a>67.5&&112.5>a?UP:a>112.5&&157.5>a?UP_LEFT:a>157.5&&202.5>a?LEFT:a>202.5&&247.5>a?DOWN_LEFT:a>247.5&&292.5>a?DOWN:a>292.5&&337.5>a?DOWN_RIGHT:RIGHT},Mathf.prototype.direction=function(x,y){var a=radsToDegs(atan2(y,x));return a>337.5&&22.5>a?RIGHT:a>22.5&&67.5>a?UP_RIGHT:a>67.5&&112.5>a?UP:a>112.5&&157.5>a?UP_LEFT:a>157.5&&202.5>a?LEFT:a>202.5&&247.5>a?DOWN_LEFT:a>247.5&&292.5>a?DOWN:a>292.5&&337.5>a?DOWN_RIGHT:RIGHT},new Mathf}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/vec2",[],function(){function Vec2(x,y){this.x=x||0,this.y=y||0}var sqrt=Math.sqrt;return Vec2.prototype.clone=function(){return new Vec2(this.x,this.y)},Vec2.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this},Vec2.prototype.set=function(x,y){return this.x=x,this.y=y,this},Vec2.prototype.add=function(other){return this.x+=other.x,this.y+=other.y,this},Vec2.prototype.vadd=function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},Vec2.prototype.sadd=function(s){return this.x+=s,this.y+=s,this},Vec2.prototype.sub=function(other){return this.x-=other.x,this.y-=other.y,this},Vec2.prototype.vsub=function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},Vec2.prototype.ssub=function(s){return this.x-=s,this.y-=s,this},Vec2.prototype.mul=function(other){return this.x*=other.x,this.y*=other.y,this},Vec2.prototype.vmul=function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this},Vec2.prototype.smul=function(s){return this.x*=s,this.y*=s,this},Vec2.prototype.div=function(other){var x=other.x,y=other.y;return this.x*=0!==x?1/x:0,this.y*=0!==y?1/y:0,this},Vec2.prototype.vdiv=function(a,b){var x=b.x,y=b.y;return this.x=0!==x?a.x/x:0,this.y=0!==y?a.y/y:0,this},Vec2.prototype.sdiv=function(s){return s=0===s?0:1/s,this.x*=s,this.y*=s,this},Vec2.prototype.length=function(){var x=this.x,y=this.y,lsq=x*x+y*y;return 1===lsq?1:lsq>0?sqrt(lsq):0},Vec2.prototype.lengthSq=function(){var x=this.x,y=this.y;return x*x+y*y},Vec2.prototype.setLength=function(length){var x=this.x,y=this.y,l=x*x+y*y;return 1===l?(this.x*=length,this.y*=length,this):(l=l>0?1/sqrt(l):0,this.x*=l*length,this.y*=l*length,this)},Vec2.prototype.normalize=function(){var x=this.x,y=this.y,l=x*x+y*y;return 1===l?this:(l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this)},Vec2.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this},Vec2.prototype.inverseVec=function(other){return this.x=-other.x,this.y=-other.y,this},Vec2.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this},Vec2.prototype.vlerp=function(a,b,x){var ax=a.x,ay=a.y;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this},Vec2.vdot=Vec2.prototype.vdot=function(a,b){return a.x*b.x+a.y*b.y},Vec2.prototype.dot=function(other){return this.x*other.x+this.y*other.y},Vec2.vcross=Vec2.prototype.vcross=function(a,b){return a.x*b.y-a.y*b.x},Vec2.prototype.cross=function(other){return this.x*other.y-this.y*other.x},Vec2.prototype.min=function(other){var ax=this.x,ay=this.y,bx=other.x,by=other.y;return this.x=ax>bx?bx:ax,this.y=ay>by?by:ay,this},Vec2.prototype.max=function(other){var ax=this.x,ay=this.y,bx=other.x,by=other.y;return this.x=bx>ax?bx:ax,this.y=by>ay?by:ay,this},Vec2.prototype.clamp=function(min,max){var x=this.x,y=this.y,minx=min.x,miny=min.y,maxx=max.x,maxy=max.y;return this.x=minx>x?minx:x>maxx?maxx:x,this.y=miny>y?miny:y>maxy?maxy:y,this},Vec2.prototype.transformAngle=function(a){var x=this.x,y=this.y,c=cos(a),s=sin(a);return this.x=x*c-y*s,this.y=x*s+y*c,this},Vec2.prototype.transformMat2=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[2],this.y=x*me[1]+y*me[3],this},Vec2.prototype.untransformMat2=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[1],this.y=x*me[2]+y*me[3],this},Vec2.prototype.transformMat32=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[2]+me[4],this.y=x*me[1]+y*me[3]+me[5],this},Vec2.prototype.untransformMat32=function(m){var me=m.elements,x=this.x-me[4],y=this.y-me[5];return this.x=x*me[0]+y*me[1],this.y=x*me[2]+y*me[3],this},Vec2.prototype.transformMat3=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[3]+me[6],this.y=x*me[1]+y*me[4]+me[7],this},Vec2.prototype.transformMat4=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[4]+me[12],this.y=x*me[1]+y*me[5]+me[13],this},Vec2.prototype.fromVec3=function(v){return this.x=v.x,this.y=v.y,this},Vec2.prototype.fromVec4=function(v){return this.x=v.x,this.y=v.y,this},Vec2.prototype.positionFromMat32=function(m){var me=m.elements;return this.x=me[4],this.y=me[5],this},Vec2.prototype.positionFromMat4=function(m){var me=m.elements;return this.x=me[12],this.y=me[13],this},Vec2.prototype.scaleFromMat2=function(m){var me=m.elements,x=this.set(me[0],m[2]).length(),y=this.set(me[1],m[3]).length();return this.x=x,this.y=y,this},Vec2.prototype.scaleFromMat32=Vec2.prototype.scaleFromMat2,Vec2.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this},Vec2.prototype.toJSON=function(json){return json||(json={}),json.x=this.x,json.y=this.y,json},Vec2.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this},Vec2.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array},Vec2.prototype.toString=function(){return"Vec2( "+this.x+", "+this.y+" )"},Vec2}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/constraints/p2equation",["odin/base/class"],function(Class){function P2Equation(){Class.call(this),this.bi=void 0,this.bj=void 0,this.minForce=-1e6,this.maxForce=1e6,this.relaxation=5,this.stiffness=1e7,this.a=0,this.b=0,this.eps=0,this.lambda=0,this.B=0,this.invC=0}return Class.extend(P2Equation,Class),P2Equation.prototype.updateConstants=function(h){var k=this.stiffness,d=this.relaxation;this.a=4/(h*(1+4*d)),this.b=4*d/(1+4*d),this.eps=4/(h*h*k*(1+4*d))},P2Equation}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/constraints/p2contact",["odin/base/class","odin/math/mathf","odin/math/vec2","odin/phys2d/constraints/p2equation"],function(Class,Mathf,Vec2,P2Equation){function P2Contact(){P2Equation.call(this),this.minForce=0,this.p=new Vec2,this.n=new Vec2,this.s=0,this.e=1,this.u=1,this.ri=new Vec2,this.rj=new Vec2,this.rixn=0,this.rjxn=0}return Class.extend(P2Contact,P2Equation),P2Contact.prototype.init=function(h){var bi=this.bi,bj=this.bj,p=this.p,px=p.x,py=p.y,n=this.n,nx=n.x,ny=n.y,xi=bi.position,xj=bj.position,ri=this.ri,rix=px-xi.x,riy=py-xi.y,rj=this.rj,rjx=px-xj.x,rjy=py-xj.y,rixn=rix*ny-riy*nx,rjxn=rjx*ny-rjy*nx;ri.x=rix,ri.y=riy,rj.x=rjx,rj.y=rjy,this.rixn=rixn,this.rjxn=rjxn,this.lambda=0,this.calculateB(h),this.calculateC()},P2Contact.prototype.calculateB=function(h){var bi=this.bi,bj=this.bj,n=this.n,nx=n.x,ny=n.y,vi=bi.velocity,wi=bi.angularVelocity||0,fi=bi.force,ti=bi.torque||0,invMi=bi.invMass,invIi=bi.invInertia||0,vj=bj.velocity,wj=bj.angularVelocity||0,fj=bj.force,tj=bj.torque||0,invMj=bj.invMass,invIj=bj.invInertia||0,ri=this.ri,rix=ri.x,riy=ri.y,rj=this.rj,rjx=rj.x,rjy=rj.y,e=this.e,Gq=this.s,GWx=vj.x+-wj*rjy-vi.x- -wi*riy,GWy=vj.y+wj*rjx-vi.y-wi*rix,GW=e*GWx*nx+e*GWy*ny,GiMfx=fj.x*invMj+-tj*invIj*rjy-fi.x*invMi- -ti*invIi*riy,GiMfy=fj.y*invMj+tj*invIj*rjx-fi.y*invMi-ti*invIi*rix,GiMf=GiMfx*nx+GiMfy*ny;this.B=-this.a*Gq-this.b*GW-h*GiMf},P2Contact.prototype.calculateC=function(){var bi=this.bi,bj=this.bj,rixn=this.rixn,rjxn=this.rjxn,invIi=bi.invInertia||0,invIj=bj.invInertia||0,C=bi.invMass+bj.invMass+this.eps+invIi*rixn*rixn+invIj*rjxn*rjxn;this.invC=0===C?0:1/C},P2Contact.prototype.calculateGWlambda=function(){var bi=this.bi,bj=this.bj,n=this.n,vlambdai=bi.vlambda,wlambdai=bi.wlambda||0,vlambdaj=bj.vlambda,wlambdaj=bj.wlambda||0,ulambdax=vlambdaj.x-vlambdai.x,ulambday=vlambdaj.y-vlambdai.y,GWlambda=ulambdax*n.x+ulambday*n.y;return void 0!==wlambdai&&(GWlambda-=wlambdai*this.rixn),void 0!==wlambdaj&&(GWlambda+=wlambdaj*this.rjxn),GWlambda},P2Contact.prototype.addToLambda=function(deltaLambda){var bi=this.bi,bj=this.bj,n=this.n,nx=n.x,ny=n.y,invMi=bi.invMass,vlambdai=bi.vlambda,invMj=bj.invMass,vlambdaj=bj.vlambda;vlambdai.x-=deltaLambda*invMi*nx,vlambdai.y-=deltaLambda*invMi*ny,vlambdaj.x+=deltaLambda*invMj*nx,vlambdaj.y+=deltaLambda*invMj*ny,void 0!==bi.wlambda&&(bi.wlambda-=deltaLambda*bi.invInertia*this.rixn),void 0!==bj.wlambda&&(bj.wlambda+=deltaLambda*bj.invInertia*this.rjxn)},P2Contact}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/collision/p2nearphase",["odin/base/class","odin/base/object_pool","odin/math/mathf","odin/math/vec2","odin/phys2d/p2enums","odin/phys2d/constraints/p2contact"],function(Class,ObjectPool,Mathf,Vec2,P2Enums,P2Contact){function clearContact(contact){contact.bi=contact.bj=void 0}function P2Nearphase(){Class.call(this)}function collide(si,sj){var bi=si.body,bj=sj.body,i=bi._index,j=bj._index,space=bi.space;return space.collisionMatrixSet(i,j,1,!0),space.collisionMatrixGet(i,j,!0)!==space.collisionMatrixGet(i,j,!1)?(bi.wake(),bj.wake(),bi.emit("collide",bj,si,sj),bj.emit("collide",bi,sj,si)):(bi.emit("colliding",bj,si,sj),bj.emit("colliding",bi,sj,si)),si.isTrigger||sj.isTrigger?!1:!0}function circleCircle(si,sj,contacts){if(collide(si,sj)){var invDist,c,n,nx,ny,p,xi=si.position,xj=sj.position,xjx=xj.x,xjy=xj.y,dx=xjx-xi.x,dy=xjy-xi.y,dist=dx*dx+dy*dy,separation=0,ri=si.radius,rj=sj.radius,r=ri+rj;dist>r*r||(c=CONTACT_POOL.create(),n=c.n,p=c.p,c.bi=si.body,c.bj=sj.body,c.e=1+min(si.elasticity,sj.elasticity),c.u=min(si.friction,sj.friction),EPSILON>dist?(nx=0,ny=1,invDist=0,separation=-r):(dist=sqrt(dist),invDist=1/dist,nx=dx*invDist,ny=dy*invDist,separation=dist-r),n.x=nx,n.y=ny,p.x=xjx-rj*nx,p.y=xjy-rj*ny,c.s=separation,contacts.push(c))}}function circleParticle(si,sj,contacts){var invDist,c,n,nx,ny,p,xi=si.position,xj=sj.position,xjx=xj.x,xjy=xj.y,dx=xjx-xi.x,dy=xjy-xi.y,dist=dx*dx+dy*dy,separation=0,r=si.radius;dist>r*r||(c=CONTACT_POOL.create(),n=c.n,p=c.p,c.bi=si.body,c.bj=sj.body,c.e=1+si.elasticity,c.u=si.friction,EPSILON>dist?(nx=0,ny=1,invDist=0,separation=-r):(dist=sqrt(dist),invDist=1/dist,nx=dx*invDist,ny=dy*invDist,separation=dist-r),n.x=nx,n.y=ny,p.x=xjx,p.y=xjy,c.s=separation,contacts.push(c))}function convexParticle(si,sj,contacts){var vertex,normal,s,v1,v2,v1x,v1y,v2x,v2y,ex,ey,dx,dy,u,dist,invDist,c,n,nx,ny,p,i,vertices=si._vertices,normals=si._normals,xj=sj.position,xjx=xj.x,xjy=xj.y,separation=-1/0,index=-1;for(i=vertices.length;i--;){if(vertex=vertices[i],normal=normals[i],s=normal.x*(xjx-vertex.x)+normal.y*(xjy-vertex.y),s>EPSILON){return}s>separation&&(separation=s,index=i)}if(!(0>index)){if(normal=normals[index],nx=normal.x,ny=normal.y,v1=vertices[index],v1x=v1.x,v1y=v1.y,v2=vertices[index+1]||vertices[0],v2x=v2.x,v2y=v2.y,ex=v2x-v1x,ey=v2y-v1y,dx=xjx-v1x,dy=xjy-v1y,u=(ex*dx+ey*dy)/(ex*ex+ey*ey),0>u){if(dx=xjx-v1x,dy=xjy-v1y,dist=dx*dx+dy*dy,dist>EPSILON){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{if(u>1){if(dx=xjx-v2x,dy=xjy-v2y,dist=dx*dx+dy*dy,dist>EPSILON){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{normal=normals[index],nx=normal.x,ny=normal.y,dist=separation}}c=CONTACT_POOL.create(),n=c.n,p=c.p,c.bi=si.body,c.bj=sj.body,c.e=1+si.elasticity,c.u=si.friction,n.x=nx,n.y=ny,p.x=xjx,p.y=xjy,c.s=dist,contacts.push(c)}}function convexCircle(si,sj,contacts){if(collide(si,sj)){var vertex,normal,s,v1,v2,v1x,v1y,v2x,v2y,ex,ey,dx,dy,u,dist,invDist,c,n,nx,ny,p,i,vertices=si._vertices,normals=si._normals,xj=sj.position,xjx=xj.x,xjy=xj.y,radius=sj.radius,separation=-1/0,index=-1;for(i=vertices.length;i--;){if(vertex=vertices[i],normal=normals[i],s=normal.x*(xjx-vertex.x)+normal.y*(xjy-vertex.y),s>radius){return}s>separation&&(separation=s,index=i)}if(!(0>index)){if(normal=normals[index],nx=normal.x,ny=normal.y,v1=vertices[index],v1x=v1.x,v1y=v1.y,v2=vertices[index+1]||vertices[0],v2x=v2.x,v2y=v2.y,ex=v2x-v1x,ey=v2y-v1y,dx=xjx-v1x,dy=xjy-v1y,u=(ex*dx+ey*dy)/(ex*ex+ey*ey),0>u){if(dx=xjx-v1x,dy=xjy-v1y,dist=dx*dx+dy*dy,dist>radius*radius){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{if(u>1){if(dx=xjx-v2x,dy=xjy-v2y,dist=dx*dx+dy*dy,dist>radius*radius){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{normal=normals[index],nx=normal.x,ny=normal.y,dist=separation}}c=CONTACT_POOL.create(),n=c.n,p=c.p,c.bi=si.body,c.bj=sj.body,c.e=1+min(si.elasticity,sj.elasticity),c.u=min(si.friction,sj.friction),n.x=nx,n.y=ny,p.x=xjx-radius*nx,p.y=xjy-radius*ny,c.s=dist-radius,contacts.push(c)}}}function contains(vertices,normals,px,py){var n,nx,ny,v,vx,vy,i;for(i=vertices.length;i--;){if(n=normals[i],nx=n.x,ny=n.y,v=vertices[i],vx=v.x,vy=v.y,nx*px+ny*py-(nx*vx+ny*vy)>0){return!1}}return!0}function findContacts(si,sj,normal,dist,contacts){var v,vx,vy,c,n,p,i,verticesi=si._vertices,normalsi=si._normals,verticesj=sj._vertices,normalsj=sj._normals,nx=normal.x,ny=normal.y,e=1+min(si.elasticity,sj.elasticity),u=min(si.friction,sj.friction);for(i=verticesi.length;i--;){v=verticesi[i],vx=v.x,vy=v.y,contains(verticesj,normalsj,vx,vy)&&(c=CONTACT_POOL.create(),n=c.n,p=c.p,c.bi=si.body,c.bj=sj.body,c.e=e,c.u=u,n.x=nx,n.y=ny,p.x=vx,p.y=vy,c.s=dist,contacts.push(c))}for(i=verticesj.length;i--;){v=verticesj[i],vx=v.x,vy=v.y,contains(verticesi,normalsi,vx,vy)&&(c=CONTACT_POOL.create(),n=c.n,p=c.p,c.bi=si.body,c.bj=sj.body,c.e=e,c.u=u,n.x=nx,n.y=ny,p.x=vx,p.y=vy,c.s=dist,contacts.push(c))}}function valueOnAxis(vertices,n,d){var v,i,nx=n.x,ny=n.y,m=1/0;for(i=vertices.length;i--;){v=vertices[i],m=min(m,nx*v.x+ny*v.y)}return m-d}function findMSA(si,sj){var n,v,dist,i,verticesi=si._vertices,normalsi=si._normals,counti=normalsi.length,verticesj=sj._vertices,min=-1/0,index=-1;for(i=counti;i--;){if(n=normalsi[i],v=verticesi[i],dist=valueOnAxis(verticesj,n,n.x*v.x+n.y*v.y),dist>0){return-1}dist>min&&(min=dist,index=i)}return lastMinMSA=min,index}function convexConvex(si,sj,contacts){if(collide(si,sj)){var indexi,mini,indexj,minj;indexi=findMSA(si,sj),0>indexi||(mini=lastMinMSA,indexj=findMSA(sj,si),0>indexj||(minj=lastMinMSA,mini>minj?findContacts(si,sj,si._normals[indexi],mini,contacts):findContacts(sj,si,sj._normals[indexj],minj,contacts)))}}function collisionType(si,sj,contacts){if(si.type!==BodyType.Particle||sj.type!==BodyType.Particle){if(si.type===BodyType.Particle&&sj.type!==BodyType.Particle){switch(sj.type){case ShapeType.Circle:circleParticle(sj,si,contacts);break;case ShapeType.Convex:convexParticle(sj,si,contacts)}}else{if(sj.type===BodyType.Particle&&si.type!==BodyType.Particle){switch(si.type){case ShapeType.Circle:circleParticle(si,sj,contacts);break;case ShapeType.Convex:convexParticle(si,sj,contacts)}}else{if(si.type===ShapeType.Circle){switch(sj.type){case ShapeType.Circle:circleCircle(si,sj,contacts);break;case ShapeType.Convex:convexCircle(sj,si,contacts)}}else{if(si.type===ShapeType.Convex){switch(sj.type){case ShapeType.Circle:convexCircle(si,sj,contacts);break;case ShapeType.Convex:convexConvex(si,sj,contacts)}}}}}}}var lastMinMSA,min=Math.min,sqrt=Math.sqrt,EPSILON=Mathf.EPSILON,BodyType=P2Enums.BodyType,ShapeType=P2Enums.ShapeType,CONTACT_POOL=new ObjectPool(P2Contact);return Class.extend(P2Nearphase),P2Nearphase.CONTACT_POOL=CONTACT_POOL,P2Nearphase.prototype.collisions=function(pairsi,pairsj,contacts){var si,sj,i;for(contacts.length=0,CONTACT_POOL.clearForEach(clearContact),i=pairsi.length;i--;){si=pairsi[i],sj=pairsj[i],collisionType(si,sj,contacts)}},lastMinMSA=0,P2Nearphase}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat32",[],function(){function Mat32(m11,m12,m13,m21,m22,m23){var te=new Float32Array(6);this.elements=te,te[0]=void 0!==m11?m11:1,te[2]=m12||0,te[4]=m13||0,te[1]=m21||0,te[3]=void 0!==m22?m22:1,te[5]=m23||0}var sqrt=Math.sqrt,cos=Math.cos,sin=Math.sin,atan2=Math.atan2;return Mat32.prototype.clone=function(){var te=this.elements;return new Mat32(te[0],te[1],te[2],te[3],te[4],te[5])},Mat32.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],this},Mat32.prototype.set=function(m11,m12,m13,m21,m22,m23){var te=this.elements;return te[0]=m11,te[2]=m12,te[4]=m13,te[1]=m21,te[3]=m22,te[5]=m23,this},Mat32.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[2],a13=ae[4],a21=ae[1],a22=ae[3],a23=ae[5],b11=be[0],b12=be[2],b13=be[4],b21=be[1],b22=be[3],b23=be[5];return ae[0]=a11*b11+a21*b12,ae[2]=a12*b11+a22*b12,ae[1]=a11*b21+a21*b22,ae[3]=a12*b21+a22*b22,ae[4]=a11*b13+a12*b23+a13,ae[5]=a21*b13+a22*b23+a23,this},Mat32.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[2],a13=ae[4],a21=ae[1],a22=ae[3],a23=ae[5],b11=be[0],b12=be[2],b13=be[4],b21=be[1],b22=be[3],b23=be[5];return te[0]=a11*b11+a21*b12,te[2]=a12*b11+a22*b12,te[1]=a11*b21+a21*b22,te[3]=a12*b21+a22*b22,te[4]=a11*b13+a12*b23+a13,te[5]=a21*b13+a22*b23+a23,this},Mat32.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,this},Mat32.prototype.sdiv=function(s){var te=this.elements;return s=0!==s?1/s:1,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,this},Mat32.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=1,te[4]=0,te[5]=0,this},Mat32.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=0,this},Mat32.prototype.determinant=function(){var te=this.elements;return te[0]*te[3]-te[2]*te[1]},Mat32.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[2],m13=te[4],m21=te[1],m22=te[3],m23=te[5],det=m11*m22-m12*m21;return det=0!==det?1/det:0,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,te[4]=(m12*m23-m22*m13)*det,te[5]=(m21*m13-m11*m23)*det,this},Mat32.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[2],m13=me[4],m21=me[1],m22=me[3],m23=me[5],det=m11*m22-m12*m21;return det=0!==det?1/det:0,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,te[4]=(m12*m23-m22*m13)*det,te[5]=(m21*m13-m11*m23)*det,this},Mat32.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[2],te[2]=tmp,this},Mat32.prototype.setTrace=function(x,y){var te=this.elements;return te[0]=x,te[3]=y,this},Mat32.prototype.lookAt=function(eye,target){var te=this.elements,x=target.x-eye.x,y=target.y-eye.y,a=atan2(y,x)-HALF_PI,c=cos(a),s=sin(a);return te[0]=c,te[1]=s,te[2]=-s,te[3]=c,this},Mat32.prototype.compose=function(position,scale,angle){var te=this.elements,sx=scale.x,sy=scale.y,c=cos(angle),s=sin(angle);return te[0]=c*sx,te[1]=s*sx,te[2]=-s*sy,te[3]=c*sy,te[4]=position.x,te[5]=position.y,this},Mat32.prototype.decompose=function(position,scale){var te=this.elements,m11=te[0],m12=te[1],sx=scale.set(m11,m12).length(),sy=scale.set(te[2],te[3]).length();return position.x=te[4],position.y=te[5],scale.x=sx,scale.y=sy,atan2(m12,m11)},Mat32.prototype.setRotation=function(angle){var te=this.elements,c=cos(angle),s=sin(angle);return te[0]=c,te[1]=s,te[2]=-s,te[3]=c,this},Mat32.prototype.getRotation=function(){var te=this.elements;return atan2(te[1],te[0])},Mat32.prototype.setPosition=function(v){var te=this.elements;return te[4]=v.x,te[5]=v.y,this},Mat32.prototype.getPosition=function(v){var te=this.elements;return v.x=te[4],v.y=te[5],v},Mat32.prototype.extractPosition=function(other){var te=this.elements,me=other.elements;return te[4]=me[4],te[5]=me[5],this},Mat32.prototype.extractRotation=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[2],m21=me[1],m22=me[3],x=m11*m11+m21*m21,y=m12*m12+m22*m22,sx=x>0?1/sqrt(x):0,sy=y>0?1/sqrt(y):0;return te[0]=m11*sx,te[1]=m21*sx,te[2]=m12*sy,te[3]=m22*sy,this},Mat32.prototype.translate=function(v){var te=this.elements,x=v.x,y=v.y;return te[4]=te[0]*x+te[2]*y+te[4],te[5]=te[1]*x+te[3]*y+te[5],this},Mat32.prototype.rotate=function(angle){var te=this.elements,m11=te[0],m12=te[2],m21=te[1],m22=te[3],s=sin(angle),c=sin(angle);return te[0]=m11*c+m12*s,te[1]=m11*-s+m12*c,te[2]=m21*c+m22*s,te[3]=m21*-s+m22*c,this},Mat32.prototype.scale=function(v){var te=this.elements,x=v.x,y=v.y;return te[0]*=x,te[1]*=x,te[4]*=x,te[2]*=y,te[3]*=y,te[5]*=y,this},Mat32.prototype.orthographic=function(left,right,top,bottom){var te=this.elements,w=right-left,h=top-bottom,x=(right+left)/w,y=(top+bottom)/h;return te[0]=2/w,te[1]=0,te[2]=0,te[3]=2/h,te[4]=-x,te[5]=-y,this},Mat32.prototype.fromMat3=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[3],te[3]=me[4],te[4]=0,te[5]=0,this},Mat32.prototype.fromMat4=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[4],te[3]=me[5],te[4]=me[11],te[5]=me[12],this},Mat32.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],this},Mat32.prototype.toJSON=function(json){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);
return je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],je[4]=te[4],je[5]=te[5],json},Mat32.prototype.toString=function(){var te=this.elements;return"Mat32[ "+te[0]+", "+te[2]+", "+te[4]+"]\n     [ "+te[1]+", "+te[3]+", "+te[5]+"]"},Mat32}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/aabb2",["odin/math/mathf","odin/math/vec2"],function(Mathf,Vec2){function AABB2(min,max){this.min=min||new Vec2(1/0,1/0),this.max=max||new Vec2(-1/0,-1/0)}return AABB2.prototype.clone=function(){return new AABB2(this.min.clone(),this.max.clone())},AABB2.prototype.copy=function(other){return this.min.copy(other.min),this.max.copy(other.max),this},AABB2.prototype.set=function(min,max){return this.min.copy(min),this.max.copy(max),this},AABB2.prototype.expandPoint=function(v){return this.min.min(v),this.max.max(v),this},AABB2.prototype.expandVec=function(v){return this.min.sub(v),this.max.add(v),this},AABB2.prototype.expandScalar=function(s){return this.min.ssub(s),this.max.sadd(s),this},AABB2.prototype.union=function(other){return this.min.min(other.min),this.max.max(other.max),this},AABB2.prototype.clear=function(){return this.min.set(1/0,1/0),this.max.set(-1/0,-1/0),this},AABB2.prototype.contains=function(point){var min=this.min,max=this.max,px=point.x,py=point.y;return!(px<min.x||px>max.x||py<min.y||py>max.y)},AABB2.prototype.intersects=function(other){var aMin=this.min,aMax=this.max,bMin=other.min,bMax=other.max;return!(bMax.x<aMin.x||bMin.x>aMax.x||bMax.y<aMin.y||bMin.y>aMax.y)},AABB2.prototype.fromPoints=function(points){for(var v,x,y,i=points.length,minx=1/0,miny=1/0,maxx=-1/0,maxy=-1/0,min=this.min,max=this.max;i--;){v=points[i],x=v.x,y=v.y,minx=minx>x?x:minx,miny=miny>y?y:miny,maxx=x>maxx?x:maxx,maxy=y>maxy?y:maxy}return min.x=minx,min.y=miny,max.x=maxx,max.y=maxy,this},AABB2.prototype.fromCenterSize=function(center,size){var min=this.min,max=this.max,x=center.x,y=center.y,hx=.5*size.x,hy=.5*size.y;return min.x=x-hx,min.y=y-hy,max.x=x+hx,max.y=y+hy,this},AABB2.prototype.fromJSON=function(json){return this.min.fromJSON(json.min),this.max.fromJSON(json.max),this},AABB2.prototype.toJSON=function(json){return json||(json={}),json.min=this.min.toJSON(json.min),json.max=this.max.toJSON(json.max),json},AABB2.prototype.toString=function(){var min=this.min,max=this.max;return"AABB2( min: "+min+", max: "+max+" )"},AABB2}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2shape",["odin/base/class","odin/math/vec2","odin/math/mat32","odin/math/aabb2"],function(Class,Vec2,Mat32,AABB2){function P2Shape(opts){opts||(opts={}),Class.call(this),this.type=-1,this.body=void 0,this.density=void 0!=opts.density?opts.density:1,this.localPosition=void 0!=opts.position?opts.position:new Vec2,this.localRotation=void 0!=opts.rotation?opts.rotation:0,this.position=new Vec2,this.rotation=0,this.matrix=new Mat32,this.matrixWorld=new Mat32,this.friction=void 0!=opts.friction?opts.friction:.5,this.elasticity=void 0!=opts.elasticity?opts.elasticity:.25,this.isTrigger=void 0!=opts.isTrigger?!!opts.isTrigger:!1,this.filterMask=void 0!=opts.filterMask?opts.filterMask:0,this.filterGroup=void 0!=opts.filterGroup?opts.filterGroup:0,this.aabb=new AABB2}return Class.extend(P2Shape),P2Shape.prototype.copy=function(other){return this.density=other.density,this.localPosition.copy(other.localPosition),this.localRotation=other.localRotation,this.friction=other.friction,this.elasticity=other.elasticity,this.isTrigger=other.isTrigger,this.filterMask=other.filterMask,this.filterGroup=other.filterGroup,this},P2Shape.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.density=this.density,json.localPosition=this.localPosition.toJSON(json.localPosition),json.localRotation=this.localRotation,json.friction=this.friction,json.elasticity=this.elasticity,json.isTrigger=this.isTrigger,json.filterMask=this.filterMask,json.filterGroup=this.filterGroup,json},P2Shape.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.density=json.density,this.localPosition.fromJSON(json.localPosition),this.localRotation=json.localRotation,this.friction=json.friction,this.elasticity=json.elasticity,this.isTrigger=json.isTrigger,this.filterMask=json.filterMask,this.filterGroup=json.filterGroup,this},P2Shape}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2circle",["odin/base/class","odin/phys2d/p2enums","odin/phys2d/objects/p2shape"],function(Class,P2Enums,P2Shape){function P2Circle(opts){opts||(opts={}),P2Shape.call(this,opts),this.type=ShapeType.Circle,this.radius=void 0!=opts.radius?abs(opts.radius):.5}var ShapeType=P2Enums.ShapeType,abs=Math.abs,PI=Math.PI;return P2Shape.extend(P2Circle),P2Circle.prototype.copy=function(other){return P2Shape.prototype.copy.call(this,other),this.radius=other.radius,this},P2Circle.prototype.pointQuery=function(p){var x=this.position,dx=x.x-p.x,dy=x.y-p.y,r=this.radius;return r*r>dx*dx+dy*dy},P2Circle.prototype.centroid=function(v){var localPos=this.localPosition;return v.x=localPos.x,v.y=localPos.y,v},P2Circle.prototype.area=function(){var r=this.radius;return PI*r*r},P2Circle.prototype.inertia=function(mass){var r=this.radius,localPos=this.localPosition,lx=localPos.x,ly=localPos.y;return mass*(r*r*.5+(lx*lx+ly*ly))},P2Circle.prototype.update=function(matrix){var x,y,localMatrix=this.matrix,matrixWorld=this.matrixWorld,localPos=this.localPosition,pos=this.position,r=this.radius,aabb=this.aabb,min=aabb.min,max=aabb.max;localMatrix.setRotation(this.localRotation),localMatrix.setPosition(localPos),matrixWorld.mmul(matrix,localMatrix),pos.x=localPos.x,pos.y=localPos.y,pos.transformMat32(matrix),x=pos.x,y=pos.y,min.x=x-r,min.y=y-r,max.x=x+r,max.y=y+r},P2Circle.prototype.toJSON=function(json){return json=P2Shape.prototype.toJSON.call(this,json),json.radius=this.radius,json},P2Circle.prototype.fromJSON=function(json){return P2Shape.prototype.fromJSON.call(this,json),this.radius=json.radius,this},P2Circle}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/config",[],function(){function Config(){this.debug=!1,this.forceCanvas=!1,this.host="127.0.0.1",this.port=3e3,this.FAKE_LAG=0,this.SCENE_SYNC_RATE=.5,this.MAX_SCENE_STATES=5,this.MIN_DELTA=1e-6,this.MAX_DELTA=1}return Config.prototype.fromJSON=function(json){for(var key in json){void 0!=this[key]&&(this[key]=json[key])}return this},new Config}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/log",["odin/core/game/config"],function(Config){function Log(){}var has=Object.prototype.hasOwnProperty;return Log.prototype.debug=Log.prototype.info=Log.prototype.log=function(){Config.debug&&console.log.apply(console,arguments)},Log.prototype.warn=function(){(Config.debug||Config.warn)&&console.warn.apply(console,arguments)},Log.prototype.error=function(){(Config.debug||Config.error)&&console.error.apply(console,arguments)},Log.prototype.object=function(obj){if(!Config.debug){return""}var key,value,type,str="",values=arguments[1]||(arguments[1]=[]);for(key in obj){has.call(obj,key)&&(value=obj[key],~values.indexOf(value)||(type=typeof value,"object"===type?(values.push(value),str+="	"+key+" = "+this.object(value,values)):"function"!==type?str+="	"+key+" = "+value+"\n":values.push(value)))}return str},new Log}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2convex",["odin/math/vec2","odin/core/game/log","odin/phys2d/p2enums","odin/phys2d/objects/p2shape"],function(Vec2,Log,P2Enums,P2Shape){function P2Convex(opts){opts||(opts={}),P2Shape.call(this,opts),this.type=ShapeType.Convex,this.vertices=void 0!=opts.vertices?opts.vertices:[new Vec2(.5,.5),new Vec2(-.5,.5),new Vec2(-.5,-.5),new Vec2(.5,-.5)],P2Convex.validateVertices(this.vertices)||(log.warn("P2Convex.constructor: passed vertices are invalid, creating convex hull from vertices with gift wrapping algorithm"),this.vertices=P2Convex.createConvexHull(this.vertices)),this.normals=[],this._vertices=[],this._normals=[];var v1,v2,i,vertices=this.vertices,wverts=this._vertices,normals=this.normals,wnorms=this._normals;for(i=vertices.length;i--;){v1=vertices[i],v2=vertices[i+1]||vertices[0],normals[i]=new Vec2(v2.y-v1.y,-(v2.x-v1.x)).normalize(),wverts[i]=new Vec2(v1),wnorms[i]=new Vec2(normals[i])}}var ShapeType=P2Enums.ShapeType;return P2Shape.extend(P2Convex),P2Convex.prototype.copy=function(other){P2Shape.prototype.copy.call(this,other);var i,vertices=other.vertices,normals=other.normals;for(this.vertices.length=this.normals.length=this._vertices.length=this._normals.length=0,i=vertices.length;i--;){this.vertices[i]=vertices[i].clone()}for(i=normals.length;i--;){this.normals[i]=normals[i].clone()}return this},P2Convex.prototype.pointQuery=function(p){if(!this.aabb.contains(p)){return!1}var n,nx,ny,v,vx,vy,i,vertices=this._vertices,normals=this._normals,px=p.x,py=p.y;for(i=vertices.length;i--;){if(n=normals[i],nx=n.x,ny=n.y,v=vertices[i],vx=v.x,vy=v.y,nx*px+ny*py-(nx*vx+ny*vy)>0){return!1}}return!0},P2Convex.prototype.centroid=function(){var v1=new Vec2,v2=new Vec2,vsum=new Vec2;return function(v){var v1x,v1y,v2x,v2y,cross,i,localPosition=this.localPosition,vertices=this.vertices,len=vertices.length,area=0;for(vsum.x=vsum.y=0,i=len;i--;){v1.vadd(localPosition,vertices[i]),v2.vadd(localPosition,vertices[(i+1)%len]),v1x=v1.x,v1y=v1.y,v2x=v2.x,v2y=v2.y,cross=v1x*v2y-v1y*v2x,area+=cross,vsum.x+=(v1x+v2x)*cross,vsum.y+=(v1y+v2y)*cross}return v.copy(vsum).smul(1/(3*area))}}(),P2Convex.prototype.area=function(){var v1,v2,i,vertices=this.vertices,len=vertices.length,area=0;for(i=len;i--;){v1=vertices[i],v2=vertices[(i+1)%len],area+=v1.x*v2.y-v1.y*v2.x}return.5*area},P2Convex.prototype.inertia=function(){var v1=new Vec2,v2=new Vec2;return function(mass){var v1x,v1y,v2x,v2y,i,localPosition=this.localPosition,vertices=this.vertices,len=vertices.length,a=0,b=0,sum1=0,sum2=0;for(i=len;i--;){v1.vadd(localPosition,vertices[i]),v2.vadd(localPosition,vertices[(i+1)%len]),v1x=v1.x,v1y=v1.y,v2x=v2.x,v2y=v2.y,a=v2x*v1y-v2y*v1x,b=v1x*v1x+v1y*v1y+(v1x*v2x+v1y*v2y)+(v2x*v2x+v2y*v2y),sum1+=a*b,sum2+=a}return mass*sum1/(6*sum2)}}(),P2Convex.prototype.update=function(matrix){var wnorm,wvert,x,y,i,localMatrix=this.matrix,matrixWorld=this.matrixWorld,localPos=this.localPosition,vertices=this.vertices,normals=this.normals,pos=this.position,aabb=this.aabb,min=aabb.min,max=aabb.max,minx=1/0,miny=1/0,maxx=-1/0,maxy=-1/0,wnorms=this._normals,wverts=this._vertices;for(localMatrix.setRotation(this.localRotation),localMatrix.setPosition(localPos),matrixWorld.mmul(matrix,localMatrix),pos.x=localPos.x,pos.y=localPos.y,pos.transformMat32(matrix),i=vertices.length;i--;){wvert=wverts[i]||(wverts[i]=new Vec2),wnorm=wnorms[i]||(wnorms[i]=new Vec2),wnorm.copy(normals[i]).transformMat2(matrixWorld),wvert.copy(vertices[i]).transformMat32(matrixWorld),x=wvert.x,y=wvert.y,minx=minx>x?x:minx,miny=miny>y?y:miny,maxx=x>maxx?x:maxx,maxy=y>maxy?y:maxy}min.x=minx,min.y=miny,max.x=maxx,max.y=maxy},P2Convex.prototype.toJSON=function(json){json=P2Shape.prototype.toJSON.call(this,json);var i,vertices=this.vertices,normals=this.normals,jsonVertices=json.vertices||(json.vertices=[]),jsonNormals=json.normals||(json.normals=[]);for(i=vertices.length;i--;){jsonVertices[i]=vertices[i].toJSON(jsonVertices[i])}for(i=normals.length;i--;){jsonNormals[i]=normals[i].toJSON(jsonNormals[i])}return json},P2Convex.prototype.fromJSON=function(json){P2Shape.prototype.fromJSON.call(this,json);var i,vertices=this.vertices,normals=this.normals,jsonVertices=json.vertices,jsonNormals=json.normals;for(vertices.length=normals.length=this._vertices.length=this._normals.length=0,i=jsonVertices.length;i--;){vertices[i]=(new Vec2).fromJSON(jsonVertices[i])}for(i=jsonNormals.length;i--;){normals[i]=(new Vec2).fromJSON(jsonNormals[i])}return this},P2Convex.validateVertices=P2Convex.prototype.validateVertices=function(vertices){var a,b,bx,by,c,abx,aby,bcx,bcy,i,len=vertices.length;for(i=0;len>i;i++){if(a=vertices[i],b=vertices[(i+1)%len],bx=b.x,by=b.y,c=vertices[(i+2)%len],abx=bx-a.x,aby=by-a.y,bcx=c.x-bx,bcy=c.y-by,bcx*aby-bcy*abx>0){return!1}}return!0},P2Convex.createConvexHull=P2Convex.prototype.createConvexHull=function(){var hull=[],r=new Vec2;return function(points){var v,vx,vy,ih,ie,c,i,rmi=0,rmx=-1/0,n=points.length,m=0,newPoints=[],failed=!1;for(i=n;i--;){v=points[i],vx=v.x,vy=v.y,(vx>rmx||vx==rmx&&vy<points[rmi].y)&&(rmi=i,rmx=vx)}for(hull.length=0,ih=rmi;;){for(hull[m]=ih,ie=0,i=1;n>i;i++){ie!==ih?(r.vsub(points[ie],points[hull[m]]),v.vsub(points[i],points[hull[m]]),c=v.cross(r),0>c&&(ie=i),0===c&&v.lenSq()>r.lenSq()&&(ie=i)):ie=i}if(m++,ih=ie,m>n){failed=!0;break}if(ie===rmi){break}}if(failed){return Log.warn("P2Convex.constructor: gift wrapping algorithm failed"),[new Vec2(.5,.5),new Vec2(-.5,.5),new Vec2(-.5,-.5),new Vec2(.5,-.5)]}for(i=m;i--;){newPoints.push(points[hull[i]])}return P2Convex.validateVertices(newPoints)?newPoints:(Log.warn("P2Convex.constructor: gift wrapping algorithm failed"),[new Vec2(.5,.5),new Vec2(-.5,.5),new Vec2(-.5,-.5),new Vec2(.5,-.5)])}}(),P2Convex}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2particle",["odin/base/class","odin/math/vec2","odin/phys2d/p2enums"],function(Class,Vec2,P2Enums){function P2Particle(opts){opts||(opts={}),Class.call(this),this.type=BodyType.Particle,this._index=-1,this.space=void 0,this.position=void 0!=opts.position?opts.position:new Vec2,this.velocity=void 0!=opts.velocity?opts.velocity:new Vec2,this.force=new Vec2,this.linearDamping=void 0!=opts.linearDamping?opts.linearDamping:0,this.mass=0,this.invMass=0,this.motionState=void 0!=opts.motionState?opts.motionState:MotionState.Static,this.allowSleep=void 0!==opts.allowSleep?!!opts.allowSleep:!0,this.sleepState=SleepState.Awake,this._sleepTime=0,this._lastSleepyTime=0,this.vlambda=new Vec2}var pow=Math.pow,BodyType=P2Enums.BodyType,MotionState=P2Enums.MotionState,SleepState=P2Enums.SleepState;return Class.extend(P2Particle,Class),P2Particle.LINEAR_MAX_VELOCITY=.05,P2Particle.SLEEP_MAX_TIME=1,P2Particle.prototype.copy=function(other){return this.motionState=other.motionState,this.position.copy(other.position),this.velocity.copy(other.velocity),this.force.copy(other.force),this.linearDamping=other.linearDamping,this.mass=other.mass,this.invMass=other.invMass,this.allowSleep=other.allowSleep,this.sleepState=other.sleepState,this},P2Particle.prototype.init=function(){},P2Particle.prototype.update=function(dt){if(this.motionState!==MotionState.Static){var force=this.force,invMass=this.invMass,pos=this.position,vel=this.velocity,linearDamping=pow(1-this.linearDamping,dt);vel.x+=force.x*invMass*dt,vel.y+=force.y*invMass*dt,force.x=force.y=0,vel.x*=linearDamping,vel.y*=linearDamping,this.sleepState!==SleepState.Sleeping&&(pos.x+=vel.x*dt,pos.y+=vel.y*dt)}},P2Particle.prototype.setMotionState=function(motionState){this.motionState!==motionState&&(this.motionState=motionState,this.velocity.set(0,0),this.force.set(0,0),this.wake())},P2Particle.prototype.setMass=function(mass){this.mass=mass,this.invMass=mass>0?1/mass:0},P2Particle.prototype.isAwake=function(){return this.sleepState===SleepState.Awake},P2Particle.prototype.isSleepy=function(){return this.sleepState===SleepState.Sleepy},P2Particle.prototype.isSleeping=function(){return this.sleepState===SleepState.Sleeping},P2Particle.prototype.isStatic=function(){return this.motionState===MotionState.Static},P2Particle.prototype.isDynamic=function(){return this.motionState===MotionState.Dynamic},P2Particle.prototype.isKinematic=function(){return this.motionState===MotionState.Kinematic},P2Particle.prototype.wake=function(){this.sleepState===SleepState.Sleeping&&this.emit("wake"),this.sleepState=SleepState.Awake},P2Particle.prototype.sleep=function(){this.sleepState!==SleepState.Sleeping&&this.emit("sleep"),this.sleepState=SleepState.Sleeping},P2Particle.prototype.sleepTick=function(time){if(this.allowSleep){var sleepState=this.sleepState,velSq=this.velocity.lengthSq(),LINEAR_MAX_VELOCITY=P2Particle.LINEAR_MAX_VELOCITY*P2Particle.LINEAR_MAX_VELOCITY;sleepState===SleepState.Awake&&LINEAR_MAX_VELOCITY>velSq?(this.sleepState=SleepState.Sleepy,this._sleepTime=time):sleepState===SleepState.Sleepy&&velSq>LINEAR_MAX_VELOCITY?this.wake():sleepState===SleepState.Sleepy&&time-this._lastSleepyTime>P2Particle.SLEEP_MAX_TIME&&this.sleep()}},P2Particle.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.motionState=this.motionState,json.position=this.position.toJSON(json.position),json.velocity=this.velocity.toJSON(json.velocity),json.force=this.force.toJSON(json.force),json.linearDamping=this.linearDamping,json.mass=this.mass,json.invMass=this.invMass,json.allowSleep=this.allowSleep,json.sleepState=this.sleepState,json},P2Particle.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.motionState=json.motionState,this.position.fromJSON(json.position),this.velocity.fromJSON(json.velocity),this.force.fromJSON(json.force),this.linearDamping=json.linearDamping,this.mass=json.mass,this.invMass=json.invMass,this.allowSleep=json.allowSleep,this.sleepState=json.sleepState,this},P2Particle}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2rect",["odin/math/vec2","odin/phys2d/objects/p2convex"],function(Vec2,P2Convex){function P2Rect(opts){opts||(opts={});var extents=opts.extents||new Vec2(.5,.5),x=extents.x,y=extents.y;opts.vertices=[new Vec2(x,y),new Vec2(-x,y),new Vec2(-x,-y),new Vec2(x,-y)],P2Convex.call(this,opts),this.extents=extents}return P2Convex.extend(P2Rect),P2Rect.prototype.toJSON=function(json){return json=P2Convex.prototype.toJSON.call(this,json),json.extents=this.extents.toJSON(json.extents),json},P2Rect.prototype.fromJSON=function(json){return P2Convex.prototype.fromJSON.call(this,json),this.extents.fromJSON(json.extents),this},P2Rect}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2rigidbody",["odin/base/class","odin/math/aabb2","odin/math/vec2","odin/math/mat32","odin/core/game/log","odin/phys2d/p2enums","odin/phys2d/objects/p2particle"],function(Class,AABB2,Vec2,Mat32,Log,P2Enums,P2Particle){function P2Rigidbody(opts){opts||(opts={}),P2Particle.call(this,opts),this.type=BodyType.RigidBody,this.rotation=void 0!=opts.rotation?opts.rotation:0,this.angularVelocity=void 0!=opts.angularVelocity?opts.angularVelocity:0,this.torque=0,this.angularDamping="number"==typeof opts.angularDamping?opts.angularDamping:0,this.matrix=new Mat32,this.inertia=0,this.invInertia=0,this.shapes=[],this._shapeHash={},this.aabb=new AABB2,this.wlambda=0,opts.shape&&this.addShape(opts.shape),opts.shapes&&this.add.apply(this,opts.shapes)}var totalCentroid,centroid,pow=Math.pow,BodyType=P2Enums.BodyType,MotionState=P2Enums.MotionState,SleepState=P2Enums.SleepState;return P2Particle.extend(P2Rigidbody),P2Rigidbody.prototype.copy=function(other){P2Particle.prototype.copy.call(this,other);var i,shapes=other.shapes;for(this.rotation=other.rotation,this.angularVelocity=other.angularVelocity,this.torque=other.torque,this.angularDamping=other.angularDamping,i=shapes.length;i--;){this.addShape(shapes[i].clone())}return this},P2Rigidbody.prototype.init=function(){var shape,i,shapes=this.shapes,matrix=this.matrix,aabb=this.aabb;for(matrix.setRotation(this.rotation),matrix.setPosition(this.position),aabb.clear(),i=shapes.length;i--;){shape=shapes[i],shape.update(matrix),aabb.union(shape.aabb)}this.resetMassData()},P2Rigidbody.prototype.update=function(dt){if(this.motionState!==MotionState.Static){var shape,i,shapes=this.shapes,force=this.force,invMass=this.invMass,pos=this.position,vel=this.velocity,linearDamping=pow(1-this.linearDamping,dt),matrix=this.matrix,aabb=this.aabb;if(vel.x+=force.x*invMass*dt,vel.y+=force.y*invMass*dt,this.angularVelocity+=this.torque*this.invInertia*dt,force.x=force.y=this.torque=0,vel.x*=linearDamping,vel.y*=linearDamping,this.angularVelocity*=pow(1-this.angularDamping,dt),this.sleepState!==SleepState.Sleeping){for(pos.x+=vel.x*dt,pos.y+=vel.y*dt,this.rotation+=this.angularVelocity*dt,matrix.setRotation(this.rotation),matrix.setPosition(pos),aabb.clear(),i=shapes.length;i--;){shape=shapes[i],shape.update(matrix),aabb.union(shape.aabb)}}}},P2Rigidbody.prototype.applyForce=function(force,worldPoint){if(this.motionState!==MotionState.Static){this.sleepState===SleepState.Sleeping&&this.wake();var px,py,pos=this.position,f=this.force,fx=force.x,fy=force.y;worldPoint=worldPoint||pos,px=worldPoint.x-pos.x,py=worldPoint.y-pos.y,f.x+=fx,f.y+=fy,this.torque+=px*fy-py*fx}},P2Rigidbody.prototype.applyTorque=function(torque){this.motionState!==MotionState.Static&&(this.sleepState===SleepState.Sleeping&&this.wake(),this.torque+=torque)},P2Rigidbody.prototype.applyImpulse=function(impulse,worldPoint){if(this.motionState!==MotionState.Static){this.sleepState===SleepState.Sleeping&&this.wake();var px,py,pos=this.position,invMass=this.invMass,velocity=this.velocity,ix=impulse.x,iy=impulse.y;worldPoint=worldPoint||pos,px=worldPoint.x-pos.x,py=worldPoint.y-pos.y,velocity.x+=ix*invMass,velocity.y+=iy*invMass,this.angularVelocity+=(px*iy-py*ix)*this.invInertia}},P2Rigidbody.prototype.applyVelocity=function(velocity){if(this.motionState!==MotionState.Static){this.sleepState===SleepState.Sleeping&&this.wake();var vel=this.velocity;vel.x+=velocity.x,vel.y+=velocity.y}},P2Rigidbody.prototype.applyAngularVelocity=function(angularVelocity){this.motionState!==MotionState.Static&&(this.sleepState===SleepState.Sleeping&&this.wake(),this.angularVelocity+=angularVelocity)},totalCentroid=new Vec2,centroid=new Vec2,P2Rigidbody.prototype.resetMassData=function(){var shape,mass,inertia,i,shapes=this.shapes,totalMass=0,totalInertia=0;if(this.motionState===MotionState.Dynamic){for(totalCentroid.x=totalCentroid.y=0,i=shapes.length;i--;){shape=shapes[i],shape.centroid(centroid),mass=shape.area()*shape.density,inertia=shape.inertia(mass),totalCentroid.add(centroid.smul(mass)),totalMass+=mass,totalInertia+=inertia}centroid.copy(totalCentroid.sdiv(totalMass)),this.setMass(totalMass),this.setInertia(totalInertia-totalMass*centroid.lengthSq())}},P2Rigidbody.prototype.setMotionState=function(motionState){this.motionState!==motionState&&(this.motionState=motionState,this.velocity.set(0,0),this.force.set(0,0),this.angularVelocity=this.torque=0,this.wake())},P2Rigidbody.prototype.setInertia=function(inertia){this.inertia=inertia,this.invInertia=inertia>0?1/inertia:0},P2Rigidbody.prototype.addShape=function(shape){var shapes=this.shapes,index=shapes.indexOf(shape);return-1===index?(shape.body=this,shapes.push(shape),this._shapeHash[shape._id]=shape,this.space&&(shape.update(this.matrix),this.resetMassData())):Log.error("P2Rigidbody.addShape: Shape already attached to Body"),this},P2Rigidbody.prototype.add=function(){for(var i=arguments.length;i--;){this.addShape(arguments[i])}return this},P2Rigidbody.prototype.removeShape=function(shape){var shapes=this.shapes,index=shapes.indexOf(shape);return-1!==index?(shape.body=void 0,shapes.splice(index,1),this._shapeHash[shape._id]=void 0,this.space&&this.resetMassData()):Log.error("P2Rigidbody.removeShape: Shape not attached to Body"),this},P2Rigidbody.prototype.remove=function(){for(var i=arguments.length;i--;){this.removeShape(arguments[i])}return this},P2Rigidbody.prototype.toJSON=function(json){json=P2Particle.prototype.toJSON.call(this,json);var i,shapes=this.shapes,jsonShapes=json.shapes||(json.shapes=[]);for(json.rotation=this.rotation,json.angularVelocity=this.angularVelocity,json.torque=this.torque,json.angularDamping=this.angularDamping,i=shapes.length;i--;){jsonShapes[i]=shapes[i].toJSON(jsonShapes[i])}return json},P2Rigidbody.prototype.fromJSON=function(json){P2Particle.prototype.fromJSON.call(this,json);var i,jsonShapes=json.shapes||(json.shapes=[]);for(this.rotation=json.rotation,this.angularVelocity=json.angularVelocity,this.torque=json.torque,this.angularDamping=json.angularDamping,i=jsonShapes.length;i--;){this.addShape(Class.fromJSON(jsonShapes[i]))}return this},P2Rigidbody}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/p2solver",["odin/base/class","odin/math/mathf"],function(Class,Mathf){function P2Solver(opts){opts||(opts={}),Class.call(this),this.iterations="number"==typeof opts.iterations?opts.iterations:10,this.tolerance="number"==typeof opts.tolerance?opts.tolerance:1e-4}var clamp=Mathf.clamp;return Class.extend(P2Solver,Class),P2Solver.prototype.solve=function(h,equations){var eq,bi,bj,vlambdai,vlambdaj,vi,vj,GWlambda,lambda,deltaLambda,deltaLambdaTotal,i,j,num=equations.length,iterations=this.iterations,iter=0,toleranceSq=this.tolerance*this.tolerance;if(num>-1){for(i=num;i--;){eq=equations[i],eq.updateConstants(h),eq.init(h)}for(i=iterations;i--;){for(iter++,deltaLambdaTotal=0,j=num;j--;){eq=equations[j],GWlambda=eq.calculateGWlambda(),lambda=eq.lambda,deltaLambda=eq.invC*(eq.B-GWlambda-eq.eps*lambda),eq.lambda=clamp(lambda+deltaLambda,eq.minForce,eq.maxForce),deltaLambda=eq.lambda-lambda,eq.addToLambda(deltaLambda),deltaLambdaTotal+=deltaLambda}if(toleranceSq>deltaLambdaTotal*deltaLambdaTotal){break}}for(i=num;i--;){eq=equations[i],bi=eq.bi,vi=bi.velocity,vlambdai=bi.vlambda,bj=eq.bj,vj=bj.velocity,vlambdaj=bj.vlambda,vi.x+=vlambdai.x,vi.y+=vlambdai.y,vj.x+=vlambdaj.x,vj.y+=vlambdaj.y,vlambdai.x=vlambdai.y=vlambdaj.x=vlambdaj.y=0,void 0!==bi.wlambda&&(bi.angularVelocity+=bi.wlambda,bi.wlambda=0),void 0!==bj.wlambda&&(bj.angularVelocity+=bj.wlambda,bj.wlambda=0)}}return iter},P2Solver}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/time",[],function(){function now(){return.001*performance.now()}function Time(){this.start=START,this.sinceStart=0,this.time=0,this.fps=60,this.delta=delta,this.frameCount=0,defineProperty(this,"scale",{get:function(){return scale},set:function(value){scale=value,fixedDelta=globalFixed*value}}),defineProperty(this,"fixedDelta",{get:function(){return fixedDelta},set:function(value){globalFixed=value,fixedDelta=globalFixed*scale}})}var w="undefined"!=typeof window?window:{},performance="undefined"!=typeof w.performance?w.performance:{},defineProperty=Object.defineProperty,START_MS=Date.now(),START=.001*START_MS,delta=1/60,fixedDelta=delta,globalFixed=delta,scale=1;return performance.now=performance.now||performance.webkitNow||performance.mozNow||performance.msNow||performance.oNow||function(){return Date.now()-START_MS},Time.prototype.now=now,Time.prototype.stamp=function(){return.001*Date.now()},new Time}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/constraints/p2friction",["odin/base/class","odin/math/mathf","odin/math/vec2","odin/phys2d/constraints/p2equation"],function(Class,Mathf,Vec2,P2Equation){function P2Friction(){P2Equation.call(this),this.p=new Vec2,this.t=new Vec2,this.ri=new Vec2,this.rj=new Vec2,this.rixt=0,this.rjxt=0}return Class.extend(P2Friction,P2Equation),P2Friction.prototype.init=function(h){var bi=this.bi,bj=this.bj,p=this.p,px=p.x,py=p.y,t=this.t,tx=t.x,ty=t.y,xi=bi.position,xj=bj.position,ri=this.ri,rix=px-xi.x,riy=py-xi.y,rj=this.rj,rjx=px-xj.x,rjy=py-xj.y,rixt=rix*ty-riy*tx,rjxt=rjx*ty-rjy*tx;ri.x=rix,ri.y=riy,rj.x=rjx,rj.y=rjy,this.rixt=rixt,this.rjxt=rjxt,this.lambda=0,this.calculateB(h),this.calculateC()},P2Friction.prototype.calculateB=function(h){var bi=this.bi,bj=this.bj,t=this.t,tx=t.x,ty=t.y,vi=bi.velocity,wi=bi.angularVelocity||0,fi=bi.force,ti=bi.torque||0,invMi=bi.invMass,invIi=bi.invInertia||0,vj=bj.velocity,wj=bj.angularVelocity||0,fj=bj.force,tj=bj.torque||0,invMj=bj.invMass,invIj=bj.invInertia||0,ri=this.ri,rix=ri.x,riy=ri.y,rj=this.rj,rjx=rj.x,rjy=rj.y,Gq=0,GWx=vj.x+-wj*rjy-vi.x- -wi*riy,GWy=vj.y+wj*rjx-vi.y-wi*rix,GW=GWx*tx+GWy*ty,GiMfx=fj.x*invMj+-tj*invIj*rjy-fi.x*invMi- -ti*invIi*riy,GiMfy=fj.y*invMj+tj*invIj*rjx-fi.y*invMi-ti*invIi*rix,GiMf=GiMfx*tx+GiMfy*ty;this.B=-this.a*Gq-this.b*GW-h*GiMf},P2Friction.prototype.calculateC=function(){var bi=this.bi,bj=this.bj,rixt=this.rixt,rjxt=this.rjxt,invIi=bi.invInertia||0,invIj=bj.invInertia||0,C=bi.invMass+bj.invMass+this.eps+invIi*rixt*rixt+invIj*rjxt*rjxt;this.invC=0===C?0:1/C},P2Friction.prototype.calculateGWlambda=function(){var bi=this.bi,bj=this.bj,t=this.t,vlambdai=bi.vlambda,wlambdai=bi.wlambda||0,vlambdaj=bj.vlambda,wlambdaj=bj.wlambda||0,ulambdax=vlambdaj.x-vlambdai.x,ulambday=vlambdaj.y-vlambdai.y,GWlambda=ulambdax*t.x+ulambday*t.y;return void 0!==wlambdai&&(GWlambda-=wlambdai*this.rixt),void 0!==wlambdaj&&(GWlambda+=wlambdaj*this.rjxt),GWlambda},P2Friction.prototype.addToLambda=function(deltaLambda){var bi=this.bi,bj=this.bj,t=this.t,tx=t.x,ty=t.y,invMi=bi.invMass,vlambdai=bi.vlambda,invMj=bj.invMass,vlambdaj=bj.vlambda;vlambdai.x-=deltaLambda*invMi*tx,vlambdai.y-=deltaLambda*invMi*ty,vlambdaj.x+=deltaLambda*invMj*tx,vlambdaj.y+=deltaLambda*invMj*ty,void 0!==bi.wlambda&&(bi.wlambda-=deltaLambda*bi.invInertia*this.rixt),void 0!==bj.wlambda&&(bj.wlambda+=deltaLambda*bj.invInertia*this.rjxt)},P2Friction}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/p2space",["odin/base/class","odin/base/time","odin/base/object_pool","odin/math/vec2","odin/phys2d/p2enums","odin/phys2d/p2solver","odin/phys2d/collision/p2broadphase","odin/phys2d/collision/p2nearphase","odin/phys2d/constraints/p2friction","odin/core/game/log"],function(Class,Time,ObjectPool,Vec2,P2Enums,P2Solver,P2Broadphase,P2Nearphase,P2Friction,Log){function P2Space(opts){opts||(opts={}),Class.call(this,opts),this.useGravity=void 0!=opts.useGravity?!!opts.useGravity:!0,this.gravity=void 0!=opts.gravity?opts.gravity:new Vec2(0,-9.801),this.time=0,this.broadphase=new P2Broadphase,this.nearphase=new P2Nearphase,this.solver=new P2Solver,this.bodies=[],this._bodyHash={},this._pairsi=[],this._pairsj=[],this.contacts=[],this.frictions=[],this._collisionMatrix=[],this._collisionMatrixPrevious=[],this.stats={step:0,solve:0,integrate:0,nearphase:0,broadphase:0}}var now=Time.now,MotionState=(Math.pow,P2Enums.MotionState),FRICTION_POOL=new ObjectPool(P2Friction);return Class.extend(P2Space),P2Space.FRICTION_POOL=FRICTION_POOL,P2Space.prototype.collisionMatrixGet=function(i,j,current){var tmp=j;return j>i&&(j=i,i=tmp),i=(i*(i+1)>>1)+j-1,void 0===current||current?this._collisionMatrix[i]:this._collisionMatrixPrevious[i]},P2Space.prototype.collisionMatrixSet=function(i,j,value,current){var tmp=j;j>i&&(j=i,i=tmp),i=(i*(i+1)>>1)+j-1,void 0===current||current?this._collisionMatrix[i]=value:this._collisionMatrixPrevious[i]=value},P2Space.prototype.collisionMatrixTick=function(){var i,collisionMatrix=this._collisionMatrixPrevious;for(this._collisionMatrixPrevious=this._collisionMatrix,this._collisionMatrix=collisionMatrix,i=collisionMatrix.length;i--;){collisionMatrix[i]=0}},P2Space.prototype.addBody=function(body){var bodies=this.bodies,index=bodies.indexOf(body);return-1===index?(bodies.push(body),this._bodyHash[body._id]=body,body.space=this,body._index=bodies.length-1,body.init()):Log.error("P2Space.addBody: Body already member of P2Space"),this},P2Space.prototype.add=function(){for(var i=arguments.length;i--;){this.addBody(arguments[i])}return this},P2Space.prototype.removeBody=function(body){var bodies=this.bodies,index=bodies.indexOf(body);return-1!==index?(body.space=void 0,body._index=-1,bodies.splice(index,1),this._bodyHash[body._id]=void 0):Log.error("P2Space.addBody: Body not member of P2Space"),this},P2Space.prototype.remove=function(){for(var i=arguments.length;i--;){this.removeBody(arguments[i])}return this},P2Space.prototype.findBodyByPoint=function(p){var body,shapes,shape,i,j,bodies=this.bodies;for(i=bodies.length;i--;){if(body=bodies[i]){for(shapes=body.shapes,j=shapes.length;j--;){if(shape=shapes[j],shape&&shape.pointQuery(p)){return body}}}}return void 0
},P2Space.prototype.findBodyById=function(id){return this._bodyHash[id]},P2Space.prototype.step=function(dt){var time,start,body,force,mass,bi,bj,c,cp,cn,u,slipForce,fc,fcp,fct,i,stepStart=now(),stats=this.stats,g=this.gravity,gx=g.x,gy=g.y,bodies=this.bodies,numBodies=bodies.length,pairsi=this._pairsi,pairsj=this._pairsj,contacts=this.contacts,frictions=this.frictions;if(time=this.time+=dt,this.useGravity){for(i=numBodies;i--;){body=bodies[i],body.motionState===MotionState.Dynamic&&(force=body.force,mass=body.mass,force.x+=gx*mass,force.y+=gy*mass)}}for(this.collisionMatrixTick(),start=now(),this.broadphase.collisions(bodies,pairsi,pairsj),stats.broadphase=now()-start,start=now(),this.nearphase.collisions(pairsi,pairsj,contacts),stats.nearphase=now()-start,start=now(),this.solver.solve(dt,contacts),FRICTION_POOL.clear(),frictions.length=0,i=contacts.length;i--;){c=contacts[i],c.u>0&&(bi=c.bi,bj=c.bj,fc=FRICTION_POOL.create(),u=c.u,slipForce=u*c.lambda,fc.minForce=-slipForce,fc.maxForce=slipForce,fc.bi=bi,fc.bj=bj,cp=c.p,fcp=fc.p,fcp.x=cp.x,fcp.y=cp.y,cn=c.n,fct=fc.t,fct.x=-cn.y,fct.y=cn.x,frictions.push(fc))}for(this.solver.solve(dt,frictions),stats.solve=now()-start,start=now(),i=numBodies;i--;){body=bodies[i],body.update(dt)}stats.integrate=now()-start,stats.step=now()-stepStart},P2Space.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.useGravity=this.useGravity,json.gravity=this.gravity.toJSON(json.gravity),json},P2Space.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.useGravity=json.useGravity,this.gravity.fromJSON(json.gravity),this},P2Space}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/phys2d",["require","odin/phys2d/collision/p2broadphase","odin/phys2d/collision/p2nearphase","odin/phys2d/objects/p2circle","odin/phys2d/objects/p2convex","odin/phys2d/objects/p2particle","odin/phys2d/objects/p2rect","odin/phys2d/objects/p2rigidbody","odin/phys2d/objects/p2shape","odin/phys2d/p2enums","odin/phys2d/p2solver","odin/phys2d/p2space"],function(require){function Phys2D(){this.P2Broadphase=require("odin/phys2d/collision/p2broadphase"),this.P2Nearphase=require("odin/phys2d/collision/p2nearphase"),this.P2Circle=require("odin/phys2d/objects/p2circle"),this.P2Convex=require("odin/phys2d/objects/p2convex"),this.P2Particle=require("odin/phys2d/objects/p2particle"),this.P2Rect=require("odin/phys2d/objects/p2rect"),this.P2Rigidbody=require("odin/phys2d/objects/p2rigidbody"),this.P2Shape=require("odin/phys2d/objects/p2shape"),this.P2Enums=require("odin/phys2d/p2enums"),this.P2Solver=require("odin/phys2d/p2solver"),this.P2Space=require("odin/phys2d/p2space")}return new Phys2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/audio_ctx",["odin/core/game/log"],function(Log){var w="undefined"!=typeof window?window:global,ctx=w.AudioContext||w.webkitAudioContext||w.mozAudioContext||w.oAudioContext||w.msAudioContext;return ctx||Log.error("AudioContext not supported by this Browser"),ctx?new ctx:!1}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/device",[],function(){function Device(){var userAgent=navigator.userAgent.toLowerCase(),audio=new Audio,video=document.createElement("video");this.userAgent=userAgent,this.pixelRatio=window.devicePixelRatio||1,this.invPixelRatio=1/this.pixelRatio,this.browser=userAgent.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i)[1],this.touch="ontouchstart"in window,this.mobile=/android|webos|iphone|ipad|ipod|blackberry/i.test(userAgent),this.webgl=function(){var has,i,canvas=document.createElement("canvas"),names=["3d","moz-webgl","experimental-webgl","webkit-3d","webgl"];for(i=names.length;i--&&!(has=!!canvas.getContext(names[i]));){}return has}(),this.canvas=function(){var canvas=document.createElement("canvas"),has=!!canvas.getContext("2d");return has}(),this.gamepads=!!navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.webkitGamepads,this.audioMpeg=!!audio.canPlayType("audio/mpeg"),this.audioOgg=!!audio.canPlayType("audio/ogg"),this.audioMp4=!!audio.canPlayType("audio/mp4"),this.videoWebm=!!video.canPlayType("video/webm"),this.videoOgg=!!video.canPlayType("video/ogg"),this.videoMp4=!!video.canPlayType("video/mp4")}return new Device}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/dom",["odin/core/game/log"],function(Log){function Dom(){}var createShader,SPLITER=/[ ,]+/,regAttribute=/attribute\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,regUniform=/uniform\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,WEBGL_NAMES=["webgl","webkit-3d","moz-webgl","experimental-webgl","3d"],WEBGL_ATTRIBUTES={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0};return Dom.prototype.addEvent=function(obj,name,callback,ctx){var i,names=name.split(SPLITER),scope=ctx||obj,afn=function(e){callback.call(scope,e||window.event)};for(i=names.length;i--;){name=names[i],obj.attachEvent?obj.attachEvent("on"+name,afn):obj.addEventListener(name,afn,!1)}},Dom.prototype.removeEvent=function(obj,name,callback,ctx){var i,il,names=name.split(SPLITER),scope=ctx||obj,afn=function(e){callback&&callback.call(scope,e||window.event)};for(i=0,il=names.length;il>i;i++){name=names[i],obj.detachEvent?obj.detachEvent("on"+name,afn):obj.removeEventListener(name,afn,!1)}},Dom.prototype.addMeta=function(id,name,content){var meta=document.createElement("meta"),head=document.head;id&&(meta.id=id),name&&(meta.name=name),content&&(meta.content=content),head.insertBefore(meta,head.firstChild)},Dom.prototype.getWebGLContext=function(canvas,attributes){var key,gl,i;attributes||(attributes={});for(key in WEBGL_ATTRIBUTES){void 0!=attributes[key]&&(attributes[key]=WEBGL_ATTRIBUTES[key])}for(i=WEBGL_NAMES.length;i--;){try{gl=canvas.getContext(WEBGL_NAMES[i],attributes)}catch(err){Log.error("Dom.getWebGLContext: could not get a WebGL Context "+err.message||"")}if(gl){break}}return gl},createShader=Dom.prototype.createShader=function(gl,source,type){var shader=gl.createShader(type);return gl.shaderSource(shader,source),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(Log.error("Dom.createShader: problem compiling shader "+gl.getShaderInfoLog(shader)),gl.deleteShader(shader),void 0)},Dom.prototype.createProgram=function(gl,vertex,fragment){var shader,program=gl.createProgram();return shader=createShader(gl,vertex,gl.VERTEX_SHADER),gl.attachShader(program,shader),gl.deleteShader(shader),shader=createShader(gl,fragment,gl.FRAGMENT_SHADER),gl.attachShader(program,shader),gl.deleteShader(shader),gl.linkProgram(program),gl.validateProgram(program),gl.useProgram(program),gl.getProgramParameter(program,gl.LINK_STATUS)?program:(Log.error("Dom.createProgram: problem compiling Program "+gl.getProgramInfoLog(program)),gl.deleteProgram(program),void 0)},Dom.prototype.parseUniformsAttributes=function(gl,program,vertexShader,fragmentShader,attributes,uniforms){var matchAttributes,matchUniforms,name,length,line,i,j,src=vertexShader+fragmentShader,lines=src.split("\n");for(i=lines.length;i--;){if(line=lines[i],matchAttributes=line.match(regAttribute),matchUniforms=line.match(regUniform),matchAttributes&&(name=matchAttributes[3],attributes[name]=gl.getAttribLocation(program,name)),matchUniforms){if(name=matchUniforms[3],length=parseInt(matchUniforms[5])){for(uniforms[name]=[],j=length;j--;){uniforms[name][j]=gl.getUniformLocation(program,name+"["+j+"]")}}else{uniforms[name]=gl.getUniformLocation(program,name)}}}},new Dom}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/request_animation_frame",[],function(){var RATE=1e3/60,w="undefined"!=typeof window?window:global;return w.requestAnimationFrame||w.webkitRequestAnimationFrame||w.mozRequestAnimationFrame||w.oRequestAnimationFrame||w.msRequestAnimationFrame||function(callback){return w.setTimeout(callback,RATE)}}),function(){var io=function(exports,global){var io=exports;return io.version="0.9.16",io.protocol=1,io.transports=[],io.j=[],io.sockets={},io.connect=function(host,details){var uuri,socket,options,uri=io.util.parseUri(host);return global&&global.location&&(uri.protocol=uri.protocol||global.location.protocol.slice(0,-1),uri.host=uri.host||(global.document?global.document.domain:global.location.hostname),uri.port=uri.port||global.location.port),uuri=io.util.uniqueUri(uri),options={host:uri.host,secure:"https"==uri.protocol,port:uri.port||("https"==uri.protocol?443:80),query:uri.query||""},io.util.merge(options,details),(options["force new connection"]||!io.sockets[uuri])&&(socket=new io.Socket(options)),!options["force new connection"]&&socket&&(io.sockets[uuri]=socket),socket=socket||io.sockets[uuri],socket.of(uri.path.length>1?uri.path:"")},io}({},this);!function(exports,global){var pageLoaded,util=exports.util={},re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];util.parseUri=function(str){for(var m=re.exec(str||""),uri={},i=14;i--;){uri[parts[i]]=m[i]||""}return uri},util.uniqueUri=function(uri){var protocol=uri.protocol,host=uri.host,port=uri.port;return"document"in global?(host=host||document.domain,port=port||("https"==protocol&&"https:"!==document.location.protocol?443:document.location.port)):(host=host||"localhost",port||"https"!=protocol||(port=443)),(protocol||"http")+"://"+host+":"+(port||80)},util.query=function(base,addition){var part,query=util.chunkQuery(base||""),components=[];util.merge(query,util.chunkQuery(addition||""));for(part in query){query.hasOwnProperty(part)&&components.push(part+"="+query[part])}return components.length?"?"+components.join("&"):""},util.chunkQuery=function(qs){for(var kv,query={},params=qs.split("&"),i=0,l=params.length;l>i;++i){kv=params[i].split("="),kv[0]&&(query[kv[0]]=kv[1])}return query},pageLoaded=!1,util.load=function(fn){return"document"in global&&"complete"===document.readyState||pageLoaded?fn():(util.on(global,"load",fn,!1),void 0)},util.on=function(element,event,fn,capture){element.attachEvent?element.attachEvent("on"+event,fn):element.addEventListener&&element.addEventListener(event,fn,capture)},util.request=function(xdomain){if(xdomain&&"undefined"!=typeof XDomainRequest&&!util.ua.hasCORS){return new XDomainRequest}if("undefined"!=typeof XMLHttpRequest&&(!xdomain||util.ua.hasCORS)){return new XMLHttpRequest}if(!xdomain){try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}return null},"undefined"!=typeof window&&util.load(function(){pageLoaded=!0}),util.defer=function(fn){return util.ua.webkit&&"undefined"==typeof importScripts?(util.load(function(){setTimeout(fn,100)}),void 0):fn()},util.merge=function(target,additional,deep,lastseen){var prop,seen=lastseen||[],depth="undefined"==typeof deep?2:deep;for(prop in additional){additional.hasOwnProperty(prop)&&util.indexOf(seen,prop)<0&&("object"==typeof target[prop]&&depth?util.merge(target[prop],additional[prop],depth-1,seen):(target[prop]=additional[prop],seen.push(additional[prop])))}return target},util.mixin=function(ctor,ctor2){util.merge(ctor.prototype,ctor2.prototype)},util.inherit=function(ctor,ctor2){function f(){}f.prototype=ctor2.prototype,ctor.prototype=new f},util.isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},util.intersect=function(arr,arr2){var i,l,ret=[],longest=arr.length>arr2.length?arr:arr2,shortest=arr.length>arr2.length?arr2:arr;for(i=0,l=shortest.length;l>i;i++){~util.indexOf(longest,shortest[i])&&ret.push(shortest[i])}return ret},util.indexOf=function(arr,o,i){for(var j=arr.length,i=0>i?0>i+j?0:i+j:i||0;j>i&&arr[i]!==o;i++){}return i>=j?-1:i},util.toArray=function(enu){var i,l,arr=[];for(i=0,l=enu.length;l>i;i++){arr.push(enu[i])}return arr},util.ua={},util.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(e){return!1}return void 0!=a.withCredentials}(),util.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),util.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(exports,io){function EventEmitter(){}exports.EventEmitter=EventEmitter,EventEmitter.prototype.on=function(name,fn){return this.$events||(this.$events={}),this.$events[name]?io.util.isArray(this.$events[name])?this.$events[name].push(fn):this.$events[name]=[this.$events[name],fn]:this.$events[name]=fn,this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.once=function(name,fn){function on(){self.removeListener(name,on),fn.apply(this,arguments)}var self=this;return on.listener=fn,this.on(name,on),this},EventEmitter.prototype.removeListener=function(name,fn){var list,pos,i,l;if(this.$events&&this.$events[name]){if(list=this.$events[name],io.util.isArray(list)){for(pos=-1,i=0,l=list.length;l>i;i++){if(list[i]===fn||list[i].listener&&list[i].listener===fn){pos=i;break}}if(0>pos){return this}list.splice(pos,1),list.length||delete this.$events[name]}else{(list===fn||list.listener&&list.listener===fn)&&delete this.$events[name]}}return this},EventEmitter.prototype.removeAllListeners=function(name){return void 0===name?(this.$events={},this):(this.$events&&this.$events[name]&&(this.$events[name]=null),this)},EventEmitter.prototype.listeners=function(name){return this.$events||(this.$events={}),this.$events[name]||(this.$events[name]=[]),io.util.isArray(this.$events[name])||(this.$events[name]=[this.$events[name]]),this.$events[name]},EventEmitter.prototype.emit=function(name){var handler,args,listeners,i,l;if(!this.$events){return!1}if(handler=this.$events[name],!handler){return!1}if(args=Array.prototype.slice.call(arguments,1),"function"==typeof handler){handler.apply(this,args)}else{if(!io.util.isArray(handler)){return!1}for(listeners=handler.slice(),i=0,l=listeners.length;l>i;i++){listeners[i].apply(this,args)}}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(n){return 10>n?"0"+n:n}function date(d){return isFinite(d.valueOf())?d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z":null}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value instanceof Date&&(value=date(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1){partial[i]=str(i,value)||"null"}return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep){for(length=rep.length,i=0;length>i;i+=1){"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))}}else{for(k in value){Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))}}return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}var JSON,cx,escapable,gap,indent,meta,rep;return nativeJSON&&nativeJSON.parse?exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}:(JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space){for(i=0;space>i;i+=1){indent+=" "}}else{"string"==typeof space&&(indent=space)}if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length)){throw new Error("JSON.stringify")}return str("",{"":value})},JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value){for(k in value){Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k])}}return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j}throw new SyntaxError("JSON.parse")},void 0)}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(exports,io){var regexp,parser=exports.parser={},packets=parser.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],reasons=parser.reasons=["transport not supported","client not handshaken","unauthorized"],advice=parser.advice=["reconnect"],JSON=io.JSON,indexOf=io.util.indexOf;parser.encodePacket=function(packet){var reason,adv,ev,encoded,type=indexOf(packets,packet.type),id=packet.id||"",endpoint=packet.endpoint||"",ack=packet.ack,data=null;switch(packet.type){case"error":reason=packet.reason?indexOf(reasons,packet.reason):"",adv=packet.advice?indexOf(advice,packet.advice):"",(""!==reason||""!==adv)&&(data=reason+(""!==adv?"+"+adv:""));break;case"message":""!==packet.data&&(data=packet.data);break;case"event":ev={name:packet.name},packet.args&&packet.args.length&&(ev.args=packet.args),data=JSON.stringify(ev);break;case"json":data=JSON.stringify(packet.data);break;case"connect":packet.qs&&(data=packet.qs);break;case"ack":data=packet.ackId+(packet.args&&packet.args.length?"+"+JSON.stringify(packet.args):"")}return encoded=[type,id+("data"==ack?"+":""),endpoint],null!==data&&void 0!==data&&encoded.push(data),encoded.join(":")},parser.encodePayload=function(packets){var i,l,packet,decoded="";if(1==packets.length){return packets[0]}for(i=0,l=packets.length;l>i;i++){packet=packets[i],decoded+="�"+packet.length+"�"+packets[i]}return decoded},regexp=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/,parser.decodePacket=function(data){var id,packet,opts,pieces=data.match(regexp);if(!pieces){return{}}switch(id=pieces[2]||"",data=pieces[5]||"",packet={type:packets[pieces[1]],endpoint:pieces[4]||""},id&&(packet.id=id,packet.ack=pieces[3]?"data":!0),packet.type){case"error":pieces=data.split("+"),packet.reason=reasons[pieces[0]]||"",packet.advice=advice[pieces[1]]||"";break;case"message":packet.data=data||"";break;case"event":try{opts=JSON.parse(data),packet.name=opts.name,packet.args=opts.args}catch(e){}packet.args=packet.args||[];break;case"json":try{packet.data=JSON.parse(data)}catch(e){}break;case"connect":packet.qs=data||"";break;case"ack":if(pieces=data.match(/^([0-9]+)(\+)?(.*)/),pieces&&(packet.ackId=pieces[1],packet.args=[],pieces[3])){try{packet.args=pieces[3]?JSON.parse(pieces[3]):[]}catch(e){}}break;case"disconnect":case"heartbeat":}return packet},parser.decodePayload=function(data){var ret,i,length;if("�"==data.charAt(0)){for(ret=[],i=1,length="";i<data.length;i++){"�"==data.charAt(i)?(ret.push(parser.decodePacket(data.substr(i+1).substr(0,length))),i+=Number(length)+1,length=""):length+=data.charAt(i)}return ret}return[parser.decodePacket(data)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io){function Transport(socket,sessid){this.socket=socket,this.sessid=sessid}exports.Transport=Transport,io.util.mixin(Transport,io.EventEmitter),Transport.prototype.heartbeats=function(){return!0},Transport.prototype.onData=function(data){var msgs,i,l;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==data&&(msgs=io.parser.decodePayload(data),msgs&&msgs.length)){for(i=0,l=msgs.length;l>i;i++){this.onPacket(msgs[i])}}return this},Transport.prototype.onPacket=function(packet){return this.socket.setHeartbeatTimeout(),"heartbeat"==packet.type?this.onHeartbeat():("connect"==packet.type&&""==packet.endpoint&&this.onConnect(),"error"==packet.type&&"reconnect"==packet.advice&&(this.isOpen=!1),this.socket.onPacket(packet),this)},Transport.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var self=this;this.closeTimeout=setTimeout(function(){self.onDisconnect()},this.socket.closeTimeout)}},Transport.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},Transport.prototype.onConnect=function(){return this.socket.onConnect(),this},Transport.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},Transport.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},Transport.prototype.packet=function(packet){this.send(io.parser.encodePacket(packet))},Transport.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},Transport.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},Transport.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},Transport.prototype.prepareUrl=function(){var options=this.socket.options;return this.scheme()+"://"+options.host+":"+options.port+"/"+options.resource+"/"+io.protocol+"/"+this.name+"/"+this.sessid},Transport.prototype.ready=function(socket,fn){fn.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function Socket(options){if(this.options={port:80,secure:!1,document:"document"in global?document:!1,resource:"socket.io",transports:io.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},io.util.merge(this.options,options),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||io.util.ua.hasCORS)){var self=this;io.util.on(global,"beforeunload",function(){self.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function empty(){}exports.Socket=Socket,io.util.mixin(Socket,io.EventEmitter),Socket.prototype.of=function(name){return this.namespaces[name]||(this.namespaces[name]=new io.SocketNamespace(this,name),""!==name&&this.namespaces[name].packet({type:"connect"})),this.namespaces[name]},Socket.prototype.publish=function(){var nsp,i;this.emit.apply(this,arguments);for(i in this.namespaces){this.namespaces.hasOwnProperty(i)&&(nsp=this.of(i),nsp.$emit.apply(nsp,arguments))}},Socket.prototype.handshake=function(fn){function complete(data){data instanceof Error?(self.connecting=!1,self.onError(data.message)):fn.apply(null,data.split(":"))}var insertAt,script,xhr,self=this,options=this.options,url=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,io.protocol,io.util.query(this.options.query,"t="+ +new Date)].join("/");this.isXDomain()&&!io.util.ua.hasCORS?(insertAt=document.getElementsByTagName("script")[0],script=document.createElement("script"),script.src=url+"&jsonp="+io.j.length,insertAt.parentNode.insertBefore(script,insertAt),io.j.push(function(data){complete(data),script.parentNode.removeChild(script)})):(xhr=io.util.request(),xhr.open("GET",url,!0),this.isXDomain()&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){4==xhr.readyState&&(xhr.onreadystatechange=empty,200==xhr.status?complete(xhr.responseText):403==xhr.status?self.onError(xhr.responseText):(self.connecting=!1,!self.reconnecting&&self.onError(xhr.responseText)))},xhr.send(null))},Socket.prototype.getTransport=function(override){var i,transport,transports=override||this.transports;for(i=0;transport=transports[i];i++){if(io.Transport[transport]&&io.Transport[transport].check(this)&&(!this.isXDomain()||io.Transport[transport].xdomainCheck(this))){return new io.Transport[transport](this,this.sessionid)}}return null},Socket.prototype.connect=function(fn){if(this.connecting){return this}var self=this;return self.connecting=!0,this.handshake(function(sid,heartbeat,close,transports){function connect(transports){return self.transport&&self.transport.clearTimeouts(),self.transport=self.getTransport(transports),self.transport?(self.transport.ready(self,function(){self.connecting=!0,self.publish("connecting",self.transport.name),self.transport.open(),self.options["connect timeout"]&&(self.connectTimeoutTimer=setTimeout(function(){if(!self.connected&&(self.connecting=!1,self.options["try multiple transports"])){for(var remaining=self.transports;remaining.length>0&&remaining.splice(0,1)[0]!=self.transport.name;){}remaining.length?connect(remaining):self.publish("connect_failed")}},self.options["connect timeout"]))}),void 0):self.publish("connect_failed")}self.sessionid=sid,self.closeTimeout=1e3*close,self.heartbeatTimeout=1e3*heartbeat,self.transports||(self.transports=self.origTransports=transports?io.util.intersect(transports.split(","),self.options.transports):self.options.transports),self.setHeartbeatTimeout(),connect(self.transports),self.once("connect",function(){clearTimeout(self.connectTimeoutTimer),fn&&"function"==typeof fn&&fn()})}),this},Socket.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var self=this;this.heartbeatTimeoutTimer=setTimeout(function(){self.transport.onClose()},this.heartbeatTimeout)}},Socket.prototype.packet=function(data){return this.connected&&!this.doBuffer?this.transport.packet(data):this.buffer.push(data),this},Socket.prototype.setBuffer=function(v){this.doBuffer=v,!v&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},Socket.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},Socket.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},Socket.prototype.disconnectSync=function(){var xhr=io.util.request(),uri=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,io.protocol,"",this.sessionid].join("/")+"/?disconnect=1";xhr.open("GET",uri,!1),xhr.send(null),this.onDisconnect("booted")},Socket.prototype.isXDomain=function(){var port=global.location.port||("https:"==global.location.protocol?443:80);return this.options.host!==global.location.hostname||this.options.port!=port},Socket.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},Socket.prototype.onOpen=function(){this.open=!0},Socket.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},Socket.prototype.onPacket=function(packet){this.of(packet.endpoint).onPacket(packet)},Socket.prototype.onError=function(err){err&&err.advice&&"reconnect"===err.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",err&&err.reason?err.reason:err)},Socket.prototype.onDisconnect=function(reason){var wasConnected=this.connected,wasConnecting=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(wasConnected||wasConnecting)&&(this.transport.close(),this.transport.clearTimeouts(),wasConnected&&(this.publish("disconnect",reason),"booted"!=reason&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},Socket.prototype.reconnect=function(){function reset(){if(self.connected){for(var i in self.namespaces){self.namespaces.hasOwnProperty(i)&&""!==i&&self.namespaces[i].packet({type:"connect"})}self.publish("reconnect",self.transport.name,self.reconnectionAttempts)}clearTimeout(self.reconnectionTimer),self.removeListener("connect_failed",maybeReconnect),self.removeListener("connect",maybeReconnect),self.reconnecting=!1,delete self.reconnectionAttempts,delete self.reconnectionDelay,delete self.reconnectionTimer,delete self.redoTransports,self.options["try multiple transports"]=tryMultiple}function maybeReconnect(){return self.reconnecting?self.connected?reset():self.connecting&&self.reconnecting?self.reconnectionTimer=setTimeout(maybeReconnect,1e3):(self.reconnectionAttempts++>=maxAttempts?self.redoTransports?(self.publish("reconnect_failed"),reset()):(self.on("connect_failed",maybeReconnect),self.options["try multiple transports"]=!0,self.transports=self.origTransports,self.transport=self.getTransport(),self.redoTransports=!0,self.connect()):(self.reconnectionDelay<limit&&(self.reconnectionDelay*=2),self.connect(),self.publish("reconnecting",self.reconnectionDelay,self.reconnectionAttempts),self.reconnectionTimer=setTimeout(maybeReconnect,self.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var self=this,maxAttempts=this.options["max reconnection attempts"],tryMultiple=this.options["try multiple transports"],limit=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(maybeReconnect,this.reconnectionDelay),this.on("connect",maybeReconnect)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io){function SocketNamespace(socket,name){this.socket=socket,this.name=name||"",this.flags={},this.json=new Flag(this,"json"),this.ackPackets=0,this.acks={}}function Flag(nsp,name){this.namespace=nsp,this.name=name}exports.SocketNamespace=SocketNamespace,io.util.mixin(SocketNamespace,io.EventEmitter),SocketNamespace.prototype.$emit=io.EventEmitter.prototype.emit,SocketNamespace.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},SocketNamespace.prototype.packet=function(packet){return packet.endpoint=this.name,this.socket.packet(packet),this.flags={},this},SocketNamespace.prototype.send=function(data,fn){var packet={type:this.flags.json?"json":"message",data:data};return"function"==typeof fn&&(packet.id=++this.ackPackets,packet.ack=!0,this.acks[packet.id]=fn),this.packet(packet)},SocketNamespace.prototype.emit=function(name){var args=Array.prototype.slice.call(arguments,1),lastArg=args[args.length-1],packet={type:"event",name:name};return"function"==typeof lastArg&&(packet.id=++this.ackPackets,packet.ack="data",this.acks[packet.id]=lastArg,args=args.slice(0,args.length-1)),packet.args=args,this.packet(packet)},SocketNamespace.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},SocketNamespace.prototype.onPacket=function(packet){function ack(){self.packet({type:"ack",args:io.util.toArray(arguments),ackId:packet.id})}var params,self=this;
switch(packet.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(packet.reason||"booted"):this.$emit("disconnect",packet.reason);break;case"message":case"json":params=["message",packet.data],"data"==packet.ack?params.push(ack):packet.ack&&this.packet({type:"ack",ackId:packet.id}),this.$emit.apply(this,params);break;case"event":params=[packet.name].concat(packet.args),"data"==packet.ack&&params.push(ack),this.$emit.apply(this,params);break;case"ack":this.acks[packet.ackId]&&(this.acks[packet.ackId].apply(this,packet.args),delete this.acks[packet.ackId]);break;case"error":packet.advice?this.socket.onError(packet):"unauthorized"==packet.reason?this.$emit("connect_failed",packet.reason):this.$emit("error",packet.reason)}},Flag.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},Flag.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function WS(){io.Transport.apply(this,arguments)}exports.websocket=WS,io.util.inherit(WS,io.Transport),WS.prototype.name="websocket",WS.prototype.open=function(){var Socket,query=io.util.query(this.socket.options.query),self=this;return Socket||(Socket=global.MozWebSocket||global.WebSocket),this.websocket=new Socket(this.prepareUrl()+query),this.websocket.onopen=function(){self.onOpen(),self.socket.setBuffer(!1)},this.websocket.onmessage=function(ev){self.onData(ev.data)},this.websocket.onclose=function(){self.onClose(),self.socket.setBuffer(!0)},this.websocket.onerror=function(e){self.onError(e)},this},WS.prototype.send=io.util.ua.iDevice?function(data){var self=this;return setTimeout(function(){self.websocket.send(data)},0),this}:function(data){return this.websocket.send(data),this},WS.prototype.payload=function(arr){for(var i=0,l=arr.length;l>i;i++){this.packet(arr[i])}return this},WS.prototype.close=function(){return this.websocket.close(),this},WS.prototype.onError=function(e){this.socket.onError(e)},WS.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},WS.check=function(){return"WebSocket"in global&&!("__addTask"in WebSocket)||"MozWebSocket"in global},WS.xdomainCheck=function(){return!0},io.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io,global){function XHR(socket){socket&&(io.Transport.apply(this,arguments),this.sendBuffer=[])}function empty(){}exports.XHR=XHR,io.util.inherit(XHR,io.Transport),XHR.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},XHR.prototype.payload=function(payload){var i,l,msgs=[];for(i=0,l=payload.length;l>i;i++){msgs.push(io.parser.encodePacket(payload[i]))}this.send(io.parser.encodePayload(msgs))},XHR.prototype.send=function(data){return this.post(data),this},XHR.prototype.post=function(data){function stateChange(){4==this.readyState&&(this.onreadystatechange=empty,self.posting=!1,200==this.status?self.socket.setBuffer(!1):self.onClose())}function onload(){this.onload=empty,self.socket.setBuffer(!1)}var self=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),global.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=onload:this.sendXHR.onreadystatechange=stateChange,this.sendXHR.send(data)},XHR.prototype.close=function(){return this.onClose(),this},XHR.prototype.request=function(method){var req=io.util.request(this.socket.isXDomain()),query=io.util.query(this.socket.options.query,"t="+ +new Date);if(req.open(method||"GET",this.prepareUrl()+query,!0),"POST"==method){try{req.setRequestHeader?req.setRequestHeader("Content-type","text/plain;charset=UTF-8"):req.contentType="text/plain"}catch(e){}}return req},XHR.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},XHR.check=function(socket,xdomain){try{var request=io.util.request(xdomain),usesXDomReq=global.XDomainRequest&&request instanceof XDomainRequest,socketProtocol=socket&&socket.options&&socket.options.secure?"https:":"http:",isXProtocol=global.location&&socketProtocol!=global.location.protocol;if(request&&(!usesXDomReq||!isXProtocol)){return!0}}catch(e){}return!1},XHR.xdomainCheck=function(socket){return XHR.check(socket,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io){function HTMLFile(){io.Transport.XHR.apply(this,arguments)}exports.htmlfile=HTMLFile,io.util.inherit(HTMLFile,io.Transport.XHR),HTMLFile.prototype.name="htmlfile",HTMLFile.prototype.get=function(){var iframeC,self,query;this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this,iframeC=this.doc.createElement("div"),iframeC.className="socketio",this.doc.body.appendChild(iframeC),this.iframe=this.doc.createElement("iframe"),iframeC.appendChild(this.iframe),self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date),this.iframe.src=this.prepareUrl()+query,io.util.on(window,"unload",function(){self.destroy()})},HTMLFile.prototype._=function(data,doc){data=data.replace(/\\\//g,"/"),this.onData(data);try{var script=doc.getElementsByTagName("script")[0];script.parentNode.removeChild(script)}catch(e){}},HTMLFile.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},HTMLFile.prototype.close=function(){return this.destroy(),io.Transport.XHR.prototype.close.call(this)},HTMLFile.check=function(socket){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window){try{var a=new(window[["Active"].concat("Object").join("X")])("htmlfile");return a&&io.Transport.XHR.check(socket)}catch(e){}}return!1},HTMLFile.xdomainCheck=function(){return!1},io.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function XHRPolling(){io.Transport.XHR.apply(this,arguments)}function empty(){}exports["xhr-polling"]=XHRPolling,io.util.inherit(XHRPolling,io.Transport.XHR),io.util.merge(XHRPolling,io.Transport.XHR),XHRPolling.prototype.name="xhr-polling",XHRPolling.prototype.heartbeats=function(){return!1},XHRPolling.prototype.open=function(){var self=this;return io.Transport.XHR.prototype.open.call(self),!1},XHRPolling.prototype.get=function(){function stateChange(){4==this.readyState&&(this.onreadystatechange=empty,200==this.status?(self.onData(this.responseText),self.get()):self.onClose())}function onload(){this.onload=empty,this.onerror=empty,self.retryCounter=1,self.onData(this.responseText),self.get()}function onerror(){self.retryCounter++,!self.retryCounter||self.retryCounter>3?self.onClose():self.get()}if(this.isOpen){var self=this;this.xhr=this.request(),global.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=onload,this.xhr.onerror=onerror):this.xhr.onreadystatechange=stateChange,this.xhr.send(null)}},XHRPolling.prototype.onClose=function(){if(io.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=empty;try{this.xhr.abort()}catch(e){}this.xhr=null}},XHRPolling.prototype.ready=function(socket,fn){var self=this;io.util.defer(function(){fn.call(self,socket)})},io.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io,global){function JSONPPolling(){io.Transport["xhr-polling"].apply(this,arguments),this.index=io.j.length;var self=this;io.j.push(function(msg){self._(msg)})}var indicator=global.document&&"MozAppearance"in global.document.documentElement.style;exports["jsonp-polling"]=JSONPPolling,io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]),JSONPPolling.prototype.name="jsonp-polling",JSONPPolling.prototype.post=function(data){function complete(){initIframe(),self.socket.setBuffer(!1)}function initIframe(){self.iframe&&self.form.removeChild(self.iframe);try{iframe=document.createElement('<iframe name="'+self.iframeId+'">')}catch(e){iframe=document.createElement("iframe"),iframe.name=self.iframeId}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}var form,area,id,iframe,self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.form||(form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="socketio_iframe_"+this.index,form.className="socketio",form.style.position="absolute",form.style.top="0px",form.style.left="0px",form.style.display="none",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area),this.form.action=this.prepareUrl()+query,initIframe(),this.area.value=io.JSON.stringify(data);try{this.form.submit()}catch(e){}this.iframe.attachEvent?iframe.onreadystatechange=function(){"complete"==self.iframe.readyState&&complete()}:this.iframe.onload=complete,this.socket.setBuffer(!0)},JSONPPolling.prototype.get=function(){var insertAt,self=this,script=document.createElement("script"),query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.prepareUrl()+query,script.onerror=function(){self.onClose()},insertAt=document.getElementsByTagName("script")[0],insertAt.parentNode.insertBefore(script,insertAt),this.script=script,indicator&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype._=function(msg){return this.onData(msg),this.isOpen&&this.get(),this},JSONPPolling.prototype.ready=function(socket,fn){var self=this;return indicator?(io.util.load(function(){fn.call(self)}),void 0):fn.call(this)},JSONPPolling.check=function(){return"document"in global},JSONPPolling.xdomainCheck=function(){return!0},io.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define("odin/base/socket.io",[],function(){return io})}(),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/util",[],function(){function camelize(word,lowFirstLetter){var part,i,il,parts=word.split(SPILTER),string="";for(i=0,il=parts.length;il>i;i++){part=parts[i],string+=part[0].toUpperCase()+part.slice(1).toLowerCase()}return lowFirstLetter?string[0].toLowerCase()+string.slice(1):string}function underscore(word){return word.replace(SPILTER,"").replace(UNDERSCORE,"$1_$2").toLowerCase()}function merge(obj,add){var key;for(key in add){void 0!=obj[key]&&(obj[key]=add[key])}return obj}var util={},SPILTER=/[ \_\-\.]+|(?=[A-Z][^A-Z])/g,UNDERSCORE=/([a-z])([A-Z])/g;return util.camelize=camelize,util.underscore=underscore,util.merge=merge,util}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/asset",["odin/core/game/log","odin/base/class"],function(Log,Class){function Asset(opts){opts||(opts={}),Class.call(this),this._name=void 0!=opts.name?opts.name:"Asset_"+this._id,this.json=void 0!=opts.json?!!opts.json:!0,this.assets=void 0,this.src=opts.src,this.raw=opts.raw}var defineProperty=Object.defineProperty;return Class.extend(Asset),defineProperty(Asset.prototype,"name",{get:function(){return this._name},set:function(value){var hash,assets=this.assets;if(assets){if(hash=assets.hash,hash[value]){return Log.warn("Asset.set name: can't change name to "+value+" Assets already have an asset with same name"),void 0}delete hash[this.name],hash[value]=this}this._name=value}}),Asset.prototype.clone=function(){return(new this.constructor).copy(this)},Asset.prototype.copy=function(other){return this.sync=other.sync,this.json=other.json,this.name=other.name+"."+this._id,this.src=other.src,this.raw=other.raw,other.assets&&other.assets.addAsset(this),this},Asset.prototype.ext=function(){return this.src?this.src.split(".").pop():!1},Asset.prototype.clear=function(){return this.raw=null,this},Asset.prototype.destroy=function(){return this.assets?(this.assets.removeAsset(this),this.clear(),this):(Log.error("Asset.destroy: can't destroy Asset if it's not added to Assets"),this)},Asset.prototype.parse=function(raw){return this.raw=raw,this},Asset.prototype.toJSON=function(json,pack){return json=Class.prototype.toJSON.call(this,json),json.name=this.name,pack||(json.src=this.src),json},Asset.prototype.fromServerJSON=function(json){return Class.prototype.fromServerJSON.call(this,json),this.name=json.name,this.src=json.src,this},Asset.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.name=json.name,this.src=json.src,this},Asset}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/assets",["odin/base/class","odin/core/assets/asset","odin/core/game/log"],function(Class,Asset,Log){function Assets(){Array.call(this),this.hash={}}return Assets.prototype=Object.create(Array.prototype),Assets.prototype.constructor=Assets,Assets.prototype.addAsset=function(asset){if(!(asset instanceof Asset)){return Log.error("Assets.addAsset: can't add passed argument, it is not an instance of Asset"),this}var name=asset.name;return this.hash[name]?(Log.error("Assets.addAsset: Assets already have Asset named "+asset.name),void 0):(asset.assets=this,this.push(asset),this.hash[name]=asset,asset)},Assets.prototype.add=Assets.prototype.addAssets=function(){for(var i=arguments.length;i--;){this.addAsset(arguments[i])}},Assets.prototype.removeAsset=function(asset){var name="string"==typeof asset?asset:asset.name;return(asset=this.hash[name])?(this.splice(this.indexOf(asset),1),this.hash[name]=null,asset):(Log.error("Assets.removeAsset: Assets does not have an Asset named "+name),void 0)},Assets.prototype.remove=Assets.prototype.removeAssets=function(){for(var i=arguments.length;i--;){this.removeAsset(arguments[i])}},Assets.prototype.toJSON=function(json,pack){json||(json={});for(var jsonAsset,jsonAssets=json.assets||(json.assets=[]),i=this.length;i--;){(jsonAsset=this[i]).json&&(jsonAssets[i]=jsonAsset.toJSON(jsonAssets[i],pack))}return json},Assets.prototype.fromServerJSON=function(json){for(var asset,jsonAsset,assetsHash=this.hash,jsonAssets=json.assets||(json.assets=[]),i=jsonAssets.length;i--;){(jsonAsset=jsonAssets[i])&&((asset=assetsHash[jsonAsset.name])?asset.fromServerJSON(jsonAsset):this.add(Class.fromServerJSON(jsonAsset)))}return this},Assets.prototype.fromJSON=function(json){for(var asset,jsonAsset,assetsHash=this.hash,jsonAssets=json.assets||(json.assets=[]),i=jsonAssets.length;i--;){(jsonAsset=jsonAssets[i])&&((asset=assetsHash[jsonAsset.name])?asset.fromJSON(jsonAsset):this.add(Class.fromJSON(jsonAsset)))}return this},new Assets}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/asset_loader",["odin/base/event_emitter","odin/base/audio_ctx","odin/core/assets/asset","odin/core/assets/assets","odin/core/game/log"],function(EventEmitter,AudioCtx,Asset,Assets,Log){function AssetLoader(){EventEmitter.call(this)}return EventEmitter.extend(AssetLoader),AssetLoader.prototype.load=function(callback,reload){for(var self=this,count=Assets.length,i=count,fn=function(err){err&&Log.error(err.message),count--,0===count&&(self.emit("load"),callback&&callback())};i--;){this.loadAsset(Assets[i],fn,reload,!0)}},AssetLoader.prototype.loadAsset=function(asset,callback,reload,known){var ext,self=this;if(known&&-1!==Assets.indexOf(asset)||Assets.addAsset(asset),asset.raw&&!reload){return callback&&callback(),void 0}if(ext=asset.ext()){if(!this[ext]){return callback&&callback(new Error("AssetLoader.load: has no loader named "+ext)),void 0}this[ext](asset.src,function(err,raw){return err?(callback&&callback(new Error("AssetLoader.load: "+err.message)),void 0):(asset.parse(raw),self.emit("loadAsset",asset),callback&&callback(),void 0)})}},AssetLoader.prototype.gif=AssetLoader.prototype.jpg=AssetLoader.prototype.jpeg=AssetLoader.prototype.png=function(src,callback){var image=new Image;image.onload=function(){callback&&callback(null,image)},image.onerror=function(){callback&&callback(new Error("GET "+src+" 404 (Not Found)"))},image.src=src},AssetLoader.prototype.json=function(src,callback){var request=new XMLHttpRequest;request.onload=function(){var json,status=this.status;if(status>199&&301>status||304==status){try{json=JSON.parse(this.responseText)}catch(err){return callback&&callback(err),void 0}callback&&callback(null,json)}else{callback&&callback(new Error(status))}},request.onerror=function(){callback&&callback(new Error("GET "+src+" 404 (Not Found)"))},request.open("GET",src,!0),request.setRequestHeader("Content-Type","application/json"),request.send()},AssetLoader.prototype.ogg=AssetLoader.prototype.wav=AssetLoader.prototype.mp3=AssetLoader.prototype.aac=function(src,callback){var request=new XMLHttpRequest;request.onload=function(){var status=this.status;status>199&&301>status||304==status?AudioCtx?AudioCtx.decodeAudioData(this.response,function(buffer){callback&&callback(null,buffer)},function(){callback&&callback(new Error("AudioContext Failed to parse Audio Clip"))}):callback&&callback(new Error("AudioContext (WebAudio API) is not supported by this browser")):callback&&callback(new Error(status))},request.onerror=function(){callback&&callback(new Error("GET "+src+" 404 (Not Found)"))},request.open("GET",src,!0),request.responseType="arraybuffer",request.send()},new AssetLoader}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/audio_clip",["odin/base/audio_ctx","odin/core/assets/asset"],function(AudioCtx,Asset){function AudioClip(opts){opts||(opts={}),Asset.call(this,opts)}function arrayBufferToString(arrayBuffer){return fromCharCode.apply(null,new Uint16Array(arrayBuffer))}function stringToArrayBuffer(str){for(var len=str.length,arrayBuffer=new ArrayBuffer(2*len),array=new Uint16Array(arrayBuffer),i=len;i--;){array[i]=str.charCodeAt(i)}return arrayBuffer}var defineProperty=Object.defineProperty,fromCharCode=String.fromCharCode;return Asset.extend(AudioClip),defineProperty(AudioClip.prototype,"length",{get:function(){return this.raw?this.raw.duration:0}}),defineProperty(AudioClip.prototype,"samples",{get:function(){return this.raw?this.raw.length:0}}),defineProperty(AudioClip.prototype,"frequency",{get:function(){return this.raw?this.raw.sampleRate:44100}}),defineProperty(AudioClip.prototype,"channels",{get:function(){return this.raw?this.raw.numberOfChannels:0}}),AudioClip.prototype.getData=function(array,offset){return array||(array=[]),this.raw?this.raw.getChannelData(array,offset):array},AudioClip.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json,pack),!pack&&this.src||!this.raw||(json.raw=arrayBufferToString(this.raw)),json},AudioClip.prototype.fromServerJSON=function(json,pack){return Asset.prototype.fromServerJSON.call(this,json,pack),!pack&&this.src||!this.raw||(this.raw=stringToArrayBuffer(json.raw)),this},AudioClip.prototype.fromJSON=function(json,pack){return Asset.prototype.fromJSON.call(this,json,pack),!pack&&this.src||!this.raw||(this.raw=stringToArrayBuffer(json.raw)),this},AudioClip}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/material",["odin/core/assets/asset"],function(Asset){function Material(opts){opts||(opts={}),Asset.call(this,opts)}return Asset.extend(Material),Material.prototype.parse=function(raw){return Asset.prototype.parse.call(this,raw),this},Material.prototype.clear=function(){return Asset.prototype.clear.call(this),this},Material.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json,pack)},Material.prototype.fromServerJSON=function(json){return Asset.prototype.fromServerJSON.call(this,json),this},Material.prototype.fromJSON=function(json){return Asset.prototype.fromJSON.call(this,json),this},Material}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/mesh",["odin/core/assets/asset"],function(Asset){function Mesh(opts){opts||(opts={}),Asset.call(this,opts)}return Asset.extend(Mesh),Mesh.prototype.parse=function(raw){return Asset.prototype.parse.call(this,raw),this},Mesh.prototype.clear=function(){return Asset.prototype.clear.call(this),this},Mesh.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json,pack)},Mesh.prototype.fromServerJSON=function(json){return Asset.prototype.fromServerJSON.call(this,json),this},Mesh.prototype.fromJSON=function(json){return Asset.prototype.fromJSON.call(this,json),this},Mesh}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/sprite_sheet",["odin/core/assets/asset"],function(Asset){function SpriteSheet(opts){opts||(opts={}),Asset.call(this,opts)}return Asset.extend(SpriteSheet),SpriteSheet.prototype.parse=function(raw){Asset.prototype.parse.call(this,raw);for(var key in raw){this[key]?Log.error("SpriteSheet.parse: invalid animation name "+key+" in file "+this.src):this[key]=raw[key]}return this},SpriteSheet.prototype.clear=function(){for(var key in this.raw){this[key]=null}return Asset.prototype.clear.call(this),this},SpriteSheet.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json),!pack&&this.src||!this.raw||(json.raw=JSON.stringify(this.raw)),json},SpriteSheet.prototype.fromServerJSON=function(json){return Asset.prototype.fromServerJSON.call(this,json),!json.src&&json.raw&&(this.raw=JSON.parse(json.raw)),this.parse(this.raw),this},SpriteSheet.prototype.fromJSON=function(json){return Asset.prototype.fromJSON.call(this,json),!json.src&&json.raw&&(this.raw=JSON.parse(json.raw)),this.parse(this.raw),this},SpriteSheet}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/texture",["odin/core/assets/asset"],function(Asset){function Texture(opts){opts||(opts={}),Asset.call(this,opts),this.width=0,this.height=0,this.invWidth=0,this.invHeight=0,this.anisotropy=void 0!=opts.anisotropy?opts.anisotropy:1,this.minFilter=void 0!=opts.minFilter?opts.minFilter:"LINEAR",this.magFilter=void 0!=opts.magFilter?opts.magFilter:"LINEAR",this.format=void 0!==opts.format?opts.format:"RGBA",this._needsUpdate=!0}Asset.extend(Texture),Texture.prototype.parse=function(raw){return Asset.prototype.parse.call(this,raw),this.width=raw.width,this.height=raw.height,this.invWidth=1/this.width,this.invHeight=1/this.height,this},Texture.prototype.setAnisotropy=function(value){this.anisotropy=value,this._needsUpdate=!0},Texture.prototype.setMinFilter=function(value){this.minFilter=value,this._needsUpdate=!0},Texture.prototype.setMagFilter=function(value){this.magFilter=value,this._needsUpdate=!0},Texture.prototype.setFormat=function(value){this.format=value,this._needsUpdate=!0};var CANVAS,CTX;return Texture.prototype.toJSON=function(json,pack){if(json=Asset.prototype.toJSON.call(this,json),(pack||!this.src)&&this.raw){if("undefined"==typeof window){json.raw=this.raw}else{var raw=this.raw,canvas=CANVAS||(CANVAS=document.createElement("canvas")),ctx=CTX||(CTX=CANVAS.getContext("2d"));canvas.width=raw.width,canvas.height=raw.height,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(raw,0,0),json.raw=canvas.toDataURL()}}return json.anisotropy=this.anisotropy,json.minFilter=this.minFilter,json.magFilter=this.magFilter,json.format=this.format,json.width=this.width,json.height=this.height,json.invWidth=this.invWidth,json.invHeight=this.invHeight,json},Texture.prototype.fromServerJSON=function(json){if(Asset.prototype.fromServerJSON.call(this,json),!json.src&&json.raw){if("undefined"==typeof window){this.raw=json.raw}else{var image=new Image;image.src=json.raw,this.raw=image}}return this.anisotropy=json.anisotropy,this.minFilter=json.minFilter,this.magFilter=json.magFilter,this.format=json.format,this.width=json.width,this.height=json.height,this.invWidth=json.invWidth,this.invHeight=json.invHeight,this},Texture.prototype.fromJSON=function(json){if(Asset.prototype.fromJSON.call(this,json),!json.src&&json.raw){if("undefined"==typeof window){this.raw=json.raw}else{var image=new Image;image.src=json.raw,this.raw=image}}return this.anisotropy=json.anisotropy,this.minFilter=json.minFilter,this.magFilter=json.magFilter,this.format=json.format,this.width=json.width,this.height=json.height,this.invWidth=json.invWidth,this.invHeight=json.invHeight,this},Texture}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/component",["odin/base/class","odin/base/util","odin/core/game/log"],function(Class,util,Log){function Component(type,opts){opts||(opts={}),Class.call(this),this._type=type||"UnknownComponent",this._name=camelize(this._type,!0),this.sync=void 0!=opts.sync?!!opts.sync:!1,this.json=void 0!=opts.json?!!opts.json:!0,this.gameObject=void 0}var camelize=util.camelize;return Class.extend(Component),Component.prototype.init=function(){},Component.prototype.update=function(){},Component.prototype.clear=function(){},Component.prototype.destroy=function(){return this.gameObject?(this.gameObject.removeComponent(this),this.emit("destroy"),this.clear(),this):(Log.error("Component.destroy: can't destroy Component if it's not added to a GameObject"),this)},Component.prototype.sort=function(a,b){return a===b?-1:1},Component.prototype.toSYNC=function(json){return json=Class.prototype.toSYNC.call(this,json)},Component.prototype.fromSYNC=function(){return this},Component.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.sync=this.sync,json.json=this.json,json},Component.prototype.fromServerJSON=function(json){return Class.prototype.fromServerJSON.call(this,json),this.sync=json.sync,this.json=json.json,this},Component.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.sync=json.sync,this.json=json.json,this},Component}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/color",["odin/math/mathf"],function(Mathf){function Color(r,g,b){this.r=0,this.g=0,this.b=0,this._r=0,this._g=0,this._b=0,this._hex="#000000",this._rgb="rgb(0,0,0)",this.set(r,g,b)}function singleToHEX(value){var str=(~~(255*clamp01(value))).toString(16);return 1===str.length?"0"+str:str}var colorNames,sqrt=Math.sqrt,floor=Math.floor,clamp01=Mathf.clamp01;return Color.prototype.clone=function(){return new Color(this.r,this.g,this.b)},Color.prototype.copy=function(other){return this.r=other.r,this.g=other.g,this.b=other.b,this},Color.prototype.set=function(r,g,b){var type=typeof r;return"number"===type?(this.r=r,this.g=g,this.b=b):"string"===type?this.setStyle(r):r instanceof Color&&(this.r=r.r,this.g=r.g,this.b=r.b),this},Color.prototype.setRGB=function(r,g,b){return this.r=r,this.g=g,this.b=b,this},Color.prototype.setStyle=function(){var rgb0255=/^rgb\((\d+),(\d+),(\d+)\)$/i,rgb0100=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i,hex6=/^\#([0-9a-f]{6})$/i,hex3=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,hex3to6=/#(.)(.)(.)/,hex3to6String="#$1$1$2$2$3$3",colorName=/^(\w+)$/i,inv255=1/255,inv100=.01;return function(style){var color;return rgb0255.test(style)?(color=rgb0255.exec(style),this.r=min(255,Number(color[1]))*inv255,this.g=min(255,Number(color[2]))*inv255,this.b=min(255,Number(color[3]))*inv255,this):rgb0100.test(style)?(color=rgb0100.exec(style),this.r=min(100,Number(color[1]))*inv100,this.g=min(100,Number(color[2]))*inv100,this.b=min(100,Number(color[3]))*inv100,this):hex6.test(style)?(this.r=parseInt(style.substr(1,2),16)*inv255,this.g=parseInt(style.substr(3,2),16)*inv255,this.b=parseInt(style.substr(5,2),16)*inv255,this):hex3.test(style)?(style=style.replace(hex3to6,hex3to6String),this.r=parseInt(style.substr(1,2),16)*inv255,this.g=parseInt(style.substr(3,2),16)*inv255,this.b=parseInt(style.substr(5,2),16)*inv255,this):colorName.test(style)?(style=colorNames[style],this.r=parseInt(style.substr(1,2),16)*inv255,this.g=parseInt(style.substr(3,2),16)*inv255,this.b=parseInt(style.substr(5,2),16)*inv255,this):this}}(),Color.prototype.toHEX=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var hexR=singleToHEX(this.r),hexG=singleToHEX(this.g),hexB=singleToHEX(this.b);this._r=this.r,this._g=this.g,this._b=this.b,this._hex="#"+hexR+hexG+hexB,this._rgb="rgb("+floor(256*clamp01(this.r))+","+floor(256*clamp01(this.g))+","+floor(256*clamp01(this.b))+")"}return this._hex},Color.prototype.toRGB=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var r=floor(256*clamp01(this.r)),g=floor(256*clamp01(this.g)),b=floor(256*clamp01(this.b));this._r=this.r,this._g=this.g,this._b=this.b,this._rgb="rgb("+r+","+g+","+b+")",this._hex="#"+singleToHEX(this.r)+singleToHEX(this.g)+singleToHEX(this.b)}return this._rgb},Color.prototype.add=function(other){return this.r+=other.r,this.g+=other.g,this.b+=other.b,this},Color.prototype.cadd=function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},Color.prototype.sadd=function(s){return this.r+=s,this.g+=s,this.b+=s,this},Color.prototype.sub=function(other){return this.r-=other.r,this.g-=other.g,this.b-=other.b,this},Color.prototype.csub=function(a,b){return this.r=a.r-b.r,this.g=a.g-b.g,this.b=a.b-b.b,this},Color.prototype.ssub=function(s){return this.r-=s,this.g-=s,this.b-=s,this},Color.prototype.mul=function(other){return this.r*=other.r,this.g*=other.g,this.b*=other.b,this},Color.prototype.cmul=function(a,b){return this.r=a.r*b.r,this.g=a.g*b.g,this.b=a.b*b.b,this},Color.prototype.smul=function(s){return this.r*=s,this.g*=s,this.b*=s,this},Color.prototype.div=function(other){var x=other.r,y=other.g,z=other.b;return this.r*=0!==x?1/x:0,this.g*=0!==y?1/y:0,this.b*=0!==z?1/z:0,this},Color.prototype.cdiv=function(a,b){var x=b.r,y=b.g,z=b.b;return this.r=0!==x?a.r/x:0,this.g=0!==y?a.g/y:0,this.b=0!==z?a.b/z:0,this},Color.prototype.sdiv=function(s){return s=0===s?0:1/s,this.r*=s,this.g*=s,this.b*=s,this},Color.prototype.length=function(){var r=this.r,g=this.g,b=this.b,l=r*r+g*g+b*b;return l>0?1/sqrt(l):0},Color.prototype.lengthSq=function(){var r=this.r,g=this.g,b=this.b;return r*r+g*g+b*b},Color.prototype.normalize=function(){var r=this.r,g=this.g,b=this.b,l=r*r+g*g+b*b;return l=l>0?1/sqrt(l):0,this.r*=l,this.g*=l,this.b*=l,this},Color.prototype.check=function(){var r=this.r,g=this.g,b=this.b;return this.r=r>1?1:r,this.g=g>1?1:g,this.b=b>1?1:b,this},Color.prototype.lerp=function(other,x){return this.r+=(other.r-this.r)*x,this.g+=(other.g-this.g)*x,this.b+=(other.b-this.b)*x,this},Color.prototype.clerp=function(a,b,x){var ax=a.r,ay=a.g,az=a.b;return this.r=ax+(b.r-ax)*x,this.g=ay+(b.g-ay)*x,this.b=az+(b.b-az)*x,this},Color.prototype.min=function(other){var ar=this.r,ag=this.g,ab=this.b,br=other.r,bg=other.g,bb=other.b;return this.r=ar>br?br:ar,this.g=ag>bg?bg:ag,this.b=ab>bb?bb:ab,this},Color.prototype.max=function(other){var ar=this.r,ag=this.g,ab=this.b,br=other.r,bg=other.g,bb=other.b;return this.r=br>ar?br:ar,this.g=bg>ag?bg:ag,this.b=bb>ab?bb:ab,this},Color.prototype.fromVec2=function(v){return this.r=v.x,this.g=v.y,this.b=0,this},Color.prototype.fromVec3=function(v){return this.r=v.x,this.g=v.y,this.b=v.z,this},Color.prototype.fromVec4=Color.prototype.fromVec3,Color.prototype.fromJSON=function(json){return this.r=json.r,this.g=json.g,this.b=json.b,this},Color.prototype.toJSON=function(json){return json||(json={}),json.r=this.r,json.g=this.g,json.b=this.b,json},Color.prototype.fromArray=function(array){return this.r=array[0],this.g=array[1],this.b=array[2],this
},Color.prototype.toArray=function(array){return array||(array=[]),array[0]=this.r,array[1]=this.g,array[2]=this.b,array},Color.prototype.toString=function(){return"Color( "+this.r+", "+this.g+", "+this.b+" )"},colorNames=Color.colorNames={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Color}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/enums",["odin/base/enum"],function(Enum){return{AxisType:new Enum("Button Mouse MouseWheel Touch Joystick"),Blending:new Enum("Default None Additive Subtractive Muliply"),EmitterType:new Enum("Circle CircleEdge Box BoxEdge"),FontStyle:new Enum("Normal Bold Italic BoldAnditalic"),TextClipping:new Enum("Overflow Clip"),TextAnchor:new Enum("UpperLeft UpperCenter UpperRight MiddleLeft MiddleCenter MiddleRight LowerLeft LowerCenter LowerRight"),WrapMode:new Enum("Once Loop PingPong Clamp")}}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/tween",[],function(){function Tween(opts){opts||(opts={}),this.times=opts.times||[],this.values=opts.values||[]}return Tween.prototype.copy=function(other){return this.times=other.times.slice(),this.values=other.values.slice(),this},Tween.prototype.clear=function(){return this.times.length=0,this.values.length=0,this},Tween.prototype.update=function(time,out){for(var t,times=this.times,values=this.values,i=0,n=times.length;n>i&&time>times[i];){i++}return 0===i?values[0]:i===n?values[n-1]:(t=(time-times[i-1])/(times[i]-times[i-1]),out?out.copy(values[i-1]).lerp(values[i],t):values[i-1]+t*(values[i]-values[i-1]))},Tween.prototype.toJSON=function(json){json||(json={});var i,times=this.times,values=this.values,jsonTimes=json.times||(json.times=[]),jsonValues=json.values||(json.values=[]);for(i=times.length;i--;){jsonTimes[i]=times[i]}for(i=values.length;i--;){jsonValues[i]=values[i].toJSON?values[i].toJSON(jsonValues[i]):values[i]}return json},Tween.prototype.fromJSON=function(json){var i,times=this.times,values=this.values,jsonTimes=json.times,jsonValues=json.values;for(i=jsonTimes.length;i--;){times[i]=jsonTimes[i]}for(i=jsonValues.length;i--;){values[i]=jsonValues[i]}return this},Tween}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/particle_2d",["odin/math/vec2","odin/math/color"],function(Vec2,Color){function Particle2D(){this.alpha=1,this.lifeTime=0,this.life=1,this.size=1,this.color=new Color,this.position=new Vec2,this.velocity=new Vec2,this.acceleration=new Vec2,this.angle=0,this.angularVelocity=0,this.angularAcceleration=0}return Particle2D.prototype.update=function(dt){var pos=this.position,vel=this.velocity,acc=this.acceleration;pos.x+=vel.x*dt,pos.y+=vel.y*dt,vel.x+=acc.x*dt,vel.y+=acc.y*dt,this.angle+=this.angularVelocity*dt,this.angularVelocity+=this.angularAcceleration*dt,this.lifeTime+=dt},Particle2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/emitter_2d",["odin/base/object_pool","odin/base/class","odin/math/mathf","odin/math/vec2","odin/math/color","odin/core/enums","odin/core/assets/assets","odin/core/components/particle_system/tween","odin/core/components/particle_system/particle_2d"],function(ObjectPool,Class,Mathf,Vec2,Color,Enums,Assets,Tween,Particle2D){function Emitter2D(opts){opts||(opts={}),Class.call(this),this.positionType=void 0!=opts.positionType?opts.positionType:EmitterType.Box,this.velocityType=void 0!=opts.velocityType?opts.velocityType:EmitterType.Box,this.blending=void 0!=opts.blending?opts.blending:Enums.Blending.Default,this.texture=void 0!=opts.texture?opts.texture:void 0,this.positionSpread=void 0!=opts.positionSpread?opts.positionSpread:new Vec2(.5,.5),this.positionRadius=void 0!=opts.positionRadius?opts.positionRadius:.5,this.speed=void 0!=opts.speed?opts.speed:0,this.speedSpread=void 0!=opts.speedSpread?opts.speedSpread:0,this.particleSystem=void 0,this.transform=void 0,this.worldSpace=void 0!=opts.worldSpace?opts.worldSpace:!0,this.position=void 0!=opts.position?opts.position:new Vec2,this.minEmission=void 0!=opts.minEmission?opts.minEmission:1,this.maxEmission=void 0!=opts.maxEmission?opts.maxEmission:2,this.minLife=void 0!=opts.minLife?opts.minLife:1,this.maxLife=void 0!=opts.maxLife?opts.maxLife:2,this.minSize=void 0!=opts.minSize?opts.minSize:.1,this.maxSize=void 0!=opts.maxSize?opts.maxSize:.5,this.sizeTween=new Tween(opts.sizeTween),this.alphaTween=new Tween(opts.alphaTween),this.colorTween=new Tween(opts.colorTween),this.velocity=void 0!=opts.velocity?opts.velocity:new Vec2,this.velocitySpread=void 0!=opts.velocitySpread?opts.velocitySpread:new Vec2,this.acceleration=void 0!=opts.acceleration?opts.acceleration:new Vec2,this.accelerationSpread=void 0!=opts.accelerationSpread?opts.accelerationSpread:new Vec2,this.angularVelocity=void 0!=opts.angularVelocity?opts.angularVelocity:0,this.angularVelocitySpread=void 0!=opts.angularVelocitySpread?opts.angularVelocitySpread:0,this.angularAcceleration=void 0!=opts.angularAcceleration?opts.angularAcceleration:0,this.angularAccelerationSpread=void 0!=opts.angularAccelerationSpread?opts.angularAccelerationSpread:0,this.randomAngle=void 0!=opts.randomAngle?opts.randomAngle:!0,this.emissionRate=void 0!=opts.emissionRate?opts.emissionRate:1/60,this.color=void 0!=opts.color?opts.color:new Color,this.colorSpread=void 0!=opts.colorSpread?opts.colorSpread:new Color,this.time=void 0!=opts.time?opts.time:0,this._time=0,this.duration=void 0!=opts.duration?opts.duration:0,this.loop=void 0!=opts.loop?opts.loop:!0,this.playing=void 0!=opts.playing?opts.playing:!0,this.emitting=void 0!=opts.emitting?opts.emitting:!0,this.particles=[]}var VEC,EmitterType=Enums.EmitterType,PI=Math.PI,TWO_PI=2*PI,random=Math.random,floor=Math.floor,randInt=Mathf.randInt,randFloat=Mathf.randFloat,clampTop=Mathf.clampTop,cos=Math.cos,sin=Math.sin,sqrt=Math.sqrt,PARTICLE_POOL=Emitter2D.PARTICLE_POOL=new ObjectPool(Particle2D);return Class.extend(Emitter2D),Emitter2D.prototype.copy=function(other){return this.positionType=other.positionType,this.velocityType=other.velocityType,this.blending=other.blending,this.texture=other.texture,this.position.copy(other.position),this.positionSpread.copy(other.positionSpread),this.positionRadius=other.positionRadius,this.speed=other.speed,this.speedSpread=other.speedSpread,this.worldSpace=other.worldSpace,this.minEmission=other.minEmission,this.maxEmission=other.maxEmission,this.minLife=other.minLife,this.maxLife=other.maxLife,this.minSize=other.minSize,this.maxSize=other.maxSize,this.sizeTween.copy(other.sizeTween),this.alphaTween.copy(other.alphaTween),this.colorTween.copy(other.colorTween),this.velocity.copy(other.velocity),this.velocitySpread.copy(other.velocitySpread),this.acceleration.copy(other.acceleration),this.accelerationSpread.copy(other.accelerationSpread),this.angularVelocity=other.angularVelocity,this.angularVelocitySpread=other.angularVelocitySpread,this.angularAcceleration=other.angularAcceleration,this.angularAccelerationSpread=other.angularAccelerationSpread,this.randomAngle=other.randomAngle,this.emissionRate=other.emissionRate,this.color.copy(other.color),this.colorSpread.copy(other.colorSpread),this.time=other.time,this._time=other._time,this.duration=other.duration,this.loop=other.loop,this.playing=other.playing,this.emitting=other.emitting,this},Emitter2D.prototype.play=function(){return this.time=0,this.playing=!0,this.emitting=!0,this},Emitter2D.prototype.clear=function(){var particles=this.particles,i=particles.length;for(this.transform=void 0,this.time=0,this._time=0,this.playing=!1,this.emitting=!1;i--;){PARTICLE_POOL.removeObject(particles[i])}return particles.length=0,this},VEC=new Vec2,Emitter2D.prototype.spawn=function(count){for(var vel,acc,pos,col,angle,u,r,dx,dy,spd,particle,transform=this.transform||(this.transform=this.particleSystem.gameObject.transform||this.particleSystem.gameObject.transform2d),transformPosition=transform.toWorld(VEC.set(0,0)),position=this.position,positionSpread=this.positionSpread,positionRadius=this.positionRadius,speed=this.speed,speedSpread=this.speedSpread,particles=this.particles,numParticle2Ds=particles.length,worldSpace=this.worldSpace,randomAngle=this.randomAngle,color=this.color,colorSpread=this.colorSpread,useRandColor=colorSpread.lengthSq()>0,velocity=this.velocity,velocitySpread=this.velocitySpread,acceleration=this.acceleration,accelerationSpread=this.accelerationSpread,angularVelocity=this.angularVelocity,angularVelocitySpread=this.angularVelocitySpread,angularAcceleration=this.angularAcceleration,angularAccelerationSpread=this.angularAccelerationSpread,minLife=this.minLife,maxLife=this.maxLife,minSize=this.minSize,maxSize=this.maxSize,positionType=this.positionType,velocityType=this.velocityType,posx=randFloat(-positionSpread.x,positionSpread.x),posy=randFloat(-positionSpread.y,positionSpread.y),limit=clampTop(numParticle2Ds+count,Emitter2D.MAX_PARTICLES)-numParticle2Ds;limit--;){switch(particle=PARTICLE_POOL.create(),pos=particle.position,vel=particle.velocity,acc=particle.acceleration,col=particle.color,col.r=color.r,col.g=color.g,col.b=color.b,useRandColor&&(col.r+=colorSpread.r*random(),col.g+=colorSpread.g*random(),col.b+=colorSpread.b*random(),col.check()),worldSpace?(pos.x=position.x+transformPosition.x,pos.y=position.y+transformPosition.y):(pos.x=position.x,pos.y=position.y),positionType){case EmitterType.Box:pos.x+=randFloat(-positionSpread.x,positionSpread.x),pos.y+=randFloat(-positionSpread.y,positionSpread.y);break;case EmitterType.BoxEdge:switch(floor(4*random())){case 0:pos.x+=randFloat(-positionSpread.x,positionSpread.x),pos.y+=positionSpread.y;break;case 1:pos.x+=positionSpread.x,pos.y+=randFloat(-positionSpread.y,positionSpread.y);break;case 2:pos.x+=randFloat(-positionSpread.x,positionSpread.x),pos.y+=-positionSpread.y;break;case 3:pos.x+=-positionSpread.x,pos.y+=randFloat(-positionSpread.y,positionSpread.y)}break;case EmitterType.Circle:angle=TWO_PI*random(),u=random()+random(),r=u>1?2-u:u,pos.x+=posx+r*cos(angle)*positionRadius,pos.y+=posy+r*sin(angle)*positionRadius;break;case EmitterType.CircleEdge:angle=TWO_PI*random(),pos.x+=posx+cos(angle)*positionRadius,pos.y+=posy+sin(angle)*positionRadius}switch(velocityType){case EmitterType.Box:case EmitterType.BoxEdge:vel.x=velocity.x+randFloat(-velocitySpread.x,velocitySpread.x),vel.y=velocity.y+randFloat(-velocitySpread.y,velocitySpread.y);break;case EmitterType.Circle:case EmitterType.CircleEdge:worldSpace?(dx=pos.x-(position.x+transformPosition.x),dy=pos.y-(position.y+transformPosition.y)):(dx=pos.x-position.x,dy=pos.y-position.y),spd=speed+randFloat(-speedSpread,speedSpread),r=dx*dx+dy*dy,r=0!==r?1/sqrt(r):r,vel.x=dx*r*spd,vel.y=dy*r*spd}acc.x=acceleration.x+randFloat(-accelerationSpread.x,accelerationSpread.x),acc.y=acceleration.y+randFloat(-accelerationSpread.y,accelerationSpread.y),particle.angularVelocity=angularVelocity+randFloat(-angularVelocitySpread,angularVelocitySpread),particle.angularAcceleration=angularAcceleration+randFloat(-angularAccelerationSpread,angularAccelerationSpread),particle.alpha=1,particle.angle=randomAngle?random()*TWO_PI:0,particle.lifeTime=0,particle.life=randFloat(minLife,maxLife),particle.size=randFloat(minSize,maxSize),particles.push(particle)}},Emitter2D.prototype.update=function(dt){if(this.playing){var particle,life,count,i,particles=this.particles,sizeTween=this.sizeTween,alphaTween=this.alphaTween,colorTween=this.colorTween,sizeTweenUpdate=sizeTween.times.length>0,alphaTweenUpdate=alphaTween.times.length>0,colorTweenUpdate=colorTween.times.length>0;for(this.time+=dt,this._time+=dt,count=this._time/this.emissionRate,this.emitting&&count>=1&&(this._time=0,this.spawn(randInt(this.minEmission,this.maxEmission)*floor(count)),!this.loop&&this.time>this.duration&&(this.emitting=!1)),i=particles.length;i--;){particle=particles[i],particle.update(dt),life=particle.lifeTime/particle.life,sizeTweenUpdate&&(particle.size=sizeTween.update(life)),alphaTweenUpdate&&(particle.alpha=alphaTween.update(life)),colorTweenUpdate&&colorTween.update(life,particle.color),life>1&&(PARTICLE_POOL.removeObject(particle),particles.splice(i,1))}this.emitting||0!==particles.length||(this.playing=!1)}},Emitter2D.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.type=1,json.positionType=this.positionType,json.velocityType=this.velocityType,json.blending=this.blending,json.texture=this.texture?this.texture.name:void 0,json.position=this.position.toJSON(json.position),json.positionSpread=this.positionSpread.toJSON(json.positionSpread),json.positionRadius=this.positionRadius,json.speed=this.speed,json.speedSpread=this.speedSpread,json.worldSpace=this.worldSpace,json.minEmission=this.minEmission,json.maxEmission=this.maxEmission,json.minLife=this.minLife,json.maxLife=this.maxLife,json.minSize=this.minSize,json.maxSize=this.maxSize,json.sizeTween=this.sizeTween.toJSON(json.sizeTween),json.alphaTween=this.alphaTween.toJSON(json.alphaTween),json.colorTween=this.colorTween.toJSON(json.colorTween),json.velocity=this.velocity.toJSON(json.velocity),json.velocitySpread=this.velocitySpread.toJSON(json.velocitySpread),json.acceleration=this.acceleration.toJSON(json.acceleration),json.accelerationSpread=this.accelerationSpread.toJSON(json.accelerationSpread),json.angularVelocity=this.angularVelocity,json.angularAcceleration=this.angularAcceleration,json.angularVelocitySpread=this.angularVelocitySpread,json.randomAngle=this.randomAngle,json.emissionRate=this.emissionRate,json.color=this.color.toJSON(json.color),json.colorSpread=this.colorSpread.toJSON(json.colorSpread),json.time=this.time,json._time=this._time,json.duration=this.duration,json.loop=this.loop,json.playing=this.playing,json.emitting=this.emitting,json},Emitter2D.prototype.fromServerJSON=function(json){return Class.prototype.fromServerJSON.call(this,json),this.positionType=json.positionType,this.velocityType=json.velocityType,this.blending=json.blending,this.texture=json.texture?Assets.hash[json.texture]:void 0,this.position.fromJSON(json.position),this.positionSpread.fromJSON(json.positionSpread),this.positionRadius=json.positionRadius,this.speed=json.speed,this.speedSpread=json.speedSpread,this.worldSpace=json.worldSpace,this.minEmission=json.minEmission,this.maxEmission=json.maxEmission,this.minLife=json.minLife,this.maxLife=json.maxLife,this.minSize=json.minSize,this.maxSize=json.maxSize,this.sizeTween.fromJSON(json.sizeTween),this.alphaTween.fromJSON(json.alphaTween),this.colorTween.fromJSON(json.colorTween),this.velocity.fromJSON(json.velocity),this.velocitySpread.fromJSON(json.velocitySpread),this.acceleration.fromJSON(json.acceleration),this.accelerationSpread.fromJSON(json.accelerationSpread),this.angularVelocity=json.angularVelocity,this.angularAcceleration=json.angularAcceleration,this.angularVelocitySpread=json.angularVelocitySpread,this.randomAngle=json.randomAngle,this.emissionRate=json.emissionRate,this.color.fromJSON(json.color),this.colorSpread.fromJSON(json.colorSpread),this.time=json.time,this._time=json._time,this.duration=json.duration,this.loop=json.loop,this.playing=json.playing,this.emitting=json.emitting,this},Emitter2D.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.positionType=json.positionType,this.velocityType=json.velocityType,this.blending=json.blending,this.texture=json.texture?Assets.hash[json.texture]:void 0,this.position.fromJSON(json.position),this.positionSpread.fromJSON(json.positionSpread),this.positionRadius=json.positionRadius,this.speed=json.speed,this.speedSpread=json.speedSpread,this.worldSpace=json.worldSpace,this.minEmission=json.minEmission,this.maxEmission=json.maxEmission,this.minLife=json.minLife,this.maxLife=json.maxLife,this.minSize=json.minSize,this.maxSize=json.maxSize,this.sizeTween.fromJSON(json.sizeTween),this.alphaTween.fromJSON(json.alphaTween),this.colorTween.fromJSON(json.colorTween),this.velocity.fromJSON(json.velocity),this.velocitySpread.fromJSON(json.velocitySpread),this.acceleration.fromJSON(json.acceleration),this.accelerationSpread.fromJSON(json.accelerationSpread),this.angularVelocity=json.angularVelocity,this.angularAcceleration=json.angularAcceleration,this.angularVelocitySpread=json.angularVelocitySpread,this.randomAngle=json.randomAngle,this.emissionRate=json.emissionRate,this.color.fromJSON(json.color),this.colorSpread.fromJSON(json.colorSpread),this.time=json.time,this._time=json._time,this.duration=json.duration,this.loop=json.loop,this.playing=json.playing,this.emitting=json.emitting,this},Emitter2D.MAX_PARTICLES=1024,Emitter2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/particle_system",["odin/base/class","odin/base/time","odin/core/components/component","odin/core/components/particle_system/emitter_2d","odin/core/components/particle_system/tween"],function(Class,Time,Component,Emitter2D,Tween){function ParticleSystem(opts){opts||(opts={}),Component.call(this,"ParticleSystem",opts),this.playing=void 0!=opts.playing?opts.playing:!0,this.emitters=[],this._emitterHash={},this._emitterServerHash={},opts.emitter&&this.addEmitter(opts.emitter),opts.emitters&&this.add.apply(this,opts.emitters)}return ParticleSystem.type="ParticleSystem",Component.extend(ParticleSystem),ParticleSystem.Emitter2D=Emitter2D,ParticleSystem.Tween=Tween,ParticleSystem.prototype.copy=function(other){var otherEmitters=other.emitters,i=0,il=otherEmitters.length;for(this.clear();il>i;i++){this.addEmitter(otherEmitters[i].clone())}return this.playing=other.playing,this},ParticleSystem.prototype.clear=function(){for(var emitters=this.emitters,i=emitters.length;i--;){this.removeEmitter(emitters[i])}return this},ParticleSystem.prototype.addEmitter=function(emitter){var emitters=this.emitters,index=emitters.indexOf(emitter);return-1===index?(emitter.particleSystem&&(emitter=emitter.clone()),emitter.particleSystem=this,emitters.push(emitter),this._emitterHash[emitter._id]=emitter,-1!==emitter._serverId&&(this._emitterHash[emitter._serverId]=emitter)):Log.error("ParticleSystem.addEmitter: ParticleSystem already has passed Emitter"),this},ParticleSystem.prototype.add=function(){for(var i=arguments.length;i--;){this.addEmitter(arguments[i])}return this},ParticleSystem.prototype.removeEmitter=function(emitter){var emitters=this.emitters,index=emitters.indexOf(emitter);return-1!==index?(emitters.splice(index,1),this._emitterHash[emitter._id]=void 0,-1!==emitter._serverId&&(this._emitterHash[emitter._serverId]=void 0),emitter.clear(),emitter.particleSystem=void 0,emitter.transform=void 0):Log.error("ParticleSystem.removeEmitter: ParticleSystem does not have passed Emitter"),this},ParticleSystem.prototype.remove=function(){for(var i=arguments.length;i--;){this.removeEmitter(arguments[i])}return this},ParticleSystem.prototype.findEmitterById=function(id){return this._emitterHash[id]},ParticleSystem.prototype.findEmitterByServerId=function(id){return this._emitterServerHash[id]},ParticleSystem.prototype.play=function(){var i,emitters=this.emitters;for(i=emitters.length;i--;){emitters[i].play()}return this.playing=!0,this},ParticleSystem.prototype.update=function(){if(!this.isServer&&this.playing){var emitter,i,dt=Time.delta,emitters=this.emitters,playing=!1;for(i=emitters.length;i--;){emitter=emitters[i],emitter.update(dt),emitter.playing&&(playing=!0)}this.playing=playing}},ParticleSystem.prototype.toJSON=function(json){json=Component.prototype.toJSON.call(this,json);for(var emitters=this.emitters,jsonEmitters=json.emitters||(json.emitters=[]),i=0,il=emitters.length;il>i;i++){jsonEmitters[i]=emitters[i].toJSON(jsonEmitters[i])}return json.playing=this.playing,json},ParticleSystem.prototype.fromServerJSON=function(json){Component.prototype.fromServerJSON.call(this,json);for(var emitter,jsonEmitter,jsonEmitters=json.emitters,i=0,il=jsonEmitters.length;il>i;i++){jsonEmitter=jsonEmitters[i],(emitter=this.findEmitterByServerId(jsonEmitter._id))?emitter.fromServerJSON(jsonEmitter):this.addEmitter(Class.fromServerJSON(jsonEmitter))}return this.playing=json.playing,this},ParticleSystem.prototype.fromJSON=function(json){Component.prototype.fromJSON.call(this,json);for(var emitter,jsonEmitter,jsonEmitters=json.emitters,i=0,il=jsonEmitters.length;il>i;i++){jsonEmitter=jsonEmitters[i],(emitter=this.findEmitterById(jsonEmitter._id))?emitter.fromJSON(jsonEmitter):this.addEmitter(Class.fromJSON(jsonEmitter))}return this.playing=json.playing,this},ParticleSystem}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/vec3",[],function(){function Vec3(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0}var sqrt=Math.sqrt;return Vec3.prototype.clone=function(){return new Vec3(this.x,this.y,this.z)},Vec3.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this.z=other.z,this},Vec3.prototype.set=function(x,y,z){return this.x=x,this.y=y,this.z=z,this},Vec3.prototype.add=function(other){return this.x+=other.x,this.y+=other.y,this.z+=other.z,this},Vec3.prototype.vadd=function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},Vec3.prototype.sadd=function(s){return this.x+=s,this.y+=s,this.z+=s,this},Vec3.prototype.sub=function(other){return this.x-=other.x,this.y-=other.y,this.z-=other.z,this},Vec3.prototype.vsub=function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},Vec3.prototype.ssub=function(s){return this.x-=s,this.y-=s,this.z-=s,this},Vec3.prototype.mul=function(other){return this.x*=other.x,this.y*=other.y,this.z*=other.z,this},Vec3.prototype.vmul=function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},Vec3.prototype.smul=function(s){return this.x*=s,this.y*=s,this.z*=s,this},Vec3.prototype.div=function(other){var x=other.x,y=other.y,z=other.z;return this.x*=0!==x?1/x:0,this.y*=0!==y?1/y:0,this.z*=0!==z?1/z:0,this},Vec3.prototype.vdiv=function(a,b){var x=b.x,y=b.y,z=b.z;return this.x=0!==x?a.x/x:0,this.y=0!==y?a.y/y:0,this.z=0!==z?a.z/z:0,this},Vec3.prototype.sdiv=function(s){return s=0===s?0:1/s,this.x*=s,this.y*=s,this.z*=s,this},Vec3.prototype.length=function(){var x=this.x,y=this.y,z=this.z,lsq=x*x+y*y+z*z;return 1===lsq?1:0===lsq?0:sqrt(lsq)},Vec3.prototype.lengthSq=function(){var x=this.x,y=this.y,z=this.z;return x*x+y*y+z*z},Vec3.prototype.setLength=function(length){var x=this.x,y=this.y,z=this.z,l=x*x+y*y+z*z;return 1===l?(this.x*=length,this.y*=length,this.z*=length,this):(l=l>0?1/sqrt(l):0,this.x*=l*length,this.y*=l*length,this.z*=l*length,this)},Vec3.prototype.normalize=function(){var x=this.x,y=this.y,z=this.z,l=x*x+y*y+z*z;return 1===l?this:(l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this.z*=l,this)},Vec3.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},Vec3.prototype.inverseVec=function(other){return this.x=-other.x,this.y=-other.y,this.z=-other.z,this},Vec3.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this},Vec3.prototype.vlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this},Vec3.vdot=Vec3.prototype.vdot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},Vec3.prototype.dot=function(other){return this.x*other.x+this.y*other.y+this.z*other.z},Vec3.vcross=Vec3.prototype.vcross=function(a,b){var ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this},Vec3.prototype.cross=function(other){var ax=this.x,ay=this.y,az=this.z,bx=other.x,by=other.y,bz=other.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this},Vec3.prototype.min=function(other){var ax=this.x,ay=this.y,az=this.z,bx=other.x,by=other.y,bz=other.z;return this.x=ax>bx?bx:ax,this.y=ay>by?by:ay,this.z=az>bz?bz:az,this},Vec3.prototype.max=function(other){var ax=this.x,ay=this.y,az=this.z,bx=other.x,by=other.y,bz=other.z;return this.x=bx>ax?bx:ax,this.y=by>ay?by:ay,this.z=bz>az?bz:az,this},Vec3.prototype.clamp=function(min,max){var x=this.x,y=this.y,z=this.z,minx=min.x,miny=min.y,minz=min.z,maxx=max.x,maxy=max.y,maxz=max.z;return this.x=minx>x?minx:x>maxx?maxx:x,this.y=miny>y?miny:y>maxy?maxy:y,this.z=minz>z?minz:z>maxz?maxz:z,this},Vec3.prototype.transformMat3=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z;return this.x=x*me[0]+y*me[3]+z*me[6],this.y=x*me[1]+y*me[4]+z*me[7],this.z=x*me[2]+y*me[5]+z*me[8],this},Vec3.prototype.transformMat4=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z;return this.x=x*me[0]+y*me[4]+z*me[8]+me[12],this.y=x*me[1]+y*me[5]+z*me[9]+me[13],this.z=x*me[2]+y*me[6]+z*me[10]+me[14],this},Vec3.prototype.transformQuat=function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this},Vec3.prototype.fromVec2=function(v){return this.x=v.x,this.y=v.y,this.z=0,this},Vec3.prototype.fromVec4=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},Vec3.prototype.positionFromMat4=function(m){var me=m.elements;return this.x=me[12],this.y=me[13],this.z=me[14],this},Vec3.prototype.scaleFromMat3=function(m){var me=m.elements,x=this.set(me[0],me[3],me[6]).length(),y=this.set(me[1],me[4],me[7]).length(),z=this.set(me[2],me[5],me[8]).length();return this.x=x,this.y=y,this.z=z,this},Vec3.prototype.scaleFromMat4=function(m){var me=m.elements,x=this.set(me[0],me[4],me[8]).length(),y=this.set(me[1],me[5],me[9]).length(),z=this.set(me[2],me[6],me[10]).length();return this.x=x,this.y=y,this.z=z,this},Vec3.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.z=json.z,this},Vec3.prototype.toJSON=function(json){return json||(json={}),json.x=this.x,json.y=this.y,json.z=this.z,json},Vec3.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this.z=array[2],this},Vec3.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array[2]=this.z,array},Vec3.prototype.toString=function(){return"Vec3( "+this.x+", "+this.y+", "+this.z+" )"},Vec3}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/audio_source",["odin/base/audio_ctx","odin/base/time","odin/math/mathf","odin/math/vec2","odin/math/vec3","odin/core/assets/assets","odin/core/components/component"],function(AudioCtx,Time,Mathf,Vec2,Vec3,Assets,Component){function AudioSource(opts){opts||(opts={}),Component.call(this,"AudioSource",opts),this.clip=opts.clip,this._source=void 0,this._gain=void 0,this._panner=void 0,this.dopplerLevel=void 0!=opts.dopplerLevel?opts.dopplerLevel:1,this._loop=void 0!=opts.loop?!!opts.loop:!1,this.maxDistance=void 0!=opts.maxDistance?opts.maxDistance:15,this.minDistance=void 0!=opts.minDistance?opts.minDistance:1,this.offset=void 0!=opts.offset?opts.offset:new Vec3,this.pitch=void 0!=opts.pitch?opts.pitch:0,this.playOnInit=void 0!=opts.playOnInit?!!opts.playOnInit:!1,this.spread=void 0!=opts.spread?opts.spread:0,this.time=void 0!=opts.time?opts.time:0,this._volume=void 0!=opts.volume?opts.volume:1,this.playing=!1,this.stopped=!1,this.paused=!1,this._startTime=0;var self=this;this._onended=function(){self.playing=!1,self.time=0}}var VEC2,VEC3,now=Time.now,clamp01=Mathf.clamp01,defineProperty=Object.defineProperty;return AudioSource.type="AudioSource",Component.extend(AudioSource),defineProperty(AudioSource.prototype,"volume",{get:function(){return this._volume},set:function(value){this._volume=clamp01(value),this._gain&&(this._gain.gain.value=this._volume)}}),defineProperty(AudioSource.prototype,"loop",{get:function(){return this._loop},set:function(value){this._loop=!!value,this._source&&(this._source.loop=this._loop)}}),AudioSource.prototype.copy=function(other){return this.clip=other.clip,this.dopplerLevel=other.dopplerLevel,this.loop=other.loop,this.maxDistance=other.maxDistance,this.minDistance=other.minDistance,this.offset.copy(other.offset),this.panLevel=other.panLevel,this.pitch=other.pitch,this.playOnInit=other.playOnInit,this.spread=other.spread,this.time=other.time,this.volume=other.volume,this.playing=!1,this.stopped=!1,this.paused=!1,this},AudioSource.prototype.clear=function(){this.playing&&this.stop(),this.clip=void 0,this._source=void 0,this._gain=void 0,this._panner=void 0},AudioSource.prototype.init=function(){this.playOnInit&&this.play()},VEC2=new Vec2,VEC3=new Vec3,AudioSource.prototype.update=function(){if(0!==this.dopplerLevel&&this.playing){var transform2d,transform,camera,cameraTransform,panner;(camera=this.gameObject.scene.game.camera)&&(panner=this._panner)&&(transform=this.transform,transform2d=this.transform2d,cameraTransform=camera.transform||camera.transform2d,transform2d?(VEC2.vadd(transform2d.position,this.offset),VEC2.sub(cameraTransform.position),VEC2.smul(this.dopplerLevel),panner.setPosition(VEC2.x,VEC2.y,camera.orthographicSize)):(VEC3.vadd(transform.position,this.offset),VEC3.sub(cameraTransform.position),VEC3.smul(this.dopplerLevel),panner.setPosition(VEC3.x,VEC3.y,VEC3.z||0)))}},AudioSource.prototype.play=function(delay,offset){return AudioCtx?(delay||(delay=0),offset||(offset=this.time),this._refresh(),this.playing=!0,this.stopped=!1,this.paused=!1,this._startTime=now(),this.time=offset,this._source.start(delay,this.time),this):this
},AudioSource.prototype.pause=function(){return AudioCtx?(this.playing=!1,this.stopped=!1,this.paused=!0,this.time=now()-this._startTime,this._source.stop(this.time),this):this},AudioSource.prototype.stop=function(){return AudioCtx?(this.time=0,this.playing=!1,this.stopped=!0,this.paused=!1,this._source.stop(this.time),this):this},AudioSource.prototype._refresh=function(){var source=this._source=AudioCtx.createBufferSource(),gain=this._gain=AudioCtx.createGain(),panner=this._panner=AudioCtx.createPanner();return gain.connect(AudioCtx.destination),panner.connect(gain),source.connect(panner),source.buffer=this.clip.raw,source.onended=this._onended,gain.gain.value=this.volume,source.loop=this.loop,this},AudioSource.prototype.toSYNC=function(json){return json=Component.prototype.toSYNC.call(this,json),json.playing=this.playing,json.stopped=this.stopped,json.paused=this.paused,json},AudioSource.prototype.fromSYNC=function(json){return Component.prototype.fromSYNC.call(this,json),json.stopped&&this.stop(),json.paused&&this.pause(),json.playing&&this.play(),this},AudioSource.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.clip=this.clip?this.clip.name:void 0,json.dopplerLevel=this.dopplerLevel,json.loop=this.loop,json.maxDistance=this.maxDistance,json.minDistance=this.minDistance,json.offset=this.offset.toJSON(json.offset),json.panLevel=this.panLevel,json.pitch=this.pitch,json.playOnInit=this.playOnInit,json.spread=this.spread,json.time=this.time,json.volume=this.volume,json},AudioSource.prototype.fromServerJSON=function(json){return Component.prototype.fromServerJSON.call(this,json),this.clip=json.clip?Assets.hash[json.clip]:void 0,this.dopplerLevel=json.dopplerLevel,this.loop=json.loop,this.maxDistance=json.maxDistance,this.minDistance=json.minDistance,this.offset.fromJSON(json.offset),this.panLevel=json.panLevel,this.pitch=json.pitch,this.playOnInit=json.playOnInit,this.spread=json.spread,this.time=json.time,this.volume=json.volume,this},AudioSource.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.clip=json.clip?Assets.hash[json.clip]:void 0,this.dopplerLevel=json.dopplerLevel,this.loop=json.loop,this.maxDistance=json.maxDistance,this.minDistance=json.minDistance,this.offset.fromJSON(json.offset),this.panLevel=json.panLevel,this.pitch=json.pitch,this.playOnInit=json.playOnInit,this.spread=json.spread,this.time=json.time,this.volume=json.volume,this},AudioSource}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat4",["odin/math/mathf","odin/math/vec3"],function(Mathf,Vec3){function Mat4(m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44){var te=new Float32Array(16);this.elements=te,te[0]=void 0!==m11?m11:1,te[4]=m12||0,te[8]=m13||0,te[12]=m14||0,te[1]=m21||0,te[5]=void 0!==m22?m22:1,te[9]=m23||0,te[13]=m24||0,te[2]=m31||0,te[6]=m32||0,te[10]=void 0!==m33?m33:1,te[14]=m34||0,te[3]=m41||0,te[7]=m42||0,te[11]=m43||0,te[15]=void 0!==m44?m44:1}var sqrt=Math.sqrt,cos=Math.cos,sin=Math.sin,tan=Math.tan,degsToRads=Mathf.degsToRads;return Mat4.prototype.clone=function(){var te=this.elements;return new Mat4(te[0],te[4],te[8],te[12],te[1],te[5],te[9],te[13],te[2],te[6],te[10],te[14],te[3],te[7],te[11],te[15])},Mat4.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],te[9]=me[9],te[10]=me[10],te[11]=me[11],te[12]=me[12],te[13]=me[13],te[14]=me[14],te[15]=me[15],this},Mat4.prototype.set=function(m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44){var te=this.elements;return te[0]=m11,te[4]=m12,te[8]=m13,te[12]=m14,te[1]=m21,te[5]=m22,te[9]=m23,te[13]=m24,te[2]=m31,te[6]=m32,te[10]=m33,te[14]=m34,te[3]=m41,te[7]=m42,te[11]=m43,te[15]=m44,this},Mat4.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return ae[0]=a11*b11+a12*b21+a13*b31+a14*b41,ae[4]=a11*b12+a12*b22+a13*b32+a14*b42,ae[8]=a11*b13+a12*b23+a13*b33+a14*b43,ae[12]=a11*b14+a12*b24+a13*b34+a14*b44,ae[1]=a21*b11+a22*b21+a23*b31+a24*b41,ae[5]=a21*b12+a22*b22+a23*b32+a24*b42,ae[9]=a21*b13+a22*b23+a23*b33+a24*b43,ae[13]=a21*b14+a22*b24+a23*b34+a24*b44,ae[2]=a31*b11+a32*b21+a33*b31+a34*b41,ae[6]=a31*b12+a32*b22+a33*b32+a34*b42,ae[10]=a31*b13+a32*b23+a33*b33+a34*b43,ae[14]=a31*b14+a32*b24+a33*b34+a34*b44,ae[3]=a41*b11+a42*b21+a43*b31+a44*b41,ae[7]=a41*b12+a42*b22+a43*b32+a44*b42,ae[11]=a41*b13+a42*b23+a43*b33+a44*b43,ae[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},Mat4.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return te[0]=a11*b11+a12*b21+a13*b31+a14*b41,te[4]=a11*b12+a12*b22+a13*b32+a14*b42,te[8]=a11*b13+a12*b23+a13*b33+a14*b43,te[12]=a11*b14+a12*b24+a13*b34+a14*b44,te[1]=a21*b11+a22*b21+a23*b31+a24*b41,te[5]=a21*b12+a22*b22+a23*b32+a24*b42,te[9]=a21*b13+a22*b23+a23*b33+a24*b43,te[13]=a21*b14+a22*b24+a23*b34+a24*b44,te[2]=a31*b11+a32*b21+a33*b31+a34*b41,te[6]=a31*b12+a32*b22+a33*b32+a34*b42,te[10]=a31*b13+a32*b23+a33*b33+a34*b43,te[14]=a31*b14+a32*b24+a33*b34+a34*b44,te[3]=a41*b11+a42*b21+a43*b31+a44*b41,te[7]=a41*b12+a42*b22+a43*b32+a44*b42,te[11]=a41*b13+a42*b23+a43*b33+a44*b43,te[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},Mat4.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,te[9]*=s,te[10]*=s,te[11]*=s,te[12]*=s,te[13]*=s,te[14]*=s,te[15]*=s,this},Mat4.prototype.sdiv=function(s){var te=this.elements;return s=0!==s?1/s:1,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,te[9]*=s,te[10]*=s,te[11]*=s,te[12]*=s,te[13]*=s,te[14]*=s,te[15]*=s,this},Mat4.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=1,te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=1,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=0,te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=0,this},Mat4.prototype.determinant=function(){var m11=ae[0],m12=ae[4],m13=ae[8],m14=ae[12],m21=ae[1],m22=ae[5],m23=ae[9],m24=ae[13],m31=ae[2],m32=ae[6],m33=ae[10],m34=ae[14],m41=ae[3],m42=ae[7],m43=ae[11],m44=ae[15];return m41*(m14*m23*m32-m13*m24*m32-m14*m22*m33+m12*m24*m33+m13*m22*m34-m12*m23*m34)+m42*(m11*m23*m34-m11*m24*m33+m14*m21*m33-m13*m21*m34+m13*m24*m31-m14*m23*m31)+m43*(m11*m24*m32-m11*m22*m34-m14*m21*m32+m12*m21*m34+m14*m22*m31-m12*m24*m31)+m44*(-m13*m22*m31-m11*m23*m32+m11*m22*m33+m13*m21*m32-m12*m21*m33+m12*m23*m31)},Mat4.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[4],m13=te[8],m14=te[12],m21=te[1],m22=te[5],m23=te[9],m24=te[13],m31=te[2],m32=te[6],m33=te[10],m34=te[14],m41=te[3],m42=te[7],m43=te[11],m44=te[15],m0=m23*m34*m42-m24*m33*m42+m24*m32*m43-m22*m34*m43-m23*m32*m44+m22*m33*m44,m4=m14*m33*m42-m13*m34*m42-m14*m32*m43+m12*m34*m43+m13*m32*m44-m12*m33*m44,m8=m13*m24*m42-m14*m23*m42+m14*m22*m43-m12*m24*m43-m13*m22*m44+m12*m23*m44,m12=m14*m23*m32-m13*m24*m32-m14*m22*m33+m12*m24*m33+m13*m22*m34-m12*m23*m34,det=m11*m0+m21*m4+m31*m8+m41*m12;return det=0===det?0:1/det,te[0]=m0*det,te[4]=m4*det,te[8]=m8*det,te[12]=m12*det,te[1]=(m24*m33*m41-m23*m34*m41-m24*m31*m43+m21*m34*m43+m23*m31*m44-m21*m33*m44)*det,te[5]=(m13*m34*m41-m14*m33*m41+m14*m31*m43-m11*m34*m43-m13*m31*m44+m11*m33*m44)*det,te[9]=(m14*m23*m41-m13*m24*m41-m14*m21*m43+m11*m24*m43+m13*m21*m44-m11*m23*m44)*det,te[13]=(m13*m24*m31-m14*m23*m31+m14*m21*m33-m11*m24*m33-m13*m21*m34+m11*m23*m34)*det,te[2]=(m22*m34*m41-m24*m32*m41+m24*m31*m42-m21*m34*m42-m22*m31*m44+m21*m32*m44)*det,te[6]=(m14*m32*m41-m12*m34*m41-m14*m31*m42+m11*m34*m42+m12*m31*m44-m11*m32*m44)*det,te[10]=(m12*m24*m41-m14*m22*m41+m14*m21*m42-m11*m24*m42-m12*m21*m44+m11*m22*m44)*det,te[14]=(m14*m22*m31-m12*m24*m31-m14*m21*m32+m11*m24*m32+m12*m21*m34-m11*m22*m34)*det,te[3]=(m23*m32*m41-m22*m33*m41-m23*m31*m42+m21*m33*m42+m22*m31*m43-m21*m32*m43)*det,te[7]=(m12*m33*m41-m13*m32*m41+m13*m31*m42-m11*m33*m42-m12*m31*m43+m11*m32*m43)*det,te[11]=(m13*m22*m41-m12*m23*m41-m13*m21*m42+m11*m23*m42+m12*m21*m43-m11*m22*m43)*det,te[15]=(m12*m23*m31-m13*m22*m31+m13*m21*m32-m11*m23*m32-m12*m21*m33+m11*m22*m33)*det,this},Mat4.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[4],m13=me[8],m14=me[12],m21=me[1],m22=me[5],m23=me[9],m24=me[13],m31=me[2],m32=me[6],m33=me[10],m34=me[14],m41=me[3],m42=me[7],m43=me[11],m44=me[15],m0=m23*m34*m42-m24*m33*m42+m24*m32*m43-m22*m34*m43-m23*m32*m44+m22*m33*m44,m4=m14*m33*m42-m13*m34*m42-m14*m32*m43+m12*m34*m43+m13*m32*m44-m12*m33*m44,m8=m13*m24*m42-m14*m23*m42+m14*m22*m43-m12*m24*m43-m13*m22*m44+m12*m23*m44,m12=m14*m23*m32-m13*m24*m32-m14*m22*m33+m12*m24*m33+m13*m22*m34-m12*m23*m34,det=m11*m0+m21*m4+m31*m8+m41*m12;return det=0===det?0:1/det,te[0]=m0*det,te[4]=m4*det,te[8]=m8*det,te[12]=m12*det,te[1]=(m24*m33*m41-m23*m34*m41-m24*m31*m43+m21*m34*m43+m23*m31*m44-m21*m33*m44)*det,te[5]=(m13*m34*m41-m14*m33*m41+m14*m31*m43-m11*m34*m43-m13*m31*m44+m11*m33*m44)*det,te[9]=(m14*m23*m41-m13*m24*m41-m14*m21*m43+m11*m24*m43+m13*m21*m44-m11*m23*m44)*det,te[13]=(m13*m24*m31-m14*m23*m31+m14*m21*m33-m11*m24*m33-m13*m21*m34+m11*m23*m34)*det,te[2]=(m22*m34*m41-m24*m32*m41+m24*m31*m42-m21*m34*m42-m22*m31*m44+m21*m32*m44)*det,te[6]=(m14*m32*m41-m12*m34*m41-m14*m31*m42+m11*m34*m42+m12*m31*m44-m11*m32*m44)*det,te[10]=(m12*m24*m41-m14*m22*m41+m14*m21*m42-m11*m24*m42-m12*m21*m44+m11*m22*m44)*det,te[14]=(m14*m22*m31-m12*m24*m31-m14*m21*m32+m11*m24*m32+m12*m21*m34-m11*m22*m34)*det,te[3]=(m23*m32*m41-m22*m33*m41-m23*m31*m42+m21*m33*m42+m22*m31*m43-m21*m32*m43)*det,te[7]=(m12*m33*m41-m13*m32*m41+m13*m31*m42-m11*m33*m42-m12*m31*m43+m11*m32*m43)*det,te[11]=(m13*m22*m41-m12*m23*m41-m13*m21*m42+m11*m23*m42+m12*m21*m43-m11*m22*m43)*det,te[15]=(m12*m23*m31-m13*m22*m31+m13*m21*m32-m11*m23*m32-m12*m21*m33+m11*m22*m33)*det,this},Mat4.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this},Mat4.prototype.setTrace=function(v){var te=this.elements,w=v.w;return te[0]=v.x,te[5]=v.y,te[10]=v.z,te[15]=void 0!==w?w:1,this},Mat4.prototype.lookAt=function(){var dup=new Vec3(0,0,1),x=new Vec3,y=new Vec3,z=new Vec3;return function(eye,target,up){var te=this.elements;return up=up||dup,z.vsub(target,eye).normalize(),x.vcross(up,z).normalize(),y.vcross(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this}}(),Mat4.prototype.compose=function(position,scale,rotation){var te=this.elements,x=rotation.x,y=rotation.y,z=rotation.z,w=rotation.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=scale.x,sy=scale.y,sz=scale.z;return te[0]=(1-(yy+zz))*sx,te[4]=(xy-wz)*sy,te[8]=(xz+wy)*sz,te[1]=(xy+wz)*sx,te[5]=(1-(xx+zz))*sy,te[9]=(yz-wx)*sz,te[2]=(xz-wy)*sx,te[6]=(yz+wx)*sy,te[10]=(1-(xx+yy))*sz,te[3]=0,te[7]=0,te[11]=0,te[12]=position.x,te[13]=position.y,te[14]=position.z,te[15]=1,this},Mat4.prototype.decompose=function(position,scale,quaternion){var trace,s,te=this.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],x=0,y=0,z=0,w=1,sx=scale.set(m11,m21,m31).length(),sy=scale.set(m12,m22,m32).length(),sz=scale.set(m13,m23,m33).length(),invSx=1/sx,invSy=1/sy,invSz=1/sz;return scale.x=sx,scale.y=sy,scale.z=sz,position.x=te[12],position.y=te[13],position.z=te[14],m11*=invSx,m12*=invSy,m13*=invSz,m21*=invSx,m22*=invSy,m23*=invSz,m31*=invSx,m32*=invSy,m33*=invSz,trace=m11+m22+m33,trace>0?(s=.5/sqrt(trace+1),w=.25/s,x=(m32-m23)*s,y=(m13-m31)*s,z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*sqrt(1+m11-m22-m33),w=(m32-m23)/s,x=.25*s,y=(m12+m21)/s,z=(m13+m31)/s):m22>m33?(s=2*sqrt(1+m22-m11-m33),w=(m13-m31)/s,x=(m12+m21)/s,y=.25*s,z=(m23+m32)/s):(s=2*sqrt(1+m33-m11-m22),w=(m21-m12)/s,x=(m13+m31)/s,y=(m23+m32)/s,z=.25*s),quaternion.x=x,quaternion.y=y,quaternion.w=w,quaternion.z=z,this},Mat4.prototype.setPosition=function(v){var te=this.elements,z=v.z;return te[12]=v.x,te[13]=v.y,te[14]=void 0!==z?z:0,this},Mat4.prototype.extractPosition=function(other){var te=this.elements,me=other.elements;return te[12]=me[12],te[13]=me[13],te[14]=me[14],this},Mat4.prototype.extractRotation=function(){var vec=new Vec3;return function(other){var te=this.elements,me=other.elements,lx=vec.set(me[0],me[1],me[2]).lengthSq(),ly=vec.set(me[4],me[5],me[6]).lengthSq(),lz=vec.set(me[8],me[9],me[10]).lengthSq(),scaleX=lx>0?1/sqrt(lx):0,scaleY=ly>0?1/sqrt(ly):0,scaleZ=lz>0?1/sqrt(lz):0;return te[0]=me[0]*scaleX,te[1]=me[1]*scaleX,te[2]=me[2]*scaleX,te[4]=me[4]*scaleY,te[5]=me[5]*scaleY,te[6]=me[6]*scaleY,te[8]=me[8]*scaleZ,te[9]=me[9]*scaleZ,te[10]=me[10]*scaleZ,this}}(),Mat4.prototype.extractRotationScale=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[8]=me[8],te[9]=me[9],te[10]=me[10],this},Mat4.prototype.translate=function(v){var te=this.elements,x=v.x,y=v.y,z=v.z||0;return te[12]=te[0]*x+te[4]*y+te[8]*z+te[12],te[13]=te[1]*x+te[5]*y+te[9]*z+te[13],te[14]=te[2]*x+te[6]*y+te[10]*z+te[14],te[15]=te[3]*x+te[7]*y+te[11]*z+te[15],this},Mat4.prototype.scale=function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this},Mat4.prototype.rotateX=function(angle){var te=this.elements,m12=te[4],m22=te[5],m32=te[6],m42=te[7],m13=te[8],m23=te[9],m33=te[10],m43=te[11],c=cos(angle),s=sin(angle);return te[4]=c*m12+s*m13,te[5]=c*m22+s*m23,te[6]=c*m32+s*m33,te[7]=c*m42+s*m43,te[8]=c*m13-s*m12,te[9]=c*m23-s*m22,te[10]=c*m33-s*m32,te[11]=c*m43-s*m42,this},Mat4.prototype.rotateY=function(angle){var te=this.elements,m11=te[0],m21=te[1],m31=te[2],m41=te[3],m13=te[8],m23=te[9],m33=te[10],m43=te[11],c=cos(angle),s=sin(angle);return te[0]=c*m11-s*m13,te[1]=c*m21-s*m23,te[2]=c*m31-s*m33,te[3]=c*m41-s*m43,te[8]=c*m13+s*m11,te[9]=c*m23+s*m21,te[10]=c*m33+s*m31,te[11]=c*m43+s*m41,this},Mat4.prototype.rotateZ=function(angle){var te=this.elements,m11=te[0],m21=te[1],m31=te[2],m41=te[3],m12=te[4],m22=te[5],m32=te[6],m42=te[7],c=cos(angle),s=sin(angle);return te[0]=c*m11+s*m12,te[1]=c*m21+s*m22,te[2]=c*m31+s*m32,te[3]=c*m41+s*m42,te[4]=c*m12-s*m11,te[5]=c*m22-s*m21,te[6]=c*m32-s*m31,te[7]=c*m42-s*m41,this},Mat4.prototype.makeTranslation=function(x,y,z){return this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1)},Mat4.prototype.makeScale=function(x,y,z){return this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1)},Mat4.prototype.makeRotationX=function(angle){var c=cos(angle),s=sin(angle);return this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1)},Mat4.prototype.makeRotationY=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1)},Mat4.prototype.makeRotationZ=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1)},Mat4.prototype.frustum=function(left,right,bottom,top,near,far){var te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this},Mat4.prototype.perspective=function(fov,aspect,near,far){var ymax=near*tan(degsToRads(.5*fov)),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return this.frustum(xmin,xmax,ymin,ymax,near,far)},Mat4.prototype.orthographic=function(left,right,top,bottom,near,far){var te=this.elements,w=right-left,h=top-bottom,p=far-near,x=(right+left)/w,y=(top+bottom)/h,z=(far+near)/p;return te[0]=2/w,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=2/h,te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=-2/p,te[11]=0,te[12]=-x,te[13]=-y,te[14]=-z,te[15]=1,this},Mat4.prototype.fromMat2=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=0,te[3]=0,te[4]=me[2],te[5]=me[3],te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=1,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.fromMat32=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=0,te[3]=0,te[4]=me[2],te[5]=me[3],te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=1,te[11]=0,te[12]=me[4],te[13]=me[5],te[14]=0,te[15]=1,this},Mat4.prototype.fromMat3=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=0,te[4]=me[3],te[5]=me[4],te[6]=me[5],te[7]=0,te[8]=me[6],te[9]=me[7],te[10]=me[8],te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.fromQuat=function(q){var te=this.elements,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[4]=xy-wz,te[8]=xz+wy,te[1]=xy+wz,te[5]=1-(xx+zz),te[9]=yz-wx,te[2]=xz-wy,te[6]=yz+wx,te[10]=1-(xx+yy),te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],te[9]=me[9],te[10]=me[10],te[11]=me[11],te[12]=me[12],te[13]=me[13],te[14]=me[14],te[15]=me[15],this},Mat4.prototype.toJSON=function(){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);return je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],je[4]=te[4],je[5]=te[5],je[6]=te[6],je[7]=te[7],je[8]=te[8],json},Mat4.prototype.toString=function(){var te=this.elements;return"Mat4["+te[0]+", "+te[4]+", "+te[8]+", "+te[12]+"]\n     ["+te[1]+", "+te[5]+", "+te[9]+", "+te[13]+"]\n     ["+te[2]+", "+te[6]+", "+te[10]+", "+te[14]+"]\n     ["+te[3]+", "+te[7]+", "+te[11]+", "+te[15]+"]"},Mat4}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/camera",["odin/math/mathf","odin/math/color","odin/math/vec3","odin/math/mat4","odin/core/components/component"],function(Mathf,Color,Vec3,Mat4,Component){function Camera(opts){opts||(opts={}),Component.call(this,"Camera",opts),this.width=960,this.height=640,this.aspect=this.width/this.height,this.fov=void 0!==opts.fov?opts.fov:35,this.near=void 0!==opts.near?opts.near:.1,this.far=void 0!==opts.far?opts.far:512,this.orthographic=void 0!==opts.orthographic?!!opts.orthographic:!1,this.orthographicSize=void 0!==opts.orthographicSize?opts.orthographicSize:2,this.minOrthographicSize=void 0!==opts.minOrthographicSize?opts.minOrthographicSize:.01,this.maxOrthographicSize=void 0!==opts.maxOrthographicSize?opts.maxOrthographicSize:1024,this.projection=new Mat4,this.view=new Mat4,this._needsUpdate=!0,this._active=!1}var MAT4,VEC3,degsToRads=Mathf.degsToRads;return Camera.type="Camera",Component.extend(Camera),Camera.prototype.copy=function(other){return this.width=other.width,this.height=other.height,this.aspect=other.aspect,this.far=other.far,this.near=other.near,this.fov=other.fov,this.orthographic=other.orthographic,this.orthographicSize=other.orthographicSize,this.minOrthographicSize=other.minOrthographicSize,this.maxOrthographicSize=other.maxOrthographicSize,this._needsUpdate=!0,this},Camera.prototype.set=function(width,height){this.width=width,this.height=height,this.aspect=width/height,this._needsUpdate=!0},Camera.prototype.setWidth=function(width){this.width=width,this.aspect=width/this.height,this._needsUpdate=!0},Camera.prototype.setHeight=function(height){this.height=height,this.aspect=this.width/height,this._needsUpdate=!0},Camera.prototype.setFov=function(value){this.fov=value,this._needsUpdate=!0},Camera.prototype.setNear=function(value){this.near=value,this._needsUpdate=!0},Camera.prototype.setFar=function(value){this.far=value,this._needsUpdate=!0},Camera.prototype.setOrthographic=function(value){this.orthographic=!!value,this._needsUpdate=!0},Camera.prototype.toggleOrthographic=function(){this.orthographic=!this.orthographic,this._needsUpdate=!0},Camera.prototype.setOrthographicSize=function(size){this.orthographicSize=clamp(size,this.minOrthographicSize,this.maxOrthographicSize),this._needsUpdate=!0},MAT4=new Mat4,VEC3=new Vec3,Camera.prototype.toWorld=function(v,out){return out||(out=new Vec3),out.x=2*v.x/this.width-1,out.y=-2*v.y/this.height+1,out.transformMat4(MAT4.mmul(this.projection,this.view).inverse()),out.z=this.near,out},Camera.prototype.toScreen=function(v,out){return out||(out=new Vec2),VEC3.copy(v),VEC3.transformMat4(MAT4.mmul(this.projection,this.view)),out.x=.5*(VEC3.x+1)*this.width,out.y=.5*(1-VEC3.y)*this.height,v},Camera.prototype.update=function(){if(this._active){if(this._needsUpdate){if(this.orthographic){this.orthographicSize=clamp(this.orthographicSize,this.minOrthographicSize,this.maxOrthographicSize);var orthographicSize=this.orthographicSize,right=orthographicSize*this.aspect,left=-right,top=orthographicSize,bottom=-top;this.projection.orthographic(left,right,top,bottom,this.near,this.far)}else{this.projection.perspective(degsToRads(this.fov),this.aspect,this.near,this.far)}this._needsUpdate=!1}this.view.inverseMat(this.transform.matrixWorld)}},Camera.prototype.sort=function(a,b){return a._active?-1:b._active?1:-1},Camera.prototype.toSYNC=function(json){return json=Component.prototype.toSYNC.call(this,json),json.width=this.width,json.height=this.height,json.aspect=this.aspect,json.far=this.far,json.near=this.near,json.fov=this.fov,json.orthographic=this.orthographic,json.orthographicSize=this.orthographicSize,json.minOrthographicSize=this.minOrthographicSize,json.maxOrthographicSize=this.maxOrthographicSize,json},Camera.prototype.fromSYNC=function(json){return Component.prototype.fromSYNC.call(this,json),(json.width!==this.width||json.height!==this.height)&&(this._needsUpdate=!0),this.width=json.width,this.height=json.height,this.aspect=json.aspect,this.far=json.far,this.near=json.near,this.fov=json.fov,this.orthographic=json.orthographic,this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this},Camera.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.width=this.width,json.height=this.height,json.aspect=this.aspect,json.far=this.far,json.near=this.near,json.fov=this.fov,json.orthographic=this.orthographic,json.orthographicSize=this.orthographicSize,json.minOrthographicSize=this.minOrthographicSize,json.maxOrthographicSize=this.maxOrthographicSize,json},Camera.prototype.fromServerJSON=function(json){return Component.prototype.fromServerJSON.call(this,json),this.width=json.width,this.height=json.height,this.aspect=json.aspect,this.far=json.far,this.near=json.near,this.fov=json.fov,this.orthographic=json.orthographic,this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this._needsUpdate=!0,this},Camera.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.width=json.width,this.height=json.height,this.aspect=json.aspect,this.far=json.far,this.near=json.near,this.fov=json.fov,this.orthographic=json.orthographic,this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this._needsUpdate=!0,this},Camera}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/camera_2d",["odin/math/mathf","odin/math/color","odin/math/vec2","odin/math/mat32","odin/math/mat4","odin/core/components/component"],function(Mathf,Color,Vec2,Mat32,Mat4,Component){function Camera2D(opts){opts||(opts={}),Component.call(this,"Camera2D",opts),this.width=960,this.height=640,this.aspect=this.width/this.height,this.orthographicSize=void 0!==opts.orthographicSize?opts.orthographicSize:2,this.minOrthographicSize=void 0!==opts.minOrthographicSize?opts.minOrthographicSize:.01,this.maxOrthographicSize=void 0!==opts.maxOrthographicSize?opts.maxOrthographicSize:1024,this.projection=new Mat32,this._projectionMat4=new Mat4,this.view=new Mat32,this._needsUpdate=!0,this._active=!1}var MAT32,VEC2,clamp=Mathf.clamp;return Camera2D.type="Camera2D",Component.extend(Camera2D),Camera2D.prototype.copy=function(other){return this.width=other.width,this.height=other.height,this.orthographicSize=other.orthographicSize,this.minOrthographicSize=other.minOrthographicSize,this.maxOrthographicSize=other.maxOrthographicSize,this._needsUpdate=!0,this},Camera2D.prototype.set=function(width,height){this.width=width,this.height=height,this.aspect=width/height,this._needsUpdate=!0},Camera2D.prototype.setWidth=function(width){this.width=width,this.aspect=width/this.height,this._needsUpdate=!0},Camera2D.prototype.setHeight=function(height){this.height=height,this.aspect=this.width/height,this._needsUpdate=!0},Camera2D.prototype.setOrthographicSize=function(size){this.orthographicSize=clamp(size,this.minOrthographicSize,this.maxOrthographicSize),this._needsUpdate=!0},MAT32=new Mat32,VEC2=new Vec2,Camera2D.prototype.toWorld=function(v,out){return out||(out=new Vec2),out.x=2*v.x/this.width-1,out.y=-2*v.y/this.height+1,out.transformMat32(MAT32.mmul(this.projection,this.view).inverse()),out},Camera2D.prototype.toScreen=function(v,out){return out||(out=new Vec2),VEC2.copy(v).transformMat32(MAT32.mmul(this.projection,this.view)),out.x=.5*(VEC2.x+1)*this.width,out.y=.5*(1-VEC2.y)*this.height,out},Camera2D.prototype.update=function(){if(this._active){if(this._needsUpdate){var orthographicSize=this.orthographicSize,right=orthographicSize*this.aspect,left=-right,top=orthographicSize,bottom=-top;this.projection.orthographic(left,right,top,bottom),this._projectionMat4.orthographic(left,right,top,bottom,-1,1),this._needsUpdate=!1}this.view.inverseMat(this.transform2d.matrixWorld)}},Camera2D.prototype.sort=function(a,b){return a._active?-1:b._active?1:-1},Camera2D.prototype.toSYNC=function(json){return json=Component.prototype.toSYNC.call(this,json),json.width=this.width,json.height=this.height,json.orthographicSize=this.orthographicSize,json.minOrthographicSize=this.minOrthographicSize,json.maxOrthographicSize=this.maxOrthographicSize,json},Camera2D.prototype.fromSYNC=function(json){return Component.prototype.fromSYNC.call(this,json),(json.width!==this.width||json.height!==this.height)&&(this._needsUpdate=!0),this.width=json.width,this.height=json.height,this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this},Camera2D.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.width=this.width,json.height=this.height,json.orthographicSize=this.orthographicSize,json.minOrthographicSize=this.minOrthographicSize,json.maxOrthographicSize=this.maxOrthographicSize,json},Camera2D.prototype.fromServerJSON=function(json){return Component.prototype.fromServerJSON.call(this,json),this.width=json.width,this.height=json.height,this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this._needsUpdate=!0,this},Camera2D.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.width=json.width,this.height=json.height,this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this._needsUpdate=!0,this},Camera2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/mesh_filter",["odin/core/components/component","odin/core/assets/material","odin/core/assets/mesh"],function(Component,Material,Mesh){function MeshFilter(opts){opts||(opts={}),Component.call(this,"MeshFilter",opts),this.castShadows=void 0!==opts.castShadows?!!opts.castShadows:!0,this.receiveShadows=void 0!==opts.receiveShadows?!!opts.receiveShadows:!0,this.mesh=opts.mesh instanceof Mesh?opts.mesh:new Mesh(opts.mesh),this.material=opts.material instanceof Material?opts.material:new Material(opts.material)}return Component.extend(MeshFilter),MeshFilter.prototype.copy=function(other){return this.castShadows=other.castShadows,this.receiveShadows=other.receiveShadows,this.mesh=other.mesh,this.material.copy(other.material),this},MeshFilter.prototype.clear=function(){return this.mesh=void 0,this.material=void 0,this},MeshFilter}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/rigid_body_2d",["odin/base/class","odin/math/vec2","odin/core/components/component","odin/phys2d/phys2d"],function(Class,Vec2,Component,Phys2D){function RigidBody2D(opts){opts||(opts={}),Component.call(this,"RigidBody2D",opts),this.body=new Phys2D.P2Rigidbody(opts)}function onCollision(body,si,sj){this.emit("collide",body,si,sj)}return Class.extend(RigidBody2D,Component),RigidBody2D.prototype.copy=function(other){return this.body.off("collide",onCollision,this),this.body=other.body.clone(),this.body.on("collide",onCollision,this),this},RigidBody2D.prototype.init=function(){var shape,i,body=this.body,shapes=body.shapes,matrix=body.matrix,gameObject=this.gameObject,transform=gameObject.transform2d,aabb=body.aabb;for(body.position.copy(transform.position),body.rotation=transform.rotation,matrix.setPosition(body.position),matrix.setRotation(body.rotation),aabb.clear(),i=shapes.length;i--;){shape=shapes[i],shape.update(matrix),aabb.union(shape.aabb)}body.on("collide",onCollision,this)},RigidBody2D.prototype.update=function(){var body=this.body,gameObject=this.gameObject,transform=gameObject.transform2d;transform.position.copy(body.position),transform.rotation=body.rotation},RigidBody2D.prototype.applyForce=function(force,worldPoint){this.body.applyForce(force,worldPoint)},RigidBody2D.prototype.applyTorque=function(torque){this.body.applyTorque(torque)},RigidBody2D.prototype.applyImpulse=function(impulse,worldPoint){this.body.applyImpulse(impulse,worldPoint)},RigidBody2D.prototype.applyVelocity=function(velocity){this.body.applyVelocity(velocity)},RigidBody2D.prototype.applyAngularVelocity=function(angularVelocity){this.body.applyAngularVelocity(angularVelocity)},RigidBody2D.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.body=this.body.toJSON(json.body),json},RigidBody2D.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.body.fromJSON(json.body),this.body.on("collide",onCollision,this),this},RigidBody2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/sprite",["odin/base/time","odin/math/vec2","odin/core/enums","odin/core/components/component","odin/core/assets/assets"],function(Time,Vec2,Enums,Component,Assets){function Sprite(opts){opts||(opts={}),Component.call(this,"Sprite",opts),this.visible=void 0!=opts.visible?!!opts.visible:!0,this.blending=void 0!=opts.blending?opts.blending:Enums.Blending.Default,this.z=void 0!=opts.z?opts.z:0,this.alpha=void 0!=opts.alpha?opts.alpha:1,this.texture=void 0!=opts.texture?opts.texture:void 0,this.width=opts.width||1,this.height=opts.height||1,this.x=opts.x||0,this.y=opts.y||0,this.w=opts.w||1,this.h=opts.h||1
}return Sprite.type="Sprite",Component.extend(Sprite),Sprite.prototype.copy=function(other){return this.visible=other.visible,this.blending=other.blending,this.z=other.z,this.alpha=other.alpha,this.texture=other.texture,this.width=other.width,this.height=other.height,this.x=other.x,this.y=other.y,this.w=other.w,this.h=other.h,this},Sprite.prototype.clear=function(){return this.texture=void 0,this},Sprite.prototype.toSYNC=function(json){return json=Component.prototype.toSYNC.call(this,json),json.visible=this.visible,json.blending=this.blending,json.z=this.z,json.alpha=this.alpha,json.width=this.width,json.height=this.height,json.x=this.x,json.y=this.y,json.w=this.w,json.h=this.h,json},Sprite.prototype.fromSYNC=function(json){return Component.prototype.fromSYNC.call(this,json),this.visible=json.visible,this.blending=json.blending,this.z=json.z,this.alpha=json.alpha,this.width=json.width,this.height=json.height,this.x=json.x,this.y=json.y,this.w=json.w,this.h=json.h,this},Sprite.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.visible=this.visible,json.blending=this.blending,json.z=this.z,json.alpha=this.alpha,json.texture=this.texture?this.texture.name:void 0,json.width=this.width,json.height=this.height,json.x=this.x,json.y=this.y,json.w=this.w,json.h=this.h,json},Sprite.prototype.fromServerJSON=function(json){return Component.prototype.fromServerJSON.call(this,json),this.visible=json.visible,this.blending=json.blending,this.z=json.z,this.alpha=json.alpha,this.texture=json.texture?Assets.hash[json.texture]:void 0,this.width=json.width,this.height=json.height,this.x=json.x,this.y=json.y,this.w=json.w,this.h=json.h,this},Sprite.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.visible=json.visible,this.blending=json.blending,this.z=json.z,this.alpha=json.alpha,this.texture=json.texture?Assets.hash[json.texture]:void 0,this.width=json.width,this.height=json.height,this.x=json.x,this.y=json.y,this.w=json.w,this.h=json.h,this},Sprite.prototype.sort=function(a,b){return b.z-a.z},Sprite}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/sprite_animation",["odin/base/time","odin/core/assets/assets","odin/core/components/component","odin/core/enums"],function(Time,Assets,Component,Enums){function SpriteAnimation(opts){opts||(opts={}),Component.call(this,"SpriteAnimation",opts),this.sheet=void 0!=opts.sheet?opts.sheet:void 0,this.current=void 0!=opts.current?opts.current:"idle",this.mode=void 0!=opts.mode?opts.mode:WrapMode.Loop,this.rate=void 0!==opts.rate?opts.rate:1/24,this._time=0,this._frame=0,this._order=1,this.playing=this.sheet?!0:!1}var WrapMode=Enums.WrapMode,floor=Math.floor;return Component.extend(SpriteAnimation),SpriteAnimation.prototype.copy=function(other){return this.sheet=other.sheet,this.current=other.current,this.mode=other.mode,this.rate=other.rate,this._time=other._time,this._frame=other._frame,this._order=other._order,this.playing=other.playing,this},SpriteAnimation.prototype.clear=function(){return this.sheet=void 0,this},SpriteAnimation.prototype.play=function(name,mode,rate){return this.sheet?this.playing&&this.current===name||!this.sheet[name]?this:(this.current=name,this.rate=rate||(rate=this.rate),this.mode=mode||(mode=this.mode),this._frame=0,this._order=1,this._time=0,this.playing=!0,this.emit("play",name,mode,rate),this):this},SpriteAnimation.prototype.stop=function(){return this.playing&&this.emit("stop"),this.playing=!1,this._frame=0,this._order=1,this._time=0,this},SpriteAnimation.prototype.update=function(){if(this.playing&&this.rate){var dt,count,length,order,frame,mode,animation,sprite=this.sprite,sheet=this.sheet,current=sheet[this.current];if(sprite&&sheet&&current){if(dt=Time.delta,order=this._order,frame=this._frame,mode=this.mode,this._time+=dt,count=this._time/this.rate,count>=1){switch(this._time=0,length=current.length,frame+=order*floor(count),mode){case WrapMode.Loop:frame%=length;break;case WrapMode.Once:order>0?frame>=length&&(frame=length-1,this.stop()):0>frame&&(frame=0,this.stop());break;case WrapMode.PingPong:order>0?frame>=length&&(this._order=-1,frame=length-1):0>frame&&(this._order=1,frame=0);break;case WrapMode.Clamp:order>0?frame>=length&&(frame=length-1):0>frame&&(frame=0)}animation=current[frame],sprite.x=animation[0],sprite.y=animation[1],sprite.w=animation[2],sprite.h=animation[3]}this._frame=frame}}},SpriteAnimation.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.sheet=this.sheet?this.sheet.name:void 0,json.current=this.current,json.mode=this.mode,json.rate=this.rate,json._time=this._time,json._frame=this._frame,json._order=this._order,json.playing=this.playing,json},SpriteAnimation.prototype.fromServerJSON=function(json){return Component.prototype.fromServerJSON.call(this,json),this.sheet=json.sheet?Assets.hash[json.sheet]:void 0,this.current=json.current,this.mode=json.mode,this.rate=json.rate,this._time=json._time,this._frame=json._frame,this._order=json._order,this.playing=json.playing,this},SpriteAnimation.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.sheet=json.sheet?Assets.hash[json.sheet]:void 0,this.current=json.current,this.mode=json.mode,this.rate=json.rate,this._time=json._time,this._frame=json._frame,this._order=json._order,this.playing=json.playing,this},SpriteAnimation}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/quat",["odin/math/mathf","odin/math/vec3"],function(Mathf,Vec3){function Quat(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!==w?w:1}var abs=Math.abs,sqrt=Math.sqrt,acos=Math.acos,sin=Math.sin,cos=Math.cos,EPSILON=Mathf.EPSILON;return Quat.prototype.clone=function(){return new Quat(this.x,this.y,this.z,this.w)},Quat.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this.z=other.z,this.w=other.w,this},Quat.prototype.set=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},Quat.prototype.mul=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=other.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.qmul=function(a,b){var ax=a.x,ay=a.y,az=a.z,aw=a.w,bx=b.x,by=b.y,bz=b.z,bw=b.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.div=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=-other.x,by=-other.y,bz=-other.z,bw=other.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.qdiv=function(a,b){var ax=a.x,ay=a.y,az=a.z,aw=a.w,bx=-b.x,by=-b.y,bz=-b.z,bw=b.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.length=function(){var x=this.x,y=this.y,z=this.z,w=this.w,lsq=x*x+y*y+z*z+w*w;return lsq>0?sqrt(lsq):0},Quat.prototype.lengthSq=function(){var x=this.x,y=this.y,z=this.z,w=this.w;return x*x+y*y+z*z+w*w},Quat.prototype.normalize=function(){var x=this.x,y=this.y,z=this.z,w=this.w,l=x*x+y*y+z*z+w*w;return l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this.z*=l,this.w*=l,this},Quat.prototype.inverse=function(){var x=this.x,y=this.y,z=this.z,w=this.w,d=x*x+y*y+z*z+w*w,invD=d>0?1/d:0;return this.x*=-invD,this.y*=-invD,this.z*=-invD,this.w*=invD,this},Quat.prototype.inverseQuat=function(other){var x=other.x,y=other.y,z=other.z,w=other.w,d=x*x+y*y+z*z+w*w,invD=d>0?1/d:0;return this.x=-x*invD,this.y=-y*invD,this.z=-z*invD,this.w=w*invD,this},Quat.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},Quat.prototype.calculateW=function(){var x=this.x,y=this.y,z=this.z;return this.w=-sqrt(abs(1-x*x-y*y-z*z)),this},Quat.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this.w+=(other.w-this.w)*x,this},Quat.prototype.qlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z,aw=a.w;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this.w=aw+(b.w-aw)*x,this},Quat.prototype.nlerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this.w+=(other.w-this.w)*x,this.normalize()},Quat.prototype.qnlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z,aw=a.w;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this.w=aw+(b.w-aw)*x,this.normalize()},Quat.prototype.slerp=function(other,x){var omega,sinom,scale0,scale1,ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=other.w,cosom=ax*bx+ay*by+az*bz+aw*bw;return 0>cosom&&(cosom*=-1,bx*=-1,by*=-1,bz*=-1,bw*=-1),1-cosom>EPSILON?(omega=acos(cosom),sinom=1/sin(omega),scale0=sin((1-x)*omega)*sinom,scale1=sin(x*omega)*sinom):(scale0=1-x,scale1=x),this.x=scale0*ax+scale1*bx,this.y=scale0*ay+scale1*by,this.z=scale0*az+scale1*bz,this.w=scale0*aw+scale1*bw,this},Quat.prototype.qslerp=function(a,b,x){var omega,sinom,scale0,scale1,ax=a.x,ay=a.y,az=a.z,aw=a.w,bx=b.x,by=b.y,bz=b.z,bw=b.w,cosom=ax*bx+ay*by+az*bz+aw*bw;return 0>cosom&&(cosom*=-1,bx*=-1,by*=-1,bz*=-1,bw*=-1),1-cosom>EPSILON?(omega=acos(cosom),sinom=1/sin(omega),scale0=sin((1-x)*omega)*sinom,scale1=sin(x*omega)*sinom):(scale0=1-x,scale1=x),this.x=scale0*ax+scale1*bx,this.y=scale0*ay+scale1*by,this.z=scale0*az+scale1*bz,this.w=scale0*aw+scale1*bw,this},Quat.qdot=Quat.prototype.qdot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w},Quat.prototype.dot=function(other){return this.x*other.x+this.y*other.y+this.z*other.z+this.w*other.w},Quat.prototype.rotateX=function(angle){var halfAngle=.5*angle,x=this.x,y=this.y,z=this.z,w=this.w,s=sin(halfAngle),c=cos(halfAngle);return this.x=x*c+w*s,this.y=y*c+z*s,this.z=z*c-y*s,this.w=w*c-x*s,this},Quat.prototype.rotateY=function(angle){var halfAngle=.5*angle,x=this.x,y=this.y,z=this.z,w=this.w,s=sin(halfAngle),c=cos(halfAngle);return this.x=x*c-z*s,this.y=y*c+w*s,this.z=z*c+x*s,this.w=w*c-y*s,this},Quat.prototype.rotateZ=function(angle){var halfAngle=.5*angle,x=this.x,y=this.y,z=this.z,w=this.w,s=sin(halfAngle),c=cos(halfAngle);return this.x=x*c+y*s,this.y=y*c-x*s,this.z=z*c+w*s,this.w=w*c-z*s,this},Quat.prototype.rotate=function(x,y,z){return this.rotateZ(z),this.rotateX(x),this.rotateY(y),this},Quat.prototype.lookRotation=function(forward,up){var fx=forward.x,fy=forward.y,fz=forward.z,ux=up.x,uy=u.y,uz=up.z,ax=uy*fz-uz*fy,ay=uz*fx-ux*fz,az=ux*fy-uy*fx,d=2*(1+ux*fx+uy*fy+uz*fz),dsq=d*d;return s=1/dsq,this.x=ax*s,this.y=ay*s,this.z=az*s,this.w=.5*dsq,this},Quat.prototype.fromAxisAngle=function(axis,angle){var halfAngle=.5*angle,s=sin(halfAngle);return this.x=axis.x*s,this.y=axis.y*s,this.z=axis.z*s,this.w=cos(halfAngle),this},Quat.prototype.fromVec3s=function(){var a=new Vec3;return function(u,v){return a.vcross(u,v),this.x=a.x,this.y=a.y,this.z=a.z,this.w=sqrt(u.lengthSq()*v.lengthSq())+u.dot(v),this.normalize()}}(),Quat.prototype.fromMat3=function(m){var s,invS,te=m.elements,m11=te[0],m12=te[3],m13=te[6],m21=te[1],m22=te[4],m23=te[7],m31=te[2],m32=te[5],m33=te[8],trace=m11+m22+m33;return trace>0?(s=.5/sqrt(trace+1),this.w=.25/s,this.x=(m32-m23)*s,this.y=(m13-m31)*s,this.z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*sqrt(1+m11-m22-m33),invS=1/s,this.w=(m32-m23)*invS,this.x=.25*s,this.y=(m12+m21)*invS,this.z=(m13+m31)*invS):m22>m33?(s=2*sqrt(1+m22-m11-m33),invS=1/s,this.w=(m13-m31)*invS,this.x=(m12+m21)*invS,this.y=.25*s,this.z=(m23+m32)*invS):(s=2*sqrt(1+m33-m11-m22),invS=1/s,this.w=(m21-m12)*invS,this.x=(m13+m31)*invS,this.y=(m23+m32)*invS,this.z=.25*s),this},Quat.prototype.fromMat4=function(m){var s,invS,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33;return trace>0?(s=.5/sqrt(trace+1),this.w=.25/s,this.x=(m32-m23)*s,this.y=(m13-m31)*s,this.z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*sqrt(1+m11-m22-m33),invS=1/s,this.w=(m32-m23)*invS,this.x=.25*s,this.y=(m12+m21)*invS,this.z=(m13+m31)*invS):m22>m33?(s=2*sqrt(1+m22-m11-m33),invS=1/s,this.w=(m13-m31)*invS,this.x=(m12+m21)*invS,this.y=.25*s,this.z=(m23+m32)*invS):(s=2*sqrt(1+m33-m11-m22),invS=1/s,this.w=(m21-m12)*invS,this.x=(m13+m31)*invS,this.y=(m23+m32)*invS,this.z=.25*s),this},Quat.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this.z=array[2],this.w=array[3],this},Quat.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.z=json.z,this.w=json.w,this},Quat.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array[2]=this.z,array[3]=this.w,array},Quat.prototype.toJSON=function(json){return json||(json={}),json.x=this.x,json.y=this.y,json.z=this.z,json.w=this.w,json},Quat.prototype.toString=function(){return"Quat( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},Quat}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/transform",["odin/math/mathf","odin/math/vec3","odin/math/quat","odin/math/mat4","odin/core/components/component","odin/core/game/log"],function(Mathf,Vec3,Quat,Mat4,Component,Log){function Transform(opts){opts||(opts={}),opts.sync=void 0!=opts.sync?opts.sync:!0,Component.call(this,"Transform",opts),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!==opts.position?opts.position:new Vec3,this.rotation=void 0!==opts.rotation?opts.rotation:new Quat,this.scale=void 0!==opts.scale?opts.scale:new Vec3(1,1,1),this.matrix=new Mat4,this.matrixWorld=new Mat4,this.modelView=new Mat4,this._modelViewNeedsUpdate=!1}function updateDepth(transform,depth){var i,children=transform.children;for(transform.depth=depth,i=children.length;i--;){updateDepth(children[i],depth+1)}}var VEC,EPSILON=Mathf.EPSILON;return Transform.type="Transform",Component.extend(Transform),Transform.prototype.copy=function(other){var i,children=other.children;for(this.position.copy(other.position),this.scale.copy(other.scale),this.rotation.copy(other.rotation),i=children.length;i--;){this.addChild(children[i].gameObject.clone().transform)}return other.parent&&other.parent.addChild(this),this},Transform.prototype.clear=function(){var i,children=this.children;for(i=children.length;i--;){this.removeChild(children[i])}return this.position.set(0,0,0),this.scale.set(1,1,1),this.rotation.set(0,0,0,1),this.root=this,this.depth=0,this},Transform.prototype.translate=function(){var vec=new Vec3;return function(translation,relativeTo){return vec.copy(translation),relativeTo instanceof Transform?vec.transformQuat(relativeTo.rotation):relativeTo instanceof Quat&&vec.transformQuat(relativeTo),this.position.add(vec),this}}(),Transform.prototype.rotate=function(){var vec=new Vec3;return function(rotation,relativeTo){return vec.copy(rotation),relativeTo instanceof Transform?vec.transformQuat(relativeTo.rotation):relativeTo instanceof Quat&&vec.transformQuat(relativeTo),this.rotation.rotate(vec.x,vec.y,vec.z),this}}(),Transform.prototype.lookAt=function(){var mat=new Mat4,vec=new Vec3,dup=new Vec3(0,0,1);return function(target,up){return up=up||dup,target instanceof Transform?vec.copy(target.position):vec.copy(target),mat.lookAt(this.position,vec,up),this.rotation.fromMat4(mat),this}}(),Transform.prototype.follow=function(){var target=new Vec3,position=new Vec3,delta=new Vec3;return function(transform,speed){return position.set(0,0,0).transformMat4(this.matrixWorld),target.set(0,0,0).transformMat4(transform.matrixWorld),delta.vsub(target,position),delta.lengthSq()>EPSILON&&this.position.add(delta.smul(speed)),this}}(),Transform.prototype.addChild=function(child){if(!(child instanceof Transform)){return Log.error("Transform.add: can't add passed argument, it is not an instance of Transform"),this}var root,depth,children=this.children,index=children.indexOf(child);if(-1===index){for(child.parent&&child.parent.remove(child),child.parent=this,children.push(child),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=root,this.root=root,updateDepth(this,depth)}else{Log.error("Transform.add: child is not a member of this Transform")}return this},Transform.prototype.add=Transform.prototype.addChildren=function(){for(var i=arguments.length;i--;){this.addChild(arguments[i])}return this},Transform.prototype.removeChild=function(child){var root,depth,children=this.children,index=children.indexOf(child);if(-1!==index){for(child.parent=void 0,children.splice(index,1),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=child,this.root=root,updateDepth(this,depth)}else{Log.error("Transform.remove: child is not a member of this Transform")}return this},Transform.prototype.remove=Transform.prototype.removeChildren=function(){for(var i=arguments.length;i--;){this.removeChild(arguments[i])}return this},Transform.prototype.detachChildren=function(){var i,children=this.children;for(i=children.length;i--;){this.removeChild(children[i])}return this},Transform.prototype.toWorld=function(v){return v.transformMat4(this.matrixWorld)},Transform.prototype.toLocal=function(){var mat=new Mat4;return function(v){return v.transformMat4(mat.inverseMat(this.matrixWorld))}}(),Transform.prototype.update=function(){var matrix=this.matrix,parent=this.parent;matrix.compose(this.position,this.scale,this.rotation),parent?this.matrixWorld.mmul(parent.matrixWorld,matrix):this.matrixWorld.copy(matrix),this._modelViewNeedsUpdate=!0},Transform.prototype.updateModelView=function(viewMatrix){this._modelViewNeedsUpdate&&(this.modelView.mmul(viewMatrix,this.matrixWorld),this._modelViewNeedsUpdate=!1)},Transform.prototype.sort=function(a,b){return b.depth-a.depth},VEC=new Vec3,Transform.prototype.toSYNC=function(json){return json=Component.prototype.toSYNC.call(this,json),this.parent?(json.position=this.toWorld(VEC.copy(this.position)).toJSON(json.position),json.scale=this.toWorld(VEC.copy(this.scale)).toJSON(json.scale),json.rotation=this.toWorld(VEC.copy(this.rotation)).toJSON(json.rotation)):(json.position=this.position.toJSON(json.position),json.scale=this.scale.toJSON(json.scale),json.rotation=this.rotation.toJSON(json.rotation)),json},Transform.prototype.fromSYNC=function(json){return this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation.fromJSON(json.rotation),this},Transform.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.position=this.position.toJSON(json.position),json.scale=this.scale.toJSON(json.scale),json.rotation=this.rotation.toJSON(json.rotation),json},Transform.prototype.fromServerJSON=function(json){return Component.prototype.fromServerJSON.call(this,json),this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation.fromJSON(json.rotation),this},Transform.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation.fromJSON(json.rotation),this},Transform}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/transform_2d",["odin/math/mathf","odin/math/vec2","odin/math/mat32","odin/math/mat4","odin/core/components/component","odin/core/game/config","odin/core/game/log"],function(Mathf,Vec2,Mat32,Mat4,Component,Config,Log){function Transform2D(opts){opts||(opts={}),opts.sync=void 0!=opts.sync?opts.sync:!0,Component.call(this,"Transform2D",opts),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!=opts.position?opts.position:new Vec2,this.rotation=void 0!=opts.rotation?opts.rotation:0,this.scale=void 0!=opts.scale?opts.scale:new Vec2(1,1),this.matrix=new Mat32,this.matrixWorld=new Mat32,this.modelView=new Mat32,this._modelViewNeedsUpdate=!1}function updateDepth(transform,depth){var i,children=transform.children;for(transform.depth=depth,i=children.length;i--;){updateDepth(children[i],depth+1)}}var VEC,EPSILON=Mathf.EPSILON;return Transform2D.type="Transform2D",Component.extend(Transform2D),Transform2D.prototype.copy=function(other){var i,children=other.children;for(this.position.copy(other.position),this.scale.copy(other.scale),this.rotation=other.rotation,i=children.length;i--;){this.addChild(children[i].gameObject.clone().transform)}return other.parent&&other.parent.addChild(this),this},Transform2D.prototype.clear=function(){var i,children=this.children;for(i=children.length;i--;){this.removeChild(children[i])}return this.position.set(0,0),this.scale.set(1,1),this.rotation=0,this.root=this,this.depth=0,this},Transform2D.prototype.translate=function(){var vec=new Vec2;return function(translation,relativeTo){return vec.copy(translation),relativeTo instanceof Transform2D?vec.transformAngle(relativeTo.rotation):relativeTo&&vec.transformAngle(relativeTo),this.position.add(vec),this}}(),Transform2D.prototype.rotate=function(){var vec=new Vec2;return function(rotation,relativeTo){return vec.copy(rotation),relativeTo instanceof Transform2D?vec.transformAngle(relativeTo.rotation):relativeTo&&vec.transformAngle(relativeTo),this.rotation.rotate(vec.x,vec.y,vec.z),this}}(),Transform2D.prototype.lookAt=function(){var mat=new Mat32,vec=new Vec2;return function(target,up){return up=up||dup,target instanceof Transform2D?vec.copy(target.position):vec.copy(target),mat.lookAt(this.position,vec),this.rotation=mat.getRotation(),this}}(),Transform2D.prototype.follow=function(){var target=new Vec2,position=new Vec2,delta=new Vec2;return function(transform,speed){return position.set(0,0).transformMat32(this.matrixWorld),target.set(0,0).transformMat32(transform.matrixWorld),delta.vsub(target,position),delta.lengthSq()>EPSILON&&this.position.add(delta.smul(speed)),this}}(),Transform2D.prototype.addChild=function(child){if(!(child instanceof Transform2D)){return Log.error("Transform2D.add: can't add passed argument, it is not an instance of Transform2D"),this}var root,depth,children=this.children,index=children.indexOf(child);if(-1===index){for(child.parent&&child.parent.remove(child),child.parent=this,children.push(child),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=root,this.root=root,updateDepth(this,depth)}else{Log.error("Transform2D.add: child is not a member of this Transform2D")}return this},Transform2D.prototype.add=Transform2D.prototype.addChildren=function(){for(var i=arguments.length;i--;){this.addChild(arguments[i])}return this},Transform2D.prototype.removeChild=function(child){var root,depth,children=this.children,index=children.indexOf(child);if(-1!==index){for(child.parent=void 0,children.splice(index,1),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=child,this.root=root,updateDepth(this,depth)}else{Log.error("Transform2D.remove: child is not a member of this Transform2D")}return this},Transform2D.prototype.remove=Transform2D.prototype.removeChildren=function(){for(var i=arguments.length;i--;){this.removeChild(arguments[i])}return this},Transform2D.prototype.detachChildren=function(){var i,children=this.children;for(i=children.length;i--;){this.removeChild(children[i])}return this},Transform2D.prototype.toWorld=function(v){return v.transformMat32(this.matrixWorld)},Transform2D.prototype.toLocal=function(){var mat=new Mat32;return function(v){return v.transformMat32(mat.inverseMat(this.matrixWorld))}}(),Transform2D.prototype.update=function(){var matrix=this.matrix,parent=this.parent;matrix.compose(this.position,this.scale,this.rotation),parent?this.matrixWorld.mmul(parent.matrixWorld,matrix):this.matrixWorld.copy(matrix),this._modelViewNeedsUpdate=!0},Transform2D.prototype.updateModelView=function(viewMatrix){this._modelViewNeedsUpdate&&(this.modelView.mmul(viewMatrix,this.matrixWorld),this._modelViewNeedsUpdate=!1)},Transform2D.prototype.sort=function(a,b){return b.depth-a.depth},VEC=new Vec2,Transform2D.prototype.toSYNC=function(json){return json=Component.prototype.toSYNC.call(this,json),this.parent?(json.position=this.toWorld(VEC.copy(this.position)).toJSON(json.position),json.scale=this.toWorld(VEC.copy(this.scale)).toJSON(json.scale),json.rotation=this.rotation-this.parent.rotation):(json.position=this.position.toJSON(json.position),json.scale=this.scale.toJSON(json.scale),json.rotation=this.rotation),json},Transform2D.prototype.fromSYNC=function(json){return this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation=json.rotation,this},Transform2D.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.position=this.position.toJSON(json.position),json.scale=this.scale.toJSON(json.scale),json.rotation=this.rotation,json},Transform2D.prototype.fromServerJSON=function(json){return Component.prototype.fromServerJSON.call(this,json),this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation=json.rotation,this},Transform2D.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation=json.rotation,this},Transform2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/loop",["odin/base/request_animation_frame","odin/core/game/log"],function(requestAnimationFrame,Log){function Loop(callback,ctx){ctx||(ctx=this),this._loopState=L_PAUSED,this._runState=R_PAUSED,this.callback=callback,this.ctx=ctx||this;var self=this;this._run=function(ms){self._runState=R_RUNNING,callback&&(callback.call(ctx,ms),self._loopState===L_RUNNING?self._pump():self.pause()),self._runState=R_PAUSED}}Loop.prototype.init=Loop.prototype.resume=function(){return this.callback?(this._loopState=L_RUNNING,this._runState===R_PAUSED&&this._pump(),void 0):(Log.warn("Loop.resume: can't run loop without callback"),void 0)},Loop.prototype.pause=function(){this._loopState=L_PAUSED},Loop.prototype.isRunning=function(){return this._loopState===L_RUNNING},Loop.prototype.isPaused=function(){return this._loopState===L_PAUSED},Loop.prototype._pump=function(){requestAnimationFrame(this._run)};var L_RUNNING=Loop.L_RUNNING=1,L_PAUSED=Loop.L_PAUSED=2,R_RUNNING=Loop.R_RUNNING=1,R_PAUSED=Loop.R_PAUSED=2;return Loop}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game_object",["odin/base/class","odin/core/components/component","odin/core/game/log"],function(Class,Component,Log){function GameObject(opts){opts||(opts={}),Class.call(this),this.sync=void 0!=opts.sync?!!opts.sync:!0,this.json=void 0!=opts.json?!!opts.json:!0,this.scene=void 0,this.tags=[],this.components=[],this._componentHash={},this._componentHashServer={},opts.tag&&this.addTag(opts.tag),opts.tags&&this.addTags.apply(this,opts.tags),opts.components&&this.addComponents.apply(this,opts.components)}return Class.extend(GameObject),GameObject.prototype.copy=function(other){var i,components=other.components,tags=other.tags;for(this.clear(),i=components.length;i--;){this.addComponent(components[i].clone())}for(i=tags.length;i--;){this.addTag(tags[i])}return other.scene&&other.scene.addGameObject(this),this},GameObject.prototype.clear=function(){var i,components=this.components,tags=this.tags;for(i=tags.length;i--;){this.removeTag(tags[i])}for(i=components.length;i--;){this.removeComponent(components[i],!0)}return this},GameObject.prototype.destroy=function(){return this.scene?(this.scene.removeGameObject(this),this.emit("destroy"),this.clear(),this):(Log.error("GameObject.destroy: can't destroy GameObject if it's not added to a Scene"),this)},GameObject.prototype.addTag=function(tag){var tags=this.tags;return-1===tags.indexOf(tag)&&tags.push(tag),this},GameObject.prototype.addTags=function(){for(var i=arguments.length;i--;){this.addTag(arguments[i])}return this},GameObject.prototype.removeTag=function(tag){var tags=this.tags,index=tags.indexOf(tag);return-1!==index&&tags.splice(index,1),this},GameObject.prototype.removeTags=function(){for(var i=arguments.length;i--;){this.removeTag(arguments[i])}return this},GameObject.prototype.hasTag=function(tag){return-1!==this.tags.indexOf(tag)},GameObject.prototype.addComponent=function(component,others){if("string"==typeof component&&(component=new Component._types[component]),!(component instanceof Component)){return Log.error("GameObject.addComponent: can't add passed argument, it is not an instance of Component"),this}var comp,i,j,name=component._name,components=this.components;if(this[name]){Log.error("GameObject.addComponent: GameObject already has a(n) "+component._type+" Component")}else{if(component.gameObject&&(component=component.clone()),components.push(component),this._componentHash[component._id]=component,-1!==component._serverId&&(this._componentHashServer[component._serverId]=component),component.gameObject=this,this[name]=component,!others){for(i=components.length;i--;){if(comp=components[i]){for(j=components.length;j--;){name=components[j]._name,comp[name]=components[j]}}}}this.emit("add"+component._type,component),this.emit("addComponent",component),this.scene&&this.scene._addComponent(component)}return this},GameObject.prototype.add=GameObject.prototype.addComponents=function(){var component,name,i,j,length=arguments.length,components=this.components;for(i=length;i--;){this.addComponent(arguments[i],!0)}for(i=components.length;i--;){if(component=components[i]){for(j=components.length;j--;){name=components[j]._name,component[name]=components[j]}}}return this},GameObject.prototype.removeComponent=function(component,clear,others){if("string"==typeof component&&(component=this.getComponent(component)),!(component instanceof Component)){return Log.error("GameObject.removeComponent: can't remove passed argument, it is not an instance of Component"),this}var comp,i,j,name=component._name,components=this.components;if(this[name]){if(!others){for(i=components.length;i--;){if(comp=components[i]){for(j=components.length;j--;){name===components[j]._name&&(comp[name]=void 0)}}}}components.splice(components.indexOf(component),1),this._componentHash[component._id]=void 0,-1!==component._serverId&&(this._componentHashServer[component._serverId]=void 0),component.gameObject=void 0,this[name]=void 0,this.emit("remove"+component._type,component),this.emit("removeComponent",component),clear&&component.clear(),this.scene&&this.scene._removeComponent(component)}else{Log.error("GameObject.removeComponent: GameObject does not have a(n) "+type+" Component")}return this},GameObject.prototype.remove=GameObject.prototype.removeComponents=function(){var component,name,i,j,length=arguments.length,components=this.components,toRemove=arguments;for(i=length;i--;){this.removeComponent(arguments[i],null,!0)}for(i=components.length;i--;){if(component=components[i]){for(name=component._name,j=toRemove.length;j--;){name===toRemove[i]._name&&(component[name]=void 0)}}}return this},GameObject.prototype.getComponent=function(type){return this._componentHash[type]||this[type]||this[type.toLowerCase()]},GameObject.prototype.hasComponent=function(type){var i,components=this.components;for(i=components.length;i--;){if(components[i]._type===type){return!0}}return!1},GameObject.prototype.findComponentById=function(id){return this._componentHash[id]},GameObject.prototype.findComponentByServerId=function(id){return this._componentHashServer[id]},GameObject.prototype.toSYNC=function(json){json=Class.prototype.toSYNC.call(this,json);for(var component,components=this.components,jsonComponents=json.components||(json.components=[]),i=components.length;i--;){(component=components[i]).sync&&(jsonComponents[i]=component.toSYNC(jsonComponents[i]))}return json},GameObject.prototype.fromSYNC=function(json){Class.prototype.fromSYNC.call(this,json);for(var component,jsonComponent,jsonComponents=json.components||(json.components=[]),i=jsonComponents.length;i--;){(jsonComponent=jsonComponents[i])&&((component=this.findComponentByServerId(jsonComponent._id))?component.fromSYNC(jsonComponent):this.addComponent(Class.fromSYNC(jsonComponent)))
}return this},GameObject.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);for(var component,components=this.components,jsonComponents=json.components||(json.components=[]),tags=this.tags,jsonTags=json.tags||(json.tags=[]),i=components.length;i--;){(component=components[i]).json&&(jsonComponents[i]=component.toJSON(jsonComponents[i]))}for(i=tags.length;i--;){jsonTags[i]=tags[i]}return json},GameObject.prototype.fromServerJSON=function(json){Class.prototype.fromServerJSON.call(this,json);for(var component,jsonComponent,tag,jsonComponents=json.components||(json.components=[]),tags=this.tags,jsonTags=json.tags||(json.tags=[]),i=jsonComponents.length;i--;){(jsonComponent=jsonComponents[i])&&((component=this.findComponentByServerId(jsonComponent._id))?component.fromServerJSON(jsonComponent):this.addComponent(Class.fromServerJSON(jsonComponent)))}for(i=jsonTags.length;i--;){-1===tags.indexOf(tag=jsonTags[i])&&tags.push(tag)}return this},GameObject.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);for(var component,jsonComponent,tag,jsonComponents=json.components||(json.components=[]),tags=this.tags,jsonTags=json.tags||(json.tags=[]),i=jsonComponents.length;i--;){(jsonComponent=jsonComponents[i])&&((component=this.findComponentById(jsonComponent._id))?component.fromJSON(jsonComponent):this.addComponent(Class.fromJSON(jsonComponent)))}for(i=jsonTags.length;i--;){-1===tags.indexOf(tag=jsonTags[i])&&tags.push(tag)}return this},GameObject}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/world/world",["odin/base/class","odin/math/color"],function(Class,Color){function World(opts){opts||(opts={}),Class.call(this),this.scene=void 0,this.sync=!1,this.background=void 0!=opts.background?opts.background:new Color(.5,.5,.5)}return Class.extend(World),World.prototype.init=function(){},World.prototype.update=function(){},World.prototype.clear=function(){return this.background.set(.5,.5,.5),this},World.prototype.destroy=function(){return this.scene?(this.scene.removeWorld(),this.emit("destroy"),this.clear(),this):(Log.error("World.destroy: can't destroy World if it's not set to a Scene"),this)},World.prototype.toSYNC=function(json){return json=Class.prototype.toSYNC.call(this,json),json.background=this.background.toJSON(json.background),json},World.prototype.fromSYNC=function(json){return Class.prototype.fromSYNC.call(this,json),this.background.fromJSON(json.background),this},World.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.background=this.background.toJSON(json.background),json},World.prototype.fromServerJSON=function(json){return Class.prototype.fromServerJSON.call(this,json),this.background.fromJSON(json.background),this},World.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.background.fromJSON(json.background),this},World}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/scene",["odin/base/class","odin/core/game_object","odin/core/world/world","odin/core/game/log"],function(Class,GameObject,World,Log){function Scene(opts){opts||(opts={}),Class.call(this),this.game=void 0,this._name=void 0!=opts.name?opts.name:"Scene_"+this._id,this.world=void 0,this.gameObjects=[],this._gameObjectHash={},this._gameObjectServerHash={},this.components={},this._componentTypes=[],this._componentHash={},this._componentHashServer={},this.setWorld(opts.world instanceof World?opts.world:new World(opts.world)),opts.gameObjects&&this.addGameObjects.apply(this,opts.gameObjects)}var defineProperty=Object.defineProperty;return Class.extend(Scene),defineProperty(Scene.prototype,"name",{get:function(){return this._name},set:function(value){var sceneNameHash,game=this.game;if(game){if(sceneNameHash=game._sceneNameHash,sceneNameHash[value]){return Log.warn("Scene.set name: can't change name to "+value+" Game already have an Scene with same name"),void 0}delete sceneNameHash[this.name],sceneNameHash[value]=this}this._name=value}}),Scene.prototype.copy=function(other){var i,otherGameObjects=other.gameObjects;for(this.clear(),this.name=other.name+"."+this._id,i=otherGameObjects.length;i--;){this.addGameObject(otherGameObjects[i].clone())}return this},Scene.prototype.init=function(){var components,i,j,types=this._componentTypes,gameObjects=this.gameObjects;for(this.world&&this.world.init(),i=types.length;i--;){for(components=types[i],j=components.length;j--;){components[j].init()}}for(i=gameObjects.length;i--;){gameObjects[i].emit("init")}},Scene.prototype.update=function(){var components,i,j,types=this._componentTypes,gameObjects=this.gameObjects;for(this.world&&this.world.update(),i=types.length;i--;){for(components=types[i],j=components.length;j--;){components[j].update()}}for(i=gameObjects.length;i--;){gameObjects[i].emit("update")}},Scene.prototype.clear=function(){var i,gameObjects=this.gameObjects;for(this.world=void 0,i=gameObjects.length;i--;){this.removeGameObject(gameObjects[i],!0)}return this},Scene.prototype.destroy=function(){return this.game?(this.game.removeScene(this),this.emit("destroy"),this.clear(),this):(Log.error("Scene.destroy: can't destroy Scene if it's not added to a Game"),this)},Scene.prototype.setWorld=function(world){return this.world&&this.removeWorld(),world.scene=this,this.world=world,this.game&&world.init(),this},Scene.prototype.removeWorld=function(){if(!this.world){return this}var world=this.world;return world.scene=void 0,this.world=void 0,this},Scene.prototype.addGameObject=function(gameObject){if(!(gameObject instanceof GameObject)){return Log.error("Scene.addGameObject: can't add argument to Scene, it's not an instance of GameObject"),this}var components,i,gameObjects=this.gameObjects,index=gameObjects.indexOf(gameObject);if(-1===index){for(gameObject.scene&&gameObject.scene.removeGameObject(gameObject),gameObjects.push(gameObject),this._gameObjectHash[gameObject._id]=gameObject,-1!==gameObject._serverId&&(this._gameObjectServerHash[gameObject._serverId]=gameObject),gameObject.scene=this,components=gameObject.components,i=components.length;i--;){this._addComponent(components[i])}this.game&&gameObject.emit("init"),this.emit("addGameObject",gameObject)}else{Log.error("Scene.addGameObject: GameObject is already a member of Scene")}return this},Scene.prototype.add=Scene.prototype.addGameObjects=function(){for(var i=arguments.length;i--;){this.addGameObject(arguments[i])}return this},Scene.prototype._addComponent=function(component){if(component){var type=component._type,components=this.components,isNew=!components[type],types=components[type]=components[type]||[];this._componentHash[component._id]=component,-1!==component._serverId&&(this._componentHashServer[component._serverId]=component),types.push(component),types.sort(component.sort),isNew&&this._componentTypes.push(types),this.game&&component.init(),this.emit("add"+type,component),this.emit("addComponent",component)}},Scene.prototype.removeGameObject=function(gameObject,clear){if(!(gameObject instanceof GameObject)){return Log.error("Scene.removeGameObject: can't remove argument from Scene, it's not an instance of GameObject"),this}var components,i,gameObjects=this.gameObjects,index=gameObjects.indexOf(gameObject);if(-1!==index){for(gameObjects.splice(index,1),this._gameObjectHash[gameObject._id]=void 0,-1!==gameObject._serverId&&(this._gameObjectServerHash[gameObject._serverId]=void 0),gameObject.scene=void 0,components=gameObject.components,i=components.length;i--;){this._removeComponent(components[i])}this.emit("removeGameObject",gameObject),clear&&gameObject.clear()}else{Log.error("Scene.removeGameObject: GameObject is not a member of Scene")}return this},Scene.prototype.remove=Scene.prototype.removeGameObjects=function(){for(var i=arguments.length;i--;){this.removeGameObject(arguments[i])}return this},Scene.prototype._removeComponent=function(component){if(component){var type=component._type,components=this.components,types=components[type],index=types.indexOf(component);this._componentHash[component._id]=void 0,-1!==component._serverId&&(this._componentHashServer[component._serverId]=void 0),types.splice(index,1),types.sort(component.sort),this.emit("remove"+type,component),this.emit("removeComponent",component),component.clear()}},Scene.prototype.findByTag=function(tag,out){out||(out=[]);for(var gameObject,gameObjects=this.gameObjects,i=gameObjects.length;i--;){(gameObject=gameObjects[i]).hasTag(tag)&&out.push(gameObject)}return out},Scene.prototype.findByTagFirst=function(tag){for(var gameObject,gameObjects=this.gameObjects,i=gameObjects.length;i--;){if((gameObject=gameObjects[i]).hasTag(tag)){return gameObject}}return void 0},Scene.prototype.findById=function(id){return this._gameObjectHash[id]},Scene.prototype.findByServerId=function(id){return this._gameObjectServerHash[id]},Scene.prototype.findComponentById=function(id){return this._componentHash[id]},Scene.prototype.findComponentByServerId=function(id){return this._componentHashServer[id]},Scene.prototype.toSYNC=function(json){if(!this._needsSync){return this._SYNC}json=Class.prototype.toSYNC.call(this,json);var gameObject,i,gameObjects=this.gameObjects,jsonGameObjects=json.gameObjects||(json.gameObjects=[]);for(this.world.sync&&(json.world=this.world.toSYNC(json.world)),i=gameObjects.length;i--;){(gameObject=gameObjects[i]).sync&&(jsonGameObjects[i]=gameObject.toSYNC(jsonGameObjects[i]))}return this._needsSync=!1,json},Scene.prototype.fromSYNC=function(json){Class.prototype.fromSYNC.call(this,json);var gameObject,jsonGameObject,i,jsonGameObjects=json.gameObjects;for(json.world&&this.world.fromSYNC(json.world),i=jsonGameObjects.length;i--;){(jsonGameObject=jsonGameObjects[i])&&(gameObject=this.findByServerId(jsonGameObject._id))&&gameObject.fromSYNC(jsonGameObject)}return this},Scene.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);var gameObject,i,gameObjects=this.gameObjects,jsonGameObjects=json.gameObjects||(json.gameObjects=[]);for(json.name=this.name,json.world=this.world.toJSON(json.world),i=gameObjects.length;i--;){(gameObject=gameObjects[i]).json&&(jsonGameObjects[i]=gameObject.toJSON(jsonGameObjects[i]))}return json},Scene.prototype.fromServerJSON=function(json){Class.prototype.fromServerJSON.call(this,json);var gameObject,jsonGameObject,i,jsonGameObjects=json.gameObjects;for(this.name=json.name,this.world=Class.fromJSON(json.world),this.world.scene=this,i=jsonGameObjects.length;i--;){(jsonGameObject=jsonGameObjects[i])&&((gameObject=this.findByServerId(jsonGameObject._id))?gameObject.fromServerJSON(jsonGameObject):this.addGameObject(Class.fromServerJSON(jsonGameObject)))}return this},Scene.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);var gameObject,jsonGameObject,i,jsonGameObjects=json.gameObjects;for(this.name=json.name,this.world=Class.fromJSON(json.world),this.world.scene=this,i=jsonGameObjects.length;i--;){(jsonGameObject=jsonGameObjects[i])&&((gameObject=this.findById(jsonGameObject._id))?gameObject.fromJSON(jsonGameObject):this.addGameObject(Class.fromJSON(jsonGameObject)))}return this},Scene}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/rect",[],function(){function Rect(x,y,width,height){this._x=x||0,this._y=y||0,this._width=width||0,this._height=height||0,this._xMin=this._x,this._xMax=this._x+this._width,this._yMin=this._y,this._yMax=this._y+this._height}var defineProperty=Object.defineProperty;return defineProperty(Rect.prototype,"x",{get:function(){return this._x},set:function(value){this._x=value,this._xMin=value,this._xMax=value+this._width}}),defineProperty(Rect.prototype,"y",{get:function(){return this._y},set:function(value){this._y=value,this._yMin=value,this._yMax=value+this._height}}),defineProperty(Rect.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value,this._xMax=this._xMin+value}}),defineProperty(Rect.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value,this._yMax=this._yMin+value}}),defineProperty(Rect.prototype,"xMin",{get:function(){return this._xMin},set:function(value){this._xMin=value,this._x=value,this._width=this._xMax-this._xMin,this._xMax=value+this._width}}),defineProperty(Rect.prototype,"xMax",{get:function(){return this._xMax},set:function(value){this._xMax=value,this._width=value-this._xMin}}),defineProperty(Rect.prototype,"yMin",{get:function(){return this._yMin},set:function(value){this._yMin=value,this._y=value,this._height=this._yMax-this._yMin,this._yMax=value+this._height}}),defineProperty(Rect.prototype,"yMax",{get:function(){return this._yMax},set:function(value){this._yMax=value,this._height=value-this._yMin}}),Rect.prototype.clone=function(){return new Rect(this.x,this.y,this.width,this.height)},Rect.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this.width=other.width,this.height=other.height,this},Rect.prototype.set=function(x,y,width,height){return this.x=x,this.y=y,this.width=width,this.height=height,this},Rect.prototype.contains=function(point){var x=point.x,y=point.y;return!(x<this._xMin||x>this._xMax||y<this._yMin||y>this._yMax)},Rect.prototype.toJSON=function(json){return json||(json={}),json.x=this._x,json.y=this._y,json.width=this._width,json.height=this._height,json},Rect.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.width=json.width,this.height=json.height,this},Rect.prototype.toString=function(){return"Rect( "+this._x+", "+this._y+", "+this._width+", "+this._height+" )"},Rect}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui_content",["odin/core/assets/assets"],function(Assets){function GUIContent(opts){opts||(opts={}),this.text=opts.text,this.texture=opts.texture}return GUIContent.prototype.clone=function(){return(new GUIContent).copy(this)},GUIContent.prototype.copy=function(other){return this.text=other.text,this.texture=other.texture,this},GUIContent.prototype.toJSON=function(json){return json||(json={}),json.text=this.text,json.texture=this.texture?this.texture.name:void 0,json},GUIContent.prototype.fromJSON=function(json){return this.text=json.text,this.texture=json.texture?Assets.hash[json.texture.name]:void 0,this},GUIContent}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui_layout",["odin/base/class","odin/core/game/log","odin/math/mat32","odin/math/vec2","odin/math/rect","odin/core/gui/gui_content"],function(Class,Log,Mat32,Vec2,Rect,GUIContent){function GUILayout(opts){opts||(opts={}),Class.call(this),this.root=this,this.depth=0,this.gui=void 0,this.content=opts.content instanceof GUIContent?opts.content:new GUIContent(opts.content),this.style=opts.style instanceof GUIStyle?opts.style:new GUIStyle(opts.style),this.parent=void 0,this.children=[],this.position=void 0!=opts.position?opts.position:new Rect,this.rotation=void 0!=opts.rotation?opts.rotation:0,this.scale=void 0!=opts.scale?opts.scale:new Vec2(1,1),this.matrix=new Mat32,this.matrixWorld=new Mat32}function updateDepth(layout,depth){var i,children=layout.children;for(layout.depth=depth,i=children.length;i--;){updateDepth(children[i],depth+1)}}Class.extend(GUILayout),GUILayout.prototype.copy=function(other){var i,children=other.children;for(this.position.copy(other.position),this.rotation.copy(other.rotation),this.scale.copy(other.scale),i=children.length;i--;){this.addChild(children[i].clone())}return other.parent&&other.parent.add(this),this},GUILayout.prototype.clear=function(){var i,children=this.children;for(i=children.length;i--;){this.removeChild(children[i])}return this.position.set(0,0,0,0),this.scale.set(1,1),this.rotation=0,this.root=this,this.depth=0,this},GUILayout.prototype.addChild=function(child){if(!(child instanceof GUILayout)){return Log.error("GUILayout.add: can't add passed argument, it is not an instance of GUILayout"),this}var root,depth,children=this.children,index=children.indexOf(child);if(-1===index){for(child.parent&&child.parent.remove(child),child.parent=this,children.push(child),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=root,this.root=root,updateDepth(this,depth)}else{Log.error("GUILayout.add: child is not a member of this GUILayout")}return this},GUILayout.prototype.add=GUILayout.prototype.addChildren=function(){for(var i=arguments.length;i--;){this.addChild(arguments[i])}return this},GUILayout.prototype.removeChild=function(child){var root,depth,children=this.children,index=children.indexOf(child);if(-1!==index){for(child.parent=void 0,children.splice(index,1),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=child,this.root=root,updateDepth(this,depth)}else{Log.error("GUILayout.remove: child is not a member of this GUILayout")}return this},GUILayout.prototype.remove=GUILayout.prototype.removeChildren=function(){for(var i=arguments.length;i--;){this.removeChild(arguments[i])}return this};var CENTER=new Vec2;return GUILayout.prototype.update=function(){var matrix=this.matrix,parent=this.parent,position=this.position;CENTER.x=position._x+.5*position._width,CENTER.y=position._y+.5*position._height,matrix.compose(CENTER,this.scale,this.rotation),parent?this.matrixWorld.mmul(parent.matrixWorld,matrix):this.matrixWorld.copy(matrix)},GUILayout}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui",["odin/base/class","odin/core/gui/gui_layout"],function(Class,GUILayout){function GUI(opts){opts||(opts={}),Class.call(this),this.game=void 0,this.layouts=[],this._layoutHash={},this._layoutServerHash={}}return Class.extend(GUI),GUI.prototype.copy=function(other){var i,layouts=other.layouts;for(this.clear(),i=layouts.length;i--;){this.addLayout(layouts[i])}return this},GUI.prototype.clear=function(){var i,layouts=this.layouts;for(i=layouts.length;i--;){this.removeLayout(layouts[i])}return this},GUI.prototype.addLayout=function(layout){if(!(layout instanceof GUILayout)){return Log.error("GUI.addLayout: can't add argument to GUI, it's not an instance of GUILayout"),this}var layouts=this.layouts,index=layouts.indexOf(layout);return-1===index?(layout.gui&&layout.gui.removeLayout(layout),layouts.push(layout),this._layoutHash[layout._id]=layout,-1!==layout._serverId&&(this._layoutServerHash[layout._serverId]=layout),layout.gui=this,this.emit("addLayout",layout)):Log.error("GUI.addLayout: GUILayout is already a member of GUI"),this},GUI.prototype.add=function(){for(var i=arguments.length;i--;){this.addLayout(arguments[i])}return this},GUI.prototype.removeLayout=function(layout,clear){if(!(layout instanceof GUILayout)){return Log.error("GUI.removeLayout: can't remove argument from GUI, it's not an instance of GUILayout"),this}var layouts=this.layouts,index=layouts.indexOf(layout);return-1!==index?(layout.gui&&layout.gui.removeLayout(layout),layouts.push(layout),this._layoutHash[layout._id]=layout,-1!==layout._serverId&&(this._layoutServerHash[layout._serverId]=layout),layout.gui=this,clear&&layout.clear(),this.emit("removeLayout",layout)):Log.error("GUI.removeLayout: GUILayout is already a member of GUI"),this},GUI.prototype.remove=function(){for(var i=arguments.length;i--;){this.removeLayout(arguments[i])}return this},GUI}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/base_game",["odin/base/class","odin/core/game/loop","odin/core/scene","odin/core/gui/gui","odin/core/game/log"],function(Class,Loop,Scene,GUI,Log){function Game(opts){opts||(opts={}),Class.call(this),this._loop=new Loop(this.loop,this),this.scenes=[],this._sceneHash={},this._sceneServerHash={},this._sceneNameHash={}}return Class.extend(Game),Game.prototype.clear=function(){var i,scenes=this.scenes;for(i=scenes.length;i--;){this.removeScene(scenes[i],!0)}return this},Game.prototype.destroy=function(){return this.emit("destroy"),this.clear(),this},Game.prototype.addScene=function(scene){if(!(scene instanceof Scene)){return Log.error("Game.addScene: can't add argument to Game, it's not an instance of Scene"),this}var json,sceneHash=this._sceneHash,sceneNameHash=this._sceneNameHash,name=scene.name,id=scene._id;return sceneNameHash[name]||sceneHash[id]?Log.error("Game.addScene: Scene is already a member of Game"):(json=scene.toJSON(),sceneNameHash[name]=json,sceneHash[id]=json,this.scenes.push(json),-1!==scene._serverId&&(this._sceneServerHash[scene._serverId]=json),this.emit("addScene",name)),this},Game.prototype.add=Game.prototype.addScenes=function(){for(var i=arguments.length;i--;){this.addScene(arguments[i])}return this},Game.prototype.removeScene=function(scene){"string"==typeof scene?scene=this._sceneNameHash[scene]:"number"==typeof scene&&(scene=this._sceneHash[scene]);var json,scenes=this.scenes,sceneHash=this._sceneHash,sceneNameHash=this._sceneNameHash,name=scene.name,id=scene._id;return sceneNameHash[name]&&sceneHash[id]?(json=sceneNameHash[name],sceneNameHash[name]=void 0,sceneHash[id]=void 0,scenes.splice(scenes.indexOf(json),1),-1!==json._serverId&&(this._sceneServerHash[json._serverId]=void 0),this.emit("removeScene",name)):Log.error("Game.removeScene: Scene not a member of Game"),this},Game.prototype.remove=Game.prototype.removeScenes=function(){for(var i=arguments.length;i--;){this.removeScene(arguments[i])}return this},Game.prototype.findByName=function(name){return this._sceneNameHash[name]},Game.prototype.findById=function(id){return this._sceneHash[id]},Game.prototype.findByServerId=function(id){return this._sceneServerHash[id]},Game.prototype.pause=function(){return this._loop.pause(),this},Game.prototype.resume=function(){return this._loop.resume(),this},Game.prototype.loop=function(ms){this.emit("update",ms)},Game.prototype.toSYNC=function(json){json=Class.prototype.fromSYNC.call(this,json);var i,scenes=this.scenes,jsonScenes=json.jsonScenes||(json.jsonScenes=[]);for(i=scenes.length;i--;){jsonScenes[i]=scenes[i].toSYNC(jsonScenes[i])}return json},Game.prototype.fromSYNC=function(json){Class.prototype.fromSYNC.call(this,json);var scene,jsonScene,i,jsonScenes=json.scenes;for(i=jsonScenes.length;i--;){jsonScene=jsonScenes[i],(scene=this.findByServerId(jsonScene._serverId))&&scene.fromSYNC(jsonScene)}return this},Game.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);var i,scenes=this.scenes,jsonScenes=json.scenes||(json.scenes=[]);for(i=scenes.length;i--;){jsonScenes[i]=scenes[i].toJSON(jsonScenes[i])}return json},Game.prototype.fromServerJSON=function(json){Class.prototype.fromServerJSON.call(this,json);var scene,jsonScene,i,jsonScenes=json.scenes;for(i=jsonScenes.length;i--;){jsonScene=jsonScenes[i],(scene=this.findByServerId(jsonScene._id))?scene.fromServerJSON(jsonScene):this.addScene((new Scene).fromServerJSON(jsonScene))}return this},Game.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);var scene,jsonScene,i,jsonScenes=json.scenes;for(i=jsonScenes.length;i--;){jsonScene=jsonScenes[i],(scene=this.findById(jsonScene._id))?scene.fromJSON(jsonScene):this.addScene((new Scene).fromJSON(jsonScene))}return this},Game}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/rendering/canvas",["odin/base/event_emitter","odin/base/device","odin/base/dom","odin/core/game/config"],function(EventEmitter,Device,Dom,Config){function Canvas(width,height){EventEmitter.call(this),this.fullScreen=void 0===width&&void 0===height?!0:!1,this.width=void 0!==width?width:window.innerWidth,this.height=void 0!==height?height:window.innerHeight,this.aspect=this.width/this.height,this.pixelWidth=this.width,this.pixelHeight=this.height,this.element=void 0}var addEvent=Dom.addEvent,removeEvent=Dom.removeEvent,addMeta=Dom.addMeta,floor=Math.floor,SCALE_REG=/-scale\s *=\s*[.0-9]+/g,VIEWPORT="viewport",VIEWPORT_WIDTH="viewport-width",VIEWPORT_HEIGHT="viewport-height",CANVAS_STYLE=["background: #000000;","position: absolute;","top: 50%;","left: 50%;","padding:0px;","margin: 0px;"].join("\n");return addMeta(VIEWPORT,"viewport","initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"),addMeta(VIEWPORT_WIDTH,"viewport","width=device-width"),addMeta(VIEWPORT_HEIGHT,"viewport","height=device-height"),EventEmitter.extend(Canvas),Canvas.prototype.init=function(){this.element&&this.destroy();var element=document.createElement("canvas");element.style.cssText=CANVAS_STYLE,document.body.appendChild(element),Config.debug||(element.oncontextmenu=function(){return!1}),addEvent(window,"resize orientationchange",this.handleResize,this),this.element=element,this.handleResize()},Canvas.prototype.destroy=function(){return this.element?(removeEvent(window,"resize orientationchange",this.handleResize,this),document.body.removeChild(this.element),this.element=void 0,this):this},Canvas.prototype.setFullscreen=function(value){return this.element&&this.fullScreen!==value?(this.fullScreen=!!value,this.handleResize(),this):this},Canvas.prototype.setWidth=function(width){return this.element&&this.width!==width?(this.width=width,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},Canvas.prototype.setHeight=function(height){return this.element&&this.height!==height?(this.height=height,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},Canvas.prototype.style=function(key,value){return this.element?(this.element.style[key]=value,this):this},Canvas.prototype.setBackgroundColor=function(color){return this.element?(this.element.style.background=color,this):this},Canvas.prototype.handleResize=function(){var width,height,viewportScale=document.getElementById(VIEWPORT).getAttribute("content"),w=window.innerWidth,h=window.innerHeight,aspect=w/h,element=this.element,style=element.style;this.fullScreen?(width=w,height=h):aspect>this.aspect?(width=h*this.aspect,height=h):(width=w,height=w/this.aspect),this.pixelWidth=floor(width),this.pixelHeight=floor(height),element.width=width,element.height=height,style.marginLeft=-floor(.5*width)-1+"px",style.marginTop=-floor(.5*height)-1+"px",style.width=floor(width)+"px",style.height=floor(height)+"px",document.getElementById(VIEWPORT).setAttribute("content",viewportScale.replace(SCALE_REG,"-scale="+Device.invPixelRatio)),document.getElementById(VIEWPORT_WIDTH).setAttribute("content","width="+w),document.getElementById(VIEWPORT_HEIGHT).setAttribute("content","height="+h),window.scrollTo(1,1),this.emit("resize")},Canvas}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/rendering/canvas_renderer_2d",["odin/base/event_emitter","odin/base/device","odin/base/dom","odin/math/mathf","odin/math/vec2","odin/math/mat32","odin/math/color","odin/core/enums","odin/core/game/log"],function(EventEmitter,Device,Dom,Mathf,Vec2,Mat32,Color,Enums,Log){function CanvasRenderer2D(opts){opts||(opts={}),EventEmitter.call(this),this.imageSmoothingEnabled=void 0!=opts.imageSmoothingEnabled?opts.imageSmoothingEnabled:!1,this.canvas=void 0,this.context=void 0,this._context=!1,this._offContext=void 0,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground=new Color}var MAT,mvp,Blending=Enums.Blending,EMPTY_ARRAY=[],DEFAULT_IMAGE=new Image;return DEFAULT_IMAGE.src="data:image/gif;base64,R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",EventEmitter.extend(CanvasRenderer2D),CanvasRenderer2D.prototype.init=function(canvas){this.canvas&&this.clear();var ctx;this.canvas=canvas;try{this.context=ctx=canvas.element.getContext("2d")}catch(e){return Log.error(e),this}return this._context=!0,ctx.imageSmoothingEnabled=ctx.webkitImageSmoothingEnabled=ctx.mozImageSmoothingEnabled=ctx.oImageSmoothingEnabled=ctx.msImageSmoothingEnabled=this.imageSmoothingEnabled,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground.set(0,0,0),this.setBlending(Blending.Default),this._offContext=document.createElement("canvas").getContext("2d"),this},CanvasRenderer2D.prototype.clear=function(){return this.canvas=void 0,this.context=void 0,this._context=!1,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground.set(0,0,0),this._offContext=void 0,this},CanvasRenderer2D.prototype.setBlending=function(blending){var ctx=this.context;switch(blending){case Blending.None:ctx.globalCompositeOperation="none";break;case Blending.Additive:ctx.globalCompositeOperation="color-dodge";break;case Blending.Subtractive:ctx.globalCompositeOperation="color-burn";break;case Blending.Muliply:ctx.globalCompositeOperation="multiply";break;case Blending.Default:default:ctx.globalCompositeOperation="source-over"}},CanvasRenderer2D.prototype.render=function(scene,camera){var ctx,lastBackground,background,components,sprite2ds,particleSystems,sprite2d,particleSystem,transform2d,i,canvas,w,h,hw,hh;if(this._context){for(ctx=this.context,lastBackground=this._lastBackground,background=scene.world.background,components=scene.components,sprite2ds=components.Sprite||EMPTY_ARRAY,particleSystems=components.ParticleSystem||EMPTY_ARRAY,(lastBackground.r!==background.r||lastBackground.g!==background.g||lastBackground.b!==background.b)&&(lastBackground.copy(background),ctx.fillStyle=background.toRGB()),this._lastCamera!==camera&&(canvas=this.canvas,w=canvas.pixelWidth,h=canvas.pixelHeight,hw=.5*w,hh=.5*h,camera.set(w,h),ctx.translate(hw,hh),ctx.scale(hw,-hh),ctx.fillStyle=background.toRGB(),this._lastResizeFn&&canvas.off("resize",this._lastResizeFn),this._lastResizeFn=function(){var w=this.pixelWidth,h=this.pixelHeight,hw=.5*w,hh=.5*h;camera.set(w,h),ctx.translate(hw,hh),ctx.scale(hw,-hh),ctx.fillStyle=background.toRGB()},canvas.on("resize",this._lastResizeFn),this._lastCamera=camera),ctx.fillRect(-1,-1,2,2),i=sprite2ds.length;i--;){sprite2d=sprite2ds[i],transform2d=sprite2d.transform2d,transform2d&&(transform2d.updateModelView(camera.view),this.renderSprite(camera,transform2d,sprite2d))}for(i=particleSystems.length;i--;){particleSystem=particleSystems[i],transform2d=particleSystem.transform2d,transform2d&&(transform2d.updateModelView(camera.view),this.renderParticleSystem(camera,transform2d,particleSystem))}}},MAT=new Mat32,mvp=MAT.elements,CanvasRenderer2D.prototype.renderSprite=function(camera,transform2d,sprite2d){var ctx=this.context,texture=sprite2d.texture;MAT.mmul(camera.projection,transform2d.modelView),texture=texture?texture.raw:DEFAULT_IMAGE,ctx.save(),this.setBlending(sprite2d.blending),ctx.transform(mvp[0],-mvp[2],-mvp[1],mvp[3],mvp[4],mvp[5]),ctx.scale(1,-1),1!==sprite2d.alpha&&(ctx.globalAlpha=sprite2d.alpha),ctx.drawImage(texture,sprite2d.x,sprite2d.y,sprite2d.w,sprite2d.h,sprite2d.width*-.5,sprite2d.height*-.5,sprite2d.width,sprite2d.height),ctx.restore()},CanvasRenderer2D.prototype.renderParticleSystem=function(camera,transform2d,particleSystem){var emitter,texture,w,h,particles,view,particle,pos,size,j,ctx=this.context,offCtx=this._offContext,offCanvas=offCtx.canvas,emitters=particleSystem.emitters,i=emitters.length;if(i){for(;i--;){if(emitter=emitters[i],particles=emitter.particles,j=particles.length){if(texture=emitter.texture,texture=texture?texture.raw:DEFAULT_IMAGE,view=emitter.worldSpace?camera.view:transform2d.modelView,ctx.save(),this.setBlending(emitter.blending),MAT.mmul(camera.projection,view),ctx.transform(mvp[0],-mvp[2],-mvp[1],mvp[3],mvp[4],mvp[5]),ctx.scale(1,-1),texture){for(w=texture.width,h=texture.height;j--;){particle=particles[j],pos=particle.position,size=particle.size,ctx.save(),offCtx.save(),offCanvas.width!==w&&(offCanvas.width=w),offCanvas.height!==h&&(offCanvas.height=h),offCtx.drawImage(texture,0,0),offCtx.globalCompositeOperation="source-atop",offCtx.fillStyle=particle.color.toRGB(),offCtx.fillRect(0,0,w,h),ctx.globalAlpha=particle.alpha,ctx.translate(pos.x,pos.y),ctx.rotate(particle.angle),ctx.drawImage(offCanvas,0,0,w,h,.5*-size,.5*-size,size,size),offCtx.restore(),ctx.restore()}}else{for(;j--;){particle=particles[j],pos=particle.position,size=particle.size,ctx.save(),ctx.fillStyle=particle.color.toRGB(),ctx.globalAlpha=particle.alpha,ctx.translate(pos.x,pos.y),ctx.rotate(particle.angle),ctx.fillRect(.5*-size,.5*-size,size,size),ctx.restore()
}}ctx.restore()}}}},CanvasRenderer2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/rendering/webgl_renderer_2d",["odin/base/event_emitter","odin/base/device","odin/base/dom","odin/math/mathf","odin/math/vec2","odin/math/mat32","odin/math/mat4","odin/math/color","odin/core/game/log","odin/core/enums"],function(EventEmitter,Device,Dom,Mathf,Vec2,Mat32,Mat4,Color,Log,Enums){function WebGLRenderer2D(opts){opts||(opts={}),EventEmitter.call(this),this.canvas=void 0,this.context=void 0,this._context=!1,this.attributes=merge(opts.attributes||{},{alpha:!0,antialias:!0,depth:!0,premulipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0}),this._webgl={gpu:{precision:"highp",maxAnisotropy:16,maxTextures:16,maxTextureSize:16384,maxCubeTextureSize:16384,maxRenderBufferSize:16384},ext:{textureFilterAnisotropic:void 0,textureFloat:void 0,standardDerivatives:void 0,compressedTextureS3TC:void 0},textures:{},shaders:{},buffers:{},lastTexture:void 0,lastShader:void 0,lastBuffer:void 0},this._clearBytes=17664,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground=new Color,this._lastBlending=void 0}function bindBuffers(gl,glShader,glBuffer){var attributes=glShader.attributes,FLOAT=gl.FLOAT,ARRAY_BUFFER=gl.ARRAY_BUFFER;glBuffer.vertex&&attributes.aVertexPosition>-1&&(gl.bindBuffer(ARRAY_BUFFER,glBuffer.vertex),gl.enableVertexAttribArray(attributes.aVertexPosition),gl.vertexAttribPointer(attributes.aVertexPosition,2,FLOAT,!1,0,0)),glBuffer.color&&attributes.aVertexColor>-1&&(gl.bindBuffer(ARRAY_BUFFER,glBuffer.color),gl.enableVertexAttribArray(attributes.aVertexColor),gl.vertexAttribPointer(attributes.aVertexColor,2,FLOAT,!1,0,0)),glBuffer.uv&&attributes.aVertexUv>-1&&(gl.bindBuffer(ARRAY_BUFFER,glBuffer.uv),gl.enableVertexAttribArray(attributes.aVertexUv),gl.vertexAttribPointer(attributes.aVertexUv,2,FLOAT,!1,0,0)),glBuffer.index&&gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,glBuffer.index)}function buildBuffer(renderer,buffer){var gl,webgl,buffers,glBuffer,compileArray,DRAW,ARRAY_BUFFER,ELEMENT_ARRAY_BUFFER,items,item,i,il;if(!buffer){return void 0}if(gl=renderer.context,webgl=renderer._webgl,buffers=webgl.buffers,glBuffer=buffers[buffer._id],glBuffer&&!buffer._needsUpdate){return glBuffer}if(glBuffer=glBuffer||(buffers[buffer._id]={}),compileArray=COMPILE_ARRAY,DRAW=buffer.dynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW,ARRAY_BUFFER=gl.ARRAY_BUFFER,ELEMENT_ARRAY_BUFFER=gl.ELEMENT_ARRAY_BUFFER,items=buffer.vertices,items&&items.length){for(compileArray.length=0,i=0,il=items.length;il>i;i++){item=items[i],compileArray.push(item.x,item.y)}compileArray.length&&(glBuffer.vertex=glBuffer.vertex||gl.createBuffer(),gl.bindBuffer(ARRAY_BUFFER,glBuffer.vertex),gl.bufferData(ARRAY_BUFFER,new Float32Array(compileArray),DRAW)),glBuffer.vertices=items.length}if(items=buffer.uvs,items&&items.length){for(compileArray.length=0,i=0,il=items.length;il>i;i++){item=items[i],compileArray.push(item.x,item.y)}compileArray.length&&(glBuffer.uv=glBuffer.uv||gl.createBuffer(),gl.bindBuffer(ARRAY_BUFFER,glBuffer.uv),gl.bufferData(ARRAY_BUFFER,new Float32Array(compileArray),DRAW))}return items=buffer.indices||buffer.faces,items&&items.length&&(glBuffer.index=glBuffer.index||gl.createBuffer(),gl.bindBuffer(ELEMENT_ARRAY_BUFFER,glBuffer.index),gl.bufferData(ELEMENT_ARRAY_BUFFER,new Int16Array(items),DRAW),glBuffer.indices=items.length),glBuffer}function buildShader(renderer,shader){var vertex,fragment,program,gl=renderer.context,webgl=renderer._webgl,shaders=webgl.shaders,glShader=shaders[shader._id];return glShader&&!shader._needsUpdate?glShader:(glShader=glShader||(shaders[shader._id]={}),vertex=shader.vertex||shader.vertexShader,fragment=shader.fragment||shader.fragmentShader,program=glShader.program=createProgram(gl,vertex,fragment),glShader.vertex=vertex,glShader.fragment=fragment,parseUniformsAttributes(gl,program,vertex,fragment,glShader.attributes||(glShader.attributes={}),glShader.uniforms||(glShader.uniforms={})),glShader)}function buildTexture(renderer,texture){var gl,webgl,textures,glTexture,raw,ext,gpu,TFA,isPOT,anisotropy,TEXTURE_2D,WRAP,MAG_FILTER,MIN_FILTER,FORMAT;return texture&&texture.raw?(gl=renderer.context,webgl=renderer._webgl,textures=webgl.textures,glTexture=textures[texture._id],raw=texture.raw,glTexture&&!texture._needsUpdate?glTexture:(glTexture=glTexture||(textures[texture._id]=gl.createTexture()),ext=webgl.ext,gpu=webgl.gpu,TFA=ext.textureFilterAnisotropic,isPOT=isPowerOfTwo(raw.width)&&isPowerOfTwo(raw.height),anisotropy=clamp(texture.anisotropy,1,gpu.maxAnisotropy),TEXTURE_2D=gl.TEXTURE_2D,WRAP=isPOT?gl.REPEAT:gl.CLAMP_TO_EDGE,MAG_FILTER=gl[texture.magFilter]||gl.LINEAR,MIN_FILTER=gl[texture.minFilter]||gl.LINEAR,FORMAT=gl[texture.format],FORMAT=FORMAT?FORMAT:gl.RGBA,MIN_FILTER=isPOT?MIN_FILTER===gl.NEAREST||MIN_FILTER===gl.LINEAR?gl.LINEAR_MIPMAP_NEAREST:MIN_FILTER:MIN_FILTER===gl.NEAREST?gl.NEAREST:gl.LINEAR,gl.bindTexture(TEXTURE_2D,glTexture),gl.texImage2D(TEXTURE_2D,0,FORMAT,FORMAT,gl.UNSIGNED_BYTE,raw),gl.texParameteri(TEXTURE_2D,gl.TEXTURE_MAG_FILTER,MAG_FILTER),gl.texParameteri(TEXTURE_2D,gl.TEXTURE_MIN_FILTER,MIN_FILTER),gl.texParameteri(TEXTURE_2D,gl.TEXTURE_WRAP_S,WRAP),gl.texParameteri(TEXTURE_2D,gl.TEXTURE_WRAP_T,WRAP),TFA&&gl.texParameterf(TEXTURE_2D,TFA.TEXTURE_MAX_ANISOTROPY_EXT,anisotropy),isPOT&&gl.generateMipmap(TEXTURE_2D),webgl.lastTexture=glTexture,texture._needsUpdate=!1,glTexture)):renderer._webgl.textures[ENUM_WHITE_TEXTURE]}function particleVertexShader(precision){return["precision "+precision+" float;","uniform mat4 uMatrix;","uniform vec2 uPos;","uniform float uAngle;","uniform float uSize;","attribute vec2 aVertexPosition;","attribute vec2 aVertexUv;","varying vec2 vUvPosition;","void main() {","	float c, s, vx, vy, x, y;","	c = cos(uAngle);","	s = sin(uAngle);","	vx = aVertexPosition.x;","	vy = aVertexPosition.y;","	x = vx * c - vy * s;","	y = vx * s + vy * c;","	vUvPosition = aVertexUv;","	gl_Position = uMatrix * vec4(uPos.x + x * uSize, uPos.y + y * uSize, 0.0, 1.0);","}"].join("\n")}function particleFragmentShader(precision){return["precision "+precision+" float;","uniform float uAlpha;","uniform vec3 uColor;","uniform sampler2D uTexture;","varying vec2 vUvPosition;","void main() {","	vec4 finalColor = texture2D(uTexture, vUvPosition);","	finalColor.xyz *= uColor;","	finalColor.w *= uAlpha;","	gl_FragColor = finalColor;","}"].join("\n")}function basicVertexShader(precision){return["precision "+precision+" float;","uniform mat4 uMatrix;","attribute vec2 aVertexPosition;","void main() {","	gl_Position = uMatrix * vec4(aVertexPosition, 0.0, 1.0);","}"].join("\n")}function basicFragmentShader(precision){return["precision "+precision+" float;","uniform float uAlpha;","uniform vec3 uColor;","void main() {","	gl_FragColor = vec4(uColor, uAlpha);","}"].join("\n")}function spriteVertexShader(precision){return["precision "+precision+" float;","uniform mat4 uMatrix;","uniform vec4 uCrop;","uniform vec2 uSize;","attribute vec2 aVertexPosition;","attribute vec2 aVertexUv;","varying vec2 vUvPosition;","void main() {","	vUvPosition = vec2(aVertexUv.x * uCrop.z, aVertexUv.y * uCrop.w) + uCrop.xy;","	gl_Position = uMatrix * vec4(aVertexPosition * uSize, 0.0, 1.0);","}"].join("\n")}function spriteFragmentShader(precision){return["precision "+precision+" float;","uniform float uAlpha;","uniform sampler2D uTexture;","varying vec2 vUvPosition;","void main() {","	vec4 finalColor = texture2D(uTexture, vUvPosition);","	finalColor.w *= uAlpha;","	gl_FragColor = finalColor;","}"].join("\n")}function merge(obj,add){var key;for(key in add){void 0==obj[key]&&(obj[key]=add[key])}return obj}function clear(obj){var key;for(key in obj){delete obj[key]}return obj}var MAT,MAT4,COMPILE_ARRAY,Blending=Enums.Blending,getWebGLContext=Dom.getWebGLContext,createProgram=Dom.createProgram,parseUniformsAttributes=Dom.parseUniformsAttributes,addEvent=Dom.addEvent,removeEvent=Dom.removeEvent,clamp=Mathf.clamp,isPowerOfTwo=Mathf.isPowerOfTwo,WHITE_TEXTURE=new Uint8Array([255,255,255,255]),ENUM_WHITE_TEXTURE=-1,SPRITE_VERTICES=[new Vec2(-.5,.5),new Vec2(-.5,-.5),new Vec2(.5,.5),new Vec2(.5,-.5)],SPRITE_UVS=[new Vec2(0,0),new Vec2(0,1),new Vec2(1,0),new Vec2(1,1)],ENUM_SPRITE_BUFFER=-1,ENUM_SPRITE_SHADER=-1,ENUM_BASIC_SHADER=-2,ENUM_PARTICLE_SHADER=-3,EMPTY_ARRAY=[];return EventEmitter.extend(WebGLRenderer2D),WebGLRenderer2D.prototype.init=function(canvas){this.canvas&&this.clear();var element=canvas.element;return this.canvas=canvas,this.context=getWebGLContext(element,this.attributes),this.context?(this._context=!0,addEvent(element,"webglcontextlost",this._handleWebGLContextLost,this),addEvent(element,"webglcontextrestored",this._handleWebGLContextRestored,this),this.setDefaults(),this):this},WebGLRenderer2D.prototype.clear=function(){if(!this.canvas){return this}var canvas=this.canvas,element=canvas.element,webgl=this._webgl,ext=webgl.ext;return this.canvas=void 0,this.context=void 0,this._context=!1,removeEvent(element,"webglcontextlost",this._handleWebGLContextLost,this),removeEvent(element,"webglcontextrestored",this._handleWebGLContextRestored,this),this._clearBytes=17664,this._lastCamera=void 0,this._lastBackground.setRGB(0,0,0),this._lastBlending=void 0,ext.compressedTextureS3TC=ext.standardDerivatives=ext.textureFilterAnisotropic=ext.textureFloat=void 0,webgl.lastBuffer=webgl.lastShader=webgl.lastTexture=void 0,clear(webgl.textures),clear(webgl.buffers),clear(webgl.shaders),this},WebGLRenderer2D.prototype.setDefaults=function(){var VERTEX_SHADER,FRAGMENT_SHADER,HIGH_FLOAT,MEDIUM_FLOAT,shaderPrecision,maxAnisotropy,maxTextures,maxTextureSize,maxCubeTextureSize,maxRenderBufferSize,vsHighpFloat,vsMediumpFloat,fsHighpFloat,fsMediumpFloat,highpAvailable,mediumpAvailable,precision,texture,gl=this.context,webgl=this._webgl,ext=webgl.ext,gpu=webgl.gpu,textureFilterAnisotropic=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),compressedTextureS3TC=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),standardDerivatives=gl.getExtension("OES_standard_derivatives"),textureFloat=gl.getExtension("OES_texture_float");return ext.textureFilterAnisotropic=textureFilterAnisotropic,ext.standardDerivatives=standardDerivatives,ext.textureFloat=textureFloat,ext.compressedTextureS3TC=compressedTextureS3TC,VERTEX_SHADER=gl.VERTEX_SHADER,FRAGMENT_SHADER=gl.FRAGMENT_SHADER,HIGH_FLOAT=gl.HIGH_FLOAT,MEDIUM_FLOAT=gl.MEDIUM_FLOAT,shaderPrecision="undefined"!=typeof gl.getShaderPrecisionFormat,maxAnisotropy=ext.textureFilterAnisotropic?gl.getParameter(ext.textureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE),maxCubeTextureSize=gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderBufferSize=gl.getParameter(gl.MAX_RENDERBUFFER_SIZE),vsHighpFloat=shaderPrecision?gl.getShaderPrecisionFormat(VERTEX_SHADER,HIGH_FLOAT):0,vsMediumpFloat=shaderPrecision?gl.getShaderPrecisionFormat(VERTEX_SHADER,MEDIUM_FLOAT):1,fsHighpFloat=shaderPrecision?gl.getShaderPrecisionFormat(FRAGMENT_SHADER,HIGH_FLOAT):0,fsMediumpFloat=shaderPrecision?gl.getShaderPrecisionFormat(FRAGMENT_SHADER,MEDIUM_FLOAT):1,highpAvailable=vsHighpFloat.precision>0&&fsHighpFloat.precision>0,mediumpAvailable=vsMediumpFloat.precision>0&&fsMediumpFloat.precision>0,precision="highp",(!highpAvailable||Device.mobile)&&(precision=mediumpAvailable?"mediump":"lowp"),gpu.precision=precision,gpu.maxAnisotropy=maxAnisotropy,gpu.maxTextures=maxTextures,gpu.maxTextureSize=maxTextureSize,gpu.maxCubeTextureSize=maxCubeTextureSize,gpu.maxRenderBufferSize=maxRenderBufferSize,gl.clearColor(0,0,0,1),gl.clearDepth(1),gl.clearStencil(0),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.frontFace(gl.CCW),gl.cullFace(gl.BACK),gl.enable(gl.CULL_FACE),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),this.setBlending(Blending.Default),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT),texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,1,1,0,gl.RGB,gl.UNSIGNED_BYTE,WHITE_TEXTURE),gl.bindTexture(gl.TEXTURE_2D,null),webgl.textures[ENUM_WHITE_TEXTURE]=texture,buildBuffer(this,{_id:ENUM_SPRITE_BUFFER,vertices:SPRITE_VERTICES,uvs:SPRITE_UVS}),buildShader(this,{_id:ENUM_SPRITE_SHADER,vertexShader:spriteVertexShader(precision),fragmentShader:spriteFragmentShader(precision)}),buildShader(this,{_id:ENUM_BASIC_SHADER,vertexShader:basicVertexShader(precision),fragmentShader:basicFragmentShader(precision)}),buildShader(this,{_id:ENUM_PARTICLE_SHADER,vertexShader:particleVertexShader(precision),fragmentShader:particleFragmentShader(precision)}),this._clearBytes=gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT,this},WebGLRenderer2D.prototype.setBlending=function(blending){var gl=this.context;if(blending!==this._lastBlending){switch(blending){case Blending.None:gl.disable(gl.BLEND);break;case Blending.Additive:gl.enable(gl.BLEND),gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.SRC_ALPHA,gl.ONE);break;case Blending.Subtractive:gl.enable(gl.BLEND),gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_COLOR);break;case Blending.Muliply:gl.enable(gl.BLEND),gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.SRC_COLOR);break;case Blending.Default:default:gl.enable(gl.BLEND),gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD),gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}this._lastBlending=blending}},WebGLRenderer2D.prototype.render=function(scene,camera){var gl,lastBackground,background,components,sprite2ds,particleSystems,sprite2d,particleSystem,transform2d,i,canvas,w,h;if(this._context){for(gl=this.context,lastBackground=this._lastBackground,background=scene.world.background,components=scene.components,sprite2ds=components.Sprite||EMPTY_ARRAY,particleSystems=components.ParticleSystem||EMPTY_ARRAY,(lastBackground.r!==background.r||lastBackground.g!==background.g||lastBackground.b!==background.b)&&(lastBackground.copy(background),gl.clearColor(background.r,background.g,background.b,1)),this._lastCamera!==camera&&(canvas=this.canvas,w=canvas.pixelWidth,h=canvas.pixelHeight,camera.set(w,h),gl.viewport(0,0,w,h),this._lastResizeFn&&canvas.off("resize",this._lastResizeFn),this._lastResizeFn=function(){var w=this.pixelWidth,h=this.pixelHeight;camera.set(w,h),gl.viewport(0,0,w,h)},canvas.on("resize",this._lastResizeFn),this._lastCamera=camera),gl.clear(this._clearBytes),i=sprite2ds.length;i--;){sprite2d=sprite2ds[i],transform2d=sprite2d.transform2d,transform2d&&(transform2d.updateModelView(camera.view),this.renderSprite(camera,transform2d,sprite2d))}for(i=particleSystems.length;i--;){particleSystem=particleSystems[i],transform2d=particleSystem.transform2d,transform2d&&(transform2d.updateModelView(camera.view),this.renderParticleSystem(camera,transform2d,particleSystem))}}},MAT=new Mat32,MAT4=new Mat4,WebGLRenderer2D.prototype.renderSprite=function(camera,transform2d,sprite2d){var w,h,gl=this.context,webgl=this._webgl,texture=sprite2d.texture,glShader=webgl.shaders[ENUM_SPRITE_SHADER],glBuffer=webgl.buffers[ENUM_SPRITE_BUFFER],glTexture=buildTexture(this,texture),uniforms=glShader.uniforms;MAT4.mmul(camera._projectionMat4,MAT4.fromMat32(transform2d.modelView)),texture&&texture.raw&&(w=texture.invWidth,h=texture.invHeight,webgl.lastShader!==glShader&&(gl.useProgram(glShader.program),webgl.lastShader=glShader),webgl.lastBuffer!==glBuffer&&(bindBuffers(gl,glShader,glBuffer),webgl.lastBuffer=glBuffer),gl.uniformMatrix4fv(uniforms.uMatrix,!1,MAT4.elements),gl.uniform4f(uniforms.uCrop,sprite2d.x*w,sprite2d.y*h,sprite2d.w*w,sprite2d.h*h),gl.uniform2f(uniforms.uSize,sprite2d.width,sprite2d.height),gl.uniform1f(uniforms.uAlpha,sprite2d.alpha),webgl.lastTexture!==glTexture&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,glTexture),gl.uniform1i(uniforms.uTexture,0),webgl.lastTexture=glTexture),gl.drawArrays(gl.TRIANGLE_STRIP,0,glBuffer.vertices))},WebGLRenderer2D.prototype.renderParticleSystem=function(camera,transform2d,particleSystem){var emitter,particles,view,particle,pos,color,glTexture,j,gl=this.context,webgl=this._webgl,glShader=webgl.shaders[ENUM_PARTICLE_SHADER],glBuffer=webgl.buffers[ENUM_SPRITE_BUFFER],vertices=glBuffer.vertices,TRIANGLE_STRIP=gl.TRIANGLE_STRIP,uniforms=glShader.uniforms,uMatrix=uniforms.uMatrix,uPos=uniforms.uPos,uAngle=uniforms.uAngle,uSize=uniforms.uSize,uColor=uniforms.uColor,uAlpha=uniforms.uAlpha,elements=MAT4.elements,blending=this._lastBlending,emitters=particleSystem.emitters,i=emitters.length;if(i){for(;i--;){if(emitter=emitters[i],particles=emitter.particles,view=emitter.worldSpace?camera.view:transform2d.modelView,j=particles.length){for(glTexture=buildTexture(this,emitter.texture),webgl.lastShader!==glShader&&(gl.useProgram(glShader.program),webgl.lastShader=glShader),webgl.lastBuffer!==glBuffer&&(bindBuffers(gl,glShader,glBuffer),webgl.lastBuffer=glBuffer),this.setBlending(emitter.blending),MAT4.mmul(camera._projectionMat4,MAT4.fromMat32(view)),gl.uniformMatrix4fv(uMatrix,!1,elements),webgl.lastTexture!==glTexture&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,glTexture),gl.uniform1i(uniforms.uTexture,0),webgl.lastTexture=glTexture);j--;){particle=particles[j],pos=particle.position,color=particle.color,gl.uniform2f(uPos,pos.x,pos.y),gl.uniform1f(uAngle,particle.angle),gl.uniform1f(uSize,particle.size),gl.uniform3f(uColor,color.r,color.g,color.b),gl.uniform1f(uAlpha,particle.alpha),gl.drawArrays(TRIANGLE_STRIP,0,vertices)}}}this.setBlending(blending)}},WebGLRenderer2D.prototype._handleWebGLContextLost=function(e){e.preventDefault(),Log.warn("WebGLRenderer2D: webgl context was lost"),this._context=!1,this.emit("webglcontextlost",e)},WebGLRenderer2D.prototype._handleWebGLContextRestored=function(e){Log.log("WebGLRenderer2D: webgl context was restored"),this.setDefaults(),this._context=!0,this.emit("webglcontextrestored",e)},COMPILE_ARRAY=[],WebGLRenderer2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/button",[],function(){function Button(name){this.name=name,this.timeDown=-1,this.timeUp=-1,this.frameDown=-1,this.frameUp=-1,this.value=!1,this._first=!0,this._SYNC={}}return Button.prototype.toSYNC=function(json){return json||(json=this._SYNC),json.name=this.name,json.timeDown=this.timeDown,json.timeUp=this.timeUp,json.frameDown=this.frameDown,json.frameUp=this.frameUp,json.value=this.value,json},Button.prototype.fromSYNC=function(json){return this.name=json.name,this.timeDown=json.timeDown,this.timeUp=json.timeUp,this.frameDown=json.frameDown,this.frameUp=json.frameUp,this.value=json.value,this},Button.prototype.toJSON=function(json){return json||(json={}),json.name=this.name,json.timeDown=this.timeDown,json.timeUp=this.timeUp,json.frameDown=this.frameDown,json.frameUp=this.frameUp,json.value=this.value,json},Button.prototype.fromJSON=function(json){return this.name=json.name,this.timeDown=json.timeDown,this.timeUp=json.timeUp,this.frameDown=json.frameDown,this.frameUp=json.frameUp,this.value=json.value,this},Button}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/buttons",["odin/base/time","odin/core/input/button","odin/core/game/log"],function(Time,Button,Log){function Buttons(){Array.call(this),this.hash={},this._SYNC={},this.add("mouse0"),this.add("mouse1"),this.add("mouse2")}return Buttons.prototype=Object.create(Array.prototype),Buttons.prototype.constructor=Buttons,Buttons.prototype.add=function(name){if(this.hash[name]){return Log.error("Buttons.add: Buttons already have Button name "+name),void 0}var button=new Button(name);return this.push(button),this.hash[name]=button,button},Buttons.prototype.get=function(name){return this.hash[name]},Buttons.prototype.on=function(name){var button=this.hash[name]||this.add(name);button._first&&(button.frameDown=Time.frameCount+1,button.timeDown=Time.stamp(),button._first=!1),button.value=!0},Buttons.prototype.off=function(name){var button=this.hash[name]||this.add(name);button.frameUp=Time.frameCount+1,button.timeUp=Time.stamp(),button.value=!1,button._first=!0},Buttons.prototype.toSYNC=function(json){json||(json=this._SYNC);var i,jsonButtons=json.buttons||(json.buttons=[]);for(i=this.length;i--;){jsonButtons[i]=this[i].toSYNC(jsonButtons[i])}return json},Buttons.prototype.fromSYNC=function(json){var button,jsonButton,i,buttonHash=this.hash,jsonButtons=json.buttons||(json.buttons=[]);for(i=jsonButtons.length;i--;){jsonButton=jsonButtons[i],(button=buttonHash[jsonButton.name])?button.fromSYNC(jsonButton):this.add(jsonButton.name).fromJSON(jsonButton)}return this},Buttons.prototype.toJSON=function(json){json||(json={});var i,jsonButtons=json.buttons||(json.buttons=[]);for(i=this.length;i--;){jsonButtons[i]=this[i].toJSON(jsonButtons[key])}return json},Buttons.prototype.fromJSON=function(json){var button,jsonButton,i,buttonHash=this.hash,jsonButtons=json.buttons||(json.buttons=[]);for(i=jsonButtons.length;i--;){jsonButton=jsonButtons[i],(button=buttonHash[jsonButton.name])?button.fromJSON(jsonButton):this.add(jsonButton.name).fromJSON(jsonButton)}return this},Buttons}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/axis",["odin/core/enums"],function(Enums){function Axis(opts){opts||(opts={}),this.name=void 0!=opts.name?opts.name:"unknown",this.negButton=void 0!=opts.negButton?opts.negButton:"",this.posButton=void 0!=opts.posButton?opts.posButton:"",this.altNegButton=void 0!=opts.altNegButton?opts.altNegButton:"",this.altPosButton=void 0!=opts.altPosButton?opts.altPosButton:"",this.gravity=void 0!=opts.gravity?opts.gravity:3,this.sensitivity=void 0!=opts.sensitivity?opts.sensitivity:3,this.dead=void 0!=opts.dead?opts.dead:.001,this.type=void 0!=opts.type?opts.type:AxisType.BUTTON,this.axis=void 0!=opts.axis?opts.axis:"x",this.index=void 0!=opts.index?opts.index:0,this.joyNum=void 0!=opts.joyNum?opts.joyNum:0,this.value=0,this._SYNC={}}var AxisType=Enums.AxisType;return Axis.prototype.toSYNC=function(json){return json||(json=this._SYNC),json.name=this.name,json.value=this.value,json},Axis.prototype.fromSYNC=function(json){return this.name=json.name,this.value=json.value,this},Axis.prototype.toJSON=function(json){return json||(json={}),json.name=this.name,json.negButton=this.negButton,json.posButton=this.posButton,json.altNegButton=this.altNegButton,json.altPosButton=this.altPosButton,json.gravity=this.gravity,json.sensitivity=this.sensitivity,json.dead=this.dead,json.type=this.type,json.axis=this.axis,json.index=this.index,json.joyNum=this.joyNum,json.value=this.value,json},Axis.prototype.fromJSON=function(json){return this.name=json.name,this.negButton=json.negButton,this.posButton=json.posButton,this.altNegButton=json.altNegButton,this.altPosButton=json.altPosButton,this.gravity=json.gravity,this.sensitivity=json.sensitivity,this.dead=json.dead,this.type=json.type,this.axis=json.axis,this.index=json.index,this.joyNum=json.joyNum,this.value=json.value,this},Axis}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/axes",["odin/core/enums","odin/core/input/axis","odin/core/game/log"],function(Enums,Axis,Log){function Axes(){Array.call(this),this.hash={},this._SYNC={},this.add({name:"horizontal",posButton:"right",negButton:"left",altPosButton:"d",altNegButton:"a",type:AxisType.Button}),this.add({name:"vertical",posButton:"up",negButton:"down",altPosButton:"w",altNegButton:"s",type:AxisType.Button}),this.add({name:"fire",posButton:"ctrl",negButton:"",altPosButton:"mouse0",altNegButton:"",type:AxisType.Button}),this.add({name:"jump",posButton:"space",negButton:"",altPosButton:"mouse2",altNegButton:"",type:AxisType.Button}),this.add({name:"mouseX",type:AxisType.Mouse,axis:"x"}),this.add({name:"mouseY",type:AxisType.Mouse,axis:"y"}),this.add({name:"touchX",type:AxisType.Touch,axis:"x"}),this.add({name:"touchY",type:AxisType.Touch,axis:"y"}),this.add({name:"mouseWheel",type:AxisType.MouseWheel})}var AxisType=Enums.AxisType;return Axes.prototype=Object.create(Array.prototype),Axes.prototype.constructor=Axes,Axes.prototype.add=function(name,opts){if("object"==typeof name&&(opts=name,name=opts.name),this.hash[name]){return Log.error("Axes.add: Axes already have Axis named "+name+' use Axes.get("'+name+'") and edit it instead'),void 0}opts||(opts={}),opts.name=name;var axis=new Axis(opts);return this.push(axis),this.hash[name]=axis,axis},Axes.prototype.get=function(name){return this.hash[name]},Axes.prototype.toSYNC=function(json){json||(json=this._SYNC);var i,jsonAxes=json.axes||(json.axes=[]);for(i=this.length;i--;){jsonAxes[i]=this[i].toSYNC(jsonAxes[i])}return json},Axes.prototype.fromSYNC=function(json){var axis,jsonAxis,i,axisHash=this.hash,jsonAxes=json.axes||(json.axes=[]);for(i=jsonAxes.length;i--;){jsonAxis=jsonAxes[i],(axis=axisHash[jsonAxis.name])?axis.fromSYNC(jsonAxis):this.add(jsonAxis.name).fromJSON(jsonAxis)}return this},Axes.prototype.toJSON=function(json){json||(json={});var i,jsonAxes=json.axes||(json.axes=[]);for(i=this.length;i--;){jsonAxes[i]=this[i].toJSON(jsonAxes[i])}return json},Axes.prototype.fromJSON=function(json){var axis,jsonAxis,i,axisHash=this.hash,jsonAxes=json.axes||(json.axes=[]);for(i=jsonAxes.length;i--;){jsonAxis=jsonAxes[i],(axis=axisHash[jsonAxis.name])?axis.fromJSON(jsonAxis):this.add(jsonAxis.name).fromJSON(jsonAxis)}return this},Axes}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/touch",["odin/math/vec2"],function(Vec2){function Touch(){this.id=-1,this.delta=new Vec2,this.position=new Vec2,this._last=new Vec2,this._first=!1,this._SYNC={}}return Touch.prototype.clear=function(){return this.id=-1,this.position.set(0,0),this.delta.set(0,0),this._last.set(0,0),this._first=!1,this},Touch.prototype.fromEvent=function(e){var position=this.position,delta=this.delta,last=this._last,first=this._first,element=e.target||e.srcElement,offsetX=element.offsetLeft,offsetY=element.offsetTop,x=(e.pageX||e.clientX)-offsetX,y=(e.pageY||e.clientY)-offsetY;return last.x=first?position.x:x,last.y=first?position.y:y,position.x=x,position.y=y,delta.x=position.x-last.x,delta.y=position.y-last.y,this._first=!0,this},Touch.prototype.toSYNC=function(json){return json||(json=this._SYNC),json.id=this.id,json.delta=this.delta.toJSON(json.delta),json.position=this.position.toJSON(json.position),json._last=this._last.toJSON(json._last),json._first=this._first,json},Touch.prototype.fromSYNC=function(json){return this.id=json.id,this.delta.fromJSON(json.delta),this.position.fromJSON(json.position),this._last.fromJSON(json._last),this._first=json._first,this},Touch.prototype.toJSON=function(json){return json||(json={}),json.id=this.id,json.delta=this.delta.toJSON(json.delta),json.position=this.position.toJSON(json.position),json._last=this._last.toJSON(json._last),json._first=this._first,json},Touch.prototype.fromJSON=function(json){return this.id=json.id,this.delta.fromJSON(json.delta),this.position.fromJSON(json.position),this._last.fromJSON(json._last),this._first=json._first,this},Touch}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/touches",["odin/base/object_pool","odin/core/input/touch"],function(ObjectPool,Touch){function Touches(){Array.call(this),this._SYNC={}}var TOUCH_POOL=new ObjectPool(Touch),OBJECT_POOL=new ObjectPool(Object);return Touches.prototype=Object.create(Array.prototype),Touches.prototype.constructor=Touches,Touches.TOUCH_POOL=TOUCH_POOL,Touches.prototype.start=function(evtTouch){var touch=TOUCH_POOL.create();return touch.clear(),touch.id=evtTouch.identifier,touch.fromEvent(evtTouch),this.push(touch),touch},Touches.prototype.end=function(i){var touch=this[i];return TOUCH_POOL.removeObject(touch),this.splice(i,1),touch},Touches.prototype.cancel=function(){return TOUCH_POOL.clear(),this.length=0,this},Touches.prototype.move=function(i,evtTouch){var touch=this[i];return touch.fromEvent(evtTouch),touch},Touches.prototype.toSYNC=function(json){json||(json=this._SYNC);var jsonTouches=json.touches||(json.touches=[]),i=this.length;for(jsonTouches.length=0,OBJECT_POOL.clear();i--;){jsonTouches[i]=this[i].toSYNC(OBJECT_POOL.create())}return json},Touches.prototype.fromSYNC=function(json){var jsonTouches=json.touches,i=jsonTouches.length;for(this.length=0,TOUCH_POOL.clear();i--;){this[i]=TOUCH_POOL.create().fromSYNC(jsonTouches[i])}return this},Touches.prototype.toJSON=function(json){json||(json={});var i,jsonTouches=json.touches||(json.touches=[]);for(i=this.length;i--;){jsonTouches[i]=this[i].toJSON(jsonTouches[i])}return json},Touches.prototype.fromJSON=function(json){var touch,i,j,tl,jsonTouches=json.touches;for(i=jsonTouches.length,tl=this.length,j=tl;i--;){tl>i&&(this.splice(j--,1),TOUCH_POOL.removeObject(this[j])),(touch=this[i])?touch.fromJSON(jsonTouches[i]):this[i]=TOUCH_POOL.create().fromJSON(jsonTouches[i])}return this},Touches}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/input",["odin/base/event_emitter","odin/base/object_pool","odin/base/time","odin/math/mathf","odin/math/vec2","odin/math/vec3","odin/core/enums","odin/core/input/buttons","odin/core/input/button","odin/core/input/axes","odin/core/input/axis","odin/core/input/touches"],function(EventEmitter,ObjectPool,Time,Mathf,Vec2,Vec3,Enums,Buttons,Button,Axes,Axis,Touches){function Input(){EventEmitter.call(this),this.axes=new Axes,this.buttons=new Buttons,this.mouseWheel=0,this.mousePosition=new Vec2,this.mouseDelta=new Vec2,this.mouseMoveNeedsUpdate=!1,this.touches=new Touches,this.touchesMoveNeedsUpdate=!1,this.acceleration=new Vec3,this.frameCount=0,this._frameCount=void 0,this.time=0,this._time=void 0,this._SYNC={}}var abs=Math.abs,sign=Mathf.sign,clamp=Mathf.clamp,AxisType=Enums.AxisType,MOUSE_BUTTONS={0:"mouse0",1:"mouse1",2:"mouse2"};return EventEmitter.extend(Input),Input.prototype.update=function(){var button,altButton,axis,value,sensitivity,pos,neg,tmp,i,touch,axes=this.axes,buttons=this.buttons.hash,dt=Time.delta;for(this.frameCount=this._frameCount?this._frameCount:Time.frameCount,this.time=this._time?this._time:Time.stamp(),this.mouseMoveNeedsUpdate=!0,this.touchesMoveNeedsUpdate=!0,i=axes.length;i--;){switch(axis=axes[i],value=axis.value,sensitivity=axis.sensitivity,axis.type){case AxisType.Button:button=buttons[axis.negButton],altButton=buttons[axis.altNegButton],neg=button&&button.value||altButton&&altButton.value,button=buttons[axis.posButton],altButton=buttons[axis.altPosButton],pos=button&&button.value||altButton&&altButton.value;break;case AxisType.Mouse:axis.value=this.mouseDelta[axis.axis];continue;case AxisType.Touch:touch=this.touches[axis.index],axis.value=touch?touch.delta[axis.axis]:0;continue;case AxisType.MouseWheel:value+=this.mouseWheel;break;case AxisType.Joystick:}neg&&(value-=sensitivity*dt),pos&&(value+=sensitivity*dt),pos||neg||0===value||(tmp=abs(value),value-=clamp(sign(value)*axis.gravity*dt,-tmp,tmp)),value=clamp(value,-1,1),abs(value)<=axis.dead&&(value=0),axis.value=value}this.mouseWheel=0},Input.prototype.axis=function(name){var axis=this.axes.hash[name];return axis?axis.value:0},Input.prototype.mouseButton=function(id){var button=this.buttons.hash[MOUSE_BUTTONS[id]];return button&&button.value},Input.prototype.mouseButtonDown=function(id){var button=this.buttons.hash[MOUSE_BUTTONS[id]];return button&&button.value&&button.frameDown>=this.frameCount},Input.prototype.mouseButtonUp=function(id){var button=this.buttons.hash[MOUSE_BUTTONS[id]];return button&&button.frameUp>=this.frameCount},Input.prototype.anyKey=function(){var i,buttons=this.buttons;for(i=buttons.length;i--;){if(buttons[i].value){return!0}}return!1},Input.prototype.anyKeyDown=function(){var button,i,buttons=this.buttons;
for(i=buttons.length;i--;){if((button=buttons[i]).value&&button.frameDown>=this.frameCount){return!0}}return!1},Input.prototype.key=function(name){var button=this.buttons.hash[name];return button&&button.value},Input.prototype.keyDown=function(name){var button=this.buttons.hash[name];return button&&button.value&&button.frameDown>=this.frameCount},Input.prototype.keyUp=function(name){var button=this.buttons.hash[name];return button&&button.frameUp>=this.frameCount},Input.prototype.toSYNC=function(json){return json||(json=this._SYNC),json._frameCount=Time.frameCount,json._time=Time.stamp(),json.buttons=this.buttons.toSYNC(json.buttons),json.mousePosition=this.mousePosition.toJSON(json.mousePosition),json.mouseDelta=this.mouseDelta.toJSON(json.mouseDelta),json.acceleration=this.acceleration.toJSON(json.acceleration),json.touches=this.touches.toSYNC(json.touches),json},Input.prototype.fromSYNC=function(json){return this._frameCount=json._frameCount,this._time=json._time,this.buttons.fromSYNC(json.buttons),this.mousePosition.fromJSON(json.mousePosition),this.mouseDelta.fromJSON(json.mouseDelta),this.acceleration.fromJSON(json.acceleration),this.touches.fromSYNC(json.touches),this},Input.prototype.toJSON=function(json){return json||(json={}),json.buttons=this.buttons.toJSON(json.buttons),json.axes=this.axes.toJSON(json.axes),json.mousePosition=this.mousePosition.toJSON(json.mousePosition),json.mouseDelta=this.mouseDelta.toJSON(json.mouseDelta),json.acceleration=this.acceleration.toJSON(json.acceleration),json.touches=this.touches.toJSON(json.touches),json},Input.prototype.fromJSON=function(json){return this.buttons.fromJSON(json.buttons),this.axes.fromJSON(json.axes),this.mousePosition.fromJSON(json.mousePosition),this.mouseDelta.fromJSON(json.mouseDelta),this.acceleration.fromJSON(json.acceleration),this.touches.fromJSON(json.touches),this},new Input}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/handler",["odin/base/event_emitter","odin/base/dom","odin/base/object_pool","odin/math/vec2","odin/core/input/input"],function(EventEmitter,Dom,ObjectPool,Vec2,Input){function Handler(){EventEmitter.call(this),this.element=void 0}function handleDevicemotion(e){var acceleration,acc=e.accelerationIncludingGravity;acc&&(acc.x||acc.y||acc.z)&&(acceleration=this.acceleration,acceleration.x=acc.x,acceleration.y=acc.y,acceleration.z=acc.z,this.emit("acceleration"))}function handleTouches(e){e.preventDefault();var i,touches=this.touches,evtTouches=e.touches,changedTouches=e.changedTouches;switch(e.type){case"touchstart":for(i=evtTouches.length;i--;){this.emit("touchstart",touches.start(evtTouches[i]))}break;case"touchend":for(i=changedTouches.length;i--;){this.emit("touchend",touches.end(i))}break;case"touchcancel":touches.cancel(),this.emit("touchcancel");break;case"touchmove":if(this.touchesMoveNeedsUpdate){for(i=changedTouches.length;i--;){this.emit("touchmove",touches.move(i,changedTouches[i]))}this.touchesMoveNeedsUpdate=!1}}}function handleMouse(e){switch(e.preventDefault(),e.type){case"mousedown":this.buttons.on(MOUSE_BUTTONS[e.button]),updateMousePosition(this,e),this.emit("mousedown");break;case"mouseup":this.buttons.off(MOUSE_BUTTONS[e.button]),updateMousePosition(this,e),this.emit("mouseup");break;case"mouseout":this.buttons.off(MOUSE_BUTTONS[e.button]),updateMousePosition(this,e),this.emit("mouseout");break;case"mousewheel":case"DOMMouseScroll":mouseWheel=max(-1,min(1,e.wheelDelta||-e.detail)),this.mouseWheel=mouseWheel,this.emit("mousewheel",mouseWheel);break;case"mousemove":this.mouseMoveNeedsUpdate&&(updateMousePosition(this,e),this.mouseMoveNeedsUpdate=!1),this.emit("mousemove")}}function updateMousePosition(input,e){var position=input.mousePosition,delta=input.mouseDelta,element=e.target||e.srcElement,offsetX=element.offsetLeft||0,offsetY=element.offsetTop||0,x=(e.pageX||e.clientX)-offsetX,y=(e.pageY||e.clientY)-offsetY;mouseLast.x=mouseFirst?position.x:x,mouseLast.y=mouseFirst?position.y:y,position.x=x,position.y=y,delta.x=position.x-mouseLast.x,delta.y=position.y-mouseLast.y,mouseFirst=!0}function handleKeys(e){e.preventDefault();var key;switch(e.type){case"keydown":key=KEY_CODES[e.keyCode],this.buttons.on(key),this.emit("keydown",key);break;case"keyup":key=KEY_CODES[e.keyCode],this.buttons.off(key),this.emit("keyup",key)}}var mouseFirst,mouseLast,mouseWheel,MOUSE_BUTTONS,KEY_CODES,i,min=Math.min,max=Math.max,addEvent=Dom.addEvent,removeEvent=Dom.removeEvent;for(EventEmitter.extend(Handler),Handler.prototype.setElement=function(element){this.element&&this.removeElement(),this.element=element,addEvent(element,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",handleMouse,Input),addEvent(top,"keydown keyup",handleKeys,Input),addEvent(element,"touchstart touchmove touchend touchcancel",handleTouches,Input),addEvent(window,"devicemotion",handleDevicemotion,Input)},Handler.prototype.removeElement=function(){if(this.element){var element=this.element;removeEvent(element,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",handleMouse,Input),removeEvent(top,"keydown keyup",handleKeys,Input),removeEvent(element,"touchstart touchmove touchend touchcancel",handleTouches,Input),removeEvent(window,"devicemotion",handleDevicemotion,Input),this.element=void 0}},mouseFirst=!1,mouseLast=new Vec2,mouseWheel=0,MOUSE_BUTTONS={0:"mouse0",1:"mouse1",2:"mouse2"},KEY_CODES={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},i=48;90>=i;i++){KEY_CODES[i]=String.fromCharCode(i).toLowerCase()}return new Handler}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/game",["odin/base/class","odin/base/device","odin/base/socket.io","odin/base/time","odin/math/mathf","odin/core/game/config","odin/core/game/base_game","odin/core/game/log","odin/core/rendering/canvas","odin/core/rendering/canvas_renderer_2d","odin/core/rendering/webgl_renderer_2d","odin/core/game_object","odin/core/components/component","odin/core/scene","odin/core/input/input","odin/core/input/handler"],function(Class,Device,io,Time,Mathf,Config,BaseGame,Log,Canvas,CanvasRenderer2D,WebGLRenderer2D,GameObject,Component,Scene,Input,Handler){function Game(opts){opts||(opts={}),Config.fromJSON(opts),BaseGame.call(this,opts),this._handler=Handler,this.input=Input,this.scene=void 0,this.camera=void 0,this.canvas=new Canvas(opts.width,opts.height),this.CanvasRenderer2D=void 0,this.WebGLRenderer2D=void 0,this._CanvasRenderer2DOptions=opts.CanvasRenderer2DOptions,this._WebGLRenderer2DOptions=opts.WebGLRenderer2DOptions,this.renderer=void 0,this.customRenderer=void 0}var frameCount,last,time,delta,fpsFrame,fpsLast,fpsTime,now=Time.now;return BaseGame.extend(Game),Game.prototype.init=function(){return this.canvas.init(),this._loop.init(),this.emit("init"),this},Game.prototype.setScene=function(scene){return"string"==typeof scene?scene=this._sceneNameHash[scene]:"number"==typeof scene&&(scene=this.scenes[scene]),this._sceneNameHash[scene.name]&&this._sceneHash[scene._id]?(scene=Class.fromJSON(scene),scene.game=this,scene.init(),this.scene=scene,this.emit("setScene",this.scene)):Log.error("Game.setScene: Scene is not a member of Game"),this},Game.prototype.setCamera=function(gameObject){if(!(gameObject instanceof GameObject)){return Log.error("Game.setCamera: can't set argument to Game's Active Camera, it's not an instance of GameObject"),this}var index,scene=this.scene,lastCamera=this.camera;return scene?(index=scene.gameObjects.indexOf(gameObject),-1===index&&(Log.warn("Game.setCamera: GameObject is not a member of the active Scene, adding it..."),scene.addGameObject(gameObject)),this.camera=gameObject.camera||gameObject.camera2d,this.camera?(this.camera._active=!0,lastCamera&&(lastCamera._active=!1),this.updateRenderer(),this.emit("setCamera",this.camera)):Log.error("Game.setCamera: GameObject does't have a Camera or a Camera2D Component"),this):(Log.error("Game.setCamera: can't set camera without an active scene, use Game.setScene first"),this)},Game.prototype.updateRenderer=function(){var gameObject,camera=this.camera,lastRenderer=this.renderer,canvas=this.canvas;return camera?(gameObject=camera.gameObject,"function"==typeof this.customRenderer?(this.renderer=this.customRenderer,Log.log("Game: setting up custom renderer "+this.customRenderer.name)):gameObject.camera?Log.warn("Game.updateRenderer: no renderer for camera component yet"):gameObject.camera2d&&(!Config.forceCanvas&&Device.webgl?(this.renderer=this.WebGLRenderer2D||(this.WebGLRenderer2D=new WebGLRenderer2D(this._WebGLRenderer2DOptions)),Log.log("Game: setting up WebGLRenderer2D")):Device.canvas?(this.renderer=this.CanvasRenderer2D||(this.CanvasRenderer2D=new CanvasRenderer2D(this._CanvasRenderer2DOptions)),Log.log("Game: setting up CanvasRenderer2D")):Log.error("Game.updateRenderer: Could not get a renderer for this device")),lastRenderer!==this.renderer&&(lastRenderer&&lastRenderer.clear(),this.renderer.init(canvas),Handler.setElement(canvas.element)),void 0):(Log.error("Game: can't set Renderer without a Camera"),void 0)},frameCount=0,last=-1/60,time=0,delta=1/60,fpsFrame=0,fpsLast=0,fpsTime=0,Game.prototype.loop=function(){var camera=this.camera,scene=this.scene,MIN_DELTA=Config.MIN_DELTA,MAX_DELTA=Config.MAX_DELTA;Time.frameCount=frameCount++,last=time,time=now(),Time.sinceStart=time,fpsTime=time,fpsFrame++,fpsTime>fpsLast+1&&(Time.fps=fpsFrame/(fpsTime-fpsLast),fpsLast=fpsTime,fpsFrame=0),delta=(time-last)*Time.scale,Time.delta=MIN_DELTA>delta?MIN_DELTA:delta>MAX_DELTA?MAX_DELTA:delta,Time.time=time*Time.scale,Input.update(),scene&&(scene.update(),camera&&this.renderer.render(scene,camera)),this.emit("update",time)},Game}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/client_game",["odin/base/device","odin/base/socket.io","odin/base/time","odin/math/mathf","odin/core/game/config","odin/core/game/base_game","odin/core/game/log","odin/core/rendering/canvas","odin/core/rendering/canvas_renderer_2d","odin/core/rendering/webgl_renderer_2d","odin/core/game_object","odin/core/components/component","odin/core/scene","odin/core/input/input","odin/core/input/handler","odin/core/assets/assets","odin/core/assets/asset_loader"],function(Device,io,Time,Mathf,Config,BaseGame,Log,Canvas,CanvasRenderer2D,WebGLRenderer2D,GameObject,Component,Scene,Input,Handler,Assets,AssetLoader){function ClientGame(opts){opts||(opts={}),Config.fromJSON(opts),BaseGame.call(this,opts),this.io=void 0,this._sessionid=void 0,this._inputStamp=0,this._deltaState=Config.SCENE_SYNC_RATE+Config.FAKE_LAG,this._lag=Config.FAKE_LAG,this._handler=Handler,this.input=Input,this.scene=void 0,this.camera=void 0,this.canvas=new Canvas(opts.width,opts.height),this.CanvasRenderer2D=void 0,this.WebGLRenderer2D=void 0,this._CanvasRenderer2DOptions=opts.CanvasRenderer2DOptions,this._WebGLRenderer2DOptions=opts.WebGLRenderer2DOptions,this.renderer=void 0,this.customRenderer=void 0}var frameCount,last,time,delta,fpsFrame,fpsLast,fpsTime,now=Time.now,stamp=Time.stamp;return BaseGame.extend(ClientGame),ClientGame.prototype.init=function(){return this.canvas.init(),this._loop.init(),this.emit("init"),this},ClientGame.prototype.connect=function(handler){var lastState,canvasOnResize,self=this,socket=this.io=io.connect(Config.host+":"+Config.port);return socket.on("connect",function(){self._sessionid||(self._sessionid=this.socket.sessionid),self._sessionid!==this.socket.sessionid&&location.reload(),socket.emit("client_device",Device)}),socket.on("server_ready",function(game,assets){Assets.fromServerJSON(assets),AssetLoader.load(function(){self.fromServerJSON(game),socket.emit("client_ready"),self.emit("connect",socket),handler&&handler.call(self,socket)})}),socket.on("server_sync_input",function(timeStamp){self._inputStamp=timeStamp-2*Config.FAKE_LAG,socket.emit("client_sync_input",Input.toSYNC(),stamp())}),lastState=0,socket.on("server_sync_scene",function(jsonScene,serverTimeStamp){var timeStamp,lag,scene=self.scene;scene&&(timeStamp=stamp(),lag=timeStamp-serverTimeStamp+Config.FAKE_LAG,self._lag=lag,self._deltaState=timeStamp-(lastState||timeStamp-Config.SCENE_SYNC_RATE-lag),lastState=timeStamp-lag,self.emit("serverSyncScene",jsonScene),Config.SYNC_SERVER_SCENE&&scene.fromSYNC(jsonScene))}),socket.on("server_setScene",function(scene_id){var scene=self.findByServerId(scene_id);self.setScene(scene)}),socket.on("server_setCamera",function(camera_id){if(!self.scene){return Log.error("Socket:server_setCamera: can't set camera without an active scene, use ServerGame.setScene first"),void 0}var camera=self.scene.findByServerId(camera_id),canvas=self.canvas;return camera?(self.setCamera(camera),canvasOnResize&&canvas.off("resize",canvasOnResize),canvas.on("resize",canvasOnResize=function(){socket.emit("client_resize",this.pixelWidth,this.pixelHeight)}),socket.emit("client_resize",canvas.pixelWidth,canvas.pixelHeight),void 0):(Log.error("Socket:server_setCamera: can't find camera in active scene"),void 0)}),socket.on("server_addScene",function(scene){self.addScene((new Scene).fromServerJSON(scene))}),socket.on("server_addGameObject",function(scene_id,gameObject){var scene=self.findByServerId(scene_id);scene&&scene.addGameObject((new GameObject).fromServerJSON(gameObject))}),socket.on("server_addComponent",function(scene_id,gameObject_id,component){var gameObject,scene=self.findByServerId(scene_id);scene&&(gameObject=scene.findByServerId(gameObject_id),gameObject&&gameObject.addComponent(new Component._types[component._type].fromServerJSON(component)))}),socket.on("server_removeScene",function(scene_id){self.removeScene(self.findByServerId(scene_id))}),socket.on("server_removeGameObject",function(scene_id,gameObject_id){var scene=self.findByServerId(scene_id);scene&&scene.removeGameObject(scene.findByServerId(gameObject_id))}),socket.on("server_removeComponent",function(scene_id,gameObject_id,component_type){var gameObject,scene=self.findByServerId(scene_id);scene&&(gameObject=scene.findByServerId(gameObject_id),gameObject&&gameObject.removeComponent(gameObject.getComponent(component_type)))}),this},ClientGame.prototype.disconnect=function(){var socket=this.io;return socket.disconnect(),socket.removeAllListeners(),this._sessionid=void 0,this},ClientGame.prototype.setScene=function(scene){if("string"==typeof scene&&(scene=this._sceneNameHash[scene]),!(scene instanceof Scene)){return Log.error("ClientGame.setScene: can't add passed argument, it is not an instance of Scene"),this}var scenes=this.scenes,index=scenes.indexOf(scene);return-1!==index?(this.scene=scene,this.emit("setScene",this.scene)):Log.error("ClientGame.setScene: Scene is not a member of ClientGame"),this},ClientGame.prototype.setCamera=function(gameObject){if(!(gameObject instanceof GameObject)){return Log.error("Scene.addGameObject: can't add argument to Scene, it's not an instance of GameObject"),this}var index,scene=this.scene,lastCamera=this.camera;return scene?(index=scene.gameObjects.indexOf(gameObject),-1===index&&(Log.warn("ClientGame.setCamera: GameObject is not a member of the active Scene, adding it..."),scene.addGameObject(gameObject)),this.camera=gameObject.camera||gameObject.camera2d,this.camera?(this.camera._active=!0,lastCamera&&(lastCamera._active=!1),this.updateRenderer(),this.emit("setCamera",this.camera)):Log.error("ClientGame.setCamera: GameObject does't have a Camera or a Camera2D Component"),this):(Log.error("ClientGame.setCamera: can't set camera without an active scene, use ClientGame.setScene first"),this)},ClientGame.prototype.updateRenderer=function(){var gameObject,camera=this.camera,lastRenderer=this.renderer,canvas=this.canvas;return camera?(gameObject=camera.gameObject,"function"==typeof this.customRenderer?(this.renderer=this.customRenderer,Log.log("ClientGame: setting up custom renderer "+this.customRenderer.name)):gameObject.camera?Log.warn("ClientGame.updateRenderer: no renderer for camera component yet"):gameObject.camera2d&&(!Config.forceCanvas&&Device.webgl?(this.renderer=this.WebGLRenderer2D||(this.WebGLRenderer2D=new WebGLRenderer2D(this._WebGLRenderer2DOptions)),Log.log("ClientGame: setting up WebGLRenderer2D")):Device.canvas?(this.renderer=this.CanvasRenderer2D||(this.CanvasRenderer2D=new CanvasRenderer2D(this._CanvasRenderer2DOptions)),Log.log("ClientGame: setting up CanvasRenderer2D")):Log.error("ClientGame.updateRenderer: Could not get a renderer for this device")),lastRenderer!==this.renderer&&(lastRenderer&&lastRenderer.clear(),this.renderer.init(canvas),Handler.setElement(canvas.element)),void 0):(Log.error("ClientGame: can't set Renderer without a Camera"),void 0)},frameCount=0,last=-1/60,time=0,delta=1/60,fpsFrame=0,fpsLast=0,fpsTime=0,ClientGame.prototype.loop=function(){var camera=this.camera,scene=this.scene,MIN_DELTA=Config.MIN_DELTA,MAX_DELTA=Config.MAX_DELTA;Time.frameCount=frameCount++,last=time,time=now(),Time.sinceStart=time,fpsTime=time,fpsFrame++,fpsTime>fpsLast+1&&(Time.fps=fpsFrame/(fpsTime-fpsLast),fpsLast=fpsTime,fpsFrame=0),delta=(time-last)*Time.scale,Time.delta=MIN_DELTA>delta?MIN_DELTA:delta>MAX_DELTA?MAX_DELTA:delta,Time.time=time*Time.scale,Input.update(),scene&&(scene.update(),camera&&this.renderer.render(scene,camera)),this.emit("update",time)},ClientGame}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/rect_offset",[],function(){function RectOffset(left,right,top,bottom){this.left=left||0,this.right=right||0,this.top=top||0,this.bottom=bottom||0}var defineProperty=Object.defineProperty;return defineProperty(RectOffset.prototype,"horizontal",{get:function(){return this.left+this.right}}),defineProperty(RectOffset.prototype,"vertical",{get:function(){return this.top+this.bottom}}),RectOffset.prototype.clone=function(){return new RectOffset(this.left,this.right,this.top,this.bottom)},RectOffset.prototype.copy=function(other){return this.left=other.left,this.right=other.right,this.top=other.top,this.bottom=other.bottom,this},RectOffset.prototype.set=function(left,right,top,bottom){return this.left=left,this.right=right,this.top=top,this.bottom=bottom,this},RectOffset.prototype.add=function(rect){return rect.xMin-=this.left,rect.xMax+=this.right,rect.yMin-=this.top,rect.yMax+=this.bottom,rect},RectOffset.prototype.remove=function(rect){return rect.xMin+=this.left,rect.xMax-=this.right,rect.yMin+=this.top,rect.yMax-=this.bottom,rect},RectOffset.prototype.toJSON=function(json){return json||(json={}),json.left=this.left,json.right=this.right,json.top=this.top,json.bottom=this.bottom,json},RectOffset.prototype.fromJSON=function(json){return this.left=json.left,this.right=json.right,this.top=json.top,this.bottom=json.bottom,this},RectOffset.prototype.toString=function(){return"RectOffset( "+this.left+", "+this.right+", "+this.top+", "+this.bottom+" )"},RectOffset}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui_style_state",["odin/math/color"],function(Color){function GUIStyleState(opts){opts||(opts={}),this.background=void 0!=opts.background?opts.background:new Color(1,1,1),this.text=void 0!=opts.text?opts.text:new Color}return GUIStyleState.prototype.clone=function(){return(new GUIStyleState).copy(this)},GUIStyleState.prototype.copy=function(other){return this.background.copy(other.background),this.text.copy(other.text),this},GUIStyleState.prototype.toJSON=function(json){return json||(json={}),json.background=this.background.toJSON(json.background),json.text=this.text.toJSON(json.text),json},GUIStyleState.prototype.fromJSON=function(json){return this.background.fromJSON(json.background),this.text.fromJSON(json.text),this},GUIStyleState}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui_style",["odin/base/class","odin/math/rect_offset","odin/math/vec2","odin/core/enums","odin/core/gui/gui_style_state"],function(Class,RectOffset,Vec2,Enums,GUIStyleState){function GUIStyle(opts){opts||(opts={}),this._id=++GUI_STYLE_ID,this.name=opts.name||"GUIStyle_"+this._id,this.alignment=opts.alignment||TextAnchor.MiddleLeft,this.clipping=opts.alignment||TextClipping.Clip,this.contentOffset=opts.contentOffset||new Vec2,this.fixedHeight=opts.fixedHeight||0,this.fixedWidth=opts.fixedWidth||0,this.normal=new GUIStyleState(opts.normal),this.active=new GUIStyleState(opts.active),this.focused=new GUIStyleState(opts.focused),this.hover=new GUIStyleState(opts.hover),this.font="",this.fontSize=opts.fontSize||0,this.fontStyle=opts.fontStyle||FontStyle.Normal,this.lineHeight=opts.lineHeight||25,this.margin=opts.margin||new RectOffset,this.padding=opts.padding||new RectOffset,this.border=opts.border||new RectOffset,this.overflow=opts.overflow||new RectOffset,this.stretchHeight=void 0!=opts.stretchHeight?opts.stretchHeight:!0,this.stretchWidth=void 0!=opts.stretchWidth?opts.stretchWidth:!0,this.wordWrap=void 0!=opts.wordWrap?opts.wordWrap:!0}var GUI_STYLE_ID=0,FontStyle=Enums.FontStyle,TextAnchor=Enums.TextAnchor,TextClipping=Enums.TextClipping;return GUIStyle.prototype.clone=function(){return(new GUIStyle).copy(this)},GUIStyle.prototype.copy=function(other){return this.name=other.name,this.alignment=other.alignment,this.clipping=other.alignment,this.contentOffset.copy(other.contentOffset),this.fixedHeight=other.fixedHeight||0,this.fixedWidth=other.fixedWidth||0,this.normal.copy(other.normal),this.active.copy(other.active),this.focused.copy(other.focused),this.hover.copy(other.hover),this.font=other.font,this.fontSize=other.fontSize,this.fontStyle=other.fontStyle,this.lineHeight=other.lineHeight,this.margin.copy(other.margin),this.padding.copy(other.padding),this.border.copy(other.border),this.overflow.copy(other.overflow),this.stretchHeight=other.stretchHeight,this.stretchWidth=other.stretchWidth,this.wordWrap=other.wordWrap,this},GUIStyle.prototype.toJSON=function(json){return json||(json={}),json.name=this.name,json.alignment=this.alignment,json.clipping=this.alignment,json.contentOffset=this.contentOffset.toJSON(json.contentOffset),json.fixedHeight=this.fixedHeight||0,json.fixedWidth=this.fixedWidth||0,json.normal=this.normal.toJSON(json.normal),json.active=this.active.toJSON(json.active),json.focused=this.focused.toJSON(json.focused),json.hover=this.hover.toJSON(json.hover),json.font=json.font,json.fontSize=json.fontSize,json.fontStyle=json.fontStyle,json.lineHeight=json.lineHeight,json.margin=this.margin.toJSON(json.margin),json.padding=this.padding.toJSON(json.padding),json.border=this.border.toJSON(json.border),json.overflow=this.overflow.toJSON(json.overflow),json.stretchHeight=this.stretchHeight,json.stretchWidth=this.stretchWidth,json.wordWrap=this.wordWrap,json},GUIStyle.prototype.fromJSON=function(json){return this.name=json.name,this.alignment=json.alignment,this.clipping=json.alignment,this.contentOffset.fromJSON(json.contentOffset),this.fixedHeight=json.fixedHeight||0,this.fixedWidth=json.fixedWidth||0,this.normal.fromJSON(json.normal),this.active.fromJSON(json.active),this.focused.fromJSON(json.focused),this.hover.fromJSON(json.hover),this.font=json.font,this.fontSize=json.fontSize,this.fontStyle=json.fontStyle,this.lineHeight=json.lineHeight,this.margin.fromJSON(json.margin),this.padding.fromJSON(json.padding),this.border.fromJSON(json.border),this.overflow.fromJSON(json.overflow),this.stretchHeight=json.stretchHeight,this.stretchWidth=json.stretchWidth,this.wordWrap=json.wordWrap,this},GUIStyle}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/world/world_2d",["odin/base/time","odin/math/color","odin/core/world/world","odin/phys2d/phys2d"],function(Time,Color,World,Phys2D){function World2D(opts){opts||(opts={}),World.call(this,opts),this.space=new Phys2D.P2Space(opts.space)}return World.extend(World2D),World2D.prototype.init=function(){for(var space=this.space,scene=this.scene,RigidBodies=scene.components.RigidBody2D,i=RigidBodies.length;i--;){space.addBody(RigidBodies[i].body)}scene.on("addRigidBody2D",function(component){space.addBody(component.body)}),scene.on("removeRigidBody2D",function(component){space.removeBody(component.body)})},World2D.prototype.update=function(){this.space.step(Time.fixedDelta)},World2D.prototype.clear=function(){return World.prototype.clear.call(this),this},World2D.prototype.toSYNC=function(json){return json=World.prototype.toSYNC.call(this,json)},World2D.prototype.fromSYNC=function(json){return World.prototype.fromSYNC.call(this,json),this},World2D.prototype.toJSON=function(json){return json=World.prototype.toJSON.call(this,json),json.space=this.space.toJSON(json.space),json},World2D.prototype.fromServerJSON=function(json){return World.prototype.fromServerJSON.call(this,json),this.space.fromJSON(json.space),this},World2D.prototype.fromJSON=function(json){return World.prototype.fromJSON.call(this,json),this.space.fromJSON(json.space),this},World2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/aabb3",["odin/math/mathf","odin/math/vec3"],function(Mathf,Vec3){function AABB3(min,max){this.min=min||new Vec3(1/0,1/0,1/0),this.max=max||new Vec3(-1/0,-1/0,-1/0)}return AABB3.prototype.clone=function(){return new AABB3(this.min.clone(),this.max.clone())},AABB3.prototype.copy=function(other){return this.min.copy(other.min),this.max.copy(other.max),this},AABB3.prototype.set=function(min,max){return this.min.copy(min),this.max.copy(max),this},AABB3.prototype.expandPoint=function(v){return this.min.min(v),this.max.max(v),this},AABB3.prototype.expandVec=function(v){return this.min.sub(v),this.max.add(v),this},AABB3.prototype.expandScalar=function(s){return this.min.ssub(s),this.max.sadd(s),this},AABB3.prototype.union=function(other){return this.min.min(other.min),this.max.max(other.max),this},AABB3.prototype.clear=function(){return this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0),this},AABB3.prototype.contains=function(point){var min=this.min,max=this.max,px=point.x,py=point.y,pz=point.z;return!(px<min.x||px>max.x||py<min.y||py>max.y||pz<min.z||pz>max.z)},AABB3.prototype.intersects=function(other){var aMin=this.min,aMax=this.max,bMin=other.min,bMax=other.max;return!(bMax.x<aMin.x||bMin.x>aMax.x||bMax.y<aMin.y||bMin.y>aMax.y||bMax.z<aMin.z||bMin.z>aMax.z)},AABB3.prototype.fromPoints=function(points){for(var v,x,y,z,i=points.length,minx=1/0,miny=1/0,minz=1/0,maxx=-1/0,maxy=-1/0,maxz=-1/0,min=this.min,max=this.max;i--;){v=points[i],x=v.x,y=v.y,z=v.z,minx=minx>x?x:minx,miny=miny>y?y:miny,minz=minz>z?z:minz,maxx=x>maxx?x:maxx,maxy=y>maxy?y:maxy,maxz=z>maxz?z:maxz}return min.x=minx,min.y=miny,min.z=minz,max.x=maxx,max.y=maxy,max.z=maxz,this},AABB3.prototype.fromCenterSize=function(center,size){var min=this.min,max=this.max,x=center.x,y=center.y,z=center.z,hx=.5*size.x,hy=.5*size.y,hz=.5*size.z;return min.x=x-hx,min.y=y-hy,min.z=z-hz,max.x=x+hx,max.y=y+hy,max.z=z+hz,this},AABB3.prototype.fromJSON=function(json){return this.min.fromJSON(json.min),this.max.fromJSON(json.max),this},AABB3.prototype.toJSON=function(json){return json||(json={}),json.min=this.min.toJSON(json.min),json.max=this.max.toJSON(json.max),json},AABB3.prototype.toString=function(){var min=this.min,max=this.max;return"AABB3( min: "+min+", max: "+max+" )"},AABB3}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat2",[],function(){function Mat2(m11,m12,m21,m22){var te=new Float32Array(4);this.elements=te,te[0]=void 0!==m11?m11:1,te[2]=m12||0,te[1]=m21||0,te[3]=void 0!==m22?m22:1}var cos=Math.cos,sin=Math.sin,atan2=Math.atan2;return Mat2.prototype.clone=function(){var te=this.elements;return new Mat2(te[0],te[1],te[2],te[3])},Mat2.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],this},Mat2.prototype.set=function(m11,m12,m21,m22){var te=this.elements;return te[0]=m11,te[2]=m12,te[1]=m21,te[3]=m22,this},Mat2.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[2],a21=ae[1],a22=ae[3],b11=be[0],b12=be[2],b21=be[1],b22=be[3];return ae[0]=a11*b11+a21*b12,ae[1]=a12*b11+a22*b12,ae[2]=a11*b21+a21*b22,ae[3]=a12*b21+a22*b22,this},Mat2.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[2],a21=ae[1],a22=ae[3],b11=be[0],b12=be[2],b21=be[1],b22=be[3];return te[0]=a11*b11+a21*b12,te[1]=a12*b11+a22*b12,te[2]=a11*b21+a21*b22,te[3]=a12*b21+a22*b22,this},Mat2.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,this},Mat2.prototype.sdiv=function(s){var te=this.elements;return s=0!==s?1/s:1,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,this},Mat2.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=1,this},Mat2.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,this},Mat2.prototype.determinant=function(){var te=this.elements;return te[0]*te[3]-te[2]*te[1]},Mat2.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[2],m21=te[1],m22=te[3],det=m11*m22-m12*m21;return det=0!==det?1/det:0,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,this},Mat2.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[2],m21=me[1],m22=me[3],det=m11*m22-m12*m21;return det=0!==det?1/det:0,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,this},Mat2.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[2],te[2]=tmp,this},Mat2.prototype.setTrace=function(x,y){var te=this.elements;return te[0]=x,te[3]=y,this},Mat2.prototype.setRotation=function(angle){var te=this.elements,c=cos(angle),s=sin(angle);return te[0]=c,te[1]=s,te[2]=-s,te[3]=c,this},Mat2.prototype.getRotation=function(){var te=this.elements;return atan2(te[1],te[0])},Mat2.prototype.rotate=function(angle){var te=this.elements,m11=te[0],m12=te[2],m21=te[1],m22=te[3],s=sin(angle),c=sin(angle);return te[0]=m11*c+m12*s,te[1]=m11*-s+m12*c,te[2]=m21*c+m22*s,te[3]=m21*-s+m22*c,this},Mat2.prototype.fromMat3=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[3],te[3]=me[4],this},Mat2.prototype.fromMat4=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[4],te[3]=me[5],this},Mat2.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],this},Mat2.prototype.toJSON=function(json){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);return je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],json},Mat2.prototype.toString=function(){var te=this.elements;return"Mat2[ "+te[0]+", "+te[2]+"]\n     [ "+te[1]+", "+te[3]+"]"},Mat2}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat3",[],function(){function Mat3(m11,m12,m13,m21,m22,m23,m31,m32,m33){var te=new Float32Array(9);this.elements=te,te[0]=void 0!==m11?m11:1,te[3]=m12||0,te[6]=m13||0,te[1]=m21||0,te[4]=void 0!==m22?m22:1,te[7]=m23||0,te[2]=m31||0,te[5]=m32||0,te[8]=void 0!==m33?m33:1}var cos=Math.cos,sin=Math.sin;return Mat3.prototype.clone=function(){var te=this.elements;return new Mat3(te[0],te[3],te[6],te[1],te[4],te[7],te[2],te[5],te[8])},Mat3.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],this},Mat3.prototype.set=function(m11,m12,m13,m21,m22,m23,m31,m32,m33){var te=this.elements;return te[0]=m11,te[3]=m12,te[6]=m13,te[1]=m21,te[4]=m22,te[7]=m23,te[2]=m31,te[5]=m32,te[8]=m33,this
},Mat3.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];return ae[0]=a11*b11+a21*b12+a31*b13,ae[3]=a12*b11+a22*b12+a32*b13,ae[6]=a13*b11+a23*b12+a33*b13,ae[1]=a11*b21+a21*b22+a31*b23,ae[4]=a12*b21+a22*b22+a32*b23,ae[7]=a13*b21+a23*b22+a33*b23,ae[2]=a11*b31+a21*b32+a31*b33,ae[5]=a12*b31+a22*b32+a32*b33,ae[8]=a13*b31+a23*b32+a33*b33,this},Mat3.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];return te[0]=a11*b11+a21*b12+a31*b13,te[3]=a12*b11+a22*b12+a32*b13,te[6]=a13*b11+a23*b12+a33*b13,te[1]=a11*b21+a21*b22+a31*b23,te[4]=a12*b21+a22*b22+a32*b23,te[7]=a13*b21+a23*b22+a33*b23,te[2]=a11*b31+a21*b32+a31*b33,te[5]=a12*b31+a22*b32+a32*b33,te[8]=a13*b31+a23*b32+a33*b33,this},Mat3.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,this},Mat3.prototype.sdiv=function(s){var te=this.elements;return s=0===s?0:1/s,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,this},Mat3.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=0,te[4]=1,te[5]=0,te[6]=0,te[7]=0,te[8]=1,this},Mat3.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=0,te[6]=0,te[7]=0,te[8]=0,this},Mat3.prototype.determinant=function(){var te=this.elements,a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},Mat3.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[3],m13=te[6],m21=te[1],m22=te[4],m23=te[7],m31=te[2],m32=te[5],m33=te[8],m0=m22*m33-m23*m32,m3=m13*m32-m12*m33,m6=m12*m23-m13*m22,det=m11*m0+m21*m3+m31*m6;return det=0!==det?1/det:1,te[0]=m0*det,te[1]=(m23*m31-m21*m33)*det,te[2]=(m21*m32-m22*m31)*det,te[3]=m3*det,te[4]=(m11*m33-m13*m31)*det,te[5]=(m12*m31-m11*m32)*det,te[6]=m6*det,te[7]=(m13*m21-m11*m23)*det,te[8]=(m11*m22-m12*m21)*det,this},Mat3.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[3],m13=me[6],m21=me[1],m22=me[4],m23=me[7],m31=me[2],m32=me[5],m33=me[8],m0=m22*m33-m23*m32,m3=m13*m32-m12*m33,m6=m12*m23-m13*m22,det=m11*m0+m21*m3+m31*m6;return det=0!==det?1/det:0,te[0]=m0*det,te[1]=(m23*m31-m21*m33)*det,te[2]=(m21*m32-m22*m31)*det,te[3]=m3*det,te[4]=(m11*m33-m13*m31)*det,te[5]=(m12*m31-m11*m32)*det,te[6]=m6*det,te[7]=(m13*m21-m11*m23)*det,te[8]=(m11*m22-m12*m21)*det,this},Mat3.prototype.inverseMat4=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[4],m13=me[8],m21=me[1],m22=me[5],m23=me[9],m31=me[2],m32=me[6],m33=me[10],m0=m33*m22-m32*m23,m3=-m33*m12+m32*m13,m6=m23*m12-m22*m13,det=m11*m0+m21*m3+m31*m6;return det=0!==det?1/det:0,te[0]=m0*det,te[1]=(-m33*m21+m31*m23)*det,te[2]=(m32*m21-m31*m22)*det,te[3]=m3*det,te[4]=(m33*m11-m31*m13)*det,te[5]=(-m32*m11+m31*m12)*det,te[6]=m6*det,te[7]=(-m23*m11+m21*m13)*det,te[8]=(m22*m11-m21*m12)*det,this},Mat3.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[3],te[3]=tmp,tmp=te[2],te[2]=te[6],te[6]=tmp,tmp=te[5],te[5]=te[7],te[7]=tmp,this},Mat3.prototype.setTrace=function(v){var te=this.elements;return te[0]=v.x,te[4]=v.y,te[8]=v.z,this},Mat3.prototype.scale=function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[3]*=y,te[6]*=z,te[1]*=x,te[4]*=y,te[7]*=z,te[2]*=x,te[5]*=y,te[8]*=z,this},Mat3.prototype.makeScale=function(x,y,z){return this.set(x,0,0,0,y,0,0,0,z)},Mat3.prototype.makeRotationX=function(angle){var c=cos(angle),s=sin(angle);return this.set(1,0,0,0,c,-s,0,s,c)},Mat3.prototype.makeRotationY=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,0,s,0,1,0,-s,0,c)},Mat3.prototype.makeRotationZ=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,-s,0,s,c,0,0,0,1)},Mat3.prototype.fromMat2=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=0,te[3]=me[2],te[4]=me[3],te[5]=0,te[6]=0,te[7]=0,te[8]=1,this},Mat3.prototype.fromMat4=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[4],te[4]=me[5],te[5]=me[6],te[6]=me[8],te[7]=me[9],te[8]=me[10],this},Mat3.prototype.fromQuat=function(q){var te=this.elements,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[1]=xy+wz,te[2]=xz-wy,te[3]=xy-wz,te[4]=1-(xx+zz),te[5]=yz+wx,te[6]=xz+wy,te[7]=yz-wx,te[8]=1-(xx+yy),this},Mat3.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],this},Mat3.prototype.toJSON=function(json){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);return je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],je[4]=te[4],je[5]=te[5],je[6]=te[6],je[7]=te[7],je[8]=te[8],json},Mat3.prototype.toString=function(){var te=this.elements;return"Mat3["+te[0]+", "+te[3]+", "+te[6]+"]\n     ["+te[1]+", "+te[4]+", "+te[7]+"]\n     ["+te[2]+", "+te[5]+", "+te[8]+"]"},Mat3}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/vec4",[],function(){function Vec4(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!==w?w:1}var sqrt=Math.sqrt;return Vec4.prototype.clone=function(){return new Vec4(this.x,this.y,this.z,this.w)},Vec4.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this.z=other.z,this.w=other.w,this},Vec4.prototype.set=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},Vec4.prototype.add=function(other){return this.x+=other.x,this.y+=other.y,this.z+=other.z,this.w+=other.w,this},Vec4.prototype.vadd=function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},Vec4.prototype.sadd=function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},Vec4.prototype.sub=function(other){return this.x-=other.x,this.y-=other.y,this.z-=other.z,this.w-=other.w,this},Vec4.prototype.vsub=function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},Vec4.prototype.ssub=function(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this},Vec4.prototype.mul=function(other){return this.x*=other.x,this.y*=other.y,this.z*=other.z,this.w*=other.w,this},Vec4.prototype.vmul=function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this.w=a.w*b.w,this},Vec4.prototype.smul=function(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},Vec4.prototype.div=function(other){var x=other.x,y=other.y,z=other.z,w=other.w;return this.x*=0!==x?1/x:0,this.y*=0!==y?1/y:0,this.z*=0!==z?1/z:0,this.w*=0!==w?1/w:0,this},Vec4.prototype.vdiv=function(a,b){var x=b.x,y=b.y,z=b.z,w=b.w;return this.x=0!==x?a.x/x:0,this.y=0!==y?a.y/y:0,this.z=0!==z?a.z/z:0,this.w=0!==w?a.w/w:0,this},Vec4.prototype.sdiv=function(s){return s=0===s?0:1/s,this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},Vec4.prototype.length=function(){var x=this.x,y=this.y,z=this.z,w=this.w,lsq=x*x+y*y+z*z+w*w;return 1===lsq?1:lsq>0?sqrt(lsq):0},Vec4.prototype.lengthSq=function(){var x=this.x,y=this.y,z=this.z,w=this.w;return x*x+y*y+z*z+w*w},Vec4.prototype.setLength=function(length){var x=this.x,y=this.y,z=this.z,w=this.w,l=x*x+y*y+z*z+w*w;return 1===l?(this.x*=length,this.y*=length,this.z*=length,this.w*=length,this):(l=l>0?1/sqrt(l):0,this.x*=l*length,this.y*=l*length,this.z*=l*length,this.w*=l*length,this)},Vec4.prototype.normalize=function(){var x=this.x,y=this.y,z=this.z,w=this.w,l=x*x+y*y+z*z+w*w;return 1===l?this:(l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this.z*=l,this.w*=l,this)},Vec4.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},Vec4.prototype.inverseVec=function(other){return this.x=-other.x,this.y=-other.y,this.z=-other.z,this.w=-other.w,this},Vec4.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this.w+=(other.w-this.w)*x,this},Vec4.prototype.vlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z,aw=a.w;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this.w=aw+(b.w-aw)*x,this},Vec4.vdot=Vec4.prototype.vdot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w},Vec4.prototype.dot=function(other){return this.x*other.x+this.y*other.y+this.z*other.z+this.w*other.w},Vec4.prototype.min=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=this.w;return this.x=ax>bx?bx:ax,this.y=ay>by?by:ay,this.z=az>bz?bz:az,this.w=aw>bw?bw:aw,this},Vec4.prototype.max=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=this.w;return this.x=bx>ax?bx:ax,this.y=by>ay?by:ay,this.z=bz>az?bz:az,this.w=bw>aw?bw:aw,this},Vec4.prototype.clamp=function(min,max){var x=this.x,y=this.y,z=this.z,w=this.w,minx=min.x,miny=min.y,minz=min.z,minw=min.w,maxx=max.x,maxy=max.y,maxz=max.z,maxw=maxw;return this.x=minx>x?minx:x>maxx?maxx:x,this.y=miny>y?miny:y>maxy?maxy:y,this.z=minz>z?minz:z>maxz?maxz:z,this.w=minw>w?minw:w>maxw?maxw:w,this},Vec4.prototype.transformMat4=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z,w=this.w;return this.x=x*me[0]+y*me[4]+z*me[8]+w*me[12],this.y=x*me[1]+y*me[5]+z*me[9]+w*me[13],this.z=x*me[2]+y*me[6]+z*me[10]+w*me[14],this.w=x*me[3]+y*me[7]+z*me[11]+w*me[15],this},Vec4.prototype.fromVec2=function(v){return this.x=v.x,this.y=v.y,this.z=0,this.w=1,this},Vec4.prototype.fromVec3=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=1,this},Vec4.prototype.positionFromMat4=function(m){var me=m.elements;return this.x=me[12],this.y=me[13],this.z=me[14],this.w=me[15],this},Vec4.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.z=json.z,this.w=json.w,this},Vec4.prototype.toJSON=function(json){return json||(json={}),json.x=this.x,json.y=this.y,json.z=this.z,json.w=this.w,json},Vec4.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this.z=array[2],this.w=array[3],this},Vec4.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array[2]=this.z,array[3]=this.w,array},Vec4.prototype.toString=function(){return"Vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},Vec4}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/odin",["require","odin/phys2d/phys2d","odin/base/audio_ctx","odin/base/class","odin/base/device","odin/base/dom","odin/base/enum","odin/base/event_emitter","odin/base/object_pool","odin/base/request_animation_frame","odin/base/socket.io","odin/base/time","odin/base/util","odin/core/assets/asset","odin/core/assets/asset_loader","odin/core/assets/assets","odin/core/assets/audio_clip","odin/core/assets/material","odin/core/assets/mesh","odin/core/assets/sprite_sheet","odin/core/assets/texture","odin/core/components/particle_system/particle_system","odin/core/components/audio_source","odin/core/components/camera","odin/core/components/camera_2d","odin/core/components/component","odin/core/components/mesh_filter","odin/core/components/rigid_body_2d","odin/core/components/sprite","odin/core/components/sprite_animation","odin/core/components/transform","odin/core/components/transform_2d","odin/core/game/game","odin/core/game/client_game","odin/core/game/config","odin/core/game/log","odin/core/game/base_game","odin/core/gui/gui","odin/core/gui/gui_content","odin/core/gui/gui_layout","odin/core/gui/gui_style","odin/core/gui/gui_style_state","odin/core/input/handler","odin/core/input/input","odin/core/rendering/canvas_renderer_2d","odin/core/rendering/webgl_renderer_2d","odin/core/enums","odin/core/game_object","odin/core/scene","odin/core/world/world","odin/core/world/world_2d","odin/math/aabb2","odin/math/aabb3","odin/math/color","odin/math/mat2","odin/math/mat3","odin/math/mat32","odin/math/mat4","odin/math/mathf","odin/math/quat","odin/math/rect","odin/math/rect_offset","odin/math/vec2","odin/math/vec3","odin/math/vec4"],function(require){function Odin(){this.Phys2D=require("odin/phys2d/phys2d"),this.AudioCtx=require("odin/base/audio_ctx"),this.Class=require("odin/base/class"),this.Device=require("odin/base/device"),this.Dom=require("odin/base/dom"),this.Enum=require("odin/base/enum"),this.EventEmitter=require("odin/base/event_emitter"),this.ObjectPool=require("odin/base/object_pool"),this.requestAnimationFrame=require("odin/base/request_animation_frame"),this.io=require("odin/base/socket.io"),this.Time=require("odin/base/time"),this.util=require("odin/base/util"),this.Asset=require("odin/core/assets/asset"),this.AssetLoader=require("odin/core/assets/asset_loader"),this.Assets=require("odin/core/assets/assets"),this.AudioClip=require("odin/core/assets/audio_clip"),this.Material=require("odin/core/assets/material"),this.Mesh=require("odin/core/assets/mesh"),this.SpriteSheet=require("odin/core/assets/sprite_sheet"),this.Texture=require("odin/core/assets/texture"),this.ParticleSystem=require("odin/core/components/particle_system/particle_system"),this.AudioSource=require("odin/core/components/audio_source"),this.Camera=require("odin/core/components/camera"),this.Camera2D=require("odin/core/components/camera_2d"),this.Component=require("odin/core/components/component"),this.MeshFilter=require("odin/core/components/mesh_filter"),this.RigidBody2D=require("odin/core/components/rigid_body_2d"),this.Sprite=require("odin/core/components/sprite"),this.SpriteAnimation=require("odin/core/components/sprite_animation"),this.Transform=require("odin/core/components/transform"),this.Transform2D=require("odin/core/components/transform_2d"),this.Game=require("odin/core/game/game"),this.ClientGame=require("odin/core/game/client_game"),this.Config=require("odin/core/game/config"),this.Log=require("odin/core/game/log"),this.BaseGame=require("odin/core/game/base_game"),this.GUI=require("odin/core/gui/gui"),this.GUIContent=require("odin/core/gui/gui_content"),this.GUILayout=require("odin/core/gui/gui_layout"),this.GUIStyle=require("odin/core/gui/gui_style"),this.GUIStyleState=require("odin/core/gui/gui_style_state"),this.Handler=require("odin/core/input/handler"),this.Input=require("odin/core/input/input"),this.CanvasRenderer2D=require("odin/core/rendering/canvas_renderer_2d"),this.WebGLRenderer2D=require("odin/core/rendering/webgl_renderer_2d"),this.Enums=require("odin/core/enums"),this.GameObject=require("odin/core/game_object"),this.Scene=require("odin/core/scene"),this.World=require("odin/core/world/world"),this.World2D=require("odin/core/world/world_2d"),this.AABB2=require("odin/math/aabb2"),this.AABB3=require("odin/math/aabb3"),this.Color=require("odin/math/color"),this.Mat2=require("odin/math/mat2"),this.Mat3=require("odin/math/mat3"),this.Mat32=require("odin/math/mat32"),this.Mat4=require("odin/math/mat4"),this.Mathf=require("odin/math/mathf"),this.Quat=require("odin/math/quat"),this.Rect=require("odin/math/rect"),this.RectOffset=require("odin/math/rect_offset"),this.Vec2=require("odin/math/vec2"),this.Vec3=require("odin/math/vec3"),this.Vec4=require("odin/math/vec4"),this.Device.mobile&&(window.onerror=function(message,page,line){alert("line: "+line+", page: "+page+"\nmessage: "+message)})}var IS_SERVER=!("undefined"!=typeof window&&window.document),IS_CLIENT=!IS_SERVER,defineProperty=Object.defineProperty;return defineProperty(Odin.prototype,"isServer",{get:function(){return IS_SERVER}}),defineProperty(Odin.prototype,"isClient",{get:function(){return IS_CLIENT}}),Odin.prototype.globalize=function(){for(var key in this){window[key]=this[key]}window.Odin=this},new Odin});
//# sourceMappingURL=odin.js.map