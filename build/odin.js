var define;"function"!=typeof define&&(define=require("amdefine")(module)),define("core/game/config",[],function(){function t(){this.debug=!1,this.forceCanvas=!1,this.host="127.0.0.1",this.port=3e3,this.MAX_SERVER_STATES=5,this.SCENE_SYNC_RATE=.5,this.MIN_DELTA=1e-6,this.MAX_DELTA=1}return t.prototype.fromJSON=function(t){for(var e in t){void 0!=this[e]&&(this[e]=t[e])}return this},new t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/game/log",["core/game/config"],function(t){function e(){}var i=Object.prototype.hasOwnProperty;return e.prototype.debug=e.prototype.info=e.prototype.log=function(){t.debug&&console.log.apply(console,arguments)},e.prototype.warn=function(){t.debug&&t.warn&&console.warn.apply(console,arguments)},e.prototype.error=function(){t.debug&&t.error&&console.error.apply(console,arguments)},e.prototype.object=function(e){if(!t.debug){return""}var o,n,r,s="",a=arguments[1]||(arguments[1]=[]);for(o in e){i.call(e,o)&&(n=e[o],~a.indexOf(n)||(r=typeof n,"object"===r?(a.push(n),s+="	"+o+" = "+this.object(n,a)):"function"!==r?s+="	"+o+" = "+n+"\n":a.push(n)))}return s},new e}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/audio_ctx",["core/game/log"],function(t){var e="undefined"!=typeof window?window:global,i=e.AudioContext||e.webkitAudioContext||e.mozAudioContext||e.oAudioContext||e.msAudioContext;return i||t.error("AudioContext not supported by this Browser"),i?new i:!1}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/event_emitter",[],function(){function t(){this._events={}}var e=Array.prototype.shift,i=/[ ,]+/;return t.prototype.on=function(t,e,o){var n,r=t.split(i),s=this._events;for(n=r.length;n--;){t=r[n],(s[t]||(s[t]=[])).push({listener:e,ctx:o||this})}return this},t.prototype.once=function(t,e,i){function o(){n.off(t,o),e.apply(i,arguments)}var n=this;return i=i||this,this.on(t,o,i)},t.prototype.listenTo=function(t,e,i,o){if(!t.on||!t.addEventListenerTo){throw"Can't listen to Object, it's not a instance of EventEmitter"}return t.on(e,i,o||this),this},t.prototype.off=function(t,e,o){var n,r,s,a,h=t.split(i),c=this._events;for(s=h.length;s--;){if(t=h[s],!t){for(s in c){c[s].length=0}return this}if(n=c[t],!n){return this}if(e){for(o=o||this,a=n.length;a--;){if(r=n[a],r.listener===e&&r.ctx===o){n.splice(a,1);break}}}else{n.length=0}}return this},t.prototype.emit=function(t){var i,o,n,r,s,a,h=this._events[t];if(!h||!h.length){return this}switch(arguments.length){case 1:for(a=h.length;a--;){(s=h[a]).listener.call(s.ctx)}break;case 2:for(i=arguments[1],a=h.length;a--;){(s=h[a]).listener.call(s.ctx,i)}break;case 3:for(i=arguments[1],o=arguments[2],a=h.length;a--;){(s=h[a]).listener.call(s.ctx,i,o)}break;case 4:for(i=arguments[1],o=arguments[2],n=arguments[3],a=h.length;a--;){(s=h[a]).listener.call(s.ctx,i,o,n)}break;case 5:for(i=arguments[1],o=arguments[2],n=arguments[3],r=arguments[4],a=h.length;a--;){(s=h[a]).listener.call(s.ctx,i,o,n,r)}break;default:for(e.apply(arguments),a=h.length;a--;){(s=h[a]).listener.apply(s.ctx,arguments)}}return this},t.extend=function(t,e){return e||(e=this),t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.extend=this.extend,e.prototype._onExtend&&e.prototype._onExtend(t),t.prototype._onInherit&&t.prototype._onInherit(e),t},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/class",["base/event_emitter"],function(t){function e(){t.call(this),this._id=++i,this._serverId=-1,this._SYNC={}}var i=0,o=!("undefined"!=typeof window&&window.document),n=!o,r=Object.defineProperty;return t.extend(e),r(e.prototype,"isServer",{get:function(){return o}}),r(e.prototype,"isClient",{get:function(){return n}}),e.prototype.clone=function(){return(new this.constructor).copy(this)},e.prototype.copy=function(){return this},e.prototype.toSYNC=function(t){return t||(t=this._SYNC),t._id=this._id,t},e.prototype.fromSYNC=function(t){return this._SYNC=t,this},e.prototype.toJSON=function(t){return t||(t={}),t._id=this._id,t},e.prototype.fromJSON=function(t){return this._serverId=t._id,this},e}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/device",[],function(){function t(){var t=navigator.userAgent.toLowerCase(),e=new Audio,i=document.createElement("video");this.userAgent=t,this.pixelRatio=window.devicePixelRatio||1,this.invPixelRatio=1/this.pixelRatio,this.browser=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i)[1],this.touch="ontouchstart"in window,this.mobile=/android|webos|iphone|ipad|ipod|blackberry/i.test(t),this.webgl=function(){var t,e,i=document.createElement("canvas"),o=["3d","moz-webgl","experimental-webgl","webkit-3d","webgl"];for(e=o.length;e--&&!(t=!!i.getContext(o[e]));){}return t}(),this.canvas=function(){var t=document.createElement("canvas"),e=!!t.getContext("2d");return e}(),this.gamepads=!!navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.webkitGamepads,this.audioMpeg=!!e.canPlayType("audio/mpeg"),this.audioOgg=!!e.canPlayType("audio/ogg"),this.audioMp4=!!e.canPlayType("audio/mp4"),this.videoWebm=!!i.canPlayType("video/webm"),this.videoOgg=!!i.canPlayType("video/ogg"),this.videoMp4=!!i.canPlayType("video/mp4")}return new t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/dom",["core/game/log"],function(t){function e(){}var i,o=/[ ,]+/,n=/attribute\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,r=/uniform\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,s=["webgl","webkit-3d","moz-webgl","experimental-webgl","3d"],a={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0};return e.prototype.addEvent=function(t,e,i,n){var r,s=e.split(o),a=n||t,h=function(t){i.call(a,t||window.event)};for(r=s.length;r--;){e=s[r],t.attachEvent?t.attachEvent("on"+e,h):t.addEventListener(e,h,!1)}},e.prototype.removeEvent=function(t,e,i,n){var r,s,a=e.split(o),h=n||t,c=function(t){i&&i.call(h,t||window.event)};for(r=0,s=a.length;s>r;r++){e=a[r],t.detachEvent?t.detachEvent("on"+e,c):t.removeEventListener(e,c,!1)}},e.prototype.addMeta=function(t,e,i){var o=document.createElement("meta"),n=document.head;t&&(o.id=t),e&&(o.name=e),i&&(o.content=i),n.insertBefore(o,n.firstChild)},e.prototype.getWebGLContext=function(e,i){var o,n,r;i||(i={});for(o in a){void 0!=i[o]&&(i[o]=a[o])}for(r=s.length;r--;){try{n=e.getContext(s[r],i)}catch(h){t.warn("Dom.getWebGLContext: could not get a WebGL Context "+h.message||"")}if(n){break}}return n},i=e.prototype.createShader=function(e,i,o){var n=e.createShader(o);return e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(t.warn("Dom.createShader: problem compiling shader "+e.getShaderInfoLog(n)),e.deleteShader(n),void 0)},e.prototype.createProgram=function(e,o,n){var r,s=e.createProgram();return r=i(e,o,e.VERTEX_SHADER),e.attachShader(s,r),e.deleteShader(r),r=i(e,n,e.FRAGMENT_SHADER),e.attachShader(s,r),e.deleteShader(r),e.linkProgram(s),e.validateProgram(s),e.useProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(t.warn("Dom.createProgram: problem compiling Program "+e.getProgramInfoLog(s)),e.deleteProgram(s),void 0)},e.prototype.parseUniformsAttributes=function(t,e,i,o,s,a){var h,c,p,u,f,l,m,d=i+o,y=d.split("\n");for(l=y.length;l--;){if(f=y[l],h=f.match(n),c=f.match(r),h&&(p=h[3],s[p]=t.getAttribLocation(e,p)),c){if(p=c[3],u=parseInt(c[5])){for(a[p]=[],m=u;m--;){a[p][m]=t.getUniformLocation(e,p+"["+m+"]")}}else{a[p]=t.getUniformLocation(e,p)}}}},new e}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/enum",[],function(){function t(t){t=e(t)?t:t.split(i);var o=t.length;for(this.__length__=o;o--;){this[t[o]]=o+1}}var e=Array.isArray,i=/[ ,]+/;return t.prototype.add=function(t){t=e(t)?t:t.split(i);var o=t.length,n=this.__length__;for(this.__length__+=o;o--;){this[t[o]]=n+o+1}return this},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/object_pool",[],function(){function t(t){this.pooled=[],this.objects=[],this.object=t}return t.prototype.create=function(){var t=this.pooled,e=t.length?t.pop():new this.object;return this.objects.push(e),e},t.prototype.removeObject=function(t){var e=this.objects,i=this.pooled,o=e.indexOf(t);return o>-1&&(i.push(t),e.splice(o,1)),this},t.prototype.remove=t.prototype.removeObjects=function(){for(var t=arguments.length;t--;){this.removeObject(arguments[t])}return this},t.prototype.clear=function(){var t,e=this.objects,i=this.pooled;for(t=e.length;t--;){i.push(e[t])}return e.length=0,this},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/request_animation_frame",[],function(){var t=1e3/60,e="undefined"!=typeof window?window:global;return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(i){return e.setTimeout(i,t)}}),function(){var io=function(t,e){var i=t;return i.version="0.9.16",i.protocol=1,i.transports=[],i.j=[],i.sockets={},i.connect=function(t,o){var n,r,s,a=i.util.parseUri(t);return e&&e.location&&(a.protocol=a.protocol||e.location.protocol.slice(0,-1),a.host=a.host||(e.document?e.document.domain:e.location.hostname),a.port=a.port||e.location.port),n=i.util.uniqueUri(a),s={host:a.host,secure:"https"==a.protocol,port:a.port||("https"==a.protocol?443:80),query:a.query||""},i.util.merge(s,o),(s["force new connection"]||!i.sockets[n])&&(r=new i.Socket(s)),!s["force new connection"]&&r&&(i.sockets[n]=r),r=r||i.sockets[n],r.of(a.path.length>1?a.path:"")},i}({},this);!function(t,e){var i,o=t.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];o.parseUri=function(t){for(var e=n.exec(t||""),i={},o=14;o--;){i[r[o]]=e[o]||""}return i},o.uniqueUri=function(t){var i=t.protocol,o=t.host,n=t.port;return"document"in e?(o=o||document.domain,n=n||("https"==i&&"https:"!==document.location.protocol?443:document.location.port)):(o=o||"localhost",n||"https"!=i||(n=443)),(i||"http")+"://"+o+":"+(n||80)},o.query=function(t,e){var i,n=o.chunkQuery(t||""),r=[];o.merge(n,o.chunkQuery(e||""));for(i in n){n.hasOwnProperty(i)&&r.push(i+"="+n[i])}return r.length?"?"+r.join("&"):""},o.chunkQuery=function(t){for(var e,i={},o=t.split("&"),n=0,r=o.length;r>n;++n){e=o[n].split("="),e[0]&&(i[e[0]]=e[1])}return i},i=!1,o.load=function(t){return"document"in e&&"complete"===document.readyState||i?t():(o.on(e,"load",t,!1),void 0)},o.on=function(t,e,i,o){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener&&t.addEventListener(e,i,o)},o.request=function(t){if(t&&"undefined"!=typeof XDomainRequest&&!o.ua.hasCORS){return new XDomainRequest}if("undefined"!=typeof XMLHttpRequest&&(!t||o.ua.hasCORS)){return new XMLHttpRequest}if(!t){try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}return null},"undefined"!=typeof window&&o.load(function(){i=!0}),o.defer=function(t){return o.ua.webkit&&"undefined"==typeof importScripts?(o.load(function(){setTimeout(t,100)}),void 0):t()},o.merge=function(t,e,i,n){var r,s=n||[],a="undefined"==typeof i?2:i;for(r in e){e.hasOwnProperty(r)&&o.indexOf(s,r)<0&&("object"==typeof t[r]&&a?o.merge(t[r],e[r],a-1,s):(t[r]=e[r],s.push(e[r])))}return t},o.mixin=function(t,e){o.merge(t.prototype,e.prototype)},o.inherit=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},o.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},o.intersect=function(t,e){var i,n,r=[],s=t.length>e.length?t:e,a=t.length>e.length?e:t;for(i=0,n=a.length;n>i;i++){~o.indexOf(s,a[i])&&r.push(a[i])}return r},o.indexOf=function(t,e,i){for(var o=t.length,i=0>i?0>i+o?0:i+o:i||0;o>i&&t[i]!==e;i++){}return i>=o?-1:i},o.toArray=function(t){var e,i,o=[];for(e=0,i=t.length;i>e;e++){o.push(t[e])}return o},o.ua={},o.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),o.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),o.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(t,e){function i(){}t.EventEmitter=i,i.prototype.on=function(t,i){return this.$events||(this.$events={}),this.$events[t]?e.util.isArray(this.$events[t])?this.$events[t].push(i):this.$events[t]=[this.$events[t],i]:this.$events[t]=i,this},i.prototype.addListener=i.prototype.on,i.prototype.once=function(t,e){function i(){o.removeListener(t,i),e.apply(this,arguments)}var o=this;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,i){var o,n,r,s;if(this.$events&&this.$events[t]){if(o=this.$events[t],e.util.isArray(o)){for(n=-1,r=0,s=o.length;s>r;r++){if(o[r]===i||o[r].listener&&o[r].listener===i){n=r;break}}if(0>n){return this}o.splice(n,1),o.length||delete this.$events[t]}else{(o===i||o.listener&&o.listener===i)&&delete this.$events[t]}}return this},i.prototype.removeAllListeners=function(t){return void 0===t?(this.$events={},this):(this.$events&&this.$events[t]&&(this.$events[t]=null),this)},i.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),e.util.isArray(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]},i.prototype.emit=function(t){var i,o,n,r,s;if(!this.$events){return!1}if(i=this.$events[t],!i){return!1}if(o=Array.prototype.slice.call(arguments,1),"function"==typeof i){i.apply(this,o)}else{if(!e.util.isArray(i)){return!1}for(n=i.slice(),r=0,s=n.length;s>r;r++){n[r].apply(this,o)}}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(t){return 10>t?"0"+t:t}function date(t){return isFinite(t.valueOf())?t.getUTCFullYear()+"-"+f(t.getUTCMonth()+1)+"-"+f(t.getUTCDate())+"T"+f(t.getUTCHours())+":"+f(t.getUTCMinutes())+":"+f(t.getUTCSeconds())+"Z":null}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,o,n,r,s,a=gap,h=e[t];switch(h instanceof Date&&(h=date(t)),"function"==typeof rep&&(h=rep.call(e,t,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h){return"null"}if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(h)){for(r=h.length,i=0;r>i;i+=1){s[i]=str(i,h)||"null"}return n=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,n}if(rep&&"object"==typeof rep){for(r=rep.length,i=0;r>i;i+=1){"string"==typeof rep[i]&&(o=rep[i],n=str(o,h),n&&s.push(quote(o)+(gap?": ":":")+n))}}else{for(o in h){Object.prototype.hasOwnProperty.call(h,o)&&(n=str(o,h),n&&s.push(quote(o)+(gap?": ":":")+n))}}return n=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,n}}var JSON,cx,escapable,gap,indent,meta,rep;return nativeJSON&&nativeJSON.parse?exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}:(JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var o;if(gap="",indent="","number"==typeof i){for(o=0;i>o;o+=1){indent+=" "}}else{"string"==typeof i&&(indent=i)}if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length)){throw new Error("JSON.stringify")}return str("",{"":t})},JSON.parse=function(text,reviver){function walk(t,e){var i,o,n=t[e];if(n&&"object"==typeof n){for(i in n){Object.prototype.hasOwnProperty.call(n,i)&&(o=walk(n,i),void 0!==o?n[i]=o:delete n[i])}}return reviver.call(t,e,n)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j}throw new SyntaxError("JSON.parse")},void 0)}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(t,e){var i,o=t.parser={},n=o.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=o.reasons=["transport not supported","client not handshaken","unauthorized"],s=o.advice=["reconnect"],a=e.JSON,h=e.util.indexOf;o.encodePacket=function(t){var e,i,o,c,p=h(n,t.type),u=t.id||"",f=t.endpoint||"",l=t.ack,m=null;switch(t.type){case"error":e=t.reason?h(r,t.reason):"",i=t.advice?h(s,t.advice):"",(""!==e||""!==i)&&(m=e+(""!==i?"+"+i:""));break;case"message":""!==t.data&&(m=t.data);break;case"event":o={name:t.name},t.args&&t.args.length&&(o.args=t.args),m=a.stringify(o);break;case"json":m=a.stringify(t.data);break;case"connect":t.qs&&(m=t.qs);break;case"ack":m=t.ackId+(t.args&&t.args.length?"+"+a.stringify(t.args):"")}return c=[p,u+("data"==l?"+":""),f],null!==m&&void 0!==m&&c.push(m),c.join(":")},o.encodePayload=function(t){var e,i,o,n="";if(1==t.length){return t[0]}for(e=0,i=t.length;i>e;e++){o=t[e],n+="�"+o.length+"�"+t[e]}return n},i=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/,o.decodePacket=function(t){var e,o,h,c=t.match(i);if(!c){return{}}switch(e=c[2]||"",t=c[5]||"",o={type:n[c[1]],endpoint:c[4]||""},e&&(o.id=e,o.ack=c[3]?"data":!0),o.type){case"error":c=t.split("+"),o.reason=r[c[0]]||"",o.advice=s[c[1]]||"";break;case"message":o.data=t||"";break;case"event":try{h=a.parse(t),o.name=h.name,o.args=h.args}catch(p){}o.args=o.args||[];break;case"json":try{o.data=a.parse(t)}catch(p){}break;case"connect":o.qs=t||"";break;case"ack":if(c=t.match(/^([0-9]+)(\+)?(.*)/),c&&(o.ackId=c[1],o.args=[],c[3])){try{o.args=c[3]?a.parse(c[3]):[]}catch(p){}}break;case"disconnect":case"heartbeat":}return o},o.decodePayload=function(t){var e,i,n;if("�"==t.charAt(0)){for(e=[],i=1,n="";i<t.length;i++){"�"==t.charAt(i)?(e.push(o.decodePacket(t.substr(i+1).substr(0,n))),i+=Number(n)+1,n=""):n+=t.charAt(i)}return e}return[o.decodePacket(t)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e){function i(t,e){this.socket=t,this.sessid=e}t.Transport=i,e.util.mixin(i,e.EventEmitter),i.prototype.heartbeats=function(){return!0},i.prototype.onData=function(t){var i,o,n;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==t&&(i=e.parser.decodePayload(t),i&&i.length)){for(o=0,n=i.length;n>o;o++){this.onPacket(i[o])}}return this},i.prototype.onPacket=function(t){return this.socket.setHeartbeatTimeout(),"heartbeat"==t.type?this.onHeartbeat():("connect"==t.type&&""==t.endpoint&&this.onConnect(),"error"==t.type&&"reconnect"==t.advice&&(this.isOpen=!1),this.socket.onPacket(t),this)},i.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var t=this;this.closeTimeout=setTimeout(function(){t.onDisconnect()},this.socket.closeTimeout)}},i.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},i.prototype.onConnect=function(){return this.socket.onConnect(),this},i.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},i.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},i.prototype.packet=function(t){this.send(e.parser.encodePacket(t))},i.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},i.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},i.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},i.prototype.prepareUrl=function(){var t=this.socket.options;return this.scheme()+"://"+t.host+":"+t.port+"/"+t.resource+"/"+e.protocol+"/"+this.name+"/"+this.sessid},i.prototype.ready=function(t,e){e.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function o(t){if(this.options={port:80,secure:!1,document:"document"in i?document:!1,resource:"socket.io",transports:e.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},e.util.merge(this.options,t),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||e.util.ua.hasCORS)){var o=this;e.util.on(i,"beforeunload",function(){o.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function n(){}t.Socket=o,e.util.mixin(o,e.EventEmitter),o.prototype.of=function(t){return this.namespaces[t]||(this.namespaces[t]=new e.SocketNamespace(this,t),""!==t&&this.namespaces[t].packet({type:"connect"})),this.namespaces[t]},o.prototype.publish=function(){var t,e;this.emit.apply(this,arguments);for(e in this.namespaces){this.namespaces.hasOwnProperty(e)&&(t=this.of(e),t.$emit.apply(t,arguments))}},o.prototype.handshake=function(t){function i(e){e instanceof Error?(a.connecting=!1,a.onError(e.message)):t.apply(null,e.split(":"))}var o,r,s,a=this,h=this.options,c=["http"+(h.secure?"s":"")+":/",h.host+":"+h.port,h.resource,e.protocol,e.util.query(this.options.query,"t="+ +new Date)].join("/");this.isXDomain()&&!e.util.ua.hasCORS?(o=document.getElementsByTagName("script")[0],r=document.createElement("script"),r.src=c+"&jsonp="+e.j.length,o.parentNode.insertBefore(r,o),e.j.push(function(t){i(t),r.parentNode.removeChild(r)})):(s=e.util.request(),s.open("GET",c,!0),this.isXDomain()&&(s.withCredentials=!0),s.onreadystatechange=function(){4==s.readyState&&(s.onreadystatechange=n,200==s.status?i(s.responseText):403==s.status?a.onError(s.responseText):(a.connecting=!1,!a.reconnecting&&a.onError(s.responseText)))},s.send(null))},o.prototype.getTransport=function(t){var i,o,n=t||this.transports;for(i=0;o=n[i];i++){if(e.Transport[o]&&e.Transport[o].check(this)&&(!this.isXDomain()||e.Transport[o].xdomainCheck(this))){return new e.Transport[o](this,this.sessionid)}}return null},o.prototype.connect=function(t){if(this.connecting){return this}var i=this;return i.connecting=!0,this.handshake(function(o,n,r,s){function a(t){return i.transport&&i.transport.clearTimeouts(),i.transport=i.getTransport(t),i.transport?(i.transport.ready(i,function(){i.connecting=!0,i.publish("connecting",i.transport.name),i.transport.open(),i.options["connect timeout"]&&(i.connectTimeoutTimer=setTimeout(function(){if(!i.connected&&(i.connecting=!1,i.options["try multiple transports"])){for(var t=i.transports;t.length>0&&t.splice(0,1)[0]!=i.transport.name;){}t.length?a(t):i.publish("connect_failed")}},i.options["connect timeout"]))}),void 0):i.publish("connect_failed")}i.sessionid=o,i.closeTimeout=1e3*r,i.heartbeatTimeout=1e3*n,i.transports||(i.transports=i.origTransports=s?e.util.intersect(s.split(","),i.options.transports):i.options.transports),i.setHeartbeatTimeout(),a(i.transports),i.once("connect",function(){clearTimeout(i.connectTimeoutTimer),t&&"function"==typeof t&&t()})}),this},o.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var t=this;this.heartbeatTimeoutTimer=setTimeout(function(){t.transport.onClose()},this.heartbeatTimeout)}},o.prototype.packet=function(t){return this.connected&&!this.doBuffer?this.transport.packet(t):this.buffer.push(t),this},o.prototype.setBuffer=function(t){this.doBuffer=t,!t&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},o.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},o.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},o.prototype.disconnectSync=function(){var t=e.util.request(),i=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,e.protocol,"",this.sessionid].join("/")+"/?disconnect=1";t.open("GET",i,!1),t.send(null),this.onDisconnect("booted")},o.prototype.isXDomain=function(){var t=i.location.port||("https:"==i.location.protocol?443:80);return this.options.host!==i.location.hostname||this.options.port!=t},o.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},o.prototype.onOpen=function(){this.open=!0},o.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},o.prototype.onPacket=function(t){this.of(t.endpoint).onPacket(t)},o.prototype.onError=function(t){t&&t.advice&&"reconnect"===t.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",t&&t.reason?t.reason:t)},o.prototype.onDisconnect=function(t){var e=this.connected,i=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(e||i)&&(this.transport.close(),this.transport.clearTimeouts(),e&&(this.publish("disconnect",t),"booted"!=t&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},o.prototype.reconnect=function(){function t(){if(i.connected){for(var t in i.namespaces){i.namespaces.hasOwnProperty(t)&&""!==t&&i.namespaces[t].packet({type:"connect"})}i.publish("reconnect",i.transport.name,i.reconnectionAttempts)}clearTimeout(i.reconnectionTimer),i.removeListener("connect_failed",e),i.removeListener("connect",e),i.reconnecting=!1,delete i.reconnectionAttempts,delete i.reconnectionDelay,delete i.reconnectionTimer,delete i.redoTransports,i.options["try multiple transports"]=n}function e(){return i.reconnecting?i.connected?t():i.connecting&&i.reconnecting?i.reconnectionTimer=setTimeout(e,1e3):(i.reconnectionAttempts++>=o?i.redoTransports?(i.publish("reconnect_failed"),t()):(i.on("connect_failed",e),i.options["try multiple transports"]=!0,i.transports=i.origTransports,i.transport=i.getTransport(),i.redoTransports=!0,i.connect()):(i.reconnectionDelay<r&&(i.reconnectionDelay*=2),i.connect(),i.publish("reconnecting",i.reconnectionDelay,i.reconnectionAttempts),i.reconnectionTimer=setTimeout(e,i.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var i=this,o=this.options["max reconnection attempts"],n=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function i(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new o(this,"json"),this.ackPackets=0,this.acks={}}function o(t,e){this.namespace=t,this.name=e}t.SocketNamespace=i,e.util.mixin(i,e.EventEmitter),i.prototype.$emit=e.EventEmitter.prototype.emit,i.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},i.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},i.prototype.send=function(t,e){var i={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(i.id=++this.ackPackets,i.ack=!0,this.acks[i.id]=e),this.packet(i)},i.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),i=e[e.length-1],o={type:"event",name:t};return"function"==typeof i&&(o.id=++this.ackPackets,o.ack="data",this.acks[o.id]=i,e=e.slice(0,e.length-1)),o.args=e,this.packet(o)},i.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},i.prototype.onPacket=function(t){function i(){n.packet({type:"ack",args:e.util.toArray(arguments),ackId:t.id})}var o,n=this;switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":o=["message",t.data],"data"==t.ack?o.push(i):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,o);break;case"event":o=[t.name].concat(t.args),"data"==t.ack&&o.push(i),this.$emit.apply(this,o);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},o.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},o.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function o(){e.Transport.apply(this,arguments)}t.websocket=o,e.util.inherit(o,e.Transport),o.prototype.name="websocket",o.prototype.open=function(){var t,o=e.util.query(this.socket.options.query),n=this;return t||(t=i.MozWebSocket||i.WebSocket),this.websocket=new t(this.prepareUrl()+o),this.websocket.onopen=function(){n.onOpen(),n.socket.setBuffer(!1)},this.websocket.onmessage=function(t){n.onData(t.data)},this.websocket.onclose=function(){n.onClose(),n.socket.setBuffer(!0)},this.websocket.onerror=function(t){n.onError(t)},this},o.prototype.send=e.util.ua.iDevice?function(t){var e=this;return setTimeout(function(){e.websocket.send(t)},0),this}:function(t){return this.websocket.send(t),this},o.prototype.payload=function(t){for(var e=0,i=t.length;i>e;e++){this.packet(t[e])}return this},o.prototype.close=function(){return this.websocket.close(),this},o.prototype.onError=function(t){this.socket.onError(t)},o.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},o.check=function(){return"WebSocket"in i&&!("__addTask"in WebSocket)||"MozWebSocket"in i},o.xdomainCheck=function(){return!0},e.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e,i){function o(t){t&&(e.Transport.apply(this,arguments),this.sendBuffer=[])}function n(){}t.XHR=o,e.util.inherit(o,e.Transport),o.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},o.prototype.payload=function(t){var i,o,n=[];for(i=0,o=t.length;o>i;i++){n.push(e.parser.encodePacket(t[i]))}this.send(e.parser.encodePayload(n))},o.prototype.send=function(t){return this.post(t),this},o.prototype.post=function(t){function e(){4==this.readyState&&(this.onreadystatechange=n,r.posting=!1,200==this.status?r.socket.setBuffer(!1):r.onClose())}function o(){this.onload=n,r.socket.setBuffer(!1)}var r=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),i.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=o:this.sendXHR.onreadystatechange=e,this.sendXHR.send(t)},o.prototype.close=function(){return this.onClose(),this},o.prototype.request=function(t){var i=e.util.request(this.socket.isXDomain()),o=e.util.query(this.socket.options.query,"t="+ +new Date);
if(i.open(t||"GET",this.prepareUrl()+o,!0),"POST"==t){try{i.setRequestHeader?i.setRequestHeader("Content-type","text/plain;charset=UTF-8"):i.contentType="text/plain"}catch(n){}}return i},o.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},o.check=function(t,o){try{var n=e.util.request(o),r=i.XDomainRequest&&n instanceof XDomainRequest,s=t&&t.options&&t.options.secure?"https:":"http:",a=i.location&&s!=i.location.protocol;if(n&&(!r||!a)){return!0}}catch(h){}return!1},o.xdomainCheck=function(t){return o.check(t,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function i(){e.Transport.XHR.apply(this,arguments)}t.htmlfile=i,e.util.inherit(i,e.Transport.XHR),i.prototype.name="htmlfile",i.prototype.get=function(){var t,i,o;this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this,t=this.doc.createElement("div"),t.className="socketio",this.doc.body.appendChild(t),this.iframe=this.doc.createElement("iframe"),t.appendChild(this.iframe),i=this,o=e.util.query(this.socket.options.query,"t="+ +new Date),this.iframe.src=this.prepareUrl()+o,e.util.on(window,"unload",function(){i.destroy()})},i.prototype._=function(t,e){t=t.replace(/\\\//g,"/"),this.onData(t);try{var i=e.getElementsByTagName("script")[0];i.parentNode.removeChild(i)}catch(o){}},i.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(t){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},i.prototype.close=function(){return this.destroy(),e.Transport.XHR.prototype.close.call(this)},i.check=function(t){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window){try{var i=new(window[["Active"].concat("Object").join("X")])("htmlfile");return i&&e.Transport.XHR.check(t)}catch(o){}}return!1},i.xdomainCheck=function(){return!1},e.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function o(){e.Transport.XHR.apply(this,arguments)}function n(){}t["xhr-polling"]=o,e.util.inherit(o,e.Transport.XHR),e.util.merge(o,e.Transport.XHR),o.prototype.name="xhr-polling",o.prototype.heartbeats=function(){return!1},o.prototype.open=function(){var t=this;return e.Transport.XHR.prototype.open.call(t),!1},o.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=n,200==this.status?(r.onData(this.responseText),r.get()):r.onClose())}function e(){this.onload=n,this.onerror=n,r.retryCounter=1,r.onData(this.responseText),r.get()}function o(){r.retryCounter++,!r.retryCounter||r.retryCounter>3?r.onClose():r.get()}if(this.isOpen){var r=this;this.xhr=this.request(),i.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=o):this.xhr.onreadystatechange=t,this.xhr.send(null)}},o.prototype.onClose=function(){if(e.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=n;try{this.xhr.abort()}catch(t){}this.xhr=null}},o.prototype.ready=function(t,i){var o=this;e.util.defer(function(){i.call(o,t)})},e.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e,i){function o(){e.Transport["xhr-polling"].apply(this,arguments),this.index=e.j.length;var t=this;e.j.push(function(e){t._(e)})}var n=i.document&&"MozAppearance"in i.document.documentElement.style;t["jsonp-polling"]=o,e.util.inherit(o,e.Transport["xhr-polling"]),o.prototype.name="jsonp-polling",o.prototype.post=function(t){function i(){o(),h.socket.setBuffer(!1)}function o(){h.iframe&&h.form.removeChild(h.iframe);try{a=document.createElement('<iframe name="'+h.iframeId+'">')}catch(t){a=document.createElement("iframe"),a.name=h.iframeId}a.id=h.iframeId,h.form.appendChild(a),h.iframe=a}var n,r,s,a,h=this,c=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.form||(n=document.createElement("form"),r=document.createElement("textarea"),s=this.iframeId="socketio_iframe_"+this.index,n.className="socketio",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.display="none",n.target=s,n.method="POST",n.setAttribute("accept-charset","utf-8"),r.name="d",n.appendChild(r),document.body.appendChild(n),this.form=n,this.area=r),this.form.action=this.prepareUrl()+c,o(),this.area.value=e.JSON.stringify(t);try{this.form.submit()}catch(p){}this.iframe.attachEvent?a.onreadystatechange=function(){"complete"==h.iframe.readyState&&i()}:this.iframe.onload=i,this.socket.setBuffer(!0)},o.prototype.get=function(){var t,i=this,o=document.createElement("script"),r=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),o.async=!0,o.src=this.prepareUrl()+r,o.onerror=function(){i.onClose()},t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(o,t),this.script=o,n&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},o.prototype._=function(t){return this.onData(t),this.isOpen&&this.get(),this},o.prototype.ready=function(t,i){var o=this;return n?(e.util.load(function(){i.call(o)}),void 0):i.call(this)},o.check=function(){return"document"in i},o.xdomainCheck=function(){return!0},e.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define("base/socket.io",[],function(){return io})}(),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/time",[],function(){function t(){return.001*o.now()}function e(){this.start=s,this.sinceStart=0,this.time=0,this.fps=60,this.delta=a,this.frameCount=0,n(this,"scale",{get:function(){return p},set:function(t){p=t,h=c*t}}),n(this,"fixedDelta",{get:function(){return h},set:function(t){c=t,h=c*p}})}var i="undefined"!=typeof window?window:{},o="undefined"!=typeof i.performance?i.performance:{},n=Object.defineProperty,r=Date.now(),s=.001*r,a=1/60,h=a,c=a,p=1;return o.now=o.now||o.webkitNow||o.mozNow||o.msNow||o.oNow||function(){return Date.now()-r},e.prototype.now=t,e.prototype.stamp=function(){return s+t()},new e}),"function"!=typeof define&&(define=require("amdefine")(module)),define("base/util",[],function(){function t(t,e){var i,n,r,s=t.split(o),a="";for(n=0,r=s.length;r>n;n++){i=s[n],a+=i[0].toUpperCase()+i.slice(1).toLowerCase()}return e?a[0].toLowerCase()+a.slice(1):a}function e(t){return t.replace(o,"").replace(n,"$1_$2").toLowerCase()}var i={},o=/[ \_\-\.]+|(?=[A-Z][^A-Z])/g,n=/([a-z])([A-Z])/g;return i.camelize=t,i.underscore=e,i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/assets/asset",["core/game/log","base/class"],function(t,e){function i(t){t||(t={}),e.call(this),this._type=this.constructor.name||"UnknownAsset",this._name=void 0!=t.name?t.name:"Asset-"+this._id,this.json=void 0!=t.json?!!t.json:!0,this.assets=void 0,this.src=t.src,this.raw=t.raw}var o=Object.defineProperty;return e.extend(i),i.type="Asset",i._types={Asset:i},i.prototype._onExtend=function(t){i._types[t.type]=t},o(i.prototype,"name",{get:function(){return this._name},set:function(e){var i,o=this.assets;if(o){if(i=o.hash,i[e]){return t.warn("Asset.set name: can't change name to "+e+" Assets already have an asset with same name"),void 0}delete i[this.name],i[e]=this}this._name=e}}),i.prototype.clone=function(){return(new this.constructor).copy(this)},i.prototype.copy=function(t){return this.sync=t.sync,this.json=t.json,this.name=t.name+"."+this._id,this.src=t.src,this.raw=t.raw,this.assets!==t.assets&&t.assets.addAsset(this),this},i.prototype.ext=function(){return this.src?this.src.split(".").pop():!1},i.prototype.clear=function(){return this.raw=null,this},i.prototype.destroy=function(){return this.assets?(this.assets.removeAsset(this),this.clear(),this):(t.warn("Asset.destroy: can't destroy Asset if it's not added to Assets"),this)},i.prototype.parse=function(t){return this.raw=t,this},i.prototype.toJSON=function(t,i){return t=e.prototype.toJSON.call(this,t),t._type=this._type,t.name=this.name,i||(t.src=this.src),t},i.prototype.fromJSON=function(t){return e.prototype.fromJSON.call(this,t),this._type=t._type,this.name=t.name,this.src=t.src,this},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/assets/assets",["core/assets/asset","core/game/log"],function(t,e){function i(){Array.call(this),this.hash={}}return i.prototype=Object.create(Array.prototype),i.prototype.constructor=i,i.prototype.addAsset=function(t){var i=t.name;return this.hash[i]?(e.warn("Assets.addAsset: Assets already have Asset named "+t.name),void 0):(t.assets=this,this.push(t),this.hash[i]=t,t)},i.prototype.add=i.prototype.addAssets=function(){for(var t=arguments.length;t--;){this.addAsset(arguments[t])}},i.prototype.removeAsset=function(t){var i="string"==typeof t?t:t.name;return(t=this.hash[i])?(this.splice(this.indexOf(t),1),this.hash[i]=null,t):(e.warn("Assets.removeAsset: Assets does not have an Asset named "+i),void 0)},i.prototype.remove=i.prototype.removeAssets=function(){for(var t=arguments.length;t--;){this.removeAsset(arguments[t])}},i.prototype.toJSON=function(t,e){t||(t={});for(var i,o=t.assets||(t.assets=[]),n=this.length;n--;){(i=this[n]).json&&(o[n]=i.toJSON(o[n],e))}return t},i.prototype.fromJSON=function(e){for(var i,o,n=this.hash,r=e.assets||(e.assets=[]),s=r.length;s--;){(o=r[s])&&((i=n[o.name])?i.fromJSON(o):this.add((new t._types[o._type]).fromJSON(o)))}return this},new i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/assets/asset_loader",["base/event_emitter","base/audio_ctx","core/assets/asset","core/assets/assets","core/game/log"],function(t,i,o,n,r){function s(){t.call(this)}var a=function(){};return t.extend(s),s.prototype.load=function(t,e){t||(t=a);var i,o=this,s=n.length,h=function(e){e&&r.warn(e.message),s--,0===s&&(o.emit("load"),t())};for(i=s;i--;){this.loadAsset(n[i],h,e)}},s.prototype.loadAsset=function(t,e,i){var o,n=this;if(t.raw&&!i){return e(),void 0}if(o=t.ext()){if(!this[o]){return e(new Error("AssetLoader.load: has no loader named "+o)),void 0}this[o](t.src,function(i,o){return i?(e(new Error("AssetLoader.load: "+i.message)),void 0):(t.parse(o),n.emit("loadAsset",t),e(),void 0)})}},s.prototype.gif=s.prototype.jpg=s.prototype.jpeg=s.prototype.png=function(t,i){var o=new Image;o.addEventListener("load",function(){i&&i(null,o)},!1),o.addEventListener("error",function(){i&&i(e)},!1),o.src=t},s.prototype.json=function(t,e){var i=new XMLHttpRequest;i.addEventListener("readystatechange",function(){if(1==this.readyState){this.send(null)}else{if(4==this.readyState){var t,i=this.status;if(i>199&&301>i||304==i){try{t=JSON.parse(this.responseText)}catch(o){return e&&e(o),void 0}e&&e(null,t)}else{e&&e(new Error(i))}}}},!1),i.open("GET",t,!0)},s.prototype.ogg=s.prototype.wav=s.prototype.mp3=s.prototype.aac=function(t,e){var i=new XMLHttpRequest;i.addEventListener("readystatechange",function(){if(1==this.readyState){this.responseType="arraybuffer",this.send(null)}else{if(4==this.readyState){var t=this.status;t>199&&301>t||304==t?e&&e(null,this.response):e&&e(new Error(t))}}},!1),i.open("GET",t,!0)},new s}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/assets/audio_clip",["base/audio_ctx","core/assets/asset"],function(t,e){function i(t){t||(t={}),e.call(this,t),this.buffer=void 0}function o(t){return s.apply(null,new Uint16Array(t))}function n(t){for(var e=t.length,i=new ArrayBuffer(2*e),o=new Uint16Array(i),n=e;n--;){o[n]=t.charCodeAt(n)}return i}var r=Object.defineProperty,s=String.fromCharCode;return i.type="AudioClip",e.extend(i),r(i.prototype,"length",{get:function(){return this.buffer?this.buffer.duration:0}}),r(i.prototype,"samples",{get:function(){return this.buffer?this.buffer.length:0}}),r(i.prototype,"frequency",{get:function(){return this.buffer?this.buffer.sampleRate:44100}}),r(i.prototype,"channels",{get:function(){return this.buffer?this.buffer.numberOfChannels:0}}),i.prototype.getData=function(t,e){return t||(t=[]),this.buffer?this.buffer.getChannelData(t,e):t},i.prototype.parse=function(i){return e.prototype.parse.call(this,i),this.buffer=t.createBuffer(i,!1),this},i.prototype.toJSON=function(t,i){return t=e.prototype.toJSON.call(this,t,i),!i&&this.src||!this.raw||(t.raw=o(this.raw)),t},i.prototype.fromJSON=function(t,i){return e.prototype.fromJSON.call(this,t,i),!i&&this.src||!this.raw||(this.raw=n(t.raw)),this},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/assets/sprite_sheet",["core/assets/asset","core/game/log"],function(t,e){function i(e){e||(e={}),t.call(this,e)}return i.type="SpriteSheet",t.extend(i),i.prototype.parse=function(i){t.prototype.parse.call(this,i);for(var o in i){this[o]?e.warn("SpriteSheet.parse: bad name "+o+" in file "+this.src):this[o]=i[o]}return this},i.prototype.clear=function(){for(var e in this.raw){this[e]=null}return t.prototype.clear.call(this),this},i.prototype.toJSON=function(e,i){return e=t.prototype.toJSON.call(this,e),!i&&this.src||!this.raw||(e.raw=JSON.stringify(this.raw)),e},i.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),!e.src&&e.raw&&(this.raw=JSON.parse(e.raw)),this.parse(this.raw),this},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/assets/texture",["core/assets/asset"],function(t){function e(e){e||(e={}),t.call(this,e),this.anisotropy=void 0!=e.anisotropy?e.anisotropy:1,this.minFilter=void 0!=e.minFilter?e.minFilter:"LINEAR",this.magFilter=void 0!=e.magFilter?e.magFilter:"LINEAR",this.format=void 0!==e.format?e.format:"RGBA",this._needsUpdate=!0}e.type="Texture",t.extend(e),e.prototype.setAnisotropy=function(t){this.anisotropy=t,this._needsUpdate=!0},e.prototype.setMinFilter=function(t){this.minFilter=t,this._needsUpdate=!0},e.prototype.setMagFilter=function(t){this.magFilter=t,this._needsUpdate=!0},e.prototype.setFormat=function(t){this.format=t,this._needsUpdate=!0};var i,o;return e.prototype.toJSON=function(e,n){if(e=t.prototype.toJSON.call(this,e),(n||!this.src)&&this.raw){if("undefined"==typeof window){e.raw=this.raw}else{var r=this.raw,s=i||(i=document.createElement("canvas")),a=o||(o=i.getContext("2d"));s.width=r.width,s.height=r.height,a.clearRect(0,0,s.width,s.height),a.drawImage(r,0,0),e.raw=s.toDataURL()}}return e.anisotropy=this.anisotropy,e.minFilter=this.minFilter,e.magFilter=this.magFilter,e.format=this.format,e},e.prototype.fromJSON=function(e){if(t.prototype.fromJSON.call(this,e),!e.src&&e.raw){if("undefined"==typeof window){this.raw=e.raw}else{var i=new Image;i.src=e.raw,this.raw=i}}return this.anisotropy=e.anisotropy,this.minFilter=e.minFilter,this.magFilter=e.magFilter,this.format=e.format,this},e}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/mathf",[],function(){function t(){this.PI=S,this.TWO_PI=b,this.HALF_PI=_,this.EPSILON=w,this.TO_RADS=O,this.TO_DEGS=z}var e,i,o,n,r,s,a,h,c,p,u,f,l,m=Math.random,d=Math.abs,y=Math.pow,v=Math.floor,g=Math.ceil,x=Math.atan2,w=1e-6,S=3.141592653589793,b=2*S,_=.5*S,O=S/180,z=180/S,N=Object.keys;return t.prototype.acos=Math.acos,t.prototype.asin=Math.asin,t.prototype.atan=Math.atan,t.prototype.atan2=Math.atan2,t.prototype.cos=Math.cos,t.prototype.sin=Math.sin,t.prototype.tan=Math.tan,t.prototype.abs=Math.abs,t.prototype.ceil=Math.ceil,t.prototype.exp=Math.exp,t.prototype.floor=Math.floor,t.prototype.log=Math.log,t.prototype.max=Math.max,t.prototype.min=Math.min,t.prototype.pow=Math.pow,t.prototype.random=Math.random,t.prototype.round=Math.round,t.prototype.sqrt=Math.sqrt,t.prototype.equals=function(t,e,i){return d(t-e)<(i||w)},t.prototype.modulo=e=function(t,e){var i=t%e;return 0>i*e?i+e:i},t.prototype.standardRadian=o=function(t){return e(t,b)},t.prototype.standardAngle=n=function(t){return e(t,360)},t.prototype.sign=Math.sign||(Math.sign=function(t){return t?0>t?-1:1:0}),t.prototype.clamp=function(t,e,i){return e>t?e:t>i?i:t},t.prototype.clampBottom=function(t,e){return e>t?e:t},t.prototype.clampTop=function(t,e){return t>e?e:t},t.prototype.clamp01=i=function(t){return 0>t?0:t>1?1:t},t.prototype.truncate=function(t,e){var i=y(10,e),o=t*i;return(0>o?g(o):v(o))/i},t.prototype.lerp=function(t,e,i){return t+(e-t)*i},t.prototype.lerpAngle=function(t,e,i){return o(t+(e-t)*i)},t.prototype.smoothStep=function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},t.prototype.smootherStep=function(t,e,i){return e>=t?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(6*t-15)+10))},t.prototype.pingPong=function(t,e){return e||(e=1),e-d(t%(2*e)-e)},t.prototype.degsToRads=function(t){return o(t*O)},t.prototype.radsToDegs=r=function(t){return n(t*z)},t.prototype.randInt=function(t,e){return~~(t+m()*(e+1-t))},t.prototype.randFloat=function(t,e){return t+m()*(e-t)},t.prototype.randChoice=function(t){return t[~~(m()*t.length)]},t.prototype.randChoiceObject=function(t){var e=N(t);return e[~~(m()*e.length)]},t.prototype.isPowerOfTwo=function(t){return(t&-t)===t},t.prototype.toPowerOfTwo=function(t){for(var e=2;t>e;){e*=2}return e},s="right",a="up_right",h="up",c="up_left",p="left",u="down_left",f="down",l="down_right",t.prototype.directionAngle=function(t){return t=r(t),t>337.5&&22.5>t?s:t>22.5&&67.5>t?a:t>67.5&&112.5>t?h:t>112.5&&157.5>t?c:t>157.5&&202.5>t?p:t>202.5&&247.5>t?u:t>247.5&&292.5>t?f:t>292.5&&337.5>t?l:s},t.prototype.direction=function(t,e){var i=r(x(e,t));return i>337.5&&22.5>i?s:i>22.5&&67.5>i?a:i>67.5&&112.5>i?h:i>112.5&&157.5>i?c:i>157.5&&202.5>i?p:i>202.5&&247.5>i?u:i>247.5&&292.5>i?f:i>292.5&&337.5>i?l:s},new t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/vec2",[],function(){function t(t,e){this.x=t||0,this.y=e||0}var e=Math.sqrt;return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},t.prototype.sadd=function(t){return this.x+=t,this.y+=t,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},t.prototype.ssub=function(t){return this.x-=t,this.y-=t,this},t.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this},t.prototype.smul=function(t){return this.x*=t,this.y*=t,this},t.prototype.div=function(t){var e=t.x,i=t.y;return this.x*=0!==e?1/e:0,this.y*=0!==i?1/i:0,this},t.prototype.vdiv=function(t,e){var i=e.x,o=e.y;return this.x=0!==i?t.x/i:0,this.y=0!==o?t.y/o:0,this},t.prototype.sdiv=function(t){return t=0===t?0:1/t,this.x*=t,this.y*=t,this},t.prototype.length=function(){var t=this.x,i=this.y,o=t*t+i*i;return 1===o?1:o>0?e(o):0},t.prototype.lengthSq=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.setLength=function(t){var i=this.x,o=this.y,n=i*i+o*o;return 1===n?(this.x*=t,this.y*=t,this):(n=n>0?1/e(n):0,this.x*=n*t,this.y*=n*t,this)},t.prototype.normalize=function(){var t=this.x,i=this.y,o=t*t+i*i;return 1===o?this:(o=o>0?1/e(o):0,this.x*=o,this.y*=o,this)},t.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this},t.prototype.inverseVec=function(t){return this.x=-t.x,this.y=-t.y,this},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},t.prototype.vlerp=function(t,e,i){var o=t.x,n=t.y;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this},t.vdot=t.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.vcross=t.prototype.vcross=function(t,e){return t.x*e.y-t.y*e.x},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.min=function(t){var e=this.x,i=this.y,o=t.x,n=t.y;return this.x=e>o?o:e,this.y=i>n?n:i,this},t.prototype.max=function(t){var e=this.x,i=this.y,o=t.x,n=t.y;return this.x=o>e?o:e,this.y=n>i?n:i,this},t.prototype.clamp=function(t,e){var i=this.x,o=this.y,n=t.x,r=t.y,s=e.x,a=e.y;return this.x=n>i?n:i>s?s:i,this.y=r>o?r:o>a?a:o,this},t.prototype.transformAngle=function(t){var e=this.x,i=this.y,o=cos(t),n=sin(t);return this.x=e*o-i*n,this.y=e*n+i*o,this},t.prototype.transformMat2=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[2],this.y=i*e[1]+o*e[3],this},t.prototype.untransformMat2=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[1],this.y=i*e[2]+o*e[3],this},t.prototype.transformMat32=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[2]+e[4],this.y=i*e[1]+o*e[3]+e[5],this},t.prototype.untransformMat32=function(t){var e=t.elements,i=this.x-e[4],o=this.y-e[5];return this.x=i*e[0]+o*e[1],this.y=i*e[2]+o*e[3],this},t.prototype.transformMat3=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[3]+e[6],this.y=i*e[1]+o*e[4]+e[7],this},t.prototype.transformMat4=function(t){var e=t.elements,i=this.x,o=this.y;return this.x=i*e[0]+o*e[4]+e[12],this.y=i*e[1]+o*e[5]+e[13],this},t.prototype.fromVec3=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.fromVec4=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.positionFromMat32=function(t){var e=t.elements;return this.x=e[4],this.y=e[5],this},t.prototype.positionFromMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this},t.prototype.scaleFromMat2=function(t){var e=t.elements,i=this.set(e[0],t[2]).length(),o=this.set(e[1],t[3]).length();return this.x=i,this.y=o,this},t.prototype.scaleFromMat32=t.prototype.scaleFromMat2,t.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.toJSON=function(t){return t||(t={}),t.x=this.x,t.y=this.y,t},t.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this},t.prototype.toArray=function(t){return t||(t=[]),t[0]=this.x,t[1]=this.y,t},t.prototype.toString=function(){return"Vec2( "+this.x+", "+this.y+" )"},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/vec3",[],function(){function t(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}var e=Math.sqrt;return t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},t.prototype.sadd=function(t){return this.x+=t,this.y+=t,this.z+=t,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},t.prototype.ssub=function(t){return this.x-=t,this.y-=t,this.z-=t,this},t.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},t.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},t.prototype.smul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.div=function(t){var e=t.x,i=t.y,o=t.z;return this.x*=0!==e?1/e:0,this.y*=0!==i?1/i:0,this.z*=0!==o?1/o:0,this},t.prototype.vdiv=function(t,e){var i=e.x,o=e.y,n=e.z;return this.x=0!==i?t.x/i:0,this.y=0!==o?t.y/o:0,this.z=0!==n?t.z/n:0,this},t.prototype.sdiv=function(t){return t=0===t?0:1/t,this.x*=t,this.y*=t,this.z*=t,this},t.prototype.length=function(){var t=this.x,i=this.y,o=this.z,n=t*t+i*i+o*o;return 1===n?1:0===n?0:e(n)},t.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},t.prototype.setLength=function(t){var i=this.x,o=this.y,n=this.z,r=i*i+o*o+n*n;return 1===r?(this.x*=t,this.y*=t,this.z*=t,this):(r=r>0?1/e(r):0,this.x*=r*t,this.y*=r*t,this.z*=r*t,this)},t.prototype.normalize=function(){var t=this.x,i=this.y,o=this.z,n=t*t+i*i+o*o;return 1===n?this:(n=n>0?1/e(n):0,this.x*=n,this.y*=n,this.z*=n,this)},t.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.inverseVec=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},t.prototype.vlerp=function(t,e,i){var o=t.x,n=t.y,r=t.z;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=r+(e.z-r)*i,this},t.vdot=t.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.vcross=t.prototype.vcross=function(t,e){var i=t.x,o=t.y,n=t.z,r=e.x,s=e.y,a=e.z;return this.x=o*a-n*s,this.y=n*r-i*a,this.z=i*s-o*r,this},t.prototype.cross=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,r=t.y,s=t.z;return this.x=i*s-o*r,this.y=o*n-e*s,this.z=e*r-i*n,this},t.prototype.min=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,r=t.y,s=t.z;return this.x=e>n?n:e,this.y=i>r?r:i,this.z=o>s?s:o,this},t.prototype.max=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,r=t.y,s=t.z;return this.x=n>e?n:e,this.y=r>i?r:i,this.z=s>o?s:o,this},t.prototype.clamp=function(t,e){var i=this.x,o=this.y,n=this.z,r=t.x,s=t.y,a=t.z,h=e.x,c=e.y,p=e.z;return this.x=r>i?r:i>h?h:i,this.y=s>o?s:o>c?c:o,this.z=a>n?a:n>p?p:n,this},t.prototype.transformMat3=function(t){var e=t.elements,i=this.x,o=this.y,n=this.z;return this.x=i*e[0]+o*e[3]+n*e[6],this.y=i*e[1]+o*e[4]+n*e[7],this.z=i*e[2]+o*e[5]+n*e[8],this},t.prototype.transformMat4=function(t){var e=t.elements,i=this.x,o=this.y,n=this.z;return this.x=i*e[0]+o*e[4]+n*e[8]+e[12],this.y=i*e[1]+o*e[5]+n*e[9]+e[13],this.z=i*e[2]+o*e[6]+n*e[10]+e[14],this},t.prototype.transformQuat=function(t){var e=this.x,i=this.y,o=this.z,n=t.x,r=t.y,s=t.z,a=t.w,h=a*e+r*o-s*i,c=a*i+s*e-n*o,p=a*o+n*i-r*e,u=-n*e-r*i-s*o;return this.x=h*a+u*-n+c*-s-p*-r,this.y=c*a+u*-r+p*-n-h*-s,this.z=p*a+u*-s+h*-r-c*-n,this},t.prototype.fromVec2=function(t){return this.x=t.x,this.y=t.y,this.z=0,this},t.prototype.fromVec4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.positionFromMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},t.prototype.scaleFromMat3=function(t){var e=t.elements,i=this.set(e[0],e[3],e[6]).length(),o=this.set(e[1],e[4],e[7]).length(),n=this.set(e[2],e[5],e[8]).length();return this.x=i,this.y=o,this.z=n,this},t.prototype.scaleFromMat4=function(t){var e=t.elements,i=this.set(e[0],e[4],e[8]).length(),o=this.set(e[1],e[5],e[9]).length(),n=this.set(e[2],e[6],e[10]).length();return this.x=i,this.y=o,this.z=n,this},t.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.toJSON=function(t){return t||(t={}),t.x=this.x,t.y=this.y,t.z=this.z,t},t.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},t.prototype.toArray=function(t){return t||(t=[]),t[0]=this.x,t[1]=this.y,t[2]=this.z,t},t.prototype.toString=function(){return"Vec3( "+this.x+", "+this.y+", "+this.z+" )"},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/component",["base/class","base/util","core/game/log"],function(t,e,i){function o(e,i,o){t.call(this),this._type=e||"UnknownComponent",this._name=n(this._type,!0),this.sync=void 0!=i?!!i:!0,this.json=void 0!=o?!!o:!0,this.gameObject=void 0}var n=e.camelize;return t.extend(o),o.type="Component",o._types={},o.prototype._onExtend=function(t){o._types[t.type]=t},o.prototype.init=function(){},o.prototype.update=function(){},o.prototype.clear=function(){},o.prototype.destroy=function(){return this.gameObject?(this.gameObject.removeComponent(this),this.emit("destroy"),this.clear(),this):(i.warn("Component.destroy: can't destroy Component if it's not added to a GameObject"),this)},o.prototype.sort=function(t,e){return t===e?-1:1},o.prototype.toSYNC=function(e){return e=t.prototype.toSYNC.call(this,e)},o.prototype.fromSYNC=function(){return this},o.prototype.toJSON=function(e){return e=t.prototype.toJSON.call(this,e),e.type=this._type,e.sync=this.sync,e.json=this.json,e},o.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.sync=e.sync,this.json=e.json,this},o}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/audio_source",["base/audio_ctx","base/time","math/mathf","math/vec2","math/vec3","core/components/component"],function(t,e,i,o,n,r){function s(t){t||(t={}),r.call(this,"AudioSource",!!t.sync,t.json),this.clip=t.clip,this._source=void 0,this._gain=void 0,this._panner=void 0,this.dopplerLevel=void 0!=t.dopplerLevel?t.dopplerLevel:1,this._loop=void 0!=t.loop?!!t.loop:!1,this.maxDistance=void 0!=t.maxDistance?t.maxDistance:15,this.minDistance=void 0!=t.minDistance?t.minDistance:1,this.offset=void 0!=t.offset?t.offset:new n,this.pitch=void 0!=t.pitch?t.pitch:0,this.playOnInit=void 0!=t.playOnInit?!!t.playOnInit:!1,this.spread=void 0!=t.spread?t.spread:0,this.time=void 0!=t.time?t.time:0,this._volume=void 0!=t.volume?t.volume:1,this.isPlaying=!1,this._startTime=0;var e=this;this._onended=function(){e.isPlaying=!1,e.time=0}}var a,h,c=e.now,p=i.clamp01,u=Object.defineProperty;return s.type="AudioSource",r.extend(s),u(s.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=p(t),this._gain&&(this._gain.gain.value=this._volume)}}),u(s.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=!!t,this._source&&(this._source.loop=this._loop)}}),s.prototype.init=function(){this.playOnInit&&this.play()},a=new o,h=new n,s.prototype.update=function(){if(0!==this.dopplerLevel&&this.isPlaying){var t,e,i,o,n;(i=this.gameObject.scene.game.camera)&&(n=this._panner)&&(e=this.transform,t=this.transform2d,o=i.transform||i.transform2d,t?(a.vadd(t.position,this.offset),a.sub(o.position),a.smul(this.dopplerLevel),n.setPosition(a.x,a.y,i.orthographicSize)):(h.vadd(e.position,this.offset),h.sub(o.position),h.smul(this.dopplerLevel),n.setPosition(h.x,h.y,h.z||0)))}},s.prototype.clear=function(){this.isPlaying&&this.stop(),this._source=void 0,this._gain=void 0,this._panner=void 0},s.prototype.play=function(e,i){return t?(e||(e=0),i||(i=0),this.refresh(),this.isPlaying=!0,this._startTime=c(),this.time=i,this._source.start(e,this.time),this):this},s.prototype.pause=function(){return t?(this.isPlaying=!1,this.time=c()-this._startTime,this._source.stop(this.time),this):this},s.prototype.stop=function(){return t?(this.time=0,this.isPlaying=!1,this._source.stop(this.time),this):this},s.prototype.refresh=function(){var e=this._source=t.createBufferSource(),i=this._gain=t.createGain(),o=this._panner=t.createPanner();return i.connect(t.destination),o.connect(i),e.connect(o),e.buffer=this.clip.buffer,e.onended=this._onended,i.gain.value=this.volume,e.loop=this.loop,this},s.prototype.toSYNC=function(t){return t=r.prototype.toSYNC.call(this,t)},s.prototype.fromSYNC=function(t){return r.prototype.fromSYNC.call(this,t),this},s.prototype.toJSON=function(t){return t=r.prototype.toJSON.call(this,t),t.clip=this.clip?this.clip.name:void 0,t.dopplerLevel=this.dopplerLevel,t.loop=this.loop,t.maxDistance=this.maxDistance,t.minDistance=this.minDistance,t.offset=this.offset.toJSON(t.offset),t.panLevel=this.panLevel,t.pitch=this.pitch,t.playOnInit=this.playOnInit,t.spread=this.spread,t.time=this.time,t.volume=this.volume,t.isPlaying=this.isPlaying,t},s.prototype.fromJSON=function(t){return r.prototype.fromJSON.call(this,t),this.clip=t.clip?Assets.hash[t.clip]:void 0,this.dopplerLevel=t.dopplerLevel,this.loop=t.loop,this.maxDistance=t.maxDistance,this.minDistance=t.minDistance,this.offset.fromJSON(t.offset),this.panLevel=t.panLevel,this.pitch=t.pitch,this.playOnInit=t.playOnInit,this.spread=t.spread,this.time=t.time,this.volume=t.volume,this.isPlaying=t.isPlaying,this
},s}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/color",["math/mathf"],function(t){function e(t,e,i){this.r=0,this.g=0,this.b=0,this._r=0,this._g=0,this._b=0,this._hex="#000000",this._rgb="rgb(0,0,0)",this.set(t,e,i)}function i(t){var e=(~~(255*s(t))).toString(16);return 1===e.length?"0"+e:e}var o,n=Math.sqrt,r=Math.floor,s=t.clamp01;return e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},e.prototype.set=function(t,i,o){var n=typeof t;return"number"===n?(this.r=t,this.g=i,this.b=o):"string"===n?this.setStyle(t):t instanceof e&&(this.r=t.r,this.g=t.g,this.b=t.b),this},e.prototype.setRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},e.prototype.setStyle=function(){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i,e=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i,i=/^\#([0-9a-f]{6})$/i,n=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,r=/#(.)(.)(.)/,s="#$1$1$2$2$3$3",a=/^(\w+)$/i,h=1/255,c=.01;return function(p){var u;return t.test(p)?(u=t.exec(p),this.r=min(255,Number(u[1]))*h,this.g=min(255,Number(u[2]))*h,this.b=min(255,Number(u[3]))*h,this):e.test(p)?(u=e.exec(p),this.r=min(100,Number(u[1]))*c,this.g=min(100,Number(u[2]))*c,this.b=min(100,Number(u[3]))*c,this):i.test(p)?(this.r=parseInt(p.substr(1,2),16)*h,this.g=parseInt(p.substr(3,2),16)*h,this.b=parseInt(p.substr(5,2),16)*h,this):n.test(p)?(p=p.replace(r,s),this.r=parseInt(p.substr(1,2),16)*h,this.g=parseInt(p.substr(3,2),16)*h,this.b=parseInt(p.substr(5,2),16)*h,this):a.test(p)?(p=o[p],this.r=parseInt(p.substr(1,2),16)*h,this.g=parseInt(p.substr(3,2),16)*h,this.b=parseInt(p.substr(5,2),16)*h,this):this}}(),e.prototype.toHEX=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var t=i(this.r),e=i(this.g),o=i(this.b);this._r=this.r,this._g=this.g,this._b=this.b,this._hex="#"+t+e+o,this._rgb="rgb("+r(256*s(this.r))+","+r(256*s(this.g))+","+r(256*s(this.b))+")"}return this._hex},e.prototype.toRGB=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var t=r(256*s(this.r)),e=r(256*s(this.g)),o=r(256*s(this.b));this._r=this.r,this._g=this.g,this._b=this.b,this._rgb="rgb("+t+","+e+","+o+")",this._hex="#"+i(this.r)+i(this.g)+i(this.b)}return this._rgb},e.prototype.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},e.prototype.cadd=function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},e.prototype.sadd=function(t){return this.r+=t,this.g+=t,this.b+=t,this},e.prototype.sub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this},e.prototype.csub=function(t,e){return this.r=t.r-e.r,this.g=t.g-e.g,this.b=t.b-e.b,this},e.prototype.ssub=function(t){return this.r-=t,this.g-=t,this.b-=t,this},e.prototype.mul=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},e.prototype.cmul=function(t,e){return this.r=t.r*e.r,this.g=t.g*e.g,this.b=t.b*e.b,this},e.prototype.smul=function(t){return this.r*=t,this.g*=t,this.b*=t,this},e.prototype.div=function(t){var e=t.r,i=t.g,o=t.b;return this.r*=0!==e?1/e:0,this.g*=0!==i?1/i:0,this.b*=0!==o?1/o:0,this},e.prototype.cdiv=function(t,e){var i=e.r,o=e.g,n=e.b;return this.r=0!==i?t.r/i:0,this.g=0!==o?t.g/o:0,this.b=0!==n?t.b/n:0,this},e.prototype.sdiv=function(t){return t=0===t?0:1/t,this.r*=t,this.g*=t,this.b*=t,this},e.prototype.length=function(){var t=this.r,e=this.g,i=this.b,o=t*t+e*e+i*i;return o>0?1/n(o):0},e.prototype.lengthSq=function(){var t=this.r,e=this.g,i=this.b;return t*t+e*e+i*i},e.prototype.normalize=function(){var t=this.r,e=this.g,i=this.b,o=t*t+e*e+i*i;return o=o>0?1/n(o):0,this.r*=o,this.g*=o,this.b*=o,this},e.prototype.check=function(){var t=this.r,e=this.g,i=this.b;return this.r=t>1?1:t,this.g=e>1?1:e,this.b=i>1?1:i,this},e.prototype.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},e.prototype.clerp=function(t,e,i){var o=t.r,n=t.g,r=t.b;return this.r=o+(e.r-o)*i,this.g=n+(e.g-n)*i,this.b=r+(e.b-r)*i,this},e.prototype.min=function(t){var e=this.r,i=this.g,o=this.b,n=t.r,r=t.g,s=t.b;return this.r=e>n?n:e,this.g=i>r?r:i,this.b=o>s?s:o,this},e.prototype.max=function(t){var e=this.r,i=this.g,o=this.b,n=t.r,r=t.g,s=t.b;return this.r=n>e?n:e,this.g=r>i?r:i,this.b=s>o?s:o,this},e.prototype.fromVec2=function(t){return this.r=t.x,this.g=t.y,this.b=0,this},e.prototype.fromVec3=function(t){return this.r=t.x,this.g=t.y,this.b=t.z,this},e.prototype.fromVec4=e.prototype.fromVec3,e.prototype.fromJSON=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},e.prototype.toJSON=function(t){return t||(t={}),t.r=this.r,t.g=this.g,t.b=this.b,t},e.prototype.fromArray=function(t){return this.r=t[0],this.g=t[1],this.b=t[2],this},e.prototype.toArray=function(t){return t||(t=[]),t[0]=this.r,t[1]=this.g,t[2]=this.b,t},e.prototype.toString=function(){return"Color( "+this.r+", "+this.g+", "+this.b+" )"},o=e.colorNames={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},e}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/mat4",["math/mathf","math/vec3"],function(t,e){function i(t,e,i,o,n,r,s,a,h,c,p,u,f,l,m,d){var y=new Float32Array(16);this.elements=y,y[0]=void 0!==t?t:1,y[4]=e||0,y[8]=i||0,y[12]=o||0,y[1]=n||0,y[5]=void 0!==r?r:1,y[9]=s||0,y[13]=a||0,y[2]=h||0,y[6]=c||0,y[10]=void 0!==p?p:1,y[14]=u||0,y[3]=f||0,y[7]=l||0,y[11]=m||0,y[15]=void 0!==d?d:1}var o=Math.sqrt,n=Math.cos,r=Math.sin,s=Math.tan,a=t.degsToRads;return i.prototype.clone=function(){var t=this.elements;return new i(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},i.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},i.prototype.set=function(t,e,i,o,n,r,s,a,h,c,p,u,f,l,m,d){var y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=o,y[1]=n,y[5]=r,y[9]=s,y[13]=a,y[2]=h,y[6]=c,y[10]=p,y[14]=u,y[3]=f,y[7]=l,y[11]=m,y[15]=d,this},i.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[4],r=e[8],s=e[12],a=e[1],h=e[5],c=e[9],p=e[13],u=e[2],f=e[6],l=e[10],m=e[14],d=e[3],y=e[7],v=e[11],g=e[15],x=i[0],w=i[4],S=i[8],b=i[12],_=i[1],O=i[5],z=i[9],N=i[13],C=i[2],T=i[6],A=i[10],E=i[14],k=i[3],J=i[7],R=i[11],B=i[15];return e[0]=o*x+n*_+r*C+s*k,e[4]=o*w+n*O+r*T+s*J,e[8]=o*S+n*z+r*A+s*R,e[12]=o*b+n*N+r*E+s*B,e[1]=a*x+h*_+c*C+p*k,e[5]=a*w+h*O+c*T+p*J,e[9]=a*S+h*z+c*A+p*R,e[13]=a*b+h*N+c*E+p*B,e[2]=u*x+f*_+l*C+m*k,e[6]=u*w+f*O+l*T+m*J,e[10]=u*S+f*z+l*A+m*R,e[14]=u*b+f*N+l*E+m*B,e[3]=d*x+y*_+v*C+g*k,e[7]=d*w+y*O+v*T+g*J,e[11]=d*S+y*z+v*A+g*R,e[15]=d*b+y*N+v*E+g*B,this},i.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,r=o[0],s=o[4],a=o[8],h=o[12],c=o[1],p=o[5],u=o[9],f=o[13],l=o[2],m=o[6],d=o[10],y=o[14],v=o[3],g=o[7],x=o[11],w=o[15],S=n[0],b=n[4],_=n[8],O=n[12],z=n[1],N=n[5],C=n[9],T=n[13],A=n[2],E=n[6],k=n[10],J=n[14],R=n[3],B=n[7],j=n[11],D=n[15];return i[0]=r*S+s*z+a*A+h*R,i[4]=r*b+s*N+a*E+h*B,i[8]=r*_+s*C+a*k+h*j,i[12]=r*O+s*T+a*J+h*D,i[1]=c*S+p*z+u*A+f*R,i[5]=c*b+p*N+u*E+f*B,i[9]=c*_+p*C+u*k+f*j,i[13]=c*O+p*T+u*J+f*D,i[2]=l*S+m*z+d*A+y*R,i[6]=l*b+m*N+d*E+y*B,i[10]=l*_+m*C+d*k+y*j,i[14]=l*O+m*T+d*J+y*D,i[3]=v*S+g*z+x*A+w*R,i[7]=v*b+g*N+x*E+w*B,i[11]=v*_+g*C+x*k+w*j,i[15]=v*O+g*T+x*J+w*D,this},i.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,this},i.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,this},i.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,this},i.prototype.determinant=function(){var t=ae[0],e=ae[4],i=ae[8],o=ae[12],n=ae[1],r=ae[5],s=ae[9],a=ae[13],h=ae[2],c=ae[6],p=ae[10],u=ae[14],f=ae[3],l=ae[7],m=ae[11],d=ae[15];return f*(o*s*c-i*a*c-o*r*p+e*a*p+i*r*u-e*s*u)+l*(t*s*u-t*a*p+o*n*p-i*n*u+i*a*h-o*s*h)+m*(t*a*c-t*r*u-o*n*c+e*n*u+o*r*h-e*a*h)+d*(-i*r*h-t*s*c+t*r*p+i*n*c-e*n*p+e*s*h)},i.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[4],o=t[8],n=t[12],r=t[1],s=t[5],a=t[9],h=t[13],c=t[2],p=t[6],u=t[10],f=t[14],l=t[3],m=t[7],d=t[11],y=t[15],v=a*f*m-h*u*m+h*p*d-s*f*d-a*p*y+s*u*y,g=n*u*m-o*f*m-n*p*d+i*f*d+o*p*y-i*u*y,x=o*h*m-n*a*m+n*s*d-i*h*d-o*s*y+i*a*y,i=n*a*p-o*h*p-n*s*u+i*h*u+o*s*f-i*a*f,w=e*v+r*g+c*x+l*i;return w=0===w?0:1/w,t[0]=v*w,t[4]=g*w,t[8]=x*w,t[12]=i*w,t[1]=(h*u*l-a*f*l-h*c*d+r*f*d+a*c*y-r*u*y)*w,t[5]=(o*f*l-n*u*l+n*c*d-e*f*d-o*c*y+e*u*y)*w,t[9]=(n*a*l-o*h*l-n*r*d+e*h*d+o*r*y-e*a*y)*w,t[13]=(o*h*c-n*a*c+n*r*u-e*h*u-o*r*f+e*a*f)*w,t[2]=(s*f*l-h*p*l+h*c*m-r*f*m-s*c*y+r*p*y)*w,t[6]=(n*p*l-i*f*l-n*c*m+e*f*m+i*c*y-e*p*y)*w,t[10]=(i*h*l-n*s*l+n*r*m-e*h*m-i*r*y+e*s*y)*w,t[14]=(n*s*c-i*h*c-n*r*p+e*h*p+i*r*f-e*s*f)*w,t[3]=(a*p*l-s*u*l-a*c*m+r*u*m+s*c*d-r*p*d)*w,t[7]=(i*u*l-o*p*l+o*c*m-e*u*m-i*c*d+e*p*d)*w,t[11]=(o*s*l-i*a*l-o*r*m+e*a*m+i*r*d-e*s*d)*w,t[15]=(i*a*c-o*s*c+o*r*p-e*a*p-i*r*u+e*s*u)*w,this},i.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[4],r=i[8],s=i[12],a=i[1],h=i[5],c=i[9],p=i[13],u=i[2],f=i[6],l=i[10],m=i[14],d=i[3],y=i[7],v=i[11],g=i[15],x=c*m*y-p*l*y+p*f*v-h*m*v-c*f*g+h*l*g,w=s*l*y-r*m*y-s*f*v+n*m*v+r*f*g-n*l*g,S=r*p*y-s*c*y+s*h*v-n*p*v-r*h*g+n*c*g,n=s*c*f-r*p*f-s*h*l+n*p*l+r*h*m-n*c*m,b=o*x+a*w+u*S+d*n;return b=0===b?0:1/b,e[0]=x*b,e[4]=w*b,e[8]=S*b,e[12]=n*b,e[1]=(p*l*d-c*m*d-p*u*v+a*m*v+c*u*g-a*l*g)*b,e[5]=(r*m*d-s*l*d+s*u*v-o*m*v-r*u*g+o*l*g)*b,e[9]=(s*c*d-r*p*d-s*a*v+o*p*v+r*a*g-o*c*g)*b,e[13]=(r*p*u-s*c*u+s*a*l-o*p*l-r*a*m+o*c*m)*b,e[2]=(h*m*d-p*f*d+p*u*y-a*m*y-h*u*g+a*f*g)*b,e[6]=(s*f*d-n*m*d-s*u*y+o*m*y+n*u*g-o*f*g)*b,e[10]=(n*p*d-s*h*d+s*a*y-o*p*y-n*a*g+o*h*g)*b,e[14]=(s*h*u-n*p*u-s*a*f+o*p*f+n*a*m-o*h*m)*b,e[3]=(c*f*d-h*l*d-c*u*y+a*l*y+h*u*v-a*f*v)*b,e[7]=(n*l*d-r*f*d+r*u*y-o*l*y-n*u*v+o*f*v)*b,e[11]=(r*h*d-n*c*d-r*a*y+o*c*y+n*a*v-o*h*v)*b,e[15]=(n*c*u-r*h*u+r*a*f-o*c*f-n*a*l+o*h*l)*b,this},i.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},i.prototype.setTrace=function(t){var e=this.elements,i=t.w;return e[0]=t.x,e[5]=t.y,e[10]=t.z,e[15]=void 0!==i?i:1,this},i.prototype.lookAt=function(){var t=new e(0,0,1),i=new e,o=new e,n=new e;return function(e,r,s){var a=this.elements;return s=s||t,n.vsub(r,e).normalize(),i.vcross(s,n).normalize(),o.vcross(n,i),a[0]=i.x,a[4]=o.x,a[8]=n.x,a[1]=i.y,a[5]=o.y,a[9]=n.y,a[2]=i.z,a[6]=o.z,a[10]=n.z,this}}(),i.prototype.compose=function(t,e,i){var o=this.elements,n=i.x,r=i.y,s=i.z,a=i.w,h=n+n,c=r+r,p=s+s,u=n*h,f=n*c,l=n*p,m=r*c,d=r*p,y=s*p,v=a*h,g=a*c,x=a*p,w=e.x,S=e.y,b=e.z;return o[0]=(1-(m+y))*w,o[4]=(f-x)*S,o[8]=(l+g)*b,o[1]=(f+x)*w,o[5]=(1-(u+y))*S,o[9]=(d-v)*b,o[2]=(l-g)*w,o[6]=(d+v)*S,o[10]=(1-(u+m))*b,o[3]=0,o[7]=0,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this},i.prototype.decompose=function(t,e,i){var n,r,s=this.elements,a=s[0],h=s[4],c=s[8],p=s[1],u=s[5],f=s[9],l=s[2],m=s[6],d=s[10],y=0,v=0,g=0,x=1,w=e.set(a,p,l).length(),S=e.set(h,u,m).length(),b=e.set(c,f,d).length(),_=1/w,O=1/S,z=1/b;return e.x=w,e.y=S,e.z=b,t.x=s[12],t.y=s[13],t.z=s[14],a*=_,h*=O,c*=z,p*=_,u*=O,f*=z,l*=_,m*=O,d*=z,n=a+u+d,n>0?(r=.5/o(n+1),x=.25/r,y=(m-f)*r,v=(c-l)*r,g=(p-h)*r):a>u&&a>d?(r=2*o(1+a-u-d),x=(m-f)/r,y=.25*r,v=(h+p)/r,g=(c+l)/r):u>d?(r=2*o(1+u-a-d),x=(c-l)/r,y=(h+p)/r,v=.25*r,g=(f+m)/r):(r=2*o(1+d-a-u),x=(p-h)/r,y=(c+l)/r,v=(f+m)/r,g=.25*r),i.x=y,i.y=v,i.w=x,i.z=g,this},i.prototype.setPosition=function(t){var e=this.elements,i=t.z;return e[12]=t.x,e[13]=t.y,e[14]=void 0!==i?i:0,this},i.prototype.extractPosition=function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},i.prototype.extractRotation=function(){var t=new e;return function(e){var i=this.elements,n=e.elements,r=t.set(n[0],n[1],n[2]).lengthSq(),s=t.set(n[4],n[5],n[6]).lengthSq(),a=t.set(n[8],n[9],n[10]).lengthSq(),h=r>0?1/o(r):0,c=s>0?1/o(s):0,p=a>0?1/o(a):0;return i[0]=n[0]*h,i[1]=n[1]*h,i[2]=n[2]*h,i[4]=n[4]*c,i[5]=n[5]*c,i[6]=n[6]*c,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,this}}(),i.prototype.extractRotationScale=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[8]=i[8],e[9]=i[9],e[10]=i[10],this},i.prototype.translate=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z||0;return e[12]=e[0]*i+e[4]*o+e[8]*n+e[12],e[13]=e[1]*i+e[5]*o+e[9]*n+e[13],e[14]=e[2]*i+e[6]*o+e[10]*n+e[14],e[15]=e[3]*i+e[7]*o+e[11]*n+e[15],this},i.prototype.scale=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z;return e[0]*=i,e[4]*=o,e[8]*=n,e[1]*=i,e[5]*=o,e[9]*=n,e[2]*=i,e[6]*=o,e[10]*=n,e[3]*=i,e[7]*=o,e[11]*=n,this},i.prototype.rotateX=function(t){var e=this.elements,i=e[4],o=e[5],s=e[6],a=e[7],h=e[8],c=e[9],p=e[10],u=e[11],f=n(t),l=r(t);return e[4]=f*i+l*h,e[5]=f*o+l*c,e[6]=f*s+l*p,e[7]=f*a+l*u,e[8]=f*h-l*i,e[9]=f*c-l*o,e[10]=f*p-l*s,e[11]=f*u-l*a,this},i.prototype.rotateY=function(t){var e=this.elements,i=e[0],o=e[1],s=e[2],a=e[3],h=e[8],c=e[9],p=e[10],u=e[11],f=n(t),l=r(t);return e[0]=f*i-l*h,e[1]=f*o-l*c,e[2]=f*s-l*p,e[3]=f*a-l*u,e[8]=f*h+l*i,e[9]=f*c+l*o,e[10]=f*p+l*s,e[11]=f*u+l*a,this},i.prototype.rotateZ=function(t){var e=this.elements,i=e[0],o=e[1],s=e[2],a=e[3],h=e[4],c=e[5],p=e[6],u=e[7],f=n(t),l=r(t);return e[0]=f*i+l*h,e[1]=f*o+l*c,e[2]=f*s+l*p,e[3]=f*a+l*u,e[4]=f*h-l*i,e[5]=f*c-l*o,e[6]=f*p-l*s,e[7]=f*u-l*a,this},i.prototype.makeTranslation=function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)},i.prototype.makeScale=function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1)},i.prototype.makeRotationX=function(t){var e=n(t),i=r(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1)},i.prototype.makeRotationY=function(t){var e=n(t),i=r(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1)},i.prototype.makeRotationZ=function(t){var e=n(t),i=r(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1)},i.prototype.frustum=function(t,e,i,o,n,r){var s=this.elements,a=1/(e-t),h=1/(o-i),c=1/(n-r);return s[0]=2*n*a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n*h,s[6]=0,s[7]=0,s[8]=(e+t)*a,s[9]=(o+i)*h,s[10]=(r+n)*c,s[11]=-1,s[12]=0,s[13]=0,s[14]=r*n*2*c,s[15]=0,this},i.prototype.perspective=function(t,e,i,o){var n=this.elements,r=1/s(a(.5*t)),h=1/(i-o);return n[0]=r/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(o+i)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*o*i*h,n[15]=0,this},i.prototype.orthographic=function(t,e,i,o,n,r){var s=this.elements,a=1/(t-e),h=1/(i-o),c=1/(n-r);return s[0]=-2*a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*h,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*c,s[11]=0,s[12]=(t+e)*a,s[13]=(o+i)*h,s[14]=(r+n)*c,s[15]=1,this},i.prototype.fromMat2=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=0,e[3]=0,e[4]=i[2],e[5]=i[3],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.prototype.fromMat32=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=0,e[3]=0,e[4]=i[2],e[5]=i[3],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[4],e[13]=i[5],e[14]=0,e[15]=1,this},i.prototype.fromMat3=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=0,e[4]=i[3],e[5]=i[4],e[6]=i[5],e[7]=0,e[8]=i[6],e[9]=i[7],e[10]=i[8],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.prototype.fromQuat=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z,r=t.w,s=i+i,a=o+o,h=n+n,c=i*s,p=i*a,u=i*h,f=o*a,l=o*h,m=n*h,d=r*s,y=r*a,v=r*h;return e[0]=1-(f+m),e[4]=p-v,e[8]=u+y,e[1]=p+v,e[5]=1-(c+m),e[9]=l-d,e[2]=u-y,e[6]=l+d,e[10]=1-(c+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},i.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},i.prototype.toJSON=function(){json||(json={});var t=this.elements,e=json.elements||(json.elements=[]);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],json},i.prototype.toString=function(){var t=this.elements;return"Mat4["+t[0]+", "+t[4]+", "+t[8]+", "+t[12]+"]\n     ["+t[1]+", "+t[5]+", "+t[9]+", "+t[13]+"]\n     ["+t[2]+", "+t[6]+", "+t[10]+", "+t[14]+"]\n     ["+t[3]+", "+t[7]+", "+t[11]+", "+t[15]+"]"},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/camera",["math/mathf","math/color","math/vec3","math/mat4","core/components/component"],function(t,e,i,o,n){function r(t){t||(t={}),n.call(this,"Camera",!!t.sync,t.json),this.width=960,this.height=640,this.aspect=this.width/this.height,this.fov=void 0!==t.fov?t.fov:35,this.near=void 0!==t.near?t.near:.1,this.far=void 0!==t.far?t.far:512,this.orthographic=void 0!==t.orthographic?!!t.orthographic:!1,this.orthographicSize=void 0!==t.orthographicSize?t.orthographicSize:2,this.minOrthographicSize=void 0!==t.minOrthographicSize?t.minOrthographicSize:.01,this.maxOrthographicSize=void 0!==t.maxOrthographicSize?t.maxOrthographicSize:1024,this.projection=new o,this.view=new o,this._needsUpdate=!0,this._active=!1}var s,a,h=t.degsToRads;return r.type="Camera",n.extend(r),r.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.aspect=t.aspect,this.far=t.far,this.near=t.near,this.fov=t.fov,this.orthographic=t.orthographic,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},r.prototype.set=function(t,e){this.width=t,this.height=e,this.aspect=t/e,this._needsUpdate=!0},r.prototype.setWidth=function(t){this.width=t,this.aspect=t/this.height,this._needsUpdate=!0},r.prototype.setHeight=function(t){this.height=t,this.aspect=this.width/t,this._needsUpdate=!0},r.prototype.setFov=function(t){this.fov=t,this._needsUpdate=!0},r.prototype.setNear=function(t){this.near=t,this._needsUpdate=!0},r.prototype.setFar=function(t){this.far=t,this._needsUpdate=!0},r.prototype.setOrthographic=function(t){this.orthographic=!!t,this._needsUpdate=!0},r.prototype.toggleOrthographic=function(){this.orthographic=!this.orthographic,this._needsUpdate=!0},r.prototype.setOrthographicSize=function(t){this.orthographicSize=clamp(t,this.minOrthographicSize,this.maxOrthographicSize),this._needsUpdate=!0},s=new o,a=new i,r.prototype.toWorld=function(t,e){return e||(e=new i),e.x=2*t.x/this.width-1,e.y=-2*t.y/this.height+1,e.transformMat4(s.mmul(this.projection,this.view).inverse()),e.z=this.near,e},r.prototype.toScreen=function(t,e){return e||(e=new Vec2),a.copy(t),a.transformMat4(s.mmul(this.projection,this.view)),e.x=.5*(a.x+1)*this.width,e.y=.5*(1-a.y)*this.height,t},r.prototype.update=function(){if(this._active){if(this._needsUpdate){if(this.orthographic){this.orthographicSize=clamp(this.orthographicSize,this.minOrthographicSize,this.maxOrthographicSize);var t=this.orthographicSize,e=t*this.aspect,i=-e,o=t,n=-o;this.projection.orthographic(i,e,n,o,this.near,this.far)}else{this.projection.perspective(h(this.fov),this.aspect,this.near,this.far)}this._needsUpdate=!1}this.view.inverseMat(this.transform.matrixWorld)}},r.prototype.sort=function(t,e){return t._active?-1:e._active?1:-1},r.prototype.toSYNC=function(t){return t=n.prototype.toSYNC.call(this,t),t.width=this.width,t.height=this.height,t.aspect=this.aspect,t.far=this.far,t.near=this.near,t.fov=this.fov,t.orthographic=this.orthographic,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},r.prototype.fromSYNC=function(t){return n.prototype.fromSYNC.call(this,t),(t.width!==this.width||t.height!==this.height)&&(this._needsUpdate=!0),this.width=t.width,this.height=t.height,this.aspect=t.aspect,this.far=t.far,this.near=t.near,this.fov=t.fov,this.orthographic=t.orthographic,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this},r.prototype.toJSON=function(t){return t=n.prototype.toJSON.call(this,t),t.width=this.width,t.height=this.height,t.aspect=this.aspect,t.far=this.far,t.near=this.near,t.fov=this.fov,t.orthographic=this.orthographic,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},r.prototype.fromJSON=function(t){return n.prototype.fromJSON.call(this,t),this.width=t.width,this.height=t.height,this.aspect=t.aspect,this.far=t.far,this.near=t.near,this.fov=t.fov,this.orthographic=t.orthographic,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},r}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/mat32",[],function(){function t(t,e,i,o,n,r){var s=new Float32Array(6);this.elements=s,s[0]=void 0!==t?t:1,s[2]=e||0,s[4]=i||0,s[1]=o||0,s[3]=void 0!==n?n:1,s[5]=r||0}var e=Math.sqrt,i=Math.cos,o=Math.sin,n=Math.atan2;return t.prototype.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3],e[4],e[5])},t.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],this},t.prototype.set=function(t,e,i,o,n,r){var s=this.elements;return s[0]=t,s[2]=e,s[4]=i,s[1]=o,s[3]=n,s[5]=r,this},t.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[2],r=e[4],s=e[1],a=e[3],h=e[5],c=i[0],p=i[2],u=i[4],f=i[1],l=i[3],m=i[5];return e[0]=o*c+s*p,e[2]=n*c+a*p,e[1]=o*f+s*l,e[3]=n*f+a*l,e[4]=o*u+n*m+r,e[5]=s*u+a*m+h,this},t.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,r=o[0],s=o[2],a=o[4],h=o[1],c=o[3],p=o[5],u=n[0],f=n[2],l=n[4],m=n[1],d=n[3],y=n[5];return i[0]=r*u+h*f,i[2]=s*u+c*f,i[1]=r*m+h*d,i[3]=s*m+c*d,i[4]=r*l+s*y+a,i[5]=h*l+c*y+p,this},t.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,this},t.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,this},t.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this},t.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,this},t.prototype.determinant=function(){var t=this.elements;return t[0]*t[3]-t[2]*t[1]},t.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[2],o=t[4],n=t[1],r=t[3],s=t[5],a=e*r-i*n;return a=0!==a?1/a:0,t[0]=r*a,t[1]=-i*a,t[2]=-n*a,t[3]=e*a,t[4]=(i*s-r*o)*a,t[5]=(n*o-e*s)*a,this},t.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[2],r=i[4],s=i[1],a=i[3],h=i[5],c=o*a-n*s;return c=0!==c?1/c:0,e[0]=a*c,e[1]=-n*c,e[2]=-s*c,e[3]=o*c,e[4]=(n*h-a*r)*c,e[5]=(s*r-o*h)*c,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[2],e[2]=t,this},t.prototype.setTrace=function(t,e){var i=this.elements;return i[0]=t,i[3]=e,this},t.prototype.lookAt=function(t,e){var r=this.elements,s=e.x-t.x,a=e.y-t.y,h=n(a,s)-HALF_PI,c=i(h),p=o(h);return r[0]=c,r[1]=p,r[2]=-p,r[3]=c,this},t.prototype.compose=function(t,e,n){var r=this.elements,s=e.x,a=e.y,h=i(n),c=o(n);return r[0]=h*s,r[1]=c*s,r[2]=-c*a,r[3]=h*a,r[4]=t.x,r[5]=t.y,this},t.prototype.decompose=function(t,e){var i=this.elements,o=i[0],r=i[1],s=e.set(o,r).length(),a=e.set(i[2],i[3]).length();return t.x=i[4],t.y=i[5],e.x=s,e.y=a,n(r,o)},t.prototype.setRotation=function(t){var e=this.elements,n=i(t),r=o(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,this},t.prototype.getRotation=function(){var t=this.elements;return n(t[1],t[0])},t.prototype.setPosition=function(t){var e=this.elements;return e[4]=t.x,e[5]=t.y,this},t.prototype.getPosition=function(t){var e=this.elements;return t.x=e[4],t.y=e[5],t},t.prototype.extractPosition=function(t){var e=this.elements,i=t.elements;return e[4]=i[4],e[5]=i[5],this},t.prototype.extractRotation=function(t){var i=this.elements,o=t.elements,n=o[0],r=o[2],s=o[1],a=o[3],h=n*n+s*s,c=r*r+a*a,p=h>0?1/e(h):0,u=c>0?1/e(c):0;return i[0]=n*p,i[1]=s*p,i[2]=r*u,i[3]=a*u,this},t.prototype.translate=function(t){var e=this.elements,i=t.x,o=t.y;return e[4]=e[0]*i+e[2]*o+e[4],e[5]=e[1]*i+e[3]*o+e[5],this},t.prototype.rotate=function(t){var e=this.elements,i=e[0],n=e[2],r=e[1],s=e[3],a=o(t),h=o(t);return e[0]=i*h+n*a,e[1]=i*-a+n*h,e[2]=r*h+s*a,e[3]=r*-a+s*h,this},t.prototype.scale=function(t){var e=this.elements,i=t.x,o=t.y;return e[0]*=i,e[1]*=i,e[4]*=i,e[2]*=o,e[3]*=o,e[5]*=o,this},t.prototype.orthographic=function(t,e,i,o){var n=this.elements,r=1/(e-t),s=1/(o-i),a=(e+t)*r,h=(o+i)*s;return n[0]=2*r,n[1]=0,n[2]=0,n[3]=2*s,n[4]=-a,n[5]=-h,this},t.prototype.fromMat3=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[3],e[3]=i[4],e[4]=0,e[5]=0,this},t.prototype.fromMat4=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[4],e[3]=i[5],e[4]=i[11],e[5]=i[12],this},t.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],this},t.prototype.toJSON=function(t){t||(t={});var e=this.elements,i=t.elements||(t.elements=[]);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],t},t.prototype.toString=function(){var t=this.elements;return"Mat32[ "+t[0]+", "+t[2]+", "+t[4]+"]\n     [ "+t[1]+", "+t[3]+", "+t[5]+"]"},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/camera_2d",["math/mathf","math/color","math/vec2","math/mat32","math/mat4","core/components/component"],function(t,e,i,o,n,r){function s(t){t||(t={}),r.call(this,"Camera2D",!!t.sync,t.json),this.width=960,this.height=640,this.aspect=this.width/this.height,this.orthographicSize=void 0!==t.orthographicSize?t.orthographicSize:2,this.minOrthographicSize=void 0!==t.minOrthographicSize?t.minOrthographicSize:.01,this.maxOrthographicSize=void 0!==t.maxOrthographicSize?t.maxOrthographicSize:1024,this.projection=new o,this.view=new o,this._needsUpdate=!0,this._active=!1}var a,h,c=t.clamp;return s.type="Camera2D",r.extend(s),s.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},s.prototype.set=function(t,e){this.width=t,this.height=e,this.aspect=t/e,this._needsUpdate=!0},s.prototype.setWidth=function(t){this.width=t,this.aspect=t/this.height,this._needsUpdate=!0},s.prototype.setHeight=function(t){this.height=t,this.aspect=this.width/t,this._needsUpdate=!0},s.prototype.setOrthographicSize=function(t){this.orthographicSize=c(t,this.minOrthographicSize,this.maxOrthographicSize),this._needsUpdate=!0},a=new o,h=new i,s.prototype.toWorld=function(t,e){return e||(e=new Vec3),e.x=2*t.x/this.width-1,e.y=-2*t.y/this.height+1,e.transformMat32(a.mmul(this.projection,this.view).inverse()),e},s.prototype.toScreen=function(t,e){return e||(e=new i),h.copy(t).transformMat32(a.mmul(this.projection,this.view)),e.x=.5*(h.x+1)*this.width,e.y=.5*(1-h.y)*this.height,t},s.prototype.update=function(){if(this._active){if(this._needsUpdate){var t=this.orthographicSize,e=t*this.aspect,i=-e,o=t,n=-o;this.projection.orthographic(i,e,n,o),this._needsUpdate=!1}this.view.inverseMat(this.transform2d.matrixWorld)}},s.prototype.sort=function(t,e){return t._active?-1:e._active?1:-1},s.prototype.toSYNC=function(t){return t=r.prototype.toSYNC.call(this,t),t.width=this.width,t.height=this.height,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},s.prototype.fromSYNC=function(t){return r.prototype.fromSYNC.call(this,t),(t.width!==this.width||t.height!==this.height)&&(this._needsUpdate=!0),this.width=t.width,this.height=t.height,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this},s.prototype.toJSON=function(t){return t=r.prototype.toJSON.call(this,t),t.width=this.width,t.height=this.height,t.orthographicSize=this.orthographicSize,t.minOrthographicSize=this.minOrthographicSize,t.maxOrthographicSize=this.maxOrthographicSize,t},s.prototype.fromJSON=function(t){return r.prototype.fromJSON.call(this,t),this.width=t.width,this.height=t.height,this.orthographicSize=t.orthographicSize,this.minOrthographicSize=t.minOrthographicSize,this.maxOrthographicSize=t.maxOrthographicSize,this._needsUpdate=!0,this},s}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/enums",["base/enum"],function(t){return new t(["BlendingDefault","BlendingNone","BlendingAdditive","BlendingSubtractive","BlendingMuliply","Circle","CircleEdge","Box","BoxEdge"])
}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/particle_system/tween",[],function(){function t(t){t||(t={}),this.times=t.times||[],this.values=t.values||[]}return t.prototype.copy=function(t){return this.times=t.times.slice(),this.values=t.values.slice(),this},t.prototype.update=function(t,e){for(var i,o=this.times,n=this.values,r=0,s=o.length;s>r&&t>o[r];){r++}return 0===r?n[0]:r===s?n[s-1]:(i=(t-o[r-1])/(o[r]-o[r-1]),e?e.copy(n[r-1]).lerp(n[r],i):n[r-1]+i*(n[r]-n[r-1]))},t.prototype.toJSON=function(t){t||(t={});var e,i=this.times,o=this.values,n=t.times||(t.times=[]),r=t.values||(t.values=[]);for(e=i.length;e--;){n[e]=i[e]}for(e=o.length;e--;){r[e]=o[e].toJSON?o[e].toJSON(r[e]):o[e]}return t},t.prototype.fromJSON=function(t){var e,i=this.times,o=this.values,n=t.times,r=t.values;for(e=n.length;e--;){i[e]=n[e]}for(e=r.length;e--;){o[e]=r[e]}return this},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/particle_system/particle_2d",["math/vec2","math/color"],function(t,e){function i(){this.alpha=1,this.lifeTime=0,this.life=1,this.size=1,this.color=new e,this.position=new t,this.velocity=new t,this.acceleration=new t,this.angle=0,this.angularVelocity=0,this.angularAcceleration=0}return i.prototype.update=function(t){var e=this.position,i=this.velocity,o=this.acceleration;e.x+=i.x*t,e.y+=i.y*t,i.x+=o.x*t,i.y+=o.y*t,this.angle+=this.angularVelocity*t,this.angularVelocity+=this.angularAcceleration*t,this.lifeTime+=t},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/particle_system/emitter_2d",["base/object_pool","base/class","math/mathf","math/vec2","math/color","core/enums","core/assets/assets","core/components/particle_system/tween","core/components/particle_system/particle_2d"],function(t,e,i,o,n,r,s,a,h){function c(t){t||(t={}),e.call(this),this.positionType=void 0!=t.positionType?t.positionType:r.Box,this.velocityType=void 0!=t.velocityType?t.velocityType:r.Box,this.blending=void 0!=t.blending?t.blending:r.BlendingDefault,this.texture=void 0!=t.texture?t.texture:void 0,this.positionSpread=void 0!=t.positionSpread?t.positionSpread:new o(.5,.5),this.positionRadius=void 0!=t.positionRadius?t.positionRadius:.5,this.speed=void 0!=t.speed?t.speed:0,this.speedSpread=void 0!=t.speedSpread?t.speedSpread:0,this.particleSystem=void 0,this.transform=void 0,this.worldSpace=void 0!=t.worldSpace?t.worldSpace:!0,this.position=void 0!=t.position?t.position:new o,this.minEmission=void 0!=t.minEmission?t.minEmission:1,this.maxEmission=void 0!=t.maxEmission?t.maxEmission:2,this.minLife=void 0!=t.minLife?t.minLife:1,this.maxLife=void 0!=t.maxLife?t.maxLife:2,this.minSize=void 0!=t.minSize?t.minSize:.1,this.maxSize=void 0!=t.maxSize?t.maxSize:.5,this.sizeTween=new a(t.sizeTween),this.alphaTween=new a(t.alphaTween),this.colorTween=new a(t.colorTween),this.velocity=void 0!=t.velocity?t.velocity:new o,this.velocitySpread=void 0!=t.velocitySpread?t.velocitySpread:new o,this.acceleration=void 0!=t.acceleration?t.acceleration:new o,this.accelerationSpread=void 0!=t.accelerationSpread?t.accelerationSpread:new o,this.angularVelocity=void 0!=t.angularVelocity?t.angularVelocity:0,this.angularVelocitySpread=void 0!=t.angularVelocitySpread?t.angularVelocitySpread:0,this.angularAcceleration=void 0!=t.angularAcceleration?t.angularAcceleration:0,this.angularAccelerationSpread=void 0!=t.angularAccelerationSpread?t.angularAccelerationSpread:0,this.randomAngle=void 0!=t.randomAngle?t.randomAngle:!0,this.emissionRate=void 0!=t.emissionRate?t.emissionRate:1/60,this.color=void 0!=t.color?t.color:new n,this.colorSpread=void 0!=t.colorSpread?t.colorSpread:new n,this.time=void 0!=t.time?t.time:0,this._time=0,this.duration=void 0!=t.duration?t.duration:0,this.loop=void 0!=t.loop?t.loop:!0,this.playing=void 0!=t.playing?t.playing:!0,this.emitting=void 0!=t.emitting?t.emitting:!0,this.particles=[]}var p,u=Math.PI,f=2*u,l=Math.random,m=Math.floor,d=i.randInt,y=i.randFloat,v=i.clampTop,g=Math.cos,x=Math.sin,w=Math.sqrt,S=c.PARTICLE_POOL=new t(h);return e.extend(c),c.prototype.copy=function(t){return this.positionType=t.positionType,this.velocityType=t.velocityType,this.blending=t.blending,this.texture=t.texture,this.position.copy(t.position),this.positionSpread.copy(t.positionSpread),this.positionRadius=t.positionRadius,this.speed=t.speed,this.speedSpread=t.speedSpread,this.worldSpace=t.worldSpace,this.minEmission=t.minEmission,this.maxEmission=t.maxEmission,this.minLife=t.minLife,this.maxLife=t.maxLife,this.minSize=t.minSize,this.maxSize=t.maxSize,this.sizeTween.copy(t.sizeTween),this.alphaTween.copy(t.alphaTween),this.colorTween.copy(t.colorTween),this.velocity.copy(t.velocity),this.velocitySpread.copy(t.velocitySpread),this.acceleration.copy(t.acceleration),this.accelerationSpread.copy(t.accelerationSpread),this.angularVelocity=t.angularVelocity,this.angularVelocitySpread=t.angularVelocitySpread,this.angularAcceleration=t.angularAcceleration,this.angularAccelerationSpread=t.angularAccelerationSpread,this.randomAngle=t.randomAngle,this.emissionRate=t.emissionRate,this.color.copy(t.color),this.colorSpread.copy(t.colorSpread),this.time=t.time,this._time=t._time,this.duration=t.duration,this.loop=t.loop,this.playing=t.playing,this.emitting=t.emitting,this},c.prototype.play=function(){return this.time=0,this.playing=!0,this.emitting=!0,this},c.prototype.clear=function(){var t=this.particles,e=t.length;for(this.transform=void 0,this.time=0,this._time=0,this.playing=!1,this.emitting=!1;e--;){S.removeObject(t[e])}return t.length=0,this},p=new o,c.prototype.spawn=function(t){for(var e,i,o,n,s,a,h,u,d,b,_,O=this.transform||(this.transform=this.particleSystem.gameObject.transform||this.particleSystem.gameObject.transform2d),z=O.toWorld(p.set(0,0)),N=this.position,C=this.positionSpread,T=this.positionRadius,A=this.speed,E=this.speedSpread,k=this.particles,J=k.length,R=this.worldSpace,B=this.randomAngle,j=this.color,D=this.colorSpread,M=D.lengthSq()>0,P=this.velocity,U=this.velocitySpread,L=this.acceleration,q=this.accelerationSpread,I=this.angularVelocity,F=this.angularVelocitySpread,G=this.angularAcceleration,Y=this.angularAccelerationSpread,H=this.minLife,W=this.maxLife,V=this.minSize,X=this.maxSize,$=this.positionType,Z=this.velocityType,Q=y(-C.x,C.x),K=y(-C.y,C.y),te=v(J+t,c.MAX_PARTICLES)-J;te--;){switch(_=S.create(),o=_.position,e=_.velocity,i=_.acceleration,n=_.color,n.r=j.r,n.g=j.g,n.b=j.b,M&&(n.r+=D.r*l(),n.g+=D.g*l(),n.b+=D.b*l(),n.check()),R?(o.x=N.x+z.x,o.y=N.y+z.y):(o.x=N.x,o.y=N.y),$){case r.Box:o.x+=y(-C.x,C.x),o.y+=y(-C.y,C.y);break;case r.BoxEdge:switch(m(4*l())){case 0:o.x+=y(-C.x,C.x),o.y+=C.y;break;case 1:o.x+=C.x,o.y+=y(-C.y,C.y);break;case 2:o.x+=y(-C.x,C.x),o.y+=-C.y;break;case 3:o.x+=-C.x,o.y+=y(-C.y,C.y)}break;case r.Circle:s=f*l(),a=l()+l(),h=a>1?2-a:a,o.x+=Q+h*g(s)*T,o.y+=K+h*x(s)*T;break;case r.CircleEdge:s=f*l(),o.x+=Q+g(s)*T,o.y+=K+x(s)*T}switch(Z){case r.Box:case r.BoxEdge:e.x=P.x+y(-U.x,U.x),e.y=P.y+y(-U.y,U.y);break;case r.Circle:case r.CircleEdge:R?(u=o.x-(N.x+z.x),d=o.y-(N.y+z.y)):(u=o.x-N.x,d=o.y-N.y),b=A+y(-E,E),h=u*u+d*d,h=0!==h?1/w(h):h,e.x=u*h*b,e.y=d*h*b}i.x=L.x+y(-q.x,q.x),i.y=L.y+y(-q.y,q.y),_.angularVelocity=I+y(-F,F),_.angularAcceleration=G+y(-Y,Y),_.alpha=1,_.angle=B?l()*f:0,_.lifeTime=0,_.life=y(H,W),_.size=y(V,X),k.push(_)}},c.prototype.update=function(t){if(this.playing){var e,i,o,n,r=this.particles,s=this.sizeTween,a=this.alphaTween,h=this.colorTween,c=s.times.length>0,p=a.times.length>0,u=h.times.length>0;for(this.time+=t,this._time+=t,o=m(this._time/this.emissionRate),this.emitting&&o>1&&(this._time=0,this.spawn(d(this.minEmission,this.maxEmission)*o),!this.loop&&this.time>this.duration&&(this.emitting=!1)),n=r.length;n--;){e=r[n],e.update(t),i=e.lifeTime/e.life,c&&(e.size=s.update(i)),p&&(e.alpha=a.update(i)),u&&h.update(i,e.color),i>1&&(S.removeObject(e),r.splice(n,1))}this.emitting||0!==r.length||(this.playing=!1)}},c.prototype.toJSON=function(t){return t=e.prototype.toJSON.call(this,t),t.type=1,t.positionType=this.positionType,t.velocityType=this.velocityType,t.blending=this.blending,t.texture=this.texture?this.texture.name:void 0,t.position=this.position.toJSON(t.position),t.positionSpread=this.positionSpread.toJSON(t.positionSpread),t.positionRadius=this.positionRadius,t.speed=this.speed,t.speedSpread=this.speedSpread,t.worldSpace=this.worldSpace,t.minEmission=this.minEmission,t.maxEmission=this.maxEmission,t.minLife=this.minLife,t.maxLife=this.maxLife,t.minSize=this.minSize,t.maxSize=this.maxSize,t.sizeTween=this.sizeTween.toJSON(t.sizeTween),t.alphaTween=this.alphaTween.toJSON(t.alphaTween),t.colorTween=this.colorTween.toJSON(t.colorTween),t.velocity=this.velocity.toJSON(t.velocity),t.velocitySpread=this.velocitySpread.toJSON(t.velocitySpread),t.acceleration=this.acceleration.toJSON(t.acceleration),t.accelerationSpread=this.accelerationSpread.toJSON(t.accelerationSpread),t.angularVelocity=this.angularVelocity,t.angularAcceleration=this.angularAcceleration,t.angularVelocitySpread=this.angularVelocitySpread,t.randomAngle=this.randomAngle,t.emissionRate=this.emissionRate,t.color=this.color.toJSON(t.color),t.colorSpread=this.colorSpread.toJSON(t.colorSpread),t.time=this.time,t._time=this._time,t.duration=this.duration,t.loop=this.loop,t.playing=this.playing,t.emitting=this.emitting,t},c.prototype.fromJSON=function(t){return e.prototype.fromJSON.call(this,t),this.positionType=t.positionType,this.velocityType=t.velocityType,this.blending=t.blending,this.texture=t.texture?s.hash[t.texture]:void 0,this.position.fromJSON(t.position),this.positionSpread.fromJSON(t.positionSpread),this.positionRadius=t.positionRadius,this.speed=t.speed,this.speedSpread=t.speedSpread,this.worldSpace=t.worldSpace,this.minEmission=t.minEmission,this.maxEmission=t.maxEmission,this.minLife=t.minLife,this.maxLife=t.maxLife,this.minSize=t.minSize,this.maxSize=t.maxSize,this.sizeTween.fromJSON(t.sizeTween),this.alphaTween.fromJSON(t.alphaTween),this.colorTween.fromJSON(t.colorTween),this.velocity.fromJSON(t.velocity),this.velocitySpread.fromJSON(t.velocitySpread),this.acceleration.fromJSON(t.acceleration),this.accelerationSpread.fromJSON(t.accelerationSpread),this.angularVelocity=t.angularVelocity,this.angularAcceleration=t.angularAcceleration,this.angularVelocitySpread=t.angularVelocitySpread,this.randomAngle=t.randomAngle,this.emissionRate=t.emissionRate,this.color.fromJSON(t.color),this.colorSpread.fromJSON(t.colorSpread),this.time=t.time,this._time=t._time,this.duration=t.duration,this.loop=t.loop,this.playing=t.playing,this.emitting=t.emitting,this},c.MAX_PARTICLES=1024,c}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/particle_system/particle_system",["base/time","core/components/component","core/components/particle_system/emitter_2d"],function(t,e,i){function o(t){t||(t={}),e.call(this,"ParticleSystem",!!t.sync,t.json),this.playing=void 0!=t.playing?t.playing:!0,this.emitters=[],t.emitter&&this.addEmitter(t.emitter),t.emitters&&this.add.apply(this,t.emitters)}return o.type="ParticleSystem",e.extend(o),o.Emitter2D=i,o.prototype.copy=function(t){var e=t.emitters,i=0,o=e.length;for(this.clear();o>i;i++){this.addEmitter(e[i].clone())}return this.playing=t.playing,this},o.prototype.clear=function(){for(var t=this.emitters,e=t.length;e--;){this.removeEmitter(t[e])}return this},o.prototype.addEmitter=function(t){var e=this.emitters,i=e.indexOf(t);return-1===i?(t.particleSystem&&(t=t.clone()),e.push(t),t.particleSystem=this):Log.warn("ParticleSystem.addEmitter: ParticleSystem already has passed Emitter"),this},o.prototype.add=function(){for(var t=arguments.length;t--;){this.addEmitter(arguments[t])}return this},o.prototype.removeEmitter=function(t){var e=this.emitters,i=e.indexOf(t);return-1!==i?(e.splice(i,1),t.clear(),t.particleSystem=void 0,t.transform=void 0):Log.warn("ParticleSystem.removeEmitter: ParticleSystem does not have passed Emitter"),this},o.prototype.remove=function(){for(var t=arguments.length;t--;){this.removeEmitter(arguments[t])}return this},o.prototype.play=function(){var t,e=this.emitters;for(t=e.length;t--;){e[t].play()}return this.playing=!0,this},o.prototype.update=function(){if(!this.isServer&&this.playing){var e,i,o=t.delta,n=this.emitters,r=!1;for(i=n.length;i--;){e=n[i],e.update(o),e.playing&&(r=!0)}this.playing=r}},o.prototype.toJSON=function(t){t=e.prototype.toJSON.call(this,t);for(var i=this.emitters,o=t.emitters||(t.emitters=[]),n=0,r=i.length;r>n;n++){o[n]=i[n].toJSON(o[n])}return t.playing=this.playing,t},o.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t);for(var o,n=t.emitters,r=0,s=n.length;s>r;r++){o=n[r],this.addEmitter((new i).fromJSON(o))}return this.playing=t.playing,this},o}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/sprite_2d",["base/time","math/vec2","core/components/component","core/assets/assets"],function(t,e,i,o){function n(t){t||(t={}),i.call(this,"Sprite2D",!!t.sync,t.json),this.visible=void 0!=t.visible?!!t.visible:!0,this.blending=void 0!=t.blending?t.blending:Enums.BlendingDefault,this.z=void 0!=t.z?t.z:0,this.alpha=void 0!=t.alpha?t.alpha:1,this.texture=void 0!=t.texture?t.texture:void 0,this.width=t.width||1,this.height=t.height||1,this.x=t.x||0,this.y=t.y||0,this.w=t.w||1,this.h=t.h||1}return n.type="Sprite2D",i.extend(n),n.prototype.copy=function(t){return this.visible=t.visible,this.blending=t.blending,this.z=t.z,this.alpha=t.alpha,this.texture=t.texture,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},n.prototype.toSYNC=function(t){return t=i.prototype.toSYNC.call(this,t),t.visible=this.visible,t.blending=this.blending,t.z=this.z,t.alpha=this.alpha,t.width=this.width,t.height=this.height,t.x=this.x,t.y=this.y,t.w=this.w,t.h=this.h,t},n.prototype.fromSYNC=function(t){return i.prototype.fromSYNC.call(this,t),this.visible=t.visible,this.blending=t.blending,this.z=t.z,this.alpha=t.alpha,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},n.prototype.toJSON=function(t){return t=i.prototype.toJSON.call(this,t),t.visible=this.visible,t.blending=this.blending,t.z=this.z,t.alpha=this.alpha,t.texture=this.texture?this.texture.name:void 0,t.width=this.width,t.height=this.height,t.x=this.x,t.y=this.y,t.w=this.w,t.h=this.h,t},n.prototype.fromJSON=function(t){return i.prototype.fromJSON.call(this,t),this.visible=t.visible,this.blending=t.blending,this.z=t.z,this.alpha=t.alpha,this.texture=t.texture?o.hash[t.texture]:void 0,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},n.prototype.sort=function(t,e){return e.z-t.z},n}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/quat",["math/mathf","math/vec3"],function(t,e){function i(t,e,i,o){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==o?o:1}var o=Math.abs,n=Math.sqrt,r=Math.acos,a=Math.sin,h=Math.cos,c=t.EPSILON;return i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.set=function(t,e,i,o){return this.x=t,this.y=e,this.z=i,this.w=o,this},i.prototype.mul=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,r=t.x,s=t.y,a=t.z,h=t.w;return this.x=e*h+n*r+i*a-o*s,this.y=i*h+n*s+o*r-e*a,this.z=o*h+n*a+e*s-i*r,this.w=n*h-e*r-i*s-o*a,this},i.prototype.qmul=function(t,e){var i=t.x,o=t.y,n=t.z,r=t.w,s=e.x,a=e.y,h=e.z,c=e.w;return this.x=i*c+r*s+o*h-n*a,this.y=o*c+r*a+n*s-i*h,this.z=n*c+r*h+i*a-o*s,this.w=r*c-i*s-o*a-n*h,this},i.prototype.div=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,r=-t.x,s=-t.y,a=-t.z,h=t.w;return this.x=e*h+n*r+i*a-o*s,this.y=i*h+n*s+o*r-e*a,this.z=o*h+n*a+e*s-i*r,this.w=n*h-e*r-i*s-o*a,this},i.prototype.qdiv=function(t,e){var i=t.x,o=t.y,n=t.z,r=t.w,s=-e.x,a=-e.y,h=-e.z,c=e.w;return this.x=i*c+r*s+o*h-n*a,this.y=o*c+r*a+n*s-i*h,this.z=n*c+r*h+i*a-o*s,this.w=r*c-i*s-o*a-n*h,this},i.prototype.length=function(){var t=this.x,e=this.y,i=this.z,o=this.w,r=t*t+e*e+i*i+o*o;return r>0?n(r):0},i.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z,o=this.w;return t*t+e*e+i*i+o*o},i.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,o=this.w,r=t*t+e*e+i*i+o*o;return r=r>0?1/n(r):0,this.x*=r,this.y*=r,this.z*=r,this.w*=r,this},i.prototype.inverse=function(){var t=this.x,e=this.y,i=this.z,o=this.w,n=t*t+e*e+i*i+o*o,r=n>0?1/n:0;return this.x*=-r,this.y*=-r,this.z*=-r,this.w*=r,this},i.prototype.inverseQuat=function(t){var e=t.x,i=t.y,o=t.z,n=t.w,r=e*e+i*i+o*o+n*n,s=r>0?1/r:0;return this.x=-e*s,this.y=-i*s,this.z=-o*s,this.w=n*s,this},i.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.calculateW=function(){var t=this.x,e=this.y,i=this.z;return this.w=-n(o(1-t*t-e*e-i*i)),this},i.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},i.prototype.qlerp=function(t,e,i){var o=t.x,n=t.y,r=t.z,s=t.w;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=r+(e.z-r)*i,this.w=s+(e.w-s)*i,this},i.prototype.nlerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this.normalize()},i.prototype.qnlerp=function(t,e,i){var o=t.x,n=t.y,r=t.z,s=t.w;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=r+(e.z-r)*i,this.w=s+(e.w-s)*i,this.normalize()},i.prototype.slerp=function(t,e){var i,o,n,s,h=this.x,p=this.y,u=this.z,f=this.w,l=t.x,m=t.y,d=t.z,y=t.w,v=h*l+p*m+u*d+f*y;return 0>v&&(v*=-1,l*=-1,m*=-1,d*=-1,y*=-1),1-v>c?(i=r(v),o=1/a(i),n=a((1-e)*i)*o,s=a(e*i)*o):(n=1-e,s=e),this.x=n*h+s*l,this.y=n*p+s*m,this.z=n*u+s*d,this.w=n*f+s*y,this},i.prototype.qslerp=function(t,e,i){var o,n,s,h,p=t.x,u=t.y,f=t.z,l=t.w,m=e.x,d=e.y,y=e.z,v=e.w,g=p*m+u*d+f*y+l*v;return 0>g&&(g*=-1,m*=-1,d*=-1,y*=-1,v*=-1),1-g>c?(o=r(g),n=1/a(o),s=a((1-i)*o)*n,h=a(i*o)*n):(s=1-i,h=i),this.x=s*p+h*m,this.y=s*u+h*d,this.z=s*f+h*y,this.w=s*l+h*v,this},i.qdot=i.prototype.qdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.prototype.rotateX=function(t){var e=.5*t,i=this.x,o=this.y,n=this.z,r=this.w,s=a(e),c=h(e);return this.x=i*c+r*s,this.y=o*c+n*s,this.z=n*c-o*s,this.w=r*c-i*s,this},i.prototype.rotateY=function(t){var e=.5*t,i=this.x,o=this.y,n=this.z,r=this.w,s=a(e),c=h(e);return this.x=i*c-n*s,this.y=o*c+r*s,this.z=n*c+i*s,this.w=r*c-o*s,this},i.prototype.rotateZ=function(t){var e=.5*t,i=this.x,o=this.y,n=this.z,r=this.w,s=a(e),c=h(e);return this.x=i*c+o*s,this.y=o*c-i*s,this.z=n*c+r*s,this.w=r*c-n*s,this},i.prototype.rotate=function(t,e,i){return this.rotateZ(i),this.rotateX(t),this.rotateY(e),this},i.prototype.lookRotation=function(t,e){var i=t.x,o=t.y,n=t.z,r=e.x,a=u.y,h=e.z,c=a*n-h*o,p=h*i-r*n,f=r*o-a*i,l=2*(1+r*i+a*o+h*n),m=l*l;return s=1/m,this.x=c*s,this.y=p*s,this.z=f*s,this.w=.5*m,this},i.prototype.fromAxisAngle=function(t,e){var i=.5*e,o=a(i);return this.x=t.x*o,this.y=t.y*o,this.z=t.z*o,this.w=h(i),this},i.prototype.fromVec3s=function(){var t=new e;return function(e,i){return t.vcross(e,i),this.x=t.x,this.y=t.y,this.z=t.z,this.w=n(e.lengthSq()*i.lengthSq())+e.dot(i),this.normalize()}}(),i.prototype.fromMat3=function(t){var e,i,o=t.elements,r=o[0],s=o[3],a=o[6],h=o[1],c=o[4],p=o[7],u=o[2],f=o[5],l=o[8],m=r+c+l;return m>0?(e=.5/n(m+1),this.w=.25/e,this.x=(f-p)*e,this.y=(a-u)*e,this.z=(h-s)*e):r>c&&r>l?(e=2*n(1+r-c-l),i=1/e,this.w=(f-p)*i,this.x=.25*e,this.y=(s+h)*i,this.z=(a+u)*i):c>l?(e=2*n(1+c-r-l),i=1/e,this.w=(a-u)*i,this.x=(s+h)*i,this.y=.25*e,this.z=(p+f)*i):(e=2*n(1+l-r-c),i=1/e,this.w=(h-s)*i,this.x=(a+u)*i,this.y=(p+f)*i,this.z=.25*e),this},i.prototype.fromMat4=function(t){var e,i,o=t.elements,r=o[0],s=o[4],a=o[8],h=o[1],c=o[5],p=o[9],u=o[2],f=o[6],l=o[10],m=r+c+l;return m>0?(e=.5/n(m+1),this.w=.25/e,this.x=(f-p)*e,this.y=(a-u)*e,this.z=(h-s)*e):r>c&&r>l?(e=2*n(1+r-c-l),i=1/e,this.w=(f-p)*i,this.x=.25*e,this.y=(s+h)*i,this.z=(a+u)*i):c>l?(e=2*n(1+c-r-l),i=1/e,this.w=(a-u)*i,this.x=(s+h)*i,this.y=.25*e,this.z=(p+f)*i):(e=2*n(1+l-r-c),i=1/e,this.w=(h-s)*i,this.x=(a+u)*i,this.y=(p+f)*i,this.z=.25*e),this},i.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},i.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},i.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},i.prototype.toString=function(){return"Quat( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/transform",["math/mathf","math/vec3","math/quat","math/mat4","core/components/component","core/game/log"],function(t,e,i,o,n,r){function s(t){t||(t={}),n.call(this,"Transform",t.sync,t.json),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!==t.position?t.position:new e,this.rotation=void 0!==t.rotation?t.rotation:new i,this.scale=void 0!==t.scale?t.scale:new e(1,1,1),this.matrix=new o,this.matrixWorld=new o,this.modelView=new o,this._modelViewNeedsUpdate=!1}function a(t,e){var i,o=t.children;for(t.depth=e,i=o.length;i--;){a(o[i],e+1)}}var h,c=t.EPSILON;return s.type="Transform",n.extend(s),s.prototype.copy=function(t){var e,i=t.children;for(this.position.copy(t.position),this.scale.copy(t.scale),this.rotation.copy(t.rotation),e=i.length;e--;){this.add(i[e].gameObject.clone().transform)}return t.parent&&t.parent.add(this),this},s.prototype.translate=function(){var t=new e;return function(e,o){return t.copy(e),o instanceof s?t.transformQuat(o.rotation):o instanceof i&&t.transformQuat(o),this.position.add(t),this}}(),s.prototype.rotate=function(){var t=new e;return function(e,o){return t.copy(e),o instanceof s?t.transformQuat(o.rotation):o instanceof i&&t.transformQuat(o),this.rotation.rotate(t.x,t.y,t.z),this}}(),s.prototype.lookAt=function(){var t=new o,i=new e,n=new e(0,0,1);return function(e,o){return o=o||n,e instanceof s?i.copy(e.position):i.copy(e),t.lookAt(this.position,i,o),this.rotation.fromMat4(t),this}}(),s.prototype.follow=function(){var t=new e,i=new e,o=new e;return function(e,n){return i.set(0,0,0).transformMat4(this.matrixWorld),t.set(0,0,0).transformMat4(e.matrixWorld),o.vsub(t,i),o.lengthSq()>c&&this.position.add(o.smul(n)),this}}(),s.prototype.addChild=function(t){if(!(t instanceof s)){return r.warn("Transform.add: can't add passed argument, it is not an instance of Transform"),this}var e,i,o=this.children,n=o.indexOf(t);if(0>n){for(t.parent&&t.parent.remove(t),t.parent=this,o.push(t),e=this,i=0;e.parent;){e=e.parent,i++}t.root=e,this.root=e,a(this,i)}else{r.warn("Transform.add: child is not a member of this Transform")}return this},s.prototype.add=s.prototype.addChildren=function(){for(var t=arguments.length;t--;){this.addChild(arguments[t])}return this},s.prototype.removeChild=function(t){var e,i,o=this.children,n=o.indexOf(t);if(n>-1){for(t.parent=void 0,o.splice(n,1),e=this,i=0;e.parent;){e=e.parent,i++}t.root=t,this.root=e,a(this,i)}else{r.warn("Transform.remove: child is not a member of this Transform")}return this},s.prototype.remove=s.prototype.removeChildren=function(){for(var t=arguments.length;t--;){this.removeChild(arguments[t])}return this},s.prototype.detachChildren=function(){var t,e=this.children;for(t=e.length;t--;){this.removeChild(e[t])}return this},s.prototype.toWorld=function(t){return t.transformMat4(this.matrixWorld)},s.prototype.toLocal=function(){var t=new o;return function(e){return e.transformMat4(t.inverseMat(this.matrixWorld))}}(),s.prototype.update=function(){var t=this.matrix,e=this.parent;t.compose(this.position,this.scale,this.rotation),e?this.matrixWorld.mmul(e.matrixWorld,t):this.matrixWorld.copy(t),this._modelViewNeedsUpdate=!0},s.prototype.updateModelView=function(t){this._modelViewNeedsUpdate&&(this.modelView.mmul(t,this.matrixWorld),this._modelViewNeedsUpdate=!1)},s.prototype.sort=function(t,e){return e.depth-t.depth},h=new e,s.prototype.toSYNC=function(t){return t=n.prototype.toSYNC.call(this,t),this.parent?(t.position=this.toWorld(h.copy(this.position)).toJSON(t.position),t.scale=this.toWorld(h.copy(this.scale)).toJSON(t.scale),t.rotation=this.toWorld(h.copy(this.rotation)).toJSON(t.rotation)):(t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation.toJSON(t.rotation)),t},s.prototype.fromSYNC=function(t){return this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation.fromJSON(t.rotation),this},s.prototype.toJSON=function(t){return t=n.prototype.toJSON.call(this,t),t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation.toJSON(t.rotation),t},s.prototype.fromJSON=function(t){return n.prototype.fromJSON.call(this,t),this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation.fromJSON(t.rotation),this},s}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/components/transform_2d",["math/mathf","math/vec2","math/mat32","math/mat4","core/components/component","core/game/log"],function(t,e,i,o,n,r){function s(t){t||(t={}),n.call(this,"Transform2D",t.sync,t.json),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!=t.position?t.position:new e,this.rotation=void 0!=t.rotation?t.rotation:0,this.scale=void 0!=t.scale?t.scale:new e(1,1),this.matrix=new i,this.matrixWorld=new i,this.modelView=new i,this._modelViewNeedsUpdate=!1}function a(t,e){var i,o=t.children;for(t.depth=e,i=o.length;i--;){a(o[i],e+1)}}var h,c=t.EPSILON;return s.type="Transform2D",n.extend(s),s.prototype.copy=function(t){var e,i=t.children;for(this.position.copy(t.position),this.scale.copy(t.scale),this.rotation=t.rotation,e=i.length;e--;){this.add(i[e].gameObject.clone().transform)}return t.parent&&t.parent.add(this),this},s.prototype.translate=function(){var t=new e;return function(e,i){return t.copy(e),i instanceof s?t.transformAngle(i.rotation):i&&t.transformAngle(i),this.position.add(t),this}}(),s.prototype.rotate=function(){var t=new e;return function(e,i){return t.copy(e),i instanceof s?t.transformAngle(i.rotation):i&&t.transformAngle(i),this.rotation.rotate(t.x,t.y,t.z),this}}(),s.prototype.lookAt=function(){var t=new i,o=new e;return function(e,i){return i=i||dup,e instanceof s?o.copy(e.position):o.copy(e),t.lookAt(this.position,o),this.rotation=t.getRotation(),this}}(),s.prototype.follow=function(){var t=new e,i=new e,o=new e;return function(e,n){return i.set(0,0).transformMat32(this.matrixWorld),t.set(0,0).transformMat32(e.matrixWorld),o.vsub(t,i),o.lengthSq()>c&&this.position.add(o.smul(n)),this}}(),s.prototype.addChild=function(t){if(!(t instanceof s)){return r.warn("Transform2D.add: can't add passed argument, it is not an instance of Transform2D"),this}var e,i,o=this.children,n=o.indexOf(t);if(0>n){for(t.parent&&t.parent.remove(t),t.parent=this,o.push(t),e=this,i=0;e.parent;){e=e.parent,i++}t.root=e,this.root=e,a(this,i)}else{r.warn("Transform2D.add: child is not a member of this Transform2D")}return this},s.prototype.add=s.prototype.addChildren=function(){for(var t=arguments.length;t--;){this.addChild(arguments[t])}return this},s.prototype.removeChild=function(t){var e,i,o=this.children,n=o.indexOf(t);if(n>-1){for(t.parent=void 0,o.splice(n,1),e=this,i=0;e.parent;){e=e.parent,i++}t.root=t,this.root=e,a(this,i)}else{r.warn("Transform2D.remove: child is not a member of this Transform2D")}return this},s.prototype.remove=s.prototype.removeChildren=function(){for(var t=arguments.length;t--;){this.removeChild(arguments[t])}return this},s.prototype.detachChildren=function(){var t,e=this.children;for(t=e.length;t--;){this.removeChild(e[t])}return this},s.prototype.toWorld=function(t){return t.transformMat32(this.matrixWorld)},s.prototype.toLocal=function(){var t=new i;return function(e){return e.transformMat32(t.inverseMat(this.matrixWorld))}}(),s.prototype.update=function(){var t=this.matrix,e=this.parent;t.compose(this.position,this.scale,this.rotation),e?this.matrixWorld.mmul(e.matrixWorld,t):this.matrixWorld.copy(t),this._modelViewNeedsUpdate=!0},s.prototype.updateModelView=function(t){this._modelViewNeedsUpdate&&(this.modelView.mmul(t,this.matrixWorld),this._modelViewNeedsUpdate=!1)},s.prototype.sort=function(t,e){return e.depth-t.depth},h=new e,s.prototype.toSYNC=function(t){return t=n.prototype.toSYNC.call(this,t),this.parent?(t.position=this.toWorld(h.copy(this.position)).toJSON(t.position),t.scale=this.toWorld(h.copy(this.scale)).toJSON(t.scale),t.rotation=this.rotation-this.parent.rotation):(t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation),t},s.prototype.fromSYNC=function(t){return this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation=t.rotation,this},s.prototype.toJSON=function(t){return t=n.prototype.toJSON.call(this,t),t.position=this.position.toJSON(t.position),t.scale=this.scale.toJSON(t.scale),t.rotation=this.rotation,t},s.prototype.fromJSON=function(t){return n.prototype.fromJSON.call(this,t),this.position.fromJSON(t.position),this.scale.fromJSON(t.scale),this.rotation=t.rotation,this},s}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/game/loop",["base/request_animation_frame","core/game/log"],function(t,e){function i(t,e){e||(e=this),this._loopState=n,this._runState=s,this.callback=t,this.ctx=e||this;var i=this;this._run=function(n){i._runState=r,t&&(t.call(e,n),i._loopState===o?i._pump():i.pause()),i._runState=s}}i.prototype.init=i.prototype.resume=function(){return this.callback?(this._loopState=o,this._runState===s&&this._pump(),void 0):(e.warn("Loop.resume: can't run loop without callback"),void 0)},i.prototype.pause=function(){this._loopState=n},i.prototype.isRunning=function(){return this._loopState===o},i.prototype.isPaused=function(){return this._loopState===n},i.prototype._pump=function(){t(this._run)};var o=i.L_RUNNING=1,n=i.L_PAUSED=2,r=i.R_RUNNING=1,s=i.R_PAUSED=2;return i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/game_object",["base/class","core/components/component","core/game/log"],function(t,e,i){function o(e){e||(e={}),t.call(this),this.sync=void 0!=e.sync?!!e.sync:!0,this.json=void 0!=e.json?!!e.json:!0,this.scene=void 0,this.tags=[],this.components=[],this._componentHash={},this._componentHashServer={},e.tags&&this.addTags.apply(this,e.tags),e.components&&this.addComponents.apply(this,e.components)}return t.extend(o),o.prototype.copy=function(t){var e,i=t.components,o=t.tags;for(this.clear(),e=i.length;e--;){this.addComponent(i[e].clone())}for(e=o.length;e--;){this.addTag(o[e])}return t.scene&&t.scene.addGameObject(this),this},o.prototype.clear=function(){var t,e=this.components,i=this.tags;for(t=i.length;t--;){this.removeTag(i[t])}for(t=e.length;t--;){this.removeComponent(e[t])}return this},o.prototype.destroy=function(){return this.scene?(this.scene.removeGameObject(this),this.emit("destroy"),this.clear(),this):(i.warn("GameObject.destroy: can't destroy GameObject if it's not added to a Scene"),this)},o.prototype.addTag=function(t){var e=this.tags,i=e.indexOf(t);return-1===i&&e.push(t),this},o.prototype.addTags=function(){for(var t=arguments.length;t--;){this.addTag(arguments[t])}return this},o.prototype.removeTag=function(t){var e=this.tags,i=e.indexOf(t);return-1!==i&&e.splice(i,1),this},o.prototype.removeTags=function(){for(var t=arguments.length;t--;){this.removeTag(arguments[t])}return this},o.prototype.hasTag=function(t){return-1!==this.tags.indexOf(t)},o.prototype.addComponent=function(t,o){if("string"==typeof t&&(t=new e._types[t]),!(t instanceof e)){return i.warn("GameObject.addComponent: can't add passed argument, it is not an instance of Component"),this
}var n,r,s,a=t._name,h=this.components,c=h.indexOf(t);if(-1===c){if(t.gameObject&&(t=t.clone()),h.push(t),this._componentHash[t._id]=t,-1!==t._serverId&&(this._componentHashServer[t._serverId]=t),t.gameObject=this,this[a]=t,!o){for(r=h.length;r--;){if(n=h[r]){for(s=h.length;s--;){a=h[s]._name,n[a]=h[s]}}}}this.emit("add"+t._type,t),this.emit("addComponent",t),this.scene&&this.scene._addComponent(t)}else{i.warn("GameObject.addComponent: GameObject already has a(n) "+type+" Component")}return this},o.prototype.add=o.prototype.addComponents=function(){var t,e,i,o,n=arguments.length,r=this.components;for(i=n;i--;){this.addComponent(arguments[i],!0)}for(i=r.length;i--;){if(t=r[i]){for(o=r.length;o--;){e=r[o]._name,t[e]=r[o]}}}return this},o.prototype.removeComponent=function(t,o){if("string"==typeof t&&(t=this.getComponent(t)),!(t instanceof e)){return i.warn("GameObject.removeComponent: can't remove passed argument, it is not an instance of Component"),this}var n,r,s,a=t._name,h=this.components,c=h.indexOf(t);if(-1!==c){if(!o){for(r=h.length;r--;){if(n=h[r]){for(s=h.length;s--;){a===h[s]._name&&(n[a]=void 0)}}}}h.splice(c,1),this._componentHash[t._id]=void 0,-1!==t._serverId&&(this._componentHashServer[t._serverId]=void 0),t.gameObject=void 0,this[a]=void 0,this.emit("remove"+t._type,t),this.emit("removeComponent",t),this.scene&&this.scene._removeComponent(t)}else{i.warn("GameObject.removeComponent: GameObject does not have a(n) "+type+" Component")}return this},o.prototype.remove=o.prototype.removeComponents=function(){var t,e,i,o,n=arguments.length,r=this.components,s=arguments;for(i=n;i--;){this.removeComponent(arguments[i],!0)}for(i=r.length;i--;){if(t=r[i]){for(e=t._name,o=s.length;o--;){e===s[i]._name&&(t[e]=void 0)}}}return this},o.prototype.getComponent=function(t){return this._componentHash[t]||this[t]||this[t.toLowerCase()]},o.prototype.hasComponent=function(t){var e,i=this.components;for(e=i.length;e--;){if(i[e]._type===t){return!0}}return!1},o.prototype.findComponentById=function(t){return this._componentHash[t]},o.prototype.findComponentByServerId=function(t){return this._componentHashServer[t]},o.prototype.toSYNC=function(e){e=t.prototype.toSYNC.call(this,e);for(var i,o=this.components,n=e.components||(e.components=[]),r=o.length;r--;){(i=o[r]).sync&&(n[r]=i.toSYNC(n[r]))}return e},o.prototype.fromSYNC=function(i,o){t.prototype.fromSYNC.call(this,i);for(var n,r,s,a=i.components||(i.components=[]),h=a.length;h--;){if(r=a[h]){if(n=this.findComponentByServerId(r._id)){n.fromSYNC(r,o)}else{if(!(s=e._types[r._type])){throw"No Component named "+r.type+' make sure to add a type to the constructor - Component.type = "Component"'}this.addComponent((new s).fromSYNC(r,o))}}}return this},o.prototype.toJSON=function(e){e=t.prototype.toJSON.call(this,e);for(var i,o=this.components,n=e.components||(e.components=[]),r=this.tags,s=e.tags||(e.tags=[]),a=o.length;a--;){(i=o[a]).json&&(n[a]=i.toJSON(n[a]))}for(a=r.length;a--;){s[a]=r[a]}return e},o.prototype.fromJSON=function(i){t.prototype.fromJSON.call(this,i);for(var o,n,r,s=i.components||(i.components=[]),a=this.tags,h=i.tags||(i.tags=[]),c=s.length;c--;){if(n=s[c]){if(!(r=e._types[n.type])){throw"No Component named "+n.type+' make sure to add a type to the constructor - Component.type = "Component"'}(o=this.findComponentByServerId(n._id))?o.fromJSON(n):this.addComponent((new r).fromJSON(n))}}for(c=h.length;c--;){this.hasTag(h[c])||a.push(h[c])}return this},o}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/world",["base/event_emitter","math/color"],function(t,e){function i(i){i||(i={}),t.call(this),this.scene=void 0,this.background=void 0!=i.color?i.color:new e(.5,.5,.5)}return t.extend(i),i.prototype.init=function(){},i.prototype.update=function(){},i.prototype.clear=function(){return this.background.set(.5,.5,.5),this},i.prototype.destroy=function(){return this.scene?(this.scene.removeWorld(),this.emit("destroy"),this.clear(),this):(Log.warn("World.destroy: can't destroy World if it's not set to a Scene"),this)},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/scene",["base/class","core/game_object","core/world","core/game/log"],function(t,e,i,o){function n(e){e||(e={}),t.call(this),this.game=void 0,this._needsSync=!0,this.name=void 0!=e.name?e.name:"Scene-"+this._id,this.world=void 0,this.gameObjects=[],this._gameObjectHash={},this._gameObjectServerHash={},this.components={},this._componentTypes=[],this._componentHash={},this._componentHashServer={},this.setWorld(e.world instanceof i?e.world:new i(e.world)),e.gameObjects&&this.addGameObjects.apply(this,e.gameObjects)}return t.extend(n),n.prototype.init=function(){var t,e,i,o=this._componentTypes,n=this.gameObjects;for(this.world&&this.world.init(),e=o.length;e--;){for(t=o[e],i=t.length;i--;){t[i].init()}}for(e=n.length;e--;){n[e].emit("init")}},n.prototype.update=function(){var t,e,i,o=this._componentTypes,n=this.gameObjects;for(this.world&&this.world.update(),e=o.length;e--;){for(t=o[e],i=t.length;i--;){t[i].update()}}for(e=n.length;e--;){n[e].emit("update")}this._needsSync=!0},n.prototype.clear=function(){var t,e=this.gameObjects;for(this.world=void 0,t=e.length;t--;){this.removeGameObject(e[t])}return this},n.prototype.destroy=function(){return this.game?(this.game.removeScene(this),this.emit("destroy"),this.clear(),this):(o.warn("Scene.destroy: can't destroy Scene if it's not added to a Game"),this)},n.prototype.setWorld=function(t){return this.world&&this.removeWorld(),t.scene=this,this.world=t,this.game&&t.init(),this},n.prototype.removeWorld=function(){if(!this.world){return this}var t=this.world;return t.scene=void 0,this.world=void 0,this},n.prototype.addGameObject=function(t){if(!(t instanceof e)){return o.warn("Scene.addGameObject: can't add argument to Scene, it's not an instance of GameObject"),this}var i,n,r=this.gameObjects,s=r.indexOf(t);if(-1===s){for(t.scene&&t.scene.removeGameObject(t),r.push(t),this._gameObjectHash[t._id]=t,-1!==t._serverId&&(this._gameObjectServerHash[t._serverId]=t),t.scene=this,i=t.components,n=i.length;n--;){this._addComponent(i[n])}this.game&&t.emit("init"),this.emit("addGameObject",t)}else{o.warn("Scene.addGameObject: GameObject is already a member of Scene")}return this},n.prototype.add=n.prototype.addGameObjects=function(){for(var t=arguments.length;t--;){this.addGameObject(arguments[t])}return this},n.prototype._addComponent=function(t){if(t){var e=t._type,i=this.components,o=!i[e],n=i[e]=i[e]||[];this._componentHash[t._id]=t,-1!==t._serverId&&(this._componentHashServer[t._serverId]=t),n.push(t),n.sort(t.sort),o&&this._componentTypes.push(n),this.game&&t.init(),this.emit("add"+e,t),this.emit("addComponent",t)}},n.prototype.removeGameObject=function(t){if(!(t instanceof e)){return o.warn("Scene.removeGameObject: can't remove argument from Scene, it's not an instance of GameObject"),this}var i,n,r=this.gameObjects,s=r.indexOf(t);if(-1!==s){for(r.splice(s,1),this._gameObjectHash[t._id]=void 0,-1!==t._serverId&&(this._gameObjectServerHash[t._serverId]=void 0),t.scene=void 0,i=t.components,n=i.length;n--;){this._removeComponent(i[n])}this.emit("removeGameObject",t)}else{o.warn("Scene.removeGameObject: GameObject is not a member of Scene")}return this},n.prototype.remove=n.prototype.removeGameObjects=function(){for(var t=arguments.length;t--;){this.removeGameObject(arguments[t])}return this},n.prototype._removeComponent=function(t){if(t){var e=t._type,i=this.components,o=i[e],n=o.indexOf(t);this._componentHash[t._id]=void 0,-1!==t._serverId&&(this._componentHashServer[t._serverId]=void 0),o.splice(n,1),o.sort(t.sort),this.emit("remove"+e,t),this.emit("removeComponent",t),t.clear()}},n.prototype.findById=function(t){return this._gameObjectHash[t]},n.prototype.findByServerId=function(t){return this._gameObjectServerHash[t]},n.prototype.findComponentById=function(t){return this._componentHash[t]},n.prototype.findComponentByServerId=function(t){return this._componentHashServer[t]},n.prototype.toSYNC=function(e){if(!this._needsSync){return this._SYNC}e=t.prototype.toSYNC.call(this,e);var i,o,n=this.gameObjects,r=e.gameObjects||(e.gameObjects=[]);for(o=n.length;o--;){(i=n[o]).sync&&(r[o]=i.toSYNC(r[o]))}return this._needsSync=!1,e},n.prototype.fromSYNC=function(e,i){t.prototype.fromSYNC.call(this,e);var o,n,r,s=e.gameObjects;for(r=s.length;r--;){(n=s[r])&&(o=this.findByServerId(n._id))&&o.fromSYNC(n,i)}return this},n.prototype.toJSON=function(e){e=t.prototype.toJSON.call(this,e);var i,o,n=this.gameObjects,r=e.gameObjects||(e.gameObjects=[]);for(e.name=this.name,o=n.length;o--;){(i=n[o]).json&&(r[o]=i.toJSON(r[o]))}return e},n.prototype.fromJSON=function(i){t.prototype.fromJSON.call(this,i);var o,n,r,s=i.gameObjects;for(this.name=i.name,r=s.length;r--;){(n=s[r])&&((o=this.findByServerId(n._id))?o.fromJSON(n):this.addGameObject((new e).fromJSON(n)))}return this},n}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/game/game",["base/class","core/game/loop","core/scene","core/game/log"],function(t,e,i,o){function n(i){i||(i={}),t.call(this),this._loop=new e(this.loop,this),this.scenes=[],this._sceneHash={},this._sceneServerHash={}}return t.extend(n),n.prototype.addScene=function(t){if(!(t instanceof i)){return o.warn("Game.addScene: can't add argument to Game, it's not an instance of Scene"),this}var e=this.scenes,n=e.indexOf(t);return-1===n?(t.game&&t.game.removeScene(t),e.push(t),this._sceneHash[t._id]=t,-1!==t._serverId&&(this._sceneServerHash[t._serverId]=t),t.game=this,t.init(),this.emit("addScene",t)):o.warn("Game.addScene: Scene is already a member of Game"),this},n.prototype.add=n.prototype.addScenes=function(){for(var t=arguments.length;t--;){this.addScene(arguments[t])}return this},n.prototype.removeScene=function(t){if(!(t instanceof i)){return o.warn("Game.removeScene: can't remove argument from Game, it's not an instance of Scene"),this}var e=this.scenes,n=e.indexOf(t);return-1!==n?(e.splice(n,1),this._sceneHash[t._id]=void 0,-1!==t._serverId&&(this._sceneServerHash[t._serverId]=void 0),t.game=void 0,this.emit("removeScene",t)):o.warn("Game.removeScene: Scene not a member of Game"),this},n.prototype.remove=n.prototype.removeScenes=function(){for(var t=arguments.length;t--;){this.removeScene(arguments[t])}return this},n.prototype.findById=function(t){return this._sceneHash[t]},n.prototype.findByServerId=function(t){return this._sceneServerHash[t]},n.prototype.pause=function(){return this._loop.pause(),this},n.prototype.resume=function(){return this._loop.resume(),this},n.prototype.loop=function(t){this.emit("update",t)},n.prototype.toSYNC=function(t){t||(t=this._SYNC);var e,i=this.scenes,o=t.jsonScenes||(t.jsonScenes=[]);for(e=i.length;e--;){o[e]=i[e].toSYNC(o[e])}return t},n.prototype.fromSYNC=function(t){var e,i,o,n=t.scenes;for(o=n.length;o--;){i=n[o],(e=this.findByServerId(i._serverId))&&e.fromSYNC(i)}return this},n.prototype.toJSON=function(e){e||(e={}),t.prototype.toJSON.call(this,e);var i,o=this.scenes,n=e.scenes||(e.scenes=[]);for(i=o.length;i--;){n[i]=o[i].toJSON(n[i])}return e},n.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e);var o,n,r,s=e.scenes;for(r=s.length;r--;){n=s[r],(o=this.findByServerId(n._id))?o.fromJSON(n):this.addScene((new i).fromJSON(n))}return this},n}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/rendering/canvas",["base/event_emitter","base/device","base/dom","core/game/config"],function(t,e,i,o){function n(e,i){t.call(this),this.fullScreen=void 0===e&&void 0===i?!0:!1,this.width=void 0!==e?e:window.innerWidth,this.height=void 0!==i?i:window.innerHeight,this.aspect=this.width/this.height,this.pixelWidth=this.width,this.pixelHeight=this.height,this.element=void 0}var r=i.addEvent,s=i.removeEvent,a=i.addMeta,h=Math.floor,c=/-scale\s *=\s*[.0-9]+/g,p="viewport",u="viewport-width",f="viewport-height",l=["background: #000000;","position: absolute;","top: 50%;","left: 50%;","padding:0px;","margin: 0px;"].join("\n");return a(p,"viewport","initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"),a(u,"viewport","width=device-width"),a(f,"viewport","height=device-height"),t.extend(n),n.prototype.init=function(){this.element&&this.destroy();var t=document.createElement("canvas");t.style.cssText=l,document.body.appendChild(t),o.debug||(t.oncontextmenu=function(){return!1}),r(window,"resize orientationchange",this.handleResize,this),this.element=t,this.handleResize()},n.prototype.destroy=function(){return this.element?(s(window,"resize orientationchange",this.handleResize,this),document.body.removeChild(this.element),this.element=void 0,this):this},n.prototype.setFullscreen=function(t){return this.element&&this.fullScreen!==t?(this.fullScreen=!!t,this.handleResize(),this):this},n.prototype.setWidth=function(t){return this.element&&this.width!==t?(this.width=t,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},n.prototype.setHeight=function(t){return this.element&&this.height!==t?(this.height=t,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},n.prototype.style=function(t,e){return this.element?(this.element.style[t]=e,this):this},n.prototype.setBackgroundColor=function(t){return this.element?(this.element.style.background=t,this):this},n.prototype.handleResize=function(){var t,i,o=document.getElementById(p).getAttribute("content"),n=window.innerWidth,r=window.innerHeight,s=n/r,a=this.element,l=a.style;this.fullScreen?(t=n,i=r):s>this.aspect?(t=r*this.aspect,i=r):(t=n,i=n/this.aspect),this.pixelWidth=h(t),this.pixelHeight=h(i),a.width=t,a.height=i,l.marginLeft=-h(.5*t)-1+"px",l.marginTop=-h(.5*i)-1+"px",l.width=h(t)+"px",l.height=h(i)+"px",document.getElementById(p).setAttribute("content",o.replace(c,"-scale="+e.invPixelRatio)),document.getElementById(u).setAttribute("content","width="+n),document.getElementById(f).setAttribute("content","height="+r),window.scrollTo(1,1),this.emit("resize")},n}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/rendering/canvas_renderer_2d",["base/event_emitter","base/device","base/dom","math/mathf","math/vec2","math/mat32","math/color"],function(t,e,i,o,n,r,s){function a(e){e||(e={}),t.call(this),this.canvas=void 0,this.context=void 0,this._context=!1,this._offContext=void 0,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground=new s}var h,c,p=[],u=new Image;return u.src="data:image/gif;base64,R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",t.extend(a),a.prototype.init=function(t){this.canvas&&this.clear(),this.canvas=t;try{this.context=t.element.getContext("2d")}catch(e){return this}return this._context=!0,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground.set(0,0,0),this.setBlending(Enums.BlendingDefault),this._offContext=document.createElement("canvas").getContext("2d"),this},a.prototype.clear=function(){return this.canvas=void 0,this.context=void 0,this._context=!1,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground.set(0,0,0),this._offContext=void 0,this},a.prototype.setBlending=function(t){var e=this.context;switch(t){case Enums.BlendingNone:e.globalCompositeOperation="none";break;case Enums.BlendingAdditive:e.globalCompositeOperation="color-dodge";break;case Enums.BlendingSubtractive:e.globalCompositeOperation="color-burn";break;case Enums.BlendingMuliply:e.globalCompositeOperation="multiply";break;case Enums.BlendingDefault:default:e.globalCompositeOperation="source-over"}},a.prototype.render=function(t,e){var i,o,n,r,s,a,h,c,u,f,l,m,d,y,v;if(this._context){for(i=this.context,o=this._lastBackground,n=t.world.background,r=t.components,s=r.Sprite2D||p,a=r.ParticleSystem||p,(o.r!==n.r||o.g!==n.g||o.b!==n.b)&&(o.copy(n),i.fillStyle=n.toRGB()),this._lastCamera!==e&&(l=this.canvas,m=l.pixelWidth,d=l.pixelHeight,y=.5*m,v=.5*d,e.set(m,d),i.translate(y,v),i.scale(y,-v),i.fillStyle=n.toRGB(),this._lastResizeFn&&l.off("resize",this._lastResizeFn),this._lastResizeFn=function(){var t=this.pixelWidth,o=this.pixelHeight,r=.5*t,s=.5*o;e.set(t,o),i.translate(r,s),i.scale(r,-s),i.fillStyle=n.toRGB()},l.on("resize",this._lastResizeFn),this._lastCamera=e),i.fillRect(-1,-1,2,2),f=s.length;f--;){h=s[f],u=h.transform2d,u&&(u.updateModelView(e.view),this.renderSprite2D(e,u,h))}for(f=a.length;f--;){c=a[f],u=c.transform2d,u&&(u.updateModelView(e.view),this.renderParticleSystem(e,u,c))}}},h=new r,c=h.elements,a.prototype.renderSprite2D=function(t,e,i){var o=this.context,n=i.texture;h.mmul(t.projection,e.modelView),n=n?n.raw:u,o.save(),this.setBlending(i.blending),o.transform(c[0],-c[2],-c[1],c[3],c[4],c[5]),o.scale(1,-1),1!==i.alpha&&(o.globalAlpha=i.alpha),o.drawImage(n,i.x,i.y,i.w,i.h,i.width*-.5,i.height*-.5,i.width,i.height),o.restore()},a.prototype.renderParticleSystem=function(t,e,i){var o,n,r,s,a,p,f,l,m,d,y=this.context,v=this._offContext,g=v.canvas,x=i.emitters,w=x.length;if(w){for(;w--;){if(o=x[w],a=o.particles,d=a.length){if(n=o.texture,n=n?n.raw:u,p=o.worldSpace?t.view:e.modelView,y.save(),this.setBlending(o.blending),h.mmul(t.projection,p),y.transform(c[0],-c[2],-c[1],c[3],c[4],c[5]),n){for(r=n.width,s=n.height;d--;){f=a[d],l=f.position,m=f.size,y.save(),v.save(),g.width!==r&&(g.width=r),g.height!==s&&(g.height=s),v.drawImage(n,0,0),v.globalCompositeOperation="source-atop",v.fillStyle=f.color.toRGB(),v.fillRect(0,0,r,s),y.globalAlpha=f.alpha,y.translate(l.x,l.y),y.rotate(f.angle),y.drawImage(g,0,0,r,s,.5*-m,.5*-m,m,m),v.restore(),y.restore()}}else{for(;d--;){f=a[d],l=f.position,m=f.size,y.save(),y.fillStyle=f.color.toRGB(),y.globalAlpha=f.alpha,y.translate(l.x,l.y),y.rotate(f.angle),y.fillRect(.5*-m,.5*-m,m,m),y.restore()}}y.restore()}}}},a}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/rendering/webgl_renderer_2d",["base/event_emitter","base/device","base/dom","math/mathf","math/vec2","math/mat32","math/mat4","math/color","core/game/log","core/enums"],function(t,e,i,o,n,r,s,a,h,c){function p(e){e||(e={}),t.call(this),this.canvas=void 0,this.context=void 0,this._context=!1,this.attributes=S(e.attributes||{},{alpha:!0,antialias:!0,depth:!0,premulipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0}),this._webgl={gpu:{precision:"highp",maxAnisotropy:16,maxTextures:16,maxTextureSize:16384,maxCubeTextureSize:16384,maxRenderBufferSize:16384},ext:{textureFilterAnisotropic:void 0,textureFloat:void 0,standardDerivatives:void 0,compressedTextureS3TC:void 0},textures:{},shaders:{},buffers:{},lastTexture:void 0,lastShader:void 0,lastBuffer:void 0},this._clearBytes=17664,this._lastCamera=void 0,this._lastResizeFn=void 0,this._lastBackground=new a,this._lastBlending=void 0}function u(t,e,i){var o=e.attributes,n=t.FLOAT,r=t.ARRAY_BUFFER;i.vertex&&o.aVertexPosition>-1&&(t.bindBuffer(r,i.vertex),t.enableVertexAttribArray(o.aVertexPosition),t.vertexAttribPointer(o.aVertexPosition,2,n,!1,0,0)),i.color&&o.aVertexColor>-1&&(t.bindBuffer(r,i.color),t.enableVertexAttribArray(o.aVertexColor),t.vertexAttribPointer(o.aVertexColor,2,n,!1,0,0)),i.uv&&o.aVertexUv>-1&&(t.bindBuffer(r,i.uv),t.enableVertexAttribArray(o.aVertexUv),t.vertexAttribPointer(o.aVertexUv,2,n,!1,0,0)),i.index&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.index)}function f(t,e){var i,o,n,r,s,a,h,c,p,u,f,l;if(!e){return void 0}if(i=t.context,o=t._webgl,n=o.buffers,r=n[e._id],r&&!e._needsUpdate){return r}if(r=r||(n[e._id]={}),s=z,a=e.dynamic?i.DYNAMIC_DRAW:i.STATIC_DRAW,h=i.ARRAY_BUFFER,c=i.ELEMENT_ARRAY_BUFFER,p=e.vertices,p&&p.length){for(s.length=0,f=0,l=p.length;l>f;f++){u=p[f],s.push(u.x,u.y)}s.length&&(r.vertex=r.vertex||i.createBuffer(),i.bindBuffer(h,r.vertex),i.bufferData(h,new Float32Array(s),a)),r.vertices=p.length}if(p=e.uvs,p&&p.length){for(s.length=0,f=0,l=p.length;l>f;f++){u=p[f],s.push(u.x,u.y)}s.length&&(r.uv=r.uv||i.createBuffer(),i.bindBuffer(h,r.uv),i.bufferData(h,new Float32Array(s),a))}return p=e.indices||e.faces,p&&p.length&&(r.index=r.index||i.createBuffer(),i.bindBuffer(c,r.index),i.bufferData(c,new Int16Array(p),a),r.indices=p.length),r}function l(t,e){var i,o,n,r=t.context,s=t._webgl,a=s.shaders,h=a[e._id];return h&&!e._needsUpdate?h:(h=h||(a[e._id]={}),i=e.vertex||e.vertexShader,o=e.fragment||e.fragmentShader,n=h.program=C(r,i,o),h.vertex=i,h.fragment=o,T(r,n,i,o,h.attributes||(h.attributes={}),h.uniforms||(h.uniforms={})),h)}function m(t,e){var i,o,n,r,s,a,h,c,p,u,f,l,m,d,y;return e&&e.raw?(i=t.context,o=t._webgl,n=o.textures,r=n[e._id],s=e.raw,r&&!e._needsUpdate?r:(r=r||(n[e._id]=i.createTexture()),a=o.ext,h=o.gpu,c=a.textureFilterAnisotropic,p=J(s.width)&&J(s.height),u=k(e.anisotropy,1,h.maxAnisotropy),f=i.TEXTURE_2D,l=p?i.REPEAT:i.CLAMP_TO_EDGE,m=i[e.magFilter]||i.LINEAR,d=i[e.minFilter]||i.LINEAR,y=i[e.format],y=y?y:i.RGBA,d=p?d===i.NEAREST||d===i.LINEAR?i.LINEAR_MIPMAP_NEAREST:d:d===i.NEAREST?i.NEAREST:i.LINEAR,i.bindTexture(f,r),i.texImage2D(f,0,y,y,i.UNSIGNED_BYTE,s),i.texParameteri(f,i.TEXTURE_MAG_FILTER,m),i.texParameteri(f,i.TEXTURE_MIN_FILTER,d),i.texParameteri(f,i.TEXTURE_WRAP_S,l),i.texParameteri(f,i.TEXTURE_WRAP_T,l),c&&i.texParameterf(f,c.TEXTURE_MAX_ANISOTROPY_EXT,u),p&&i.generateMipmap(f),o.lastTexture=r,e._needsUpdate=!1,r)):t._webgl.textures[B]}function d(t){return["precision "+t+" float;","uniform mat4 uMatrix;","uniform vec2 uPos;","uniform float uAngle;","uniform float uSize;","attribute vec2 aVertexPosition;","attribute vec2 aVertexUv;","varying vec2 vUvPosition;","void main() {","	float c, s, vx, vy, x, y;","	c = cos(uAngle);","	s = sin(uAngle);","	vx = aVertexPosition.x;","	vy = aVertexPosition.y;","	x = vx * c - vy * s;","	y = vx * s + vy * c;","	vUvPosition = aVertexUv;","	gl_Position = uMatrix * vec4(uPos.x + x * uSize, uPos.y + y * uSize, 0.0, 1.0);","}"].join("\n")}function y(t){return["precision "+t+" float;","uniform float uAlpha;","uniform vec3 uColor;","uniform sampler2D uTexture;","varying vec2 vUvPosition;","void main() {","	vec4 finalColor = texture2D(uTexture, vUvPosition);","	finalColor.xyz *= uColor;","	finalColor.w *= uAlpha;","	gl_FragColor = finalColor;","}"].join("\n")}function v(t){return["precision "+t+" float;","uniform mat4 uMatrix;","attribute vec2 aVertexPosition;","void main() {","	gl_Position = uMatrix * vec4(aVertexPosition, 0.0, 1.0);","}"].join("\n")}function g(t){return["precision "+t+" float;","uniform float uAlpha;","uniform vec3 uColor;","void main() {","	gl_FragColor = vec4(uColor, uAlpha);","}"].join("\n")}function x(t){return["precision "+t+" float;","uniform mat4 uMatrix;","uniform vec4 uCrop;","uniform vec2 uSize;","attribute vec2 aVertexPosition;","attribute vec2 aVertexUv;","varying vec2 vUvPosition;","void main() {","	vUvPosition = vec2(aVertexUv.x * uCrop.z, aVertexUv.y * uCrop.w) + uCrop.xy;","	gl_Position = uMatrix * vec4(aVertexPosition * uSize, 0.0, 1.0);","}"].join("\n")}function w(t){return["precision "+t+" float;","uniform float uAlpha;","uniform sampler2D uTexture;","varying vec2 vUvPosition;","void main() {","	vec4 finalColor = texture2D(uTexture, vUvPosition);","	finalColor.w *= uAlpha;","	gl_FragColor = finalColor;","}"].join("\n")}function S(t,e){var i;for(i in e){void 0==t[i]&&(t[i]=e[i])}return t}function b(t){var e;for(e in t){delete t[e]}return t}var _,O,z,N=i.getWebGLContext,C=i.createProgram,T=i.parseUniformsAttributes,A=i.addEvent,E=i.removeEvent,k=o.clamp,J=o.isPowerOfTwo,R=new Uint8Array([255,255,255,255]),B=-1,j=[new n(.5,.5),new n(-.5,.5),new n(.5,-.5),new n(-.5,-.5)],D=[new n(1,1),new n(0,1),new n(1,0),new n(0,0)],M=-1,P=-1,U=-2,L=-3,q=[];return t.extend(p),p.prototype.init=function(t){this.canvas&&this.clear();var e=t.element;return this.canvas=t,this.context=N(e,this.attributes),this.context?(this._context=!0,A(e,"webglcontextlost",this._handleWebGLContextLost,this),A(e,"webglcontextrestored",this._handleWebGLContextRestored,this),this.setDefaults(),this):this},p.prototype.clear=function(){if(!this.canvas){return this}var t=this.canvas,e=t.element,i=this._webgl,o=i.ext;return this.canvas=void 0,this.context=void 0,this._context=!1,E(e,"webglcontextlost",this._handleWebGLContextLost,this),E(e,"webglcontextrestored",this._handleWebGLContextRestored,this),this._clearBytes=17664,this._lastCamera=void 0,this._lastBackground.setRGB(0,0,0),this._lastBlending=void 0,o.compressedTextureS3TC=o.standardDerivatives=o.textureFilterAnisotropic=o.textureFloat=void 0,i.lastBuffer=i.lastShader=i.lastTexture=void 0,b(i.textures),b(i.buffers),b(i.shaders),this},p.prototype.setDefaults=function(){var t,i,o,n,r,s,a,h,p,u,m,S,b,_,O,z,N,C,T=this.context,A=this._webgl,E=A.ext,k=A.gpu,J=T.getExtension("EXT_texture_filter_anisotropic")||T.getExtension("MOZ_EXT_texture_filter_anisotropic")||T.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),q=T.getExtension("WEBGL_compressed_texture_s3tc")||T.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||T.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),I=T.getExtension("OES_standard_derivatives"),F=T.getExtension("OES_texture_float");return E.textureFilterAnisotropic=J,E.standardDerivatives=I,E.textureFloat=F,E.compressedTextureS3TC=q,t=T.VERTEX_SHADER,i=T.FRAGMENT_SHADER,o=T.HIGH_FLOAT,n=T.MEDIUM_FLOAT,r="undefined"!=typeof T.getShaderPrecisionFormat,s=E.textureFilterAnisotropic?T.getParameter(E.textureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,a=T.getParameter(T.MAX_TEXTURE_IMAGE_UNITS),h=T.getParameter(T.MAX_TEXTURE_SIZE),p=T.getParameter(T.MAX_CUBE_MAP_TEXTURE_SIZE),u=T.getParameter(T.MAX_RENDERBUFFER_SIZE),m=r?T.getShaderPrecisionFormat(t,o):0,S=r?T.getShaderPrecisionFormat(t,n):1,b=r?T.getShaderPrecisionFormat(i,o):0,_=r?T.getShaderPrecisionFormat(i,n):1,O=m.precision>0&&b.precision>0,z=S.precision>0&&_.precision>0,N="highp",(!O||e.mobile)&&(N=z?"mediump":"lowp"),k.precision=N,k.maxAnisotropy=s,k.maxTextures=a,k.maxTextureSize=h,k.maxCubeTextureSize=p,k.maxRenderBufferSize=u,T.clearColor(0,0,0,1),T.clearDepth(1),T.clearStencil(0),T.enable(T.DEPTH_TEST),T.depthFunc(T.LEQUAL),T.frontFace(T.CCW),T.cullFace(T.BACK),T.enable(T.CULL_FACE),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!0),this.setBlending(c.BlendingDefault),T.clear(T.COLOR_BUFFER_BIT|T.DEPTH_BUFFER_BIT|T.STENCIL_BUFFER_BIT),C=T.createTexture(),T.bindTexture(T.TEXTURE_2D,C),T.texImage2D(T.TEXTURE_2D,0,T.RGB,1,1,0,T.RGB,T.UNSIGNED_BYTE,R),T.bindTexture(T.TEXTURE_2D,null),A.textures[B]=C,f(this,{_id:M,vertices:j,uvs:D}),l(this,{_id:P,vertexShader:x(N),fragmentShader:w(N)}),l(this,{_id:U,vertexShader:v(N),fragmentShader:g(N)}),l(this,{_id:L,vertexShader:d(N),fragmentShader:y(N)}),this._clearBytes=T.COLOR_BUFFER_BIT|T.DEPTH_BUFFER_BIT|T.STENCIL_BUFFER_BIT,this},p.prototype.setBlending=function(t){var e=this.context;if(t!==this._lastBlending){switch(t){case c.BlendingNone:e.disable(e.BLEND);break;case c.BlendingAdditive:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE);break;case c.BlendingSubtractive:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case c.BlendingMuliply:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR);break;case c.BlendingDefault:default:e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}this._lastBlending=t}},p.prototype.render=function(t,e){var i,o,n,r,s,a,h,c,p,u,f,l,m;if(this._context){for(i=this.context,o=this._lastBackground,n=t.world.background,r=t.components,s=r.Sprite2D||q,a=r.ParticleSystem||q,(o.r!==n.r||o.g!==n.g||o.b!==n.b)&&(o.copy(n),i.clearColor(n.r,n.g,n.b,1)),this._lastCamera!==e&&(f=this.canvas,l=f.pixelWidth,m=f.pixelHeight,e.set(l,m),i.viewport(0,0,l,m),this._lastResizeFn&&f.off("resize",this._lastResizeFn),this._lastResizeFn=function(){var t=this.pixelWidth,o=this.pixelHeight;e.set(t,o),i.viewport(0,0,t,o)},f.on("resize",this._lastResizeFn),this._lastCamera=e),i.clear(this._clearBytes),u=s.length;u--;){h=s[u],p=h.transform2d,p&&(p.updateModelView(e.view),this.renderSprite2D(e,p,h))}for(u=a.length;u--;){c=a[u],p=c.transform2d,p&&(p.updateModelView(e.view),this.renderParticleSystem(e,p,c))}}},_=new r,O=new s,p.prototype.renderSprite2D=function(t,e,i){var o,n,r=this.context,s=this._webgl,a=i.texture,h=s.shaders[P],c=s.buffers[M],p=m(this,a),f=h.uniforms,l=a.raw;_.mmul(t.projection,e.modelView),O.fromMat32(_),a&&l&&(o=1/l.width,n=1/l.height,s.lastShader!==h&&(r.useProgram(h.program),s.lastShader=h),s.lastBuffer!==c&&(u(r,h,c),s.lastBuffer=c),r.uniformMatrix4fv(f.uMatrix,!1,O.elements),r.uniform4f(f.uCrop,i.x*o,i.y*n,i.w*o,i.h*n),r.uniform2f(f.uSize,i.width,i.height),r.uniform1f(f.uAlpha,i.alpha),s.lastTexture!==p&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,p),r.uniform1i(f.uTexture,0),s.lastTexture=p),r.drawArrays(r.TRIANGLE_STRIP,0,c.vertices))},p.prototype.renderParticleSystem=function(t,e,i){var o,n,r,s,a,h,c,p,f=this.context,l=this._webgl,d=l.shaders[L],y=l.buffers[M],v=y.vertices,g=f.TRIANGLE_STRIP,x=d.uniforms,w=x.uMatrix,S=x.uPos,b=x.uAngle,z=x.uSize,N=x.uColor,C=x.uAlpha,T=O.elements,A=this._lastBlending,E=i.emitters,k=E.length;if(k){for(;k--;){if(o=E[k],n=o.particles,r=o.worldSpace?t.view:e.modelView,p=n.length){for(c=m(this,o.texture),l.lastShader!==d&&(f.useProgram(d.program),l.lastShader=d),l.lastBuffer!==y&&(u(f,d,y),l.lastBuffer=y),this.setBlending(o.blending),_.mmul(t.projection,r),O.fromMat32(_),f.uniformMatrix4fv(w,!1,T),l.lastTexture!==c&&(f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,c),f.uniform1i(x.uTexture,0),l.lastTexture=c);p--;){s=n[p],a=s.position,h=s.color,f.uniform2f(S,a.x,a.y),f.uniform1f(b,s.angle),f.uniform1f(z,s.size),f.uniform3f(N,h.r,h.g,h.b),f.uniform1f(C,s.alpha),f.drawArrays(g,0,v)}}}this.setBlending(A)}},p.prototype._handleWebGLContextLost=function(t){t.preventDefault(),h.warn("WebGLRenderer2D: webgl context was lost"),this._context=!1,this.emit("webglcontextlost",t)},p.prototype._handleWebGLContextRestored=function(t){h.log("WebGLRenderer2D: webgl context was restored"),this.setDefaults(),this._context=!0,this.emit("webglcontextrestored",t)},z=[],p}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/button",[],function(){function t(t){this.name=t,this.timeDown=-1,this.timeUp=-1,this.frameDown=-1,this.frameUp=-1,this.value=!1,this._first=!0,this._SYNC={}}return t.prototype.toSYNC=function(t){return t||(t=this._SYNC),t.name=this.name,t.timeDown=this.timeDown,t.timeUp=this.timeUp,t.frameDown=this.frameDown,t.frameUp=this.frameUp,t.value=this.value,t},t.prototype.fromSYNC=function(t){return this.name=t.name,this.timeDown=t.timeDown,this.timeUp=t.timeUp,this.frameDown=t.frameDown,this.frameUp=t.frameUp,this.value=t.value,this},t.prototype.toJSON=function(t){return t||(t={}),t.name=this.name,t.timeDown=this.timeDown,t.timeUp=this.timeUp,t.frameDown=this.frameDown,t.frameUp=this.frameUp,t.value=this.value,t},t.prototype.fromJSON=function(t){return this.name=t.name,this.timeDown=t.timeDown,this.timeUp=t.timeUp,this.frameDown=t.frameDown,this.frameUp=t.frameUp,this.value=t.value,this},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/buttons",["base/time","core/input/button","core/game/log"],function(t,e,i){function o(){Array.call(this),this.hash={},this._SYNC={},this.add("mouse0"),this.add("mouse1"),this.add("mouse2")}return o.prototype=Object.create(Array.prototype),o.prototype.constructor=o,o.prototype.add=function(t){if(this.hash[t]){return i.warn("Buttons.add: Buttons already have Button name "+t),void 0}var o=new e(t);return this.push(o),this.hash[t]=o,o},o.prototype.get=function(t){return this.hash[t]},o.prototype.on=function(e){var i=this.hash[e]||this.add(e);i._first&&(i.frameDown=t.frameCount+1,i.timeDown=t.stamp(),i._first=!1),i.value=!0},o.prototype.off=function(e){var i=this.hash[e]||this.add(e);i.frameUp=t.frameCount+1,i.timeUp=t.stamp(),i.value=!1,i._first=!0},o.prototype.toSYNC=function(t){t||(t=this._SYNC);var e,i=t.buttons||(t.buttons=[]);for(e=this.length;e--;){i[e]=this[e].toSYNC(i[e])
}return t},o.prototype.fromSYNC=function(t){var e,i,o,n=this.hash,r=t.buttons||(t.buttons=[]);for(o=r.length;o--;){i=r[o],(e=n[i.name])?e.fromSYNC(i):this.add(i.name).fromJSON(i)}return this},o.prototype.toJSON=function(t){t||(t={});var e,i=t.buttons||(t.buttons=[]);for(e=this.length;e--;){i[e]=this[e].toJSON(i[key])}return t},o.prototype.fromJSON=function(t){var e,i,o,n=this.hash,r=t.buttons||(t.buttons=[]);for(o=r.length;o--;){i=r[o],(e=n[i.name])?e.fromJSON(i):this.add(i.name).fromJSON(i)}return this},o}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/axis",[],function(){function t(e){e||(e={}),this.name=void 0!=e.name?e.name:"unknown",this.negButton=void 0!=e.negButton?e.negButton:"",this.posButton=void 0!=e.posButton?e.posButton:"",this.altNegButton=void 0!=e.altNegButton?e.altNegButton:"",this.altPosButton=void 0!=e.altPosButton?e.altPosButton:"",this.gravity=void 0!=e.gravity?e.gravity:3,this.sensitivity=void 0!=e.sensitivity?e.sensitivity:3,this.dead=void 0!=e.dead?e.dead:.001,this.type=void 0!=e.type?e.type:t.BUTTON,this.axis=void 0!=e.axis?e.axis:"x",this.index=void 0!=e.index?e.index:0,this.joyNum=void 0!=e.joyNum?e.joyNum:0,this.value=0,this._SYNC={}}return t.prototype.toSYNC=function(t){return t||(t=this._SYNC),t.name=this.name,t.value=this.value,t},t.prototype.fromSYNC=function(t){return this.name=t.name,this.value=t.value,this},t.prototype.toJSON=function(t){return t||(t={}),t.name=this.name,t.negButton=this.negButton,t.posButton=this.posButton,t.altNegButton=this.altNegButton,t.altPosButton=this.altPosButton,t.gravity=this.gravity,t.sensitivity=this.sensitivity,t.dead=this.dead,t.type=this.type,t.axis=this.axis,t.index=this.index,t.joyNum=this.joyNum,t.value=this.value,t},t.prototype.fromJSON=function(t){return this.name=t.name,this.negButton=t.negButton,this.posButton=t.posButton,this.altNegButton=t.altNegButton,this.altPosButton=t.altPosButton,this.gravity=t.gravity,this.sensitivity=t.sensitivity,this.dead=t.dead,this.type=t.type,this.axis=t.axis,this.index=t.index,this.joyNum=t.joyNum,this.value=t.value,this},t.BUTTON=1,t.MOUSE=2,t.TOUCH=3,t.MOUSE_WHEEL=4,t.JOYSTICK=5,t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/axes",["core/input/axis","core/game/log"],function(t,e){function i(){Array.call(this),this.hash={},this._SYNC={},this.add({name:"horizontal",posButton:"right",negButton:"left",altPosButton:"d",altNegButton:"a",type:o}),this.add({name:"vertical",posButton:"up",negButton:"down",altPosButton:"w",altNegButton:"s",type:o}),this.add({name:"fire",posButton:"ctrl",negButton:"",altPosButton:"mouse0",altNegButton:"",type:o}),this.add({name:"jump",posButton:"space",negButton:"",altPosButton:"mouse2",altNegButton:"",type:o}),this.add({name:"mouseX",type:n,axis:"x"}),this.add({name:"mouseY",type:n,axis:"y"}),this.add({name:"touchX",type:r,axis:"x"}),this.add({name:"touchY",type:r,axis:"y"}),this.add({name:"mouseWheel",type:s})}var o=t.BUTTON,n=t.MOUSE,r=t.TOUCH,s=t.MOUSE_WHEEL;return i.prototype=Object.create(Array.prototype),i.prototype.constructor=i,i.prototype.add=function(i,o){if("object"==typeof i&&(o=i,i=o.name),this.hash[i]){return e.warn("Axes.add: Axes already have Axis named "+i),void 0}o||(o={}),o.name=i;var n=new t(o);return this.push(n),this.hash[i]=n,n},i.prototype.get=function(t){return this.hash[t]},i.prototype.toSYNC=function(t){t||(t=this._SYNC);var e,i=t.axes||(t.axes=[]);for(e=this.length;e--;){i[e]=this[e].toSYNC(i[e])}return t},i.prototype.fromSYNC=function(t){var e,i,o,n=this.hash,r=t.axes||(t.axes=[]);for(o=r.length;o--;){i=r[o],(e=n[i.name])?e.fromSYNC(i):this.add(i.name).fromJSON(i)}return this},i.prototype.toJSON=function(t){t||(t={});var e,i=t.axes||(t.axes=[]);for(e=this.length;e--;){i[e]=this[e].toJSON(i[e])}return t},i.prototype.fromJSON=function(t){var e,i,o,n=this.hash,r=t.axes||(t.axes=[]);for(o=r.length;o--;){i=r[o],(e=n[i.name])?e.fromJSON(i):this.add(i.name).fromJSON(i)}return this},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/touch",["math/vec2"],function(t){function e(){this.id=-1,this.delta=new t,this.position=new t,this._last=new t,this._first=!1,this._SYNC={}}return e.prototype.clear=function(){return this.id=-1,this.position.set(0,0),this.delta.set(0,0),this._last.set(0,0),this._first=!1,this},e.prototype.fromEvent=function(t){var e=this.position,i=this.delta,o=this._last,n=this._first,r=t.target||t.srcElement,s=r.offsetLeft,a=r.offsetTop,h=(t.pageX||t.clientX)-s,c=(t.pageY||t.clientY)-a;return o.x=n?e.x:h,o.y=n?e.y:c,e.x=h,e.y=c,i.x=e.x-o.x,i.y=e.y-o.y,this._first=!0,this},e.prototype.toSYNC=function(t){return t||(t=this._SYNC),t.id=this.id,t.delta=this.delta.toJSON(t.delta),t.position=this.position.toJSON(t.position),t._last=this._last.toJSON(t._last),t._first=this._first,t},e.prototype.fromSYNC=function(t){return this.id=t.id,this.delta.fromJSON(t.delta),this.position.fromJSON(t.position),this._last.fromJSON(t._last),this._first=t._first,this},e.prototype.toJSON=function(t){return t||(t={}),t.id=this.id,t.delta=this.delta.toJSON(t.delta),t.position=this.position.toJSON(t.position),t._last=this._last.toJSON(t._last),t._first=this._first,t},e.prototype.fromJSON=function(t){return this.id=t.id,this.delta.fromJSON(t.delta),this.position.fromJSON(t.position),this._last.fromJSON(t._last),this._first=t._first,this},e}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/touches",["base/object_pool","core/input/touch"],function(t,e){function i(){Array.call(this),this._SYNC={}}var o=new t(e),n=new t(Object);return i.prototype=Object.create(Array.prototype),i.prototype.constructor=i,i.TOUCH_POOL=o,i.prototype.start=function(t){var e=o.create();return e.clear(),e.id=t.identifier,e.fromEvent(t),this.push(e),e},i.prototype.end=function(t){var e=this[t];return o.removeObject(e),this.splice(t,1),e},i.prototype.cancel=function(){return o.clear(),this.length=0,this},i.prototype.move=function(t,e){var i=this[t];return i.fromEvent(e),i},i.prototype.toSYNC=function(t){t||(t=this._SYNC);var e=t.touches||(t.touches=[]),i=this.length;for(e.length=0,n.clear();i--;){e[i]=this[i].toSYNC(n.create())}return t},i.prototype.fromSYNC=function(t){var e=t.touches,i=e.length;for(this.length=0,o.clear();i--;){this[i]=o.create().fromSYNC(e[i])}return this},i.prototype.toJSON=function(t){t||(t={});var e,i=t.touches||(t.touches=[]);for(e=this.length;e--;){i[e]=this[e].toJSON(i[e])}return t},i.prototype.fromJSON=function(t){var e,i,n,r,s=t.touches;for(i=s.length,r=this.length,n=r;i--;){r>i&&(this.splice(n--,1),o.removeObject(this[n])),(e=this[i])?e.fromJSON(s[i]):this[i]=o.create().fromJSON(s[i])}return this},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/input",["base/event_emitter","base/object_pool","base/time","math/mathf","math/vec2","math/vec3","core/input/buttons","core/input/button","core/input/axes","core/input/axis","core/input/touches"],function(t,e,i,o,n,r,s,a,h,c,p){function u(){t.call(this),this.axes=new h,this.buttons=new s,this.mouseWheel=0,this.mousePosition=new n,this.mouseDelta=new n,this.mouseMoveNeedsUpdate=!1,this.touches=new p,this.touchesMoveNeedsUpdate=!1,this.acceleration=new r,this.frameCount=0,this._frameCount=void 0,this.time=0,this._time=void 0,this._SYNC={}}var f=Math.abs,l=o.sign,m=o.clamp,d=c.BUTTON,y=c.MOUSE,v=c.TOUCH,g=c.MOUSE_WHEEL,x=c.JOYSTICK,w={0:"mouse0",1:"mouse1",2:"mouse2"};return t.extend(u),u.prototype.update=function(){var t,e,o,n,r,s,a,h,c,p,u=this.axes,w=this.buttons.hash,S=i.delta;for(this.frameCount=this._frameCount?this._frameCount:i.frameCount,this.time=this._time?this._time:i.stamp(),this.mouseMoveNeedsUpdate=!0,this.touchesMoveNeedsUpdate=!0,c=u.length;c--;){switch(o=u[c],n=o.value,r=o.sensitivity,o.type){case d:t=w[o.negButton],e=w[o.altNegButton],a=t&&t.value||e&&e.value,t=w[o.posButton],e=w[o.altPosButton],s=t&&t.value||e&&e.value;break;case y:o.value=this.mouseDelta[o.axis];continue;case v:p=this.touches[o.index],o.value=p?p.delta[o.axis]:0;continue;case g:n+=this.mouseWheel;break;case x:}a&&(n-=r*S),s&&(n+=r*S),s||a||0===n||(h=f(n),n-=m(l(n)*o.gravity*S,-h,h)),n=m(n,-1,1),f(n)<=o.dead&&(n=0),o.value=n}this.mouseWheel=0},u.prototype.axis=function(t){var e=this.axes.hash[t];return e?e.value:0},u.prototype.mouseButton=function(t){var e=this.buttons.hash[w[t]];return e&&e.value},u.prototype.mouseButtonDown=function(t){var e=this.buttons.hash[w[t]];return e&&e.value&&e.frameDown>=this.frameCount},u.prototype.mouseButtonUp=function(t){var e=this.buttons.hash[w[t]];return e&&e.frameUp>=this.frameCount},u.prototype.anyKey=function(){var t,e=this.buttons;for(t=e.length;t--;){if(e[t].value){return!0}}return!1},u.prototype.anyKeyDown=function(){var t,e,i=this.buttons;for(e=i.length;e--;){if((t=i[e]).value&&t.frameDown>=this.frameCount){return!0}}return!1},u.prototype.key=function(t){var e=this.buttons.hash[t];return e&&e.value},u.prototype.keyDown=function(t){var e=this.buttons.hash[t];return e&&e.value&&e.frameDown>=this.frameCount},u.prototype.keyUp=function(t){var e=this.buttons.hash[t];return e&&e.frameUp>=this.frameCount},u.prototype.toSYNC=function(t){return t||(t=this._SYNC),t._frameCount=i.frameCount,t._time=i.stamp(),t.buttons=this.buttons.toSYNC(t.buttons),t.mousePosition=this.mousePosition.toJSON(t.mousePosition),t.mouseDelta=this.mouseDelta.toJSON(t.mouseDelta),t.acceleration=this.acceleration.toJSON(t.acceleration),t.touches=this.touches.toSYNC(t.touches),t},u.prototype.fromSYNC=function(t){return this._frameCount=t._frameCount,this._time=t._time,this.buttons.fromSYNC(t.buttons),this.mousePosition.fromJSON(t.mousePosition),this.mouseDelta.fromJSON(t.mouseDelta),this.acceleration.fromJSON(t.acceleration),this.touches.fromSYNC(t.touches),this},u.prototype.toJSON=function(t){return t||(t={}),t.buttons=this.buttons.toJSON(t.buttons),t.axes=this.axes.toJSON(t.axes),t.mousePosition=this.mousePosition.toJSON(t.mousePosition),t.mouseDelta=this.mouseDelta.toJSON(t.mouseDelta),t.acceleration=this.acceleration.toJSON(t.acceleration),t.touches=this.touches.toJSON(t.touches),t},u.prototype.fromJSON=function(t){return this.buttons.fromJSON(t.buttons),this.axes.fromJSON(t.axes),this.mousePosition.fromJSON(t.mousePosition),this.mouseDelta.fromJSON(t.mouseDelta),this.acceleration.fromJSON(t.acceleration),this.touches.fromJSON(t.touches),this},new u}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/input/handler",["base/event_emitter","base/dom","base/object_pool","math/vec2","core/input/input"],function(t,e,i,o,n){function r(){t.call(this),this.element=void 0}function s(t){var e,i=t.accelerationIncludingGravity;i&&(e=this.acceleration,e.x=i.x,e.y=i.y,e.z=i.z,this.emit("acceleration"))}function a(t){t.preventDefault();var e,i=this.touches,o=t.touches,n=t.changedTouches;switch(t.type){case"touchstart":for(e=o.length;e--;){this.emit("touchstart",i.start(o[e]))}break;case"touchend":for(e=n.length;e--;){this.emit("touchend",i.end(e))}break;case"touchcancel":i.cancel(),this.emit("touchcancel");break;case"touchmove":if(this.touchesMoveNeedsUpdate){for(e=n.length;e--;){this.emit("touchmove",i.move(e,n[e]))}this.touchesMoveNeedsUpdate=!1}}}function h(t){switch(t.preventDefault(),t.type){case"mousedown":this.buttons.on(m[t.button]),c(this,t),this.emit("mousedown");break;case"mouseup":this.buttons.off(m[t.button]),c(this,t),this.emit("mouseup");break;case"mouseout":this.buttons.off(m[t.button]),c(this,t),this.emit("mouseout");break;case"mousewheel":case"DOMMouseScroll":l=g(-1,v(1,t.wheelDelta||-t.detail)),this.mouseWheel=l,this.emit("mousewheel",l);break;case"mousemove":this.mouseMoveNeedsUpdate&&(c(this,t),this.mouseMoveNeedsUpdate=!1),this.emit("mousemove")}}function c(t,e){var i=t.mousePosition,o=t.mouseDelta,n=e.target||e.srcElement,r=n.offsetLeft||0,s=n.offsetTop||0,a=(e.pageX||e.clientX)-r,h=(e.pageY||e.clientY)-s;f.x=u?i.x:a,f.y=u?i.y:h,i.x=a,i.y=h,o.x=i.x-f.x,o.y=i.y-f.y,u=!0}function p(t){switch(t.preventDefault(),t.type){case"keydown":this.buttons.on(d[t.keyCode]),this.emit("keydown");break;case"keyup":this.buttons.off(d[t.keyCode]),this.emit("keyup")}}var u,f,l,m,d,y,v=Math.min,g=Math.max,x=e.addEvent,w=e.removeEvent;for(t.extend(r),r.prototype.setElement=function(t){this.element&&this.removeElement(),this.element=t,x(t,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",h,n),x(top,"keydown keyup",p,n),x(t,"touchstart touchmove touchend touchcancel",a,n),x(window,"devicemotion",s,n)},r.prototype.removeElement=function(){if(this.element){var t=this.element;w(t,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",h,n),w(top,"keydown keyup",p,n),w(t,"touchstart touchmove touchend touchcancel",a,n),w(window,"devicemotion",s,n),this.element=void 0}},u=!1,f=new o,l=0,m={0:"mouse0",1:"mouse1",2:"mouse2"},d={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},y=48;90>=y;y++){d[y]=String.fromCharCode(y).toLowerCase()}return new r}),"function"!=typeof define&&(define=require("amdefine")(module)),define("core/game/client_game",["base/device","base/socket.io","base/time","core/game/config","core/game/game","core/game/log","core/rendering/canvas","core/rendering/canvas_renderer_2d","core/rendering/webgl_renderer_2d","core/game_object","core/components/component","core/scene","core/input/input","core/input/handler","core/assets/assets","core/assets/asset_loader"],function(t,e,i,o,n,r,s,a,h,c,p,u,f,l,m,d){function y(t){t||(t={}),o.fromJSON(t),n.call(this,t),this.io=void 0,this._sessionid=void 0,this._handler=l,this.input=f,this.scene=void 0,this.camera=void 0,this.canvas=new s(t.width,t.height),this.CanvasRenderer2D=void 0,this.WebGLRenderer2D=void 0,this._optsCanvasRenderer2D=t.CanvasRenderer2D,this._optsWebGLRenderer2D=t.WebGLRenderer2D,this.renderer=void 0,this.customRenderer=void 0}var v,g,x,w,S,b,_,O=i.now;return n.extend(y),y.prototype.init=function(){return this.canvas.init(),this._loop.init(),this.emit("init"),this},y.prototype.connect=function(i){var o,n=this,s=this.io=e.connect();return s.on("connect",function(){n._sessionid||(n._sessionid=this.socket.sessionid),n._sessionid!==this.socket.sessionid&&location.reload(),s.emit("client_device",t)}),s.on("server_ready",function(t,e){m.fromJSON(e),d.load(function(){n.fromJSON(t),s.emit("client_ready"),n.emit("connect",s),i&&i.call(n,s)})}),s.on("server_sync_input",function(){s.emit("client_sync_input",f.toSYNC())}),s.on("server_sync_scene",function(t){var e=n.scene;e&&e.fromSYNC(t)}),s.on("server_setScene",function(t){var e=n.findByServerId(t);n.setScene(e)}),s.on("server_setCamera",function(t){if(!n.scene){return r.warn("Socket:server_setCamera: can't set camera without an active scene, use ServerGame.setScene first"),void 0}var e=n.scene.findByServerId(t),i=n.canvas;return e?(n.setCamera(e),o&&i.off("resize",o),i.on("resize",o=function(){s.emit("client_resize",this.pixelWidth,this.pixelHeight)}),s.emit("client_resize",i.pixelWidth,i.pixelHeight),void 0):(r.warn("Socket:server_setCamera: can't find camera in active scene"),void 0)}),s.on("server_addScene",function(t){n.addScene((new u).fromJSON(t))}),s.on("server_addGameObject",function(t,e){var i=n.findByServerId(t);i&&i.addGameObject((new c).fromJSON(e))}),s.on("server_addComponent",function(t,e,i){var o,r=n.findByServerId(t);r&&(o=r.findByServerId(e),o&&o.addComponent(new p._types[i._type].fromJSON(i)))}),s.on("server_removeScene",function(t){n.removeScene(n.findByServerId(t))}),s.on("server_removeGameObject",function(t,e){var i=n.findByServerId(t);i&&i.removeGameObject(i.findByServerId(e))}),s.on("server_removeComponent",function(t,e,i){var o,r=n.findByServerId(t);r&&(o=r.findByServerId(e),o&&o.removeComponent(o.getComponent(i)))}),this},y.prototype.disconnect=function(){var t=this.io;return t.disconnect(),t.removeAllListeners(),this._sessionid=void 0,this},y.prototype.setScene=function(t){if(!(t instanceof u)){return r.warn("ClientGame.setScene: can't add passed argument, it is not an instance of Scene"),this}var e=this.scenes,i=e.indexOf(t);return-1!==i?(this.scene=t,this.emit("setScene",t)):r.warn("ClientGame.setScene: Scene is not a member of Game"),this},y.prototype.setCamera=function(t){if(!(t instanceof c)){return r.warn("Scene.addGameObject: can't add argument to Scene, it's not an instance of GameObject"),this}var e,i=this.scene,o=this.camera;return i?(e=i.gameObjects.indexOf(t),-1===e&&(r.warn("ClientGame.setCamera: GameObject is not a member of the active Scene, adding it..."),i.addGameObject(t)),this.camera=t.camera||t.camera2d,this.camera?(this.camera._active=!0,o&&(o._active=!1),this.updateRenderer(),this.emit("setCamera",this.camera)):r.warn("ClientGame.setCamera: GameObject does't have a Camera or a Camera2D Component"),this):(r.warn("ClientGame.setCamera: can't set camera without an active scene, use ClientGame.setScene first"),this)},y.prototype.updateRenderer=function(){var e,i=this.camera,n=this.renderer,s=this.canvas;i&&(e=i.gameObject,"function"==typeof this.customRenderer?(this.renderer=this.customRenderer,r.log("Game: setting up custom renderer "+this.customRenderer.name)):e.camera?r.warn("Game.updateRenderer: no renderer for camera component yet"):e.camera2d&&(!o.forceCanvas&&t.webgl?(this.renderer=this.WebGLRenderer2D||(this.WebGLRenderer2D=new h(this._optsWebGLRenderer2D)),r.log("Game: setting up WebGLRenderer2D")):t.canvas?(this.renderer=this.CanvasRenderer2D||(this.CanvasRenderer2D=new a(this._optsCanvasRenderer2D)),r.log("Game: setting up CanvasRenderer2D")):r.error("Game.updateRenderer: Could not get a renderer for this device")),n!==this.renderer&&(n&&n.destroy(),this.renderer.init(s),l.setElement(s.element)))},v=0,g=-1/60,x=0,w=1/60,S=0,b=0,_=0,y.prototype.loop=function(){var t=this.camera,e=this.scene,n=o.MIN_DELTA,r=o.MAX_DELTA;i.frameCount=v++,g=x,x=O(),i.sinceStart=x,_=x,S++,_>b+1&&(i.fps=S/(_-b),b=_,S=0),w=(x-g)*i.scale,i.delta=n>w?n:w>r?r:w,i.time=x*i.scale,f.update(),e&&(e.update(),t&&this.renderer.render(e,t)),this.emit("update",x)},y}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/aabb2",["math/mathf","math/vec2"],function(t,e){function i(t,i){this.min=t||new e(1/0,1/0),this.max=i||new e(-1/0,-1/0)}return i.prototype.clone=function(){return new i(this.min.clone(),this.max.clone())},i.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.prototype.expandPoint=function(t){return this.min.min(t),this.max.max(t),this},i.prototype.expandVec=function(t){return this.min.sub(t),this.max.add(t),this},i.prototype.expandScalar=function(t){return this.min.ssub(t),this.max.sadd(t),this},i.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.prototype.clear=function(){return this.min.set(1/0,1/0),this.max.set(-1/0,-1/0),this},i.prototype.contains=function(t){var e=this.min,i=this.max,o=t.x,n=t.y;return!(o<e.x||o>i.x||n<e.y||n>i.y)},i.prototype.intersects=function(t){var e=this.min,i=this.max,o=t.min,n=t.max;return!(n.x<e.x||o.x>i.x||n.y<e.y||o.y>i.y)},i.prototype.fromPoints=function(t){for(var e,i,o,n=t.length,r=1/0,s=1/0,a=-1/0,h=-1/0,c=this.min,p=this.max;n--;){e=t[n],i=e.x,o=e.y,r=r>i?i:r,s=s>o?o:s,a=i>a?i:a,h=o>h?o:h}return c.x=r,c.y=s,p.x=a,p.y=h,this},i.prototype.fromCenterSize=function(t,e){var i=this.min,o=this.max,n=t.x,r=t.y,s=.5*e.x,a=.5*e.y;return i.x=n-s,i.y=r-a,o.x=n+s,o.y=r+a,this},i.prototype.fromJSON=function(t){return this.min.fromJSON(t.min),this.max.fromJSON(t.max),this},i.prototype.toJSON=function(t){return t||(t={}),t.min=this.min.toJSON(t.min),t.max=this.max.toJSON(t.max),t},i.prototype.toString=function(){var t=this.min,e=this.max;return"AABB2( min: "+t+", max: "+e+" )"},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/aabb3",["math/mathf","math/vec3"],function(t,e){function i(t,i){this.min=t||new e(1/0,1/0,1/0),this.max=i||new e(-1/0,-1/0,-1/0)}return i.prototype.clone=function(){return new i(this.min.clone(),this.max.clone())},i.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},i.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},i.prototype.expandPoint=function(t){return this.min.min(t),this.max.max(t),this},i.prototype.expandVec=function(t){return this.min.sub(t),this.max.add(t),this},i.prototype.expandScalar=function(t){return this.min.ssub(t),this.max.sadd(t),this},i.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},i.prototype.clear=function(){return this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0),this},i.prototype.contains=function(t){var e=this.min,i=this.max,o=t.x,n=t.y,r=t.z;return!(o<e.x||o>i.x||n<e.y||n>i.y||r<e.z||r>i.z)},i.prototype.intersects=function(t){var e=this.min,i=this.max,o=t.min,n=t.max;return!(n.x<e.x||o.x>i.x||n.y<e.y||o.y>i.y||n.z<e.z||o.z>i.z)},i.prototype.fromPoints=function(t){for(var e,i,o,n,r=t.length,s=1/0,a=1/0,h=1/0,c=-1/0,p=-1/0,u=-1/0,f=this.min,l=this.max;r--;){e=t[r],i=e.x,o=e.y,n=e.z,s=s>i?i:s,a=a>o?o:a,h=h>n?n:h,c=i>c?i:c,p=o>p?o:p,u=n>u?n:u}return f.x=s,f.y=a,f.z=h,l.x=c,l.y=p,l.z=u,this},i.prototype.fromCenterSize=function(t,e){var i=this.min,o=this.max,n=t.x,r=t.y,s=t.z,a=.5*e.x,h=.5*e.y,c=.5*e.z;return i.x=n-a,i.y=r-h,i.z=s-c,o.x=n+a,o.y=r+h,o.z=s+c,this},i.prototype.fromJSON=function(t){return this.min.fromJSON(t.min),this.max.fromJSON(t.max),this},i.prototype.toJSON=function(t){return t||(t={}),t.min=this.min.toJSON(t.min),t.max=this.max.toJSON(t.max),t},i.prototype.toString=function(){var t=this.min,e=this.max;return"AABB3( min: "+t+", max: "+e+" )"},i}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/mat2",[],function(){function t(t,e,i,o){var n=new Float32Array(4);this.elements=n,n[0]=void 0!==t?t:1,n[2]=e||0,n[1]=i||0,n[3]=void 0!==o?o:1}var e=Math.cos,i=Math.sin,o=Math.atan2;return t.prototype.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3])},t.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this},t.prototype.set=function(t,e,i,o){var n=this.elements;return n[0]=t,n[2]=e,n[1]=i,n[3]=o,this},t.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[2],r=e[1],s=e[3],a=i[0],h=i[2],c=i[1],p=i[3];return e[0]=o*a+r*h,e[1]=n*a+s*h,e[2]=o*c+r*p,e[3]=n*c+s*p,this},t.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,r=o[0],s=o[2],a=o[1],h=o[3],c=n[0],p=n[2],u=n[1],f=n[3];return i[0]=r*c+a*p,i[1]=s*c+h*p,i[2]=r*u+a*f,i[3]=s*u+h*f,this},t.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},t.prototype.sdiv=function(t){var e=this.elements;return t=0!==t?1/t:1,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},t.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,this},t.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,this},t.prototype.determinant=function(){var t=this.elements;return t[0]*t[3]-t[2]*t[1]},t.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[2],o=t[1],n=t[3],r=e*n-i*o;return r=0!==r?1/r:0,t[0]=n*r,t[1]=-i*r,t[2]=-o*r,t[3]=e*r,this},t.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[2],r=i[1],s=i[3],a=o*s-n*r;return a=0!==a?1/a:0,e[0]=s*a,e[1]=-n*a,e[2]=-r*a,e[3]=o*a,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[2],e[2]=t,this},t.prototype.setTrace=function(t,e){var i=this.elements;return i[0]=t,i[3]=e,this},t.prototype.setRotation=function(t){var o=this.elements,n=e(t),r=i(t);return o[0]=n,o[1]=r,o[2]=-r,o[3]=n,this},t.prototype.getRotation=function(){var t=this.elements;return o(t[1],t[0])},t.prototype.rotate=function(t){var e=this.elements,o=e[0],n=e[2],r=e[1],s=e[3],a=i(t),h=i(t);return e[0]=o*h+n*a,e[1]=o*-a+n*h,e[2]=r*h+s*a,e[3]=r*-a+s*h,this},t.prototype.fromMat3=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[3],e[3]=i[4],this},t.prototype.fromMat4=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[4],e[3]=i[5],this},t.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this},t.prototype.toJSON=function(t){t||(t={});var e=this.elements,i=t.elements||(t.elements=[]);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],t},t.prototype.toString=function(){var t=this.elements;return"Mat2[ "+t[0]+", "+t[2]+"]\n     [ "+t[1]+", "+t[3]+"]"},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/mat3",[],function(){function t(t,e,i,o,n,r,s,a,h){var c=new Float32Array(9);this.elements=c,c[0]=void 0!==t?t:1,c[3]=e||0,c[6]=i||0,c[1]=o||0,c[4]=void 0!==n?n:1,c[7]=r||0,c[2]=s||0,c[5]=a||0,c[8]=void 0!==h?h:1}var e=Math.cos,i=Math.sin;return t.prototype.clone=function(){var e=this.elements;return new t(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},t.prototype.copy=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},t.prototype.set=function(t,e,i,o,n,r,s,a,h){var c=this.elements;return c[0]=t,c[3]=e,c[6]=i,c[1]=o,c[4]=n,c[7]=r,c[2]=s,c[5]=a,c[8]=h,this},t.prototype.mul=function(t){var e=this.elements,i=t.elements,o=e[0],n=e[3],r=e[6],s=e[1],a=e[4],h=e[7],c=e[2],p=e[5],u=e[8],f=i[0],l=i[3],m=i[6],d=i[1],y=i[4],v=i[7],g=i[2],x=i[5],w=i[8];return e[0]=o*f+s*l+c*m,e[3]=n*f+a*l+p*m,e[6]=r*f+h*l+u*m,e[1]=o*d+s*y+c*v,e[4]=n*d+a*y+p*v,e[7]=r*d+h*y+u*v,e[2]=o*g+s*x+c*w,e[5]=n*g+a*x+p*w,e[8]=r*g+h*x+u*w,this},t.prototype.mmul=function(t,e){var i=this.elements,o=t.elements,n=e.elements,r=o[0],s=o[3],a=o[6],h=o[1],c=o[4],p=o[7],u=o[2],f=o[5],l=o[8],m=n[0],d=n[3],y=n[6],v=n[1],g=n[4],x=n[7],w=n[2],S=n[5],b=n[8];return i[0]=r*m+h*d+u*y,i[3]=s*m+c*d+f*y,i[6]=a*m+p*d+l*y,i[1]=r*v+h*g+u*x,i[4]=s*v+c*g+f*x,i[7]=a*v+p*g+l*x,i[2]=r*w+h*S+u*b,i[5]=s*w+c*S+f*b,i[8]=a*w+p*S+l*b,this},t.prototype.smul=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.prototype.sdiv=function(t){var e=this.elements;return t=0===t?0:1/t,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},t.prototype.zero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,this},t.prototype.determinant=function(){var t=this.elements,e=t[0],i=t[1],o=t[2],n=t[3],r=t[4],s=t[5],a=t[6],h=t[7],c=t[8];return e*r*c-e*s*h-i*n*c+i*s*a+o*n*h-o*r*a},t.prototype.inverse=function(){var t=this.elements,e=t[0],i=t[3],o=t[6],n=t[1],r=t[4],s=t[7],a=t[2],h=t[5],c=t[8],p=r*c-s*h,u=o*h-i*c,f=i*s-o*r,l=e*p+n*u+a*f;return l=0!==l?1/l:1,t[0]=p*l,t[1]=(s*a-n*c)*l,t[2]=(n*h-r*a)*l,t[3]=u*l,t[4]=(e*c-o*a)*l,t[5]=(i*a-e*h)*l,t[6]=f*l,t[7]=(o*n-e*s)*l,t[8]=(e*r-i*n)*l,this},t.prototype.inverseMat=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[3],r=i[6],s=i[1],a=i[4],h=i[7],c=i[2],p=i[5],u=i[8],f=a*u-h*p,l=r*p-n*u,m=n*h-r*a,d=o*f+s*l+c*m;return d=0!==d?1/d:0,e[0]=f*d,e[1]=(h*c-s*u)*d,e[2]=(s*p-a*c)*d,e[3]=l*d,e[4]=(o*u-r*c)*d,e[5]=(n*c-o*p)*d,e[6]=m*d,e[7]=(r*s-o*h)*d,e[8]=(o*a-n*s)*d,this},t.prototype.inverseMat4=function(t){var e=this.elements,i=t.elements,o=i[0],n=i[4],r=i[8],s=i[1],a=i[5],h=i[9],c=i[2],p=i[6],u=i[10],f=u*a-p*h,l=-u*n+p*r,m=h*n-a*r,d=o*f+s*l+c*m;return d=0!==d?1/d:0,e[0]=f*d,e[1]=(-u*s+c*h)*d,e[2]=(p*s-c*a)*d,e[3]=l*d,e[4]=(u*o-c*r)*d,e[5]=(-p*o+c*n)*d,e[6]=m*d,e[7]=(-h*o+s*r)*d,e[8]=(a*o-s*n)*d,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},t.prototype.setTrace=function(t){var e=this.elements;return e[0]=t.x,e[4]=t.y,e[8]=t.z,this},t.prototype.scale=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z;return e[0]*=i,e[3]*=o,e[6]*=n,e[1]*=i,e[4]*=o,e[7]*=n,e[2]*=i,e[5]*=o,e[8]*=n,this},t.prototype.makeScale=function(t,e,i){return this.set(t,0,0,0,e,0,0,0,i)},t.prototype.makeRotationX=function(t){var o=e(t),n=i(t);return this.set(1,0,0,0,o,-n,0,n,o)},t.prototype.makeRotationY=function(t){var o=e(t),n=i(t);return this.set(o,0,n,0,1,0,-n,0,o)},t.prototype.makeRotationZ=function(t){var o=e(t),n=i(t);return this.set(o,-n,0,n,o,0,0,0,1)},t.prototype.fromMat2=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=0,e[3]=i[2],e[4]=i[3],e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},t.prototype.fromMat4=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],this},t.prototype.fromQuat=function(t){var e=this.elements,i=t.x,o=t.y,n=t.z,r=t.w,s=i+i,a=o+o,h=n+n,c=i*s,p=i*a,u=i*h,f=o*a,l=o*h,m=n*h,d=r*s,y=r*a,v=r*h;return e[0]=1-(f+m),e[1]=p+v,e[2]=u-y,e[3]=p-v,e[4]=1-(c+m),e[5]=l+d,e[6]=u+y,e[7]=l-d,e[8]=1-(c+f),this},t.prototype.fromJSON=function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},t.prototype.toJSON=function(t){t||(t={});var e=this.elements,i=t.elements||(t.elements=[]);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],t},t.prototype.toString=function(){var t=this.elements;return"Mat3["+t[0]+", "+t[3]+", "+t[6]+"]\n     ["+t[1]+", "+t[4]+", "+t[7]+"]\n     ["+t[2]+", "+t[5]+", "+t[8]+"]"},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("math/vec4",[],function(){function t(t,e,i,o){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==o?o:1}var e=Math.sqrt;return t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.set=function(t,e,i,o){return this.x=t,this.y=e,this.z=i,this.w=o,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.vadd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},t.prototype.sadd=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},t.prototype.vsub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},t.prototype.ssub=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},t.prototype.mul=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},t.prototype.vmul=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this},t.prototype.smul=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.div=function(t){var e=t.x,i=t.y,o=t.z,n=t.w;return this.x*=0!==e?1/e:0,this.y*=0!==i?1/i:0,this.z*=0!==o?1/o:0,this.w*=0!==n?1/n:0,this},t.prototype.vdiv=function(t,e){var i=e.x,o=e.y,n=e.z,r=e.w;return this.x=0!==i?t.x/i:0,this.y=0!==o?t.y/o:0,this.z=0!==n?t.z/n:0,this.w=0!==r?t.w/r:0,this},t.prototype.sdiv=function(t){return t=0===t?0:1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.length=function(){var t=this.x,i=this.y,o=this.z,n=this.w,r=t*t+i*i+o*o+n*n;return 1===r?1:r>0?e(r):0},t.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z,o=this.w;return t*t+e*e+i*i+o*o},t.prototype.setLength=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*i+o*o+n*n+r*r;return 1===s?(this.x*=t,this.y*=t,this.z*=t,this.w*=t,this):(s=s>0?1/e(s):0,this.x*=s*t,this.y*=s*t,this.z*=s*t,this.w*=s*t,this)
},t.prototype.normalize=function(){var t=this.x,i=this.y,o=this.z,n=this.w,r=t*t+i*i+o*o+n*n;return 1===r?this:(r=r>0?1/e(r):0,this.x*=r,this.y*=r,this.z*=r,this.w*=r,this)},t.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},t.prototype.inverseVec=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=-t.w,this},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},t.prototype.vlerp=function(t,e,i){var o=t.x,n=t.y,r=t.z,s=t.w;return this.x=o+(e.x-o)*i,this.y=n+(e.y-n)*i,this.z=r+(e.z-r)*i,this.w=s+(e.w-s)*i,this},t.vdot=t.prototype.vdot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},t.prototype.min=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,r=t.x,s=t.y,a=t.z,h=this.w;return this.x=e>r?r:e,this.y=i>s?s:i,this.z=o>a?a:o,this.w=n>h?h:n,this},t.prototype.max=function(t){var e=this.x,i=this.y,o=this.z,n=this.w,r=t.x,s=t.y,a=t.z,h=this.w;return this.x=r>e?r:e,this.y=s>i?s:i,this.z=a>o?a:o,this.w=h>n?h:n,this},t.prototype.clamp=function(t,e){var i=this.x,o=this.y,n=this.z,r=this.w,s=t.x,a=t.y,h=t.z,c=t.w,p=e.x,u=e.y,f=e.z,l=l;return this.x=s>i?s:i>p?p:i,this.y=a>o?a:o>u?u:o,this.z=h>n?h:n>f?f:n,this.w=c>r?c:r>l?l:r,this},t.prototype.transformMat4=function(t){var e=t.elements,i=this.x,o=this.y,n=this.z,r=this.w;return this.x=i*e[0]+o*e[4]+n*e[8]+r*e[12],this.y=i*e[1]+o*e[5]+n*e[9]+r*e[13],this.z=i*e[2]+o*e[6]+n*e[10]+r*e[14],this.w=i*e[3]+o*e[7]+n*e[11]+r*e[15],this},t.prototype.fromVec2=function(t){return this.x=t.x,this.y=t.y,this.z=0,this.w=1,this},t.prototype.fromVec3=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=1,this},t.prototype.positionFromMat4=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this},t.prototype.fromJSON=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.toJSON=function(t){return t||(t={}),t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,t},t.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},t.prototype.toArray=function(t){return t||(t=[]),t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t},t.prototype.toString=function(){return"Vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},t}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin",["require","base/audio_ctx","base/class","base/device","base/dom","base/enum","base/event_emitter","base/object_pool","base/request_animation_frame","base/socket.io","base/time","base/util","core/assets/asset","core/assets/asset_loader","core/assets/assets","core/assets/audio_clip","core/assets/sprite_sheet","core/assets/texture","core/components/audio_source","core/components/camera","core/components/camera_2d","core/components/component","core/components/particle_system/particle_system","core/components/sprite_2d","core/components/transform","core/components/transform_2d","core/game/game","core/game/client_game","core/game/config","core/game/log","core/input/handler","core/input/input","core/rendering/canvas_renderer_2d","core/rendering/webgl_renderer_2d","core/enums","core/game_object","core/scene","core/world","math/aabb2","math/aabb3","math/color","math/mat2","math/mat3","math/mat32","math/mat4","math/mathf","math/quat","math/vec2","math/vec3","math/vec4"],function(t){function e(){this.AudioCtx=t("base/audio_ctx"),this.Class=t("base/class"),this.Device=t("base/device"),this.Dom=t("base/dom"),this.Enum=t("base/enum"),this.EventEmitter=t("base/event_emitter"),this.ObjectPool=t("base/object_pool"),this.requestAnimationFrame=t("base/request_animation_frame"),this.io=t("base/socket.io"),this.Time=t("base/time"),this.util=t("base/util"),this.Asset=t("core/assets/asset"),this.AssetLoader=t("core/assets/asset_loader"),this.Assets=t("core/assets/assets"),this.AudioClip=t("core/assets/audio_clip"),this.SpriteSheet=t("core/assets/sprite_sheet"),this.Texture=t("core/assets/texture"),this.AudioSource=t("core/components/audio_source"),this.Camera=t("core/components/camera"),this.Camera2D=t("core/components/camera_2d"),this.Component=t("core/components/component"),this.ParticleSystem=t("core/components/particle_system/particle_system"),this.Sprite2D=t("core/components/sprite_2d"),this.Transform=t("core/components/transform"),this.Transform2D=t("core/components/transform_2d"),this.Game=t("core/game/game"),this.ClientGame=t("core/game/client_game"),this.Config=t("core/game/config"),this.Log=t("core/game/log"),this.Handler=t("core/input/handler"),this.Input=t("core/input/input"),this.CanvasRenderer2D=t("core/rendering/canvas_renderer_2d"),this.WebGLRenderer2D=t("core/rendering/webgl_renderer_2d"),this.Enums=t("core/enums"),this.GameObject=t("core/game_object"),this.Scene=t("core/scene"),this.World=t("core/world"),this.AABB2=t("math/aabb2"),this.AABB3=t("math/aabb3"),this.Color=t("math/color"),this.Mat2=t("math/mat2"),this.Mat3=t("math/mat3"),this.Mat32=t("math/mat32"),this.Mat4=t("math/mat4"),this.Mathf=t("math/mathf"),this.Quat=t("math/quat"),this.Vec2=t("math/vec2"),this.Vec3=t("math/vec3"),this.Vec4=t("math/vec4"),this.Device.mobile&&(window.onerror=function(t,e,i){alert("line: "+i+", page: "+e+"\nmessage: "+t)})}var i=!("undefined"!=typeof window&&window.document),o=!i,n=Object.defineProperty;return n(e.prototype,"isServer",{get:function(){return i}}),n(e.prototype,"isClient",{get:function(){return o}}),e.prototype.globalize=function(){for(var t in this){window[t]=this[t]}window.Odin=this},new e});
//# sourceMappingURL=odin.js.map